<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:27:13 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2018-9-12+AND+created+%3C%3D+2018-9-19+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="6" total="6"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-2221] Type promotions within union schemas cause round trip failures</title>
                <link>https://issues.apache.org/jira/browse/AVRO-2221</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;When using the C# SpecificWriter and SpecificReader with the following write and read schema&#160;any long that is written to the union fails to be round tripped and is instead read back promoted to a double.&lt;/p&gt;

&lt;p&gt;&quot;type&quot;:&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;null&amp;quot;,&amp;quot;double&amp;quot;,&amp;quot;long&amp;quot;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In order to avoid type promotion issues and properly round trip we found we had to re-order the types within our union to&#160;use the following write and read schema.&lt;/p&gt;

&lt;p&gt;&quot;type&quot;:&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;null&amp;quot;,&amp;quot;long&amp;quot;,&amp;quot;double&amp;quot;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We believe this behavior is due to&#160;the type promotion behavior of the PrimitiveSchema.CanRead(Schema) implementation &lt;a href=&quot;https://github.com/apache/avro/blob/5e8168a25494b04ef0aeaf6421a033d7192f5625/lang/csharp/src/apache/main/Schema/PrimitiveSchema.cs&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/blob/5e8168a25494b04ef0aeaf6421a033d7192f5625/lang/csharp/src/apache/main/Schema/PrimitiveSchema.cs&lt;/a&gt;&#160;but&#160;why this occurs isn&apos;t entirely clear based on how we&apos;ve read the spec.&lt;/p&gt;

&lt;p&gt;Potentially relevant sections from the schema resolution rules:&lt;/p&gt;

&lt;p&gt;&quot;To match, one of the following must hold:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;both schemas are arrays whose item types match&lt;/li&gt;
	&lt;li&gt;both schemas are maps whose value types match&lt;/li&gt;
	&lt;li&gt;both schemas are enums whose names match&lt;/li&gt;
	&lt;li&gt;both schemas are fixed whose sizes and names match&lt;/li&gt;
	&lt;li&gt;both schemas are records with the same name&lt;/li&gt;
	&lt;li&gt;either schema is a union&lt;/li&gt;
	&lt;li&gt;both schemas have same primitive type&lt;/li&gt;
	&lt;li&gt;the writer&apos;s schema may be&#160;&lt;em&gt;promoted&lt;/em&gt;&#160;to the reader&apos;s as follows:
	&lt;ul&gt;
		&lt;li&gt;&lt;font color=&quot;#ff0000&quot;&gt;int is promotable to long, float, or double&lt;/font&gt;&lt;/li&gt;
		&lt;li&gt;&lt;font color=&quot;#ff0000&quot;&gt;long is promotable to float or double&lt;/font&gt;&lt;/li&gt;
		&lt;li&gt;&lt;font color=&quot;#ff0000&quot;&gt;float is promotable to double&lt;/font&gt;&lt;/li&gt;
		&lt;li&gt;string is promotable to bytes&lt;/li&gt;
		&lt;li&gt;bytes is promotable to string&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;if both are unions:&lt;/b&gt;&lt;br/&gt;
 The first schema in the reader&apos;s union that matches the selected writer&apos;s union schema is recursively resolved against it. if none match, an error is signalled.&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The current implementation of PrimitiveSchema.CanRead(Schema) appears to greedily match for numeric types only.&lt;/p&gt;

&lt;p&gt;For reference, neither of the following union schemas appeared to have any round trip type promotion issues which may be inconsistent with the spec.&lt;/p&gt;

&lt;p&gt;&quot;type&quot;:&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;null&amp;quot;,&amp;quot;bytes&amp;quot;,&amp;quot;string&amp;quot;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&quot;type&quot;:&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;null&amp;quot;,&amp;quot;string&amp;quot;,&amp;quot;bytes&amp;quot;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Should there be a short circuit in the logic to avoid type promotions within union schemas when the reader and writer schemas are identical?&#160; Or are these type promotions only for numeric types really intentional and just need to be better clarified in the spec to highlight that union schemas must order their types by precedence of type promotions in order to avoid unintended conversions when round tripped?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13184506">AVRO-2221</key>
            <summary>Type promotions within union schemas cause round trip failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nburger">Nathaniel Burger</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Sep 2018 01:41:08 +0000</created>
                <updated>Wed, 12 Sep 2018 01:46:17 +0000</updated>
                                            <version>1.8.2</version>
                                                    <component>csharp</component>
                    <component>spec</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xzof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-2222] Avro C++ documentation is missing code snippets</title>
                <link>https://issues.apache.org/jira/browse/AVRO-2222</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The Apache Avro C++ Documentation page&lt;span class=&quot;error&quot;&gt;&amp;#91;&#185;&amp;#93;&lt;/span&gt; includes an example on how to use Avro with C++ but unfortunately most code snippets are missing, which renders the document unusable.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&#185;&amp;#93;&lt;/span&gt;http://avro.apache.org/docs/1.8.2/api/cpp/html/index.html&lt;/p&gt;</description>
                <environment></environment>
        <key id="13184591">AVRO-2222</key>
            <summary>Avro C++ documentation is missing code snippets</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="da77a">Darryl Green</assignee>
                                    <reporter username="rmam">Rui Maciel</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Sep 2018 12:56:31 +0000</created>
                <updated>Fri, 28 Dec 2018 16:22:28 +0000</updated>
                            <resolved>Tue, 2 Oct 2018 16:18:37 +0000</resolved>
                                    <version>1.8.0</version>
                    <version>1.8.1</version>
                    <version>1.8.2</version>
                    <version>1.8.3</version>
                    <version>1.8.4</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>c++</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="16633719" author="da77a" created="Mon, 1 Oct 2018 08:38:15 +0000"  >&lt;p&gt;This seems to have been broken in a massive 83 file commit that was apparently only supposed to update license files - the 1.7.7 docs are ok, the 1.8.0 and later are broken.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/avro/commit/58f8b341413ef25116bf29d283bd703c3c1a9c2f#diff-4dea549538700173d7a7ba1f02ddcc0e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/commit/58f8b341413ef25116bf29d283bd703c3c1a9c2f#diff-4dea549538700173d7a7ba1f02ddcc0e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The commit removed most of the content of the Doxyfile and in particular removed:&lt;/p&gt;

&lt;p&gt;EXAMPLE_PATH = examples&lt;/p&gt;

&lt;p&gt;Attached patch reinstates that line which results in build.sh doc producing correct (well, with the examples included anyway) docs...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16635777" author="jira-bot" created="Tue, 2 Oct 2018 16:17:22 +0000"  >&lt;p&gt;Commit a943df760f6df520702a54e9b061e98250172c8e in avro&apos;s branch refs/heads/master from Thiruvalluvan M G&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=a943df7&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=a943df7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #338 from apache/&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2222&quot; title=&quot;Avro C++ documentation is missing code snippets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2222&quot;&gt;&lt;del&gt;AVRO-2222&lt;/del&gt;&lt;/a&gt;-doxygen-fix&lt;/p&gt;

&lt;p&gt;Fixed doxygen&lt;/p&gt;</comment>
                            <comment id="16635779" author="thiru_mg" created="Tue, 2 Oct 2018 16:18:37 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=da77a&quot; class=&quot;user-hover&quot; rel=&quot;da77a&quot;&gt;Darryl Green&lt;/a&gt; for the patch. I created a Pull Request and merged:&#160;&lt;a href=&quot;https://github.com/apache/avro/pull/338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/338&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16637762" author="jira-bot" created="Thu, 4 Oct 2018 03:35:24 +0000"  >&lt;p&gt;Commit e83caaf341af5368cf39a461bb5a15fe6108a21b in avro&apos;s branch refs/heads/master from da77a&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=e83caaf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=e83caaf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2222&quot; title=&quot;Avro C++ documentation is missing code snippets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2222&quot;&gt;&lt;del&gt;AVRO-2222&lt;/del&gt;&lt;/a&gt; Avro C++ documentation is missing code snippets&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12941951" name="0001-AVRO-2222-Avro-C-documentation-is-missing-code-snipp.patch" size="592" author="da77a" created="Mon, 1 Oct 2018 08:37:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Oct 2018 08:38:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y073:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-2223] Utf8.equals(String) should pass though to byte comparison</title>
                <link>https://issues.apache.org/jira/browse/AVRO-2223</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Recently when debugging a comparison of two SpecificRecord objects, that we expected were the exact same, I noticed that one of the objects had the Avro Utf8 object for a field while the other was just a java.lang.String. So, the comparison unexpectedly failed when Utf8.equals(java.lang.String) bailed out immediately rather than continuing on with a proper UTF-8 encoding comparison.   &lt;/p&gt;

&lt;p&gt;Maybe this is intentional? Equality should be symmetric and thus java.lang.String.equals(Utf8) would need to return true?&lt;/p&gt;

&lt;p&gt;Or is there an alternative to be used for unit testing that doesn&apos;t require altering the schema definition? &lt;/p&gt;

&lt;p&gt;Note: We couldn&apos;t use compareTo because the schema also has map types, and that throws the error &quot;maps cannot be compared&quot;&lt;/p&gt;

&lt;p&gt;Source code for reference&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (o == &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(o &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Utf8)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;  &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;&amp;lt;----- issue here
&lt;/span&gt;    Utf8 that = (Utf8)o;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.length == that.length)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] thatBytes = that.bytes;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.length; i++)
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (bytes[i] != thatBytes[i])
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13184712">AVRO-2223</key>
            <summary>Utf8.equals(String) should pass though to byte comparison</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cricket007">Jordan Moore</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Sep 2018 20:09:45 +0000</created>
                <updated>Wed, 12 Sep 2018 20:09:45 +0000</updated>
                                            <version>1.8.1</version>
                    <version>1.8.2</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y0xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-2224] Encode uniont types through std::any</title>
                <link>https://issues.apache.org/jira/browse/AVRO-2224</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;With the release of C+&lt;ins&gt;17, standard C&amp;#43;&amp;#43; started supporting &lt;a href=&quot;https://en.cppreference.com/w/cpp/utility/any&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;std::any&lt;/a&gt;.  It would be awesome if Apache Avro could generate C&lt;/ins&gt;+ code that expressed union types through std::any instead of providing an ad-hoc implementation, which would enable using Avro-generated code in a more idiomatic way.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13184819">AVRO-2224</key>
            <summary>Encode uniont types through std::any</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rmam">Rui Maciel</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Sep 2018 08:24:04 +0000</created>
                <updated>Tue, 2 Oct 2018 17:21:08 +0000</updated>
                            <resolved>Tue, 2 Oct 2018 17:21:08 +0000</resolved>
                                    <version>1.8.2</version>
                                                    <component>c++</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="16635845" author="thiru_mg" created="Tue, 2 Oct 2018 17:21:08 +0000"  >&lt;p&gt;This is the duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2037&quot; title=&quot;Use std::any where available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2037&quot;&gt;&lt;del&gt;AVRO-2037&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Oct 2018 17:21:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y1lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-2225] Memory leak in SpecificData class</title>
                <link>https://issues.apache.org/jira/browse/AVRO-2225</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;We are getting memory leak issue in org.apache.avro.specific.SpecificData class due to the cache CTOR_CACHE. The cache size keeps on increasing and there is no way to remove or limit the cache size.&lt;/p&gt;</description>
                <environment>&lt;p&gt;We have deployed the system as bundles in OSGi framework Apache Karaf.&lt;/p&gt;</environment>
        <key id="13184871">AVRO-2225</key>
            <summary>Memory leak in SpecificData class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="simarjot">Simarjot Dahella</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Sep 2018 11:41:43 +0000</created>
                <updated>Thu, 13 Sep 2018 11:41:43 +0000</updated>
                                            <version>1.8.2</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y1wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-2226] UnionSchema deduction is too permissive</title>
                <link>https://issues.apache.org/jira/browse/AVRO-2226</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;When given a schema of the form&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;namespace&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;com.example&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt; : [
&#160;&#160;&#160; {
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;,
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : [&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;]
&#160;&#160;&#160; }
&#160; ]
}
{
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;namespace&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;com.example&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt; : [
&#160;&#160;&#160; {
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;,
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : [&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;]
&#160;&#160;&#160; }
&#160; ]
}
{
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;AOrB&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;namespace&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;com.example&quot;&lt;/span&gt;,
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt; : [
&#160;&#160;&#160; {
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;entity&quot;&lt;/span&gt;,
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : [
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;com.example.A&quot;&lt;/span&gt;,
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;com.example.B&quot;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160; ]
&#160;&#160;&#160; }
&#160; ]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And a datum of the form&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&apos;entity&apos;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is an instance of schema A&apos;&lt;/span&gt;}}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Converting to a message, and then from a message chooses the incorrect `entity` schema:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&apos;entity&apos;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;: None}}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13185147">AVRO-2226</key>
            <summary>UnionSchema deduction is too permissive</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="keatskelleher">Andrew Kelleher</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Sep 2018 13:29:07 +0000</created>
                <updated>Thu, 29 Nov 2018 20:34:17 +0000</updated>
                                            <version>1.8.2</version>
                                                    <component>python</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>3</watches>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="16614851" author="githubbot" created="Fri, 14 Sep 2018 13:38:37 +0000"  >&lt;p&gt;akellehe opened a new pull request #331: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2226&quot; title=&quot;UnionSchema deduction is too permissive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2226&quot;&gt;AVRO-2226&lt;/a&gt; Fixes UnionSchema specificity&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/331&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/331&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Trouble arises in the python library when deducing the appropriate schema from a list of schemas given a particular datum.&lt;/p&gt;

&lt;p&gt;   When &quot;null&quot; values are allowed for fields in two separate schemas, there is no way to differentiate which should schema be used given of a list of schemas that are set as the type definition for a record.&lt;/p&gt;

&lt;p&gt;   This PR checks to ensure all fields defined on a given datum are &lt;em&gt;also&lt;/em&gt; defined in the schema being validated to use for that datum.&lt;/p&gt;

&lt;p&gt;   With this bugfix, datums such as `&lt;/p&gt;
{&quot;foo&quot;: &quot;a&quot;}
&lt;p&gt;` will not &quot;cast&quot; to schemas such as `&lt;/p&gt;
{&quot;name&quot;: &quot;bar&quot;, &quot;type&quot;: [&quot;long&quot;, &quot;null&quot;]}
&lt;p&gt;`, which is currently the case.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16614862" author="githubbot" created="Fri, 14 Sep 2018 13:42:57 +0000"  >&lt;p&gt;akellehe commented on a change in pull request #331: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2226&quot; title=&quot;UnionSchema deduction is too permissive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2226&quot;&gt;AVRO-2226&lt;/a&gt; Fixes UnionSchema specificity&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/331#discussion_r217716914&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/331#discussion_r217716914&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lang/py3/avro/io.py&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -135,9 +135,17 @@ def Validate(expected_schema, datum):&lt;br/&gt;
     return any(Validate(union_branch, datum)&lt;br/&gt;
                for union_branch in expected_schema.schemas)&lt;br/&gt;
   elif schema_type in &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;record&amp;#39;, &amp;#39;error&amp;#39;, &amp;#39;request&amp;#39;&amp;#93;&lt;/span&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (isinstance(datum, dict)&lt;/li&gt;
	&lt;li&gt;and all(Validate(field.type, datum.get(field.name))&lt;/li&gt;
	&lt;li&gt;for field in expected_schema.fields))&lt;br/&gt;
+    if not isinstance(datum, dict):&lt;br/&gt;
+        return False&lt;br/&gt;
+    expected_schema_field_names = set()&lt;br/&gt;
+    for field in expected_schema.fields:&lt;br/&gt;
+        expected_schema_field_names.add(field.name)&lt;br/&gt;
+        if not Validate(field.type, datum.get(field.name)):&lt;br/&gt;
+            return False&lt;br/&gt;
+    for datum_field in datum.keys():&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   This block ensures all fields in the `datum` exist in the `expected_schema`. If they do not then the datum does not validate.&lt;/p&gt;

&lt;p&gt;   A stricter (but incompatible) change would be to create a `Null` type and require that all datum set all null fields to `Null` rather than relying on python&apos;s `None` type. The approach here is probably better for compatibility.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16614912" author="githubbot" created="Fri, 14 Sep 2018 14:18:57 +0000"  >&lt;p&gt;akellehe commented on a change in pull request #331: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2226&quot; title=&quot;UnionSchema deduction is too permissive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2226&quot;&gt;AVRO-2226&lt;/a&gt; Fixes UnionSchema specificity&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/331#discussion_r217716914&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/331#discussion_r217716914&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lang/py3/avro/io.py&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -135,9 +135,17 @@ def Validate(expected_schema, datum):&lt;br/&gt;
     return any(Validate(union_branch, datum)&lt;br/&gt;
                for union_branch in expected_schema.schemas)&lt;br/&gt;
   elif schema_type in &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;record&amp;#39;, &amp;#39;error&amp;#39;, &amp;#39;request&amp;#39;&amp;#93;&lt;/span&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (isinstance(datum, dict)&lt;/li&gt;
	&lt;li&gt;and all(Validate(field.type, datum.get(field.name))&lt;/li&gt;
	&lt;li&gt;for field in expected_schema.fields))&lt;br/&gt;
+    if not isinstance(datum, dict):&lt;br/&gt;
+        return False&lt;br/&gt;
+    expected_schema_field_names = set()&lt;br/&gt;
+    for field in expected_schema.fields:&lt;br/&gt;
+        expected_schema_field_names.add(field.name)&lt;br/&gt;
+        if not Validate(field.type, datum.get(field.name)):&lt;br/&gt;
+            return False&lt;br/&gt;
+    for datum_field in datum.keys():&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   This block ensures all fields in the `datum` exist in the `expected_schema`. If they do not then the datum does not validate against the schema.&lt;/p&gt;

&lt;p&gt;   A stricter (but incompatible) change would be to create a `Null` type and require that all datum set all null fields to `Null` rather than relying on python&apos;s `None` type. The approach here is probably better for compatibility.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16614977" author="githubbot" created="Fri, 14 Sep 2018 15:18:55 +0000"  >&lt;p&gt;juliosantos84 commented on issue #331: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2226&quot; title=&quot;UnionSchema deduction is too permissive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2226&quot;&gt;AVRO-2226&lt;/a&gt; Fixes UnionSchema specificity&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/331#issuecomment-421392234&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/331#issuecomment-421392234&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for figuring this out @akellehe ! We&apos;ve been running into this issue ourselves and could use an official patch to fix this.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16637734" author="githubbot" created="Thu, 4 Oct 2018 02:32:05 +0000"  >&lt;p&gt;kojiromike commented on issue #331: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2226&quot; title=&quot;UnionSchema deduction is too permissive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2226&quot;&gt;AVRO-2226&lt;/a&gt; Fixes UnionSchema specificity&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/331#issuecomment-426865455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/331#issuecomment-426865455&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This looks good to me. I ran the test without the code change and it failed as it should:&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   ======================================================================&lt;br/&gt;
   FAIL: testUnionSchemaSpecificity (avro.tests.test_io.TestIO)&lt;br/&gt;
   ----------------------------------------------------------------------&lt;br/&gt;
   Traceback (most recent call last):&lt;br/&gt;
     File &quot;/home/michaels/avro/lang/py3/avro/tests/test_io.py&quot;, line 371, in testUnionSchemaSpecificity&lt;br/&gt;
       self.assertEqual(datum_to_read, datum_read)&lt;br/&gt;
   AssertionError: {&apos;entity&apos;: {&apos;foo&apos;: &apos;this is an instance of schema A&apos;}} != {&apos;entity&apos;: {&apos;bar&apos;: None}}&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;{&apos;entity&apos;: {&apos;foo&apos;: &apos;this is an instance of schema A&apos;}}&lt;br/&gt;
   + {&apos;entity&apos;: {&apos;bar&apos;: None}}&lt;br/&gt;
   ```&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   then I added the code change back and verified the tests all pass.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16703745" author="githubbot" created="Thu, 29 Nov 2018 20:21:38 +0000"  >&lt;p&gt;dkulp closed pull request #331: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2226&quot; title=&quot;UnionSchema deduction is too permissive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2226&quot;&gt;AVRO-2226&lt;/a&gt; Fixes UnionSchema specificity&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/331&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/331&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/lang/py3/avro/io.py b/lang/py3/avro/io.py&lt;br/&gt;
index b944904ee..7b56dff0f 100644&lt;br/&gt;
&amp;#8212; a/lang/py3/avro/io.py&lt;br/&gt;
+++ b/lang/py3/avro/io.py&lt;br/&gt;
@@ -135,9 +135,17 @@ def Validate(expected_schema, datum):&lt;br/&gt;
     return any(Validate(union_branch, datum)&lt;br/&gt;
                for union_branch in expected_schema.schemas)&lt;br/&gt;
   elif schema_type in &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;record&amp;#39;, &amp;#39;error&amp;#39;, &amp;#39;request&amp;#39;&amp;#93;&lt;/span&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (isinstance(datum, dict)&lt;/li&gt;
	&lt;li&gt;and all(Validate(field.type, datum.get(field.name))&lt;/li&gt;
	&lt;li&gt;for field in expected_schema.fields))&lt;br/&gt;
+    if not isinstance(datum, dict):&lt;br/&gt;
+        return False&lt;br/&gt;
+    expected_schema_field_names = set()&lt;br/&gt;
+    for field in expected_schema.fields:&lt;br/&gt;
+        expected_schema_field_names.add(field.name)&lt;br/&gt;
+        if not Validate(field.type, datum.get(field.name)):&lt;br/&gt;
+            return False&lt;br/&gt;
+    for datum_field in datum.keys():&lt;br/&gt;
+        if datum_field not in expected_schema_field_names:&lt;br/&gt;
+            return False&lt;br/&gt;
+    return True&lt;br/&gt;
   else:&lt;br/&gt;
     raise AvroTypeException(&apos;Unknown Avro schema type: %r&apos; % schema_type)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;diff --git a/lang/py3/avro/tests/test_io.py b/lang/py3/avro/tests/test_io.py&lt;br/&gt;
index 8349ce5c7..3d5868384 100644&lt;br/&gt;
&amp;#8212; a/lang/py3/avro/tests/test_io.py&lt;br/&gt;
+++ b/lang/py3/avro/tests/test_io.py&lt;br/&gt;
@@ -346,6 +346,30 @@ def testTypeException(self):&lt;br/&gt;
     self.assertRaises(&lt;br/&gt;
         avro_io.AvroTypeException, write_datum, datum_to_write, writer_schema)&lt;/p&gt;

&lt;p&gt;+  def testUnionSchemaSpecificity(self):&lt;br/&gt;
+    union_schema = schema.Parse(&quot;&quot;&quot;&lt;br/&gt;
+        [{&lt;br/&gt;
+         &quot;type&quot; : &quot;record&quot;,&lt;br/&gt;
+         &quot;name&quot; : &quot;A&quot;,&lt;br/&gt;
+         &quot;fields&quot; : [&lt;/p&gt;
{&quot;name&quot; : &quot;foo&quot;, &quot;type&quot; : [&quot;string&quot;, &quot;null&quot;]}
&lt;p&gt;]&lt;br/&gt;
+        },&lt;br/&gt;
+        {&lt;br/&gt;
+         &quot;type&quot; : &quot;record&quot;,&lt;br/&gt;
+         &quot;name&quot; : &quot;B&quot;,&lt;br/&gt;
+         &quot;fields&quot; : [&lt;/p&gt;
{&quot;name&quot; : &quot;bar&quot;, &quot;type&quot; : [&quot;string&quot;, &quot;null&quot;]}
&lt;p&gt;]&lt;br/&gt;
+        },&lt;br/&gt;
+        {&lt;br/&gt;
+         &quot;type&quot; : &quot;record&quot;,&lt;br/&gt;
+         &quot;name&quot; : &quot;AOrB&quot;,&lt;br/&gt;
+         &quot;fields&quot; : [&lt;/p&gt;
{&quot;name&quot; : &quot;entity&quot;, &quot;type&quot; : [&quot;A&quot;, &quot;B&quot;]}
&lt;p&gt;]&lt;br/&gt;
+        }]&lt;br/&gt;
+    &quot;&quot;&quot;)&lt;br/&gt;
+    sch = &lt;/p&gt;
{s.name: s for s in union_schema.schemas}
&lt;p&gt;.get(&apos;AOrB&apos;)&lt;br/&gt;
+    datum_to_read = {&apos;entity&apos;: {&apos;foo&apos;: &apos;this is an instance of schema A&apos;}}&lt;br/&gt;
+    writer, encoder, datum_writer = write_datum(datum_to_read, sch)&lt;br/&gt;
+    datum_read = read_datum(writer, sch, sch)&lt;br/&gt;
+    self.assertEqual(datum_to_read, datum_read)&lt;br/&gt;
+&lt;/p&gt;

&lt;p&gt; if _&lt;em&gt;name&lt;/em&gt;_ == &apos;_&lt;em&gt;main&lt;/em&gt;_&apos;:&lt;br/&gt;
   raise Exception(&apos;Use run_tests.py&apos;)&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16703746" author="jira-bot" created="Thu, 29 Nov 2018 20:21:41 +0000"  >&lt;p&gt;Commit 3e5cf4a94dd1f71e42a45c812f26a53c7b89e945 in avro&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=keatskelleher&quot; class=&quot;user-hover&quot; rel=&quot;keatskelleher&quot;&gt;Andrew Kelleher&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=3e5cf4a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=3e5cf4a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2226&quot; title=&quot;UnionSchema deduction is too permissive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2226&quot;&gt;AVRO-2226&lt;/a&gt; Fixes UnionSchema specificity&lt;/p&gt;

&lt;p&gt;Trouble arises in the python library when deducing the appropriate schema from a list of schemas given a particular datum.&lt;/p&gt;

&lt;p&gt;When &quot;null&quot; values are allowed for fields in two separate schemas, there is no way to differentiate which should schema be used given of a list of schemas that are set as the type definition for a record.&lt;/p&gt;

&lt;p&gt;This PR checks to ensure all fields defined on a given datum are &lt;em&gt;also&lt;/em&gt; defined in the schema being validated to use for that datum.&lt;/p&gt;

&lt;p&gt;With this bugfix, datums such as `&lt;/p&gt;
{&quot;foo&quot;: &quot;a&quot;}
&lt;p&gt;` will not &quot;cast&quot; to schemas such as `&lt;/p&gt;
{&quot;name&quot;: &quot;bar&quot;, &quot;type&quot;: [&quot;long&quot;, &quot;null&quot;]}
&lt;p&gt;`, which is currently the case.&lt;/p&gt;</comment>
                            <comment id="16703769" author="githubbot" created="Thu, 29 Nov 2018 20:34:17 +0000"  >&lt;p&gt;akellehe commented on issue #331: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2226&quot; title=&quot;UnionSchema deduction is too permissive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2226&quot;&gt;AVRO-2226&lt;/a&gt; Fixes UnionSchema specificity&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/331#issuecomment-442983359&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/331#issuecomment-442983359&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks, folks! CC: @juliosantos84&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12939731" name="AVRO-2226.patch" size="2264" author="keatskelleher" created="Fri, 14 Sep 2018 13:30:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Sep 2018 13:38:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y3lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>
