<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:17:40 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2012-9-12+AND+created+%3C%3D+2012-9-19+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="13" total="13"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-1157] Idl tool - parse properties as plain String OR expose the property as Json</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1157</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The IDL Tool currently parses &quot;annotations&quot; as Json objects but only really supports textual values.&lt;/p&gt;

&lt;p&gt;If one wants to have actual json annotations, they need to write json as an escaped json string.&lt;/p&gt;

&lt;p&gt;Proposed solutions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;expose the property as Json if it&apos;s parsed as Json&lt;/li&gt;
	&lt;li&gt;OR  parse the property as a string&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12607272">AVRO-1157</key>
            <summary>Idl tool - parse properties as plain String OR expose the property as Json</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cutting">Doug Cutting</assignee>
                                    <reporter username="onetoinfinity@yahoo.com">Cristian Opris</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Sep 2012 17:17:51 +0000</created>
                <updated>Mon, 10 Dec 2012 17:57:36 +0000</updated>
                            <resolved>Thu, 1 Nov 2012 17:44:07 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.3</fixVersion>
                                    <component>java</component>
                    <component>spec</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13454182" author="cutting" created="Wed, 12 Sep 2012 18:03:29 +0000"  >&lt;p&gt;Current IDL annotations are both Json strings (for Schema properties) and Json arrays of strings (for aliases).  So we cannot simply parse all annotations as strings, as that would break aliases.  Also, we&apos;d still need some sort of string escaping.&lt;/p&gt;

&lt;p&gt;The feature you seem to want is an improved ability to specify a schema or protocol property whose value is Json.  This would mostly require Schema and Protocol API changes.  We might:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;change Schema&apos;s props field from Map&amp;lt;String,String&amp;gt; to Map&amp;lt;String,JsonNode&amp;gt;.&lt;/li&gt;
	&lt;li&gt;change Schema#addProp(String,String) to create a Json TextNode.&lt;/li&gt;
	&lt;li&gt;change Schema#getProp(String) to, if the value isTextual(), return the String otherwise return null.&lt;/li&gt;
	&lt;li&gt;deprecate Schema#getProps() and change its implementation to return the subset with string values.&lt;/li&gt;
	&lt;li&gt;add a new method, &apos;void Schema#getJsonProp(String, JsonNode)&apos;&lt;/li&gt;
	&lt;li&gt;add a new method, &apos;JsonNode Schema#getJsonProp(String)&apos;&lt;/li&gt;
	&lt;li&gt;add a new method, &apos;Map&amp;lt;String,JsonNode&amp;gt; Schema#getJsonProps()&apos;&lt;/li&gt;
	&lt;li&gt;make similar updates to the Protocol API.&lt;/li&gt;
	&lt;li&gt;update the IDL parser to use these new APIs.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Can you give an example of a Json-valued Schema or Protocol property that you&apos;re using, in order to help motivate such a change?&lt;/p&gt;</comment>
                            <comment id="13454298" author="onetoinfinity@yahoo.com" created="Wed, 12 Sep 2012 19:59:55 +0000"  >&lt;p&gt;I wasn&apos;t aware of aliases, in fact I was actually wondering what the rationale behind parsing props as Json was if it returns a string in the end.&lt;/p&gt;

&lt;p&gt;I&apos;m looking into having structured annotations, same as in Java. &lt;/p&gt;

&lt;p&gt;I could then use Avro as a cross-language schema def format with metadata, instead of Java interfaces. &lt;/p&gt;

&lt;p&gt;Say I want to map an &quot;entity&quot; type record  to cassandra, currently I need to do this:&lt;/p&gt;

&lt;p&gt;	        @Entity(&quot;&lt;/p&gt;
{\&quot;columnFamily\&quot;:\&quot;test\&quot;}
&lt;p&gt;&quot;)&lt;br/&gt;
		record TestEntity {&lt;br/&gt;
			@Id(&quot;&lt;/p&gt;
{\&quot;column\&quot;:\&quot;id\&quot;}
&lt;p&gt;&quot;)&lt;br/&gt;
			int id;&lt;/p&gt;

&lt;p&gt;	   		@Column(&quot;&lt;/p&gt;
{\&quot;column\&quot;:\&quot;name\&quot;}
&lt;p&gt;&quot;)&lt;br/&gt;
			string name;&lt;br/&gt;
		}&lt;/p&gt;

&lt;p&gt;Note the ugly escaping&lt;/p&gt;

&lt;p&gt;The proposed changes are what I had in mind, I can see this being generic enough to be useful for other people as well. &lt;/p&gt;</comment>
                            <comment id="13454302" author="onetoinfinity@yahoo.com" created="Wed, 12 Sep 2012 20:02:37 +0000"  >&lt;p&gt;A simple hack to allow this and keep API compatibility would be to do something like:&lt;/p&gt;

&lt;p&gt; value.toJsonString() &lt;/p&gt;

&lt;p&gt;instead of &lt;/p&gt;

&lt;p&gt;if (value.isTextual())&lt;br/&gt;
      return value.getTextValue();&lt;br/&gt;
throw error(key+&quot; property must be textual: &quot;+value, token);&lt;/p&gt;

&lt;p&gt;in Idl.getTextProp()&lt;/p&gt;


</comment>
                            <comment id="13454402" author="cutting" created="Wed, 12 Sep 2012 21:47:50 +0000"  >&lt;p&gt;The problem with value.toString() alone is that then textual values would have quotes around them.  But we might try something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value.isTextual() ? value.getTextValue() : value.toString();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With that you should be able to add Json-format annotations without so many escapes, e.g.:&lt;br/&gt;
@Entity(&lt;/p&gt;
{&quot;column&quot;:&quot;id&quot;}
&lt;p&gt;)&lt;/p&gt;

&lt;p&gt;The value stored in the schema would always be a string, and sometimes it would be a string that&apos;s Json and sometimes not, just like today.&lt;/p&gt;</comment>
                            <comment id="13454907" author="onetoinfinity@yahoo.com" created="Thu, 13 Sep 2012 14:04:37 +0000"  >&lt;p&gt;Yeah, I think that&apos;s a reasonable solution, is there a chance this could make it in a patch ?&lt;/p&gt;

&lt;p&gt;Thanks vm&lt;/p&gt;</comment>
                            <comment id="13455063" author="cutting" created="Thu, 13 Sep 2012 17:48:56 +0000"  >&lt;p&gt;Here&apos;s a patch that implements this.  However note how strange the addition to simple.avpr looks.  If we really want to support complex Json annotations then we should really extend the APIs of Protocol, Schema, and Field.&lt;/p&gt;

&lt;p&gt;What&apos;s the motivating use case?  In the examples you provide above, why can&apos;t you simply use something like, @EntityColumnFamily(&quot;test&quot;), @ColumnId(&quot;id&quot;) and @ColumnName(&quot;name&quot;)?&lt;/p&gt;</comment>
                            <comment id="13455721" author="onetoinfinity@yahoo.com" created="Fri, 14 Sep 2012 10:55:55 +0000"  >&lt;p&gt;Personally I would go the whole way and add support for Json props to schema, protocol, etc. I suggested the toString() solution as a quick solution only.&lt;/p&gt;

&lt;p&gt;What I was trying to do is to have stuctured annotations and parse those against a schema themselves (similar to how Java defines annotations as a kind of interface)&lt;/p&gt;

&lt;p&gt;I could have a separate annotation for each piece of meta information as you suggest, but this is kind of nasty if I have lots of stuff to put in there.&lt;/p&gt;

&lt;p&gt;The same argument would go agains @aliases, why did you decide to go with an array of values instead of multiple @alias annotations ??&lt;/p&gt;

&lt;p&gt;My point is the current behaviour is inconsistent and rather odd...&lt;/p&gt;</comment>
                            <comment id="13455980" author="cutting" created="Fri, 14 Sep 2012 17:50:11 +0000"  >&lt;p&gt;&amp;gt; My point is the current behaviour is inconsistent and rather odd...&lt;/p&gt;

&lt;p&gt;I think of it as consistent but limited.  The syntax for annotations is consistently JSon but the implementation is limited in that it currently ignores annotations that are not strings, or, in the case of aliases, arrays of strings.  It&apos;s designed so that we can add support for full Json annotations without breaking anything.  If we made the quick fix discussed above then we&apos;d have a harder time subsequently adding real support for Json annotations without breaking applications.&lt;/p&gt;

&lt;p&gt;I agree that adding full support for Json annotations to Protocol, Schema and Field would be an improvement.  I&apos;ll try to create a patch that implements this when I have a chance and if someone else doesn&apos;t do so first.&lt;/p&gt;</comment>
                            <comment id="13456962" author="onetoinfinity@yahoo.com" created="Mon, 17 Sep 2012 12:15:59 +0000"  >&lt;p&gt;Thank you Doug, that would be brilliant. I could try and put something together and submit it, have to see if I&apos;m actually allowed to first&lt;/p&gt;</comment>
                            <comment id="13488183" author="cutting" created="Wed, 31 Oct 2012 20:08:31 +0000"  >&lt;p&gt;Here&apos;s a patch that adds support for arbitrary Json as property values.  This is supported in both Idl and through the Schema and Protocol APIs.&lt;/p&gt;</comment>
                            <comment id="13488185" author="cutting" created="Wed, 31 Oct 2012 20:09:37 +0000"  >&lt;p&gt;These changes are all back-compatible, so we could include it in 1.7.3.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this soon unless there are objections.&lt;/p&gt;</comment>
                            <comment id="13488873" author="cutting" created="Thu, 1 Nov 2012 17:44:07 +0000"  >&lt;p&gt;I committed this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12614027">AVRO-1186</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12551617" name="AVRO-1157.patch" size="27547" author="cutting" created="Wed, 31 Oct 2012 20:08:31 +0000"/>
                            <attachment id="12545008" name="AVRO-1157.patch" size="4021" author="cutting" created="Thu, 13 Sep 2012 17:48:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 12 Sep 2012 18:03:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253505</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0dog7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>77890</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1158] Avro-C: Infinite Loop in Deflate Codec Decompression</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1158</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;If an avro datafile contains corrupted or incomplete deflate data in a block, the deflate codec can go into an infinite loop as we do not check if inflation only partially occurred.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12607387">AVRO-1158</key>
            <summary>Avro-C: Infinite Loop in Deflate Codec Decompression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lmartinking">Lucas Martin-King</reporter>
                        <labels>
                            <label>codec</label>
                            <label>deflate</label>
                    </labels>
                <created>Thu, 13 Sep 2012 02:44:23 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:14 +0000</updated>
                            <resolved>Thu, 13 Sep 2012 21:21:10 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>c</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13454589" author="lmartinking" created="Thu, 13 Sep 2012 02:48:28 +0000"  >&lt;p&gt;Patch resolving the issue.&lt;/p&gt;</comment>
                            <comment id="13454597" author="lmartinking" created="Thu, 13 Sep 2012 02:58:50 +0000"  >&lt;p&gt;This patch is placed into the public domain by Experian Hitwise Pty. Ltd.&lt;/p&gt;</comment>
                            <comment id="13455312" author="dcreager" created="Thu, 13 Sep 2012 21:21:10 +0000"  >&lt;p&gt;Looks good.  Merged into SVN.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544927" name="codec_deflate_fixes.patch" size="2195" author="lmartinking" created="Thu, 13 Sep 2012 02:58:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Sep 2012 21:21:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253706</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1159] Avro-C: read_union_value does not check discriminant</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1159</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Currently read_union_value() in value-read.c does not check if the discriminant it reads is valid in any way.&lt;/p&gt;

&lt;p&gt;This can lead to SEGFAULTs after the use of avro_value_set_branch() as read_value() will attempt to read beyond or behind our dataum in memory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607388">AVRO-1159</key>
            <summary>Avro-C: read_union_value does not check discriminant</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lmartinking">Lucas Martin-King</reporter>
                        <labels>
                            <label>segfault</label>
                            <label>union</label>
                    </labels>
                <created>Thu, 13 Sep 2012 02:54:41 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:12 +0000</updated>
                            <resolved>Thu, 13 Sep 2012 21:25:07 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>c</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13454595" author="lmartinking" created="Thu, 13 Sep 2012 02:57:55 +0000"  >&lt;p&gt;A patch resolving the issue is hereby placed into the public domain by Experian Hitwise Pty. Ltd.&lt;/p&gt;</comment>
                            <comment id="13455319" author="dcreager" created="Thu, 13 Sep 2012 21:25:07 +0000"  >&lt;p&gt;Merged into SVN&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544926" name="union_discriminant_check.patch" size="952" author="lmartinking" created="Thu, 13 Sep 2012 02:57:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Sep 2012 21:25:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4pb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80524</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1160] Avro-C: avrocat can report read errors</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1160</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Currently avrocat does not report any errors resulting from avro_file_reader_read_value().&lt;/p&gt;

&lt;p&gt;Currently avro_file_reader_read_value() doesn&apos;t report if we reach EOF, due to lower level error reporting limitations in Avro C. Instead, we check if we have reached EOF before reporting any errors. This is a bit rudimentary, however we at least get some indication of errors.&lt;/p&gt;

&lt;p&gt;I have reworked avrocat to always use avro_file_reader_fp().&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607390">AVRO-1160</key>
            <summary>Avro-C: avrocat can report read errors</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lmartinking">Lucas Martin-King</reporter>
                        <labels>
                            <label>avrocat</label>
                    </labels>
                <created>Thu, 13 Sep 2012 03:05:10 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:14 +0000</updated>
                            <resolved>Thu, 13 Sep 2012 21:29:17 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>c</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13454600" author="lmartinking" created="Thu, 13 Sep 2012 03:06:19 +0000"  >&lt;p&gt;This patch is hereby placed into the public domain by Experian Hitwise Pty. Ltd.&lt;/p&gt;</comment>
                            <comment id="13455329" author="dcreager" created="Thu, 13 Sep 2012 21:29:17 +0000"  >&lt;p&gt;I updated this patch to only close the FILE if we opened it; we won&apos;t try to close the stdin stream.  Merged into SVN.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544928" name="0001-Make-avrocatreportanyerrorsduringreading.patch" size="1601" author="lmartinking" created="Thu, 13 Sep 2012 03:06:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Sep 2012 21:29:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253708</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4pj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80525</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1161] Avro-C: Memory Leak in avro_schema_record()</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1161</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;There seems to be a bug in the use of avro_schema_record() within the datafile reader. I&apos;m currently investigating this myself, and can hopefully submit a patch soon, however I am wondering if there is anything I am forgetting to do when using the Avro API?&lt;/p&gt;

&lt;p&gt;Our program is opening and closing lots of log files, and Valgrind gives me this message:&lt;/p&gt;

&lt;p&gt;==20151== 32,518 (48 direct, 32,470 indirect) bytes in 1 blocks are definitely lost in loss record 62 of 65&lt;br/&gt;
==20151==    at 0x4C2BFCB: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)&lt;br/&gt;
==20151==    by 0x4C2C27F: realloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)&lt;br/&gt;
==20151==    by 0x4E3D074: avro_default_allocator (allocation.c:36)&lt;br/&gt;
==20151==    by 0x4E60F8C: avro_schema_record (schema.c:558)&lt;br/&gt;
==20151==    by 0x4E61A5E: avro_schema_from_json_t (schema.c:856)&lt;br/&gt;
==20151==    by 0x4E622E9: avro_schema_from_json_root (schema.c:1083)&lt;br/&gt;
==20151==    by 0x4E624C9: avro_schema_from_json_length (schema.c:1127)&lt;br/&gt;
==20151==    by 0x4E3FE92: file_read_header (datafile.c:314)&lt;br/&gt;
==20151==    by 0x4E40796: avro_file_reader_fp (datafile.c:491)&lt;br/&gt;
==20151==    by 0x4082D3: LogReader::LogReader(_IO_FILE*, char const*) (LogReader.cpp:32)&lt;br/&gt;
==20151==    by 0x4066A3: main (main.cpp:206)&lt;/p&gt;

&lt;p&gt;A similar report can be reproduced when using avrocat on a single avro file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607405">AVRO-1161</key>
            <summary>Avro-C: Memory Leak in avro_schema_record()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lmartinking">Lucas Martin-King</reporter>
                        <labels>
                            <label>memory_leak</label>
                    </labels>
                <created>Thu, 13 Sep 2012 06:27:09 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:13 +0000</updated>
                            <resolved>Mon, 17 Sep 2012 23:28:28 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>c</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13455528" author="lmartinking" created="Fri, 14 Sep 2012 01:49:00 +0000"  >&lt;p&gt;Upon further investigation, this is merely a side effect of the fact that somewhere within datafile.c or schema.c, an avro_schema_decref() is not being performed.&lt;/p&gt;

&lt;p&gt;If I add an additional avro_schema_decref() to avro_file_reader_close(), then the leak is resolved, as the refcount will be zero the on the 2nd call, thus freeing up the schema. However, this is the band-aid solution, and I&apos;m going to try and find where the decref call is missing from.&lt;/p&gt;</comment>
                            <comment id="13455610" author="mpugachev" created="Fri, 14 Sep 2012 06:44:59 +0000"  >&lt;p&gt;Lucas, can you create a test for this problem? I&apos;ll try to investigate it too.&lt;/p&gt;</comment>
                            <comment id="13456713" author="lmartinking" created="Mon, 17 Sep 2012 00:18:44 +0000"  >&lt;p&gt;Hi Pugachev,&lt;/p&gt;

&lt;p&gt;Using avrocat itself can recreate the condition. What I believe is that there is a bug in Avrocat (and we wrote our internal code after looking at avrocat.c for documentation) where it does not do an avro_schema_decref() after using avro_file_get_writer_schema() to acquire the schema of the input file.&lt;/p&gt;

&lt;p&gt;After calling avro_file_reader_close() there is still one reference to the schema, so calling avro_schema_decref() after decreffing the value and iface will release that memory, stopping the leak.&lt;/p&gt;

&lt;p&gt;So my question is: Should we be decreffing that schema (the writers_schema member in avro_file_reader_t struct), or should it be decreffed somewhere else?&lt;/p&gt;</comment>
                            <comment id="13456997" author="mpugachev" created="Mon, 17 Sep 2012 13:21:44 +0000"  >&lt;p&gt;My gut feeling: this is a bug in avrocat (and friends like avropipe, avroappend and avromod) and schema should be decrefed.&lt;/p&gt;</comment>
                            <comment id="13457454" author="dcreager" created="Mon, 17 Sep 2012 23:09:46 +0000"  >&lt;p&gt;That seems right to me &#8212; if you look at the definition of avro_file_reader_get_writer_schema, it calls avro_schema_incref before returning.  (That way the schema that&apos;s returned can outlast the file object.)  So it&apos;s the caller&apos;s responsibility to decref the result.&lt;/p&gt;

&lt;p&gt;Here&apos;s a patch that updates all four of the command-line programs to do that.&lt;/p&gt;</comment>
                            <comment id="13457467" author="dcreager" created="Mon, 17 Sep 2012 23:24:19 +0000"  >&lt;p&gt;Previous patch had a syntax error.  Here&apos;s a working one.&lt;/p&gt;</comment>
                            <comment id="13457469" author="dcreager" created="Mon, 17 Sep 2012 23:28:28 +0000"  >&lt;p&gt;Merged into SVN&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545495" name="0001-AVRO-1161.-C-Fix-memory-leak-in-avro-append-cat-mod-.patch" size="2073" author="dcreager" created="Mon, 17 Sep 2012 23:24:19 +0000"/>
                            <attachment id="12545493" name="0001-AVRO-1161.-C-Fix-memory-leak-in-avro-append-cat-mod-.patch" size="2072" author="dcreager" created="Mon, 17 Sep 2012 23:09:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Sep 2012 06:44:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253709</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4pr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80526</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1162] AvroKeyValueOutputFormat doesn&apos;t support serialization of data using reflection </title>
                <link>https://issues.apache.org/jira/browse/AVRO-1162</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;When setting up a map/reduce job with the AvroKeyValueOutputFormat, using Reflection to create the schema and AvroValue to wrap the data objects to serialize, I get a ClassCastException because the datum is the object and not an instance of IndexedRecord.&lt;/p&gt;

&lt;p&gt;I think that AvroKeyValueRecordWriter should create a &lt;tt&gt;ReflectDatumWriter&lt;/tt&gt; much like AvroKeyRecordWriter does instead of a &lt;tt&gt;GenericDatumWriter&lt;/tt&gt;, right?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607520">AVRO-1162</key>
            <summary>AvroKeyValueOutputFormat doesn&apos;t support serialization of data using reflection </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alexandre.normand">Alexandre Normand</assignee>
                                    <reporter username="alexandre.normand">Alexandre Normand</reporter>
                        <labels>
                            <label>java</label>
                            <label>newbie</label>
                    </labels>
                <created>Thu, 13 Sep 2012 21:15:25 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:12 +0000</updated>
                            <resolved>Thu, 13 Sep 2012 23:41:28 +0000</resolved>
                                    <version>1.7.2</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13455305" author="alexandre.normand" created="Thu, 13 Sep 2012 21:17:41 +0000"  >&lt;p&gt;I&apos;ve tested with this patch that just changes GenericDatumWriter to ReflectDatumWriter in AvroKeyValueRecordWriter. &lt;/p&gt;</comment>
                            <comment id="13455308" author="cutting" created="Thu, 13 Sep 2012 21:19:10 +0000"  >&lt;p&gt;Did you intend to attach the patch?&lt;/p&gt;</comment>
                            <comment id="13455318" author="alexandre.normand" created="Thu, 13 Sep 2012 21:25:02 +0000"  >&lt;p&gt;Yes, sorry about that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13455335" author="cutting" created="Thu, 13 Sep 2012 21:35:50 +0000"  >&lt;p&gt;This looks reasonable to me.  Can you please add a test that fails without it?&lt;/p&gt;</comment>
                            <comment id="13455362" author="alexandre.normand" created="Thu, 13 Sep 2012 22:13:49 +0000"  >&lt;p&gt;This patch includes a new test in &lt;tt&gt;TestAvroKeyValueRecordWriter&lt;/tt&gt; that fails before the fix but is successful with the change.&lt;/p&gt;</comment>
                            <comment id="13455445" author="cutting" created="Thu, 13 Sep 2012 23:41:28 +0000"  >&lt;p&gt;I committed this.  Thanks, Alexandre.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545068" name="AVRO-1162.patch" size="4136" author="alexandre.normand" created="Thu, 13 Sep 2012 22:13:49 +0000"/>
                            <attachment id="12545056" name="AVRO-1162.patch" size="1179" author="alexandre.normand" created="Thu, 13 Sep 2012 21:25:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Sep 2012 21:19:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253710</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4pz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80527</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1163] Memory leak in avro_fixed_private() function</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1163</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;There is a memory leak in error checking code inside avro_fixed_private().&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607629">AVRO-1163</key>
            <summary>Memory leak in avro_fixed_private() function</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mpugachev">Pugachev Maxim</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Sep 2012 12:45:52 +0000</created>
                <updated>Mon, 10 Dec 2012 17:57:38 +0000</updated>
                            <resolved>Fri, 30 Nov 2012 09:54:32 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.3</fixVersion>
                                    <component>c</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13455758" author="mpugachev" created="Fri, 14 Sep 2012 12:46:30 +0000"  >&lt;p&gt;Patch for this issue.&lt;/p&gt;</comment>
                            <comment id="13506872" author="cutting" created="Thu, 29 Nov 2012 22:14:14 +0000"  >&lt;p&gt;Can someone familiar with Avro C please have a look at this?  Thanks!&lt;/p&gt;</comment>
                            <comment id="13507216" author="brucem" created="Fri, 30 Nov 2012 09:30:27 +0000"  >&lt;p&gt;This looks correct to me. Will commit shortly.&lt;/p&gt;</comment>
                            <comment id="13507222" author="brucem" created="Fri, 30 Nov 2012 09:40:08 +0000"  >&lt;p&gt;Committed in 1415558.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545140" name="AVRO-1163.patch" size="518" author="mpugachev" created="Fri, 14 Sep 2012 12:46:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Nov 2012 22:14:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253711</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80528</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1164] Avro-C: Deallocate resources used in test_avro_schema.c</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1164</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;There are a few resources that are allocated in test_avro_schema.c that are not deallocated. This minor fix deallocates these resources. Specifically - a file pointer, a directory entry and a schema that were allocated are now also deallocated.&lt;/p&gt;

&lt;p&gt;These resources leaks can be seen using valgrind. However, fixing these issues doesn&apos;t resolve all valgrind issues, since there are other bugs that need to be resolved (e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;) before all valgrind issues can be resolved.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu Linux 11.04&lt;/p&gt;</environment>
        <key id="12607676">AVRO-1164</key>
            <summary>Avro-C: Deallocate resources used in test_avro_schema.c</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="vnadkarni">Vivek Nadkarni</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Sep 2012 17:12:55 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:13 +0000</updated>
                            <resolved>Mon, 17 Sep 2012 23:13:56 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>c</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="13455953" author="vnadkarni" created="Fri, 14 Sep 2012 17:16:26 +0000"  >&lt;p&gt;Patch to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1164&quot; title=&quot;Avro-C: Deallocate resources used in test_avro_schema.c&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1164&quot;&gt;&lt;del&gt;AVRO-1164&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13455954" author="vnadkarni" created="Fri, 14 Sep 2012 17:17:11 +0000"  >&lt;p&gt;Submit patch for review.&lt;/p&gt;</comment>
                            <comment id="13457458" author="dcreager" created="Mon, 17 Sep 2012 23:13:56 +0000"  >&lt;p&gt;Merged into SVN&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545175" name="AVRO-1164.patch" size="792" author="vnadkarni" created="Fri, 14 Sep 2012 17:16:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Sep 2012 23:13:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253712</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4qf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Trivial - clean up resources after use in test_avro_schema.c.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1165] Avro-C: Memory leak in value iface containing AVRO_LINK.</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1165</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;A memory leak can be seen when the following matched pair of commands is called, using a schema containing an AVRO_LINK. This pair of commands constructs a class (value iface) from a schema and then destroys the constructed class.&lt;/p&gt;

&lt;p&gt;    record_class = avro_generic_class_from_schema( schema );&lt;br/&gt;
    avro_value_iface_decref( record_class );&lt;/p&gt;

&lt;p&gt;If schema contains an AVRO_LINK, then avro_generic_class_from_schema() calls avro_generic_link_class(), which calls avro_schema_incref() on the AVRO_LINK target schema and assigns the target schema pointer to the iface-&amp;gt;schema.&lt;/p&gt;

&lt;p&gt;When we subsequently call avro_value_iface_decref() to deallocate the class, this function calls avro_generic_link_decref_iface(), which frees the memory for the link interface without calling avro_schema_decref() on the target schema pointed to by iface-&amp;gt;schema.&lt;/p&gt;

&lt;p&gt;Thus the memory of the target schema is leaked when we create and destroy a value interface for an AVRO_LINK. &lt;/p&gt;

&lt;p&gt;Calling avro_schema_decref() on the the target schema (iface-&amp;gt;schema) before calling avro_freet() on the iface fixes this memory leak.&lt;/p&gt;

&lt;p&gt;Note: The pair of commands shown above results in a memory leak, when we create and destroy a value interface from &lt;b&gt;any&lt;/b&gt; schema containing an AVRO_LINK, regardless of whether it is recursive or not. There is a separate issue regarding memory leaks with recursive schemas described in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;. The fix for this issue can only be tested with non-recursive schemas containing AVRO_LINKs until &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; is fixed.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu Linux 11.10&lt;/p&gt;</environment>
        <key id="12607687">AVRO-1165</key>
            <summary>Avro-C: Memory leak in value iface containing AVRO_LINK.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="vnadkarni">Vivek Nadkarni</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Sep 2012 17:40:00 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:13 +0000</updated>
                            <resolved>Mon, 17 Sep 2012 23:19:09 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>c</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13455998" author="vnadkarni" created="Fri, 14 Sep 2012 18:20:41 +0000"  >&lt;p&gt;This patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1165&quot; title=&quot;Avro-C: Memory leak in value iface containing AVRO_LINK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1165&quot;&gt;&lt;del&gt;AVRO-1165&lt;/del&gt;&lt;/a&gt;-TEST.patch) provides a test that shows the memory leak, when the test program in the patch is run through valgrind. &lt;/p&gt;

&lt;p&gt;To validate &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1165&quot; title=&quot;Avro-C: Memory leak in value iface containing AVRO_LINK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1165&quot;&gt;&lt;del&gt;AVRO-1165&lt;/del&gt;&lt;/a&gt;, run this test program through valgrind before and after applying the &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1165&quot; title=&quot;Avro-C: Memory leak in value iface containing AVRO_LINK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1165&quot;&gt;&lt;del&gt;AVRO-1165&lt;/del&gt;&lt;/a&gt;-FIX.patch. Before the applying the fix valgrind will show memory leaks, and after the fix it will not.&lt;/p&gt;

&lt;p&gt;The specific valgrind commandline to use from the avro-trunk/lang/c/tests directory is: valgrind -v --track-origins=yes --leak-check=full --show-reachable = yes ../build/tests/test_avro_1165&lt;/p&gt;
</comment>
                            <comment id="13456011" author="vnadkarni" created="Fri, 14 Sep 2012 18:28:54 +0000"  >&lt;p&gt;This fix (&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1165&quot; title=&quot;Avro-C: Memory leak in value iface containing AVRO_LINK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1165&quot;&gt;&lt;del&gt;AVRO-1165&lt;/del&gt;&lt;/a&gt;-FIX.patch) decrements the reference count of the target schema of an AVRO_LINK before deallocating the AVRO_LINK value interface.&lt;/p&gt;

&lt;p&gt;Before the fix is applied, valgrind shows the following output:&lt;/p&gt;

&lt;p&gt;==6697== 1,410 (24 direct, 1,386 indirect) bytes in 1 blocks are definitely lost in loss record 12 of 12&lt;br/&gt;
==6697==    at 0x4C28F9F: malloc (vg_replace_malloc.c:236)&lt;br/&gt;
==6697==    by 0x4C29019: realloc (vg_replace_malloc.c:525)&lt;br/&gt;
==6697==    by 0x413494: avro_default_allocator (allocation.c:36)&lt;br/&gt;
==6697==    by 0x40AE84: avro_schema_link (schema.c:663)&lt;br/&gt;
==6697==    by 0x40B467: avro_schema_from_json_t (schema.c:786)&lt;br/&gt;
==6697==    by 0x40B80A: avro_schema_from_json_t (schema.c:888)&lt;br/&gt;
==6697==    by 0x40BE97: avro_schema_from_json_root (schema.c:1083)&lt;br/&gt;
==6697==    by 0x40BFA2: avro_schema_from_json (schema.c:1108)&lt;br/&gt;
==6697==    by 0x404A1F: main (test_avro_1165.c:56)&lt;br/&gt;
==6697== &lt;br/&gt;
==6697== LEAK SUMMARY:&lt;br/&gt;
==6697==    definitely lost: 48 bytes in 2 blocks&lt;br/&gt;
==6697==    indirectly lost: 1,386 bytes in 14 blocks&lt;br/&gt;
==6697==      possibly lost: 0 bytes in 0 blocks&lt;br/&gt;
==6697==    still reachable: 0 bytes in 0 blocks&lt;br/&gt;
==6697==         suppressed: 0 bytes in 0 blocks&lt;/p&gt;


&lt;p&gt;After the fix is applied, valgrind shows the following output:&lt;/p&gt;

&lt;p&gt;==7247== HEAP SUMMARY:&lt;br/&gt;
==7247==     in use at exit: 0 bytes in 0 blocks&lt;br/&gt;
==7247==   total heap usage: 180 allocs, 180 frees, 9,563 bytes allocated&lt;br/&gt;
==7247== &lt;br/&gt;
==7247== All heap blocks were freed &amp;#8211; no leaks are possible&lt;br/&gt;
==7247== &lt;br/&gt;
==7247== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 4 from 4)&lt;/p&gt;</comment>
                            <comment id="13456014" author="vnadkarni" created="Fri, 14 Sep 2012 18:30:34 +0000"  >&lt;p&gt;The patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1165&quot; title=&quot;Avro-C: Memory leak in value iface containing AVRO_LINK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1165&quot;&gt;&lt;del&gt;AVRO-1165&lt;/del&gt;&lt;/a&gt; is now available for review and for merging with the trunk. &lt;/p&gt;</comment>
                            <comment id="13457463" author="dcreager" created="Mon, 17 Sep 2012 23:19:09 +0000"  >&lt;p&gt;Merged into SVN&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545188" name="AVRO-1165-FIX.patch" size="567" author="vnadkarni" created="Fri, 14 Sep 2012 18:28:54 +0000"/>
                            <attachment id="12545185" name="AVRO-1165-TEST.patch" size="3365" author="vnadkarni" created="Fri, 14 Sep 2012 18:20:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Sep 2012 23:19:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80530</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>C: Fix memory leak in value iface containing AVRO_LINKs.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1166] IDL return type of map&lt;record&gt; fails in schema processing</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1166</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;An IDL construct such as ...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Foo.idl&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;protocol MyService {
    record Bar {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;     count;
        string  message;
    }

    map&amp;lt;Bar&amp;gt; getBars();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;generates run-time errors because of this code in SpecificData.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;SpecificData.java lines 189-196&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Map.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;isAssignableFrom(raw)) {   &lt;span class=&quot;code-comment&quot;&gt;// map
&lt;/span&gt;        java.lang.reflect.Type key = params[0];
        java.lang.reflect.Type value = params[1];
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(type &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;
              &amp;amp;&amp;amp; CharSequence.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;isAssignableFrom((&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;)type)))
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AvroTypeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Map key &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;not CharSequence: &quot;&lt;/span&gt;+key);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Schema.createMap(createSchema(value, names));
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the issue is that CharSequence.class.isAssignableFrom((Class)type)) should really be CharSequence.class.isAssignableFrom((Class)&lt;b&gt;key&lt;/b&gt;))&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607704">AVRO-1166</key>
            <summary>IDL return type of map&lt;record&gt; fails in schema processing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gffletch">George Fletcher</assignee>
                                    <reporter username="gffletch">George Fletcher</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Sep 2012 19:35:25 +0000</created>
                <updated>Tue, 12 Feb 2013 18:43:51 +0000</updated>
                            <resolved>Mon, 17 Sep 2012 20:17:06 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13456130" author="cutting" created="Fri, 14 Sep 2012 20:55:32 +0000"  >&lt;p&gt;The bug looks real, but I don&apos;t see any code that calls this.  For example, SpecificData.getSchema(Bar.class) works without error.  Can you please provide a full stack trace, and/or some sample code that causes this to produce the wrong results?  Thanks!&lt;/p&gt;</comment>
                            <comment id="13456153" author="netvisao" created="Fri, 14 Sep 2012 21:14:47 +0000"  >&lt;p&gt;Hello Doug,&lt;br/&gt;
Thanks for getting back to us so quickly&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: org.apache.avro.AvroTypeException: Map key class not CharSequence: class java.lang.String&lt;/p&gt;

&lt;p&gt;Caused by: org.apache.avro.AvroTypeException: Map key class not CharSequence: class java.lang.String&lt;br/&gt;
	at org.apache.avro.specific.SpecificData.createSchema(SpecificData.java:180)&lt;br/&gt;
	at org.apache.avro.specific.SpecificData.getSchema(SpecificData.java:140)&lt;br/&gt;
	at com.foo.bar.encode.AvroEncoder.encode(AvroEncoder.java:44)&lt;br/&gt;
	... 7 more&lt;/p&gt;


&lt;p&gt;	the encode method has this body :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	
	 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] encode(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; object, Type type) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        SpecificDatumWriter&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; writer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpecificDatumWriter&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;(SpecificData.get().getSchema(type));
        ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
        JsonEncoder encoder =  EncoderFactory.get().jsonEncoder(SpecificData.get().getSchema(type), baos);

        writer.write(object, encoder);
        encoder.flush();

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; baos.toByteArray();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13456165" author="netvisao" created="Fri, 14 Sep 2012 21:23:14 +0000"  >&lt;p&gt;Adding debug information when the &lt;tt&gt;org.apache.avro.AvroTypeException: Map key class not CharSequence: class java.lang.String&lt;/tt&gt; gets thrown:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; = {org.apache.avro.specific.SpecificData@2754}
type = {sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl@2760}&lt;span class=&quot;code-quote&quot;&gt;&quot;java.util.Map&amp;lt;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, com.foo.bar.MyObject&amp;gt;&quot;&lt;/span&gt;
names = {java.util.LinkedHashMap@2761} size = 0
ptype = {sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl@2760}&lt;span class=&quot;code-quote&quot;&gt;&quot;java.util.Map&amp;lt;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, com.foo.bar.MyObject&amp;gt;&quot;&lt;/span&gt;
raw = {java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;@2762}&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; java.util.Map&quot;&lt;/span&gt;
params = {java.lang.reflect.Type[2]@2763}
key = {java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;@2764}&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&quot;&lt;/span&gt;
value = {java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;@2451}&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;com.foo.bar.MyObject&quot;&lt;/span&gt;
params[1] = {java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;@2451}&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;com.foo.bar.MyObject&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13456168" author="netvisao" created="Fri, 14 Sep 2012 21:27:13 +0000"  >&lt;p&gt;SpecificData.getSchema(Bar.class) would not throw the error, but SpecificData.getSchema(Map&amp;lt;String, Bar&amp;gt;) will.&lt;/p&gt;</comment>
                            <comment id="13456184" author="cutting" created="Fri, 14 Sep 2012 21:54:53 +0000"  >&lt;p&gt;Here&apos;s a patch to fix this that includes a test case.&lt;/p&gt;

&lt;p&gt;Unless there are objections I&apos;ll commit this soon.&lt;/p&gt;</comment>
                            <comment id="13457279" author="cutting" created="Mon, 17 Sep 2012 20:17:06 +0000"  >&lt;p&gt;I committed this.  Thanks, George.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12606650">AVRO-1148</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12606650">AVRO-1148</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12545229" name="AVRO-1166.patch" size="1853" author="cutting" created="Fri, 14 Sep 2012 21:54:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Sep 2012 20:55:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253714</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4qv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80531</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1167] Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1167</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;When avro_schema_copy() encounters an AVRO_LINK from an old_schema to a new_schema, it sets the target of the new_link to the target of the old_link in the old_schema. Thus, the AVRO_LINK in the new_schema points to an element in the old_schema. &lt;/p&gt;

&lt;p&gt;While this is currently safe, since the reference count of the target in the old_schema is incremented, we are not really making a &quot;copy&quot; of the schema.&lt;/p&gt;

&lt;p&gt;There is a &quot;TODO&quot; in the code, which says that we should make a avro_schema_copy() of the target in old_schema instead of linking directly to it. However, this solution of making a copy would result in a few problems:&lt;/p&gt;

&lt;p&gt;1. Avro schemas are intended to be self-contained. That implies that AVRO_LINKs are intended to be internal links inside a self-contained schema. The code introduces unnecessary (and potentially disallowed) external dependencies in an Avro schema. &lt;/p&gt;

&lt;p&gt;2. The purpose of copying a schema that we want to decouple the old_schema from the new_schema. The two copies may have different owners, we may want to deallocate old schema etc.&lt;/p&gt;

&lt;p&gt;3. If the schema is recursive, then the code would enter an infinite recursion loop.&lt;/p&gt;

&lt;p&gt;It appears to me that the &quot;correct&quot; solution would be to replicate the entire structure of the current schema, including the internal links. This means that if old_link_A points to old_target_B, then new_link_A should point to new_target_B in the new schema. Note that there should only be one copy of new_target_B in the new schema, even if there are multiple links pointing to new_target_B - i.e. we should not make a new copy for each link.&lt;/p&gt;

&lt;p&gt;In order to implement this proper copying of links, we would need to keep a lookup table of pairs of old and new schemas as they are being created, as well as a list of all the AVRO_LINKs that are copied. Then as a post-copy step, we would go and fix up all the AVRO_LINKs to point to the appropriate targets. This is the way the schema is constructed in the first place in avro_schema_from_json().&lt;/p&gt;

&lt;p&gt;An inefficient way to obtain the correct result from avro_schema_copy() would be to perform an avro_schema_to_json() followed by an avro_schema_from_json().&lt;/p&gt;

&lt;p&gt;Note: I have not implemented a fix for this issue, but I am documenting this issue in AVRO-JIRA because this issue needs to be resolved before &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; can be fixed.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu Linux 11.10&lt;/p&gt;</environment>
        <key id="12607729">AVRO-1167</key>
            <summary>Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="vnadkarni">Vivek Nadkarni</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Sep 2012 22:25:40 +0000</created>
                <updated>Tue, 11 Dec 2018 19:14:56 +0000</updated>
                                            <version>1.7.1</version>
                                                    <component>c</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <timeoriginalestimate seconds="604800">168h</timeoriginalestimate>
                            <timeestimate seconds="604800">168h</timeestimate>
                                        <comments>
                            <comment id="13456201" author="vnadkarni" created="Fri, 14 Sep 2012 22:37:15 +0000"  >&lt;p&gt;The test in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;-TEST.patch shows the memory leak caused by avro_schema_copy() when an AVRO_LINK is copied. I have provided a non-recursive schema containing an AVRO_LINK in this test. Once &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; is fixed, this issue should be revisited for recursive schemas as well.&lt;/p&gt;

&lt;p&gt;The valgrind output is below:&lt;/p&gt;

&lt;p&gt;==15602== 1,410 (24 direct, 1,386 indirect) bytes in 1 blocks are definitely lost in loss record 23 of 23&lt;br/&gt;
==15602==    at 0x4C28F9F: malloc (vg_replace_malloc.c:236)&lt;br/&gt;
==15602==    by 0x4C29019: realloc (vg_replace_malloc.c:525)&lt;br/&gt;
==15602==    by 0x40D364: avro_default_allocator (allocation.c:36)&lt;br/&gt;
==15602==    by 0x405428: avro_schema_link (schema.c:663)&lt;br/&gt;
==15602==    by 0x406946: avro_schema_copy (schema.c:1260)&lt;br/&gt;
==15602==    by 0x406722: avro_schema_copy (schema.c:1165)&lt;br/&gt;
==15602==    by 0x403EEA: main (test_avro_1167.c:74)&lt;br/&gt;
==15602== &lt;br/&gt;
==15602== LEAK SUMMARY:&lt;br/&gt;
==15602==    definitely lost: 96 bytes in 3 blocks&lt;br/&gt;
==15602==    indirectly lost: 2,748 bytes in 28 blocks&lt;br/&gt;
==15602==      possibly lost: 0 bytes in 0 blocks&lt;br/&gt;
==15602==    still reachable: 0 bytes in 0 blocks&lt;br/&gt;
==15602==         suppressed: 0 bytes in 0 blocks&lt;br/&gt;
==15602== &lt;br/&gt;
==15602== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 4 from 4)&lt;/p&gt;
</comment>
                            <comment id="13456202" author="vnadkarni" created="Fri, 14 Sep 2012 22:39:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt; need to be fixed together, because the issues are closely related. &lt;/p&gt;</comment>
                            <comment id="15970112" author="githubbot" created="Sat, 15 Apr 2017 20:12:36 +0000"  >&lt;p&gt;GitHub user johnsgill3 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/217&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/217&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;&lt;br/&gt;
    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Correct reference accounting during `avro_schema_copy`&lt;/li&gt;
	&lt;li&gt;Save Named Schemas (Records, Enum, Fixed) during copy into hash&lt;/li&gt;
	&lt;li&gt;Use new Avro named schema in link target from saved hash&lt;/li&gt;
	&lt;li&gt;Adds tests cases from patches in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; ARRo-1167&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Running the test cases through valgrind does not generate any memory leak errors.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/johnsgill3/avro&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/johnsgill3/avro&lt;/a&gt; fix-c-link-memory-leaks&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/217.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/217.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #217&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 712c47cc1b8f1f5f5395c6ad72857ea5b73c3711&lt;br/&gt;
Author: John Gill &amp;lt;king2bgill@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-04-15T17:01:38Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;commit f587ade67f0856ebdfa1106089e7963bf60bc495&lt;br/&gt;
Author: John Gill &amp;lt;king2bgill@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-04-15T20:02:02Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="15970124" author="johnsgill3" created="Sat, 15 Apr 2017 20:33:51 +0000"  >&lt;p&gt;I tried to attach the patch for this fix but I can&apos;t seem to attach files to this JIRA.&lt;/p&gt;</comment>
                            <comment id="16715357" author="githubbot" created="Mon, 10 Dec 2018 18:56:11 +0000"  >&lt;p&gt;dkulp closed pull request #217: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/217&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/217&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/lang/c/src/schema.c b/lang/c/src/schema.c&lt;br/&gt;
index 3ade1140e..97e3ff354 100644&lt;br/&gt;
&amp;#8212; a/lang/c/src/schema.c&lt;br/&gt;
+++ b/lang/c/src/schema.c&lt;br/&gt;
@@ -2,17 +2,17 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Licensed to the Apache Software Foundation (ASF) under one or more&lt;/li&gt;
	&lt;li&gt;contributor license agreements.  See the NOTICE file distributed with&lt;/li&gt;
	&lt;li&gt;this work for additional information regarding copyright ownership.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* The ASF licenses this file to you under the Apache License, Version 2.0&lt;br/&gt;
+ * The ASF licenses this file to you under the Apache License, Version 2.0&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;(the &quot;License&quot;); you may not use this file except in compliance with&lt;/li&gt;
	&lt;li&gt;the License.  You may obtain a copy of the License at&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;br/&gt;
+ *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;br/&gt;
+ *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;Unless required by applicable law or agreed to in writing, software&lt;/li&gt;
	&lt;li&gt;distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;/li&gt;
	&lt;li&gt;WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or&lt;/li&gt;
	&lt;li&gt;implied.  See the License for the specific language governing&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* permissions and limitations under the License.&lt;br/&gt;
+ * permissions and limitations under the License.&lt;br/&gt;
  */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; #include &quot;avro/allocation.h&quot;&lt;br/&gt;
@@ -61,7 +61,7 @@ static int is_avro_id(const char *name)&lt;br/&gt;
 			}&lt;br/&gt;
 		}&lt;br/&gt;
 		/*&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* starts with &lt;span class=&quot;error&quot;&gt;&amp;#91;A-Za-z_&amp;#93;&lt;/span&gt; subsequent &lt;span class=&quot;error&quot;&gt;&amp;#91;A-Za-z0-9_&amp;#93;&lt;/span&gt;&lt;br/&gt;
+		 * starts with &lt;span class=&quot;error&quot;&gt;&amp;#91;A-Za-z_&amp;#93;&lt;/span&gt; subsequent &lt;span class=&quot;error&quot;&gt;&amp;#91;A-Za-z0-9_&amp;#93;&lt;/span&gt;&lt;br/&gt;
 		 */&lt;br/&gt;
 		return 1;&lt;br/&gt;
 	}&lt;br/&gt;
@@ -199,7 +199,13 @@ static void avro_schema_free(avro_schema_t schema)&lt;br/&gt;
 		case AVRO_LINK:
{
 				struct avro_link_schema_t *link;
 				link = avro_schema_to_link(schema);
-				avro_schema_decref(link-&amp;gt;to);
+				/* Since we didn&apos;t increment the
+				 * reference count of the target
+				 * schema when we created the link, we
+				 * should not decrement the reference
+				 * count of the target schema when we
+				 * free the link.
+				 */
 				avro_freet(struct avro_link_schema_t, link);
 			}
&lt;p&gt; 			break;&lt;br/&gt;
@@ -727,7 +733,19 @@ avro_schema_t avro_schema_link(avro_schema_t to)&lt;br/&gt;
 		avro_set_error(&quot;Cannot allocate new link schema&quot;);&lt;br/&gt;
 		return NULL;&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;link-&amp;gt;to = avro_schema_incref(to);&lt;br/&gt;
+&lt;br/&gt;
+	/* Do not increment the reference count of target schema&lt;br/&gt;
+	 * pointed to by the AVRO_LINK. AVRO_LINKs are only valid&lt;br/&gt;
+	 * internal to a schema. The target schema pointed to by a&lt;br/&gt;
+	 * link will be valid as long as the top-level schema is&lt;br/&gt;
+	 * valid. Similarly, the link will be valid as long as the&lt;br/&gt;
+	 * top-level schema is valid. Therefore the validity of the&lt;br/&gt;
+	 * link ensures the validity of its target, and we don&apos;t need&lt;br/&gt;
+	 * an additional reference count on the target. This mechanism&lt;br/&gt;
+	 * of an implied validity also breaks reference count cycles&lt;br/&gt;
+	 * for recursive schemas, which result in memory leaks.&lt;br/&gt;
+	 */&lt;br/&gt;
+	link-&amp;gt;to = to;&lt;br/&gt;
 	avro_schema_init(&amp;amp;link-&amp;gt;obj, AVRO_LINK);&lt;br/&gt;
 	return &amp;amp;link-&amp;gt;obj;&lt;br/&gt;
 }&lt;br/&gt;
@@ -807,7 +825,7 @@ avro_type_from_json_t(json_t *json, avro_type_t *type,&lt;br/&gt;
 		return EINVAL;&lt;br/&gt;
 	}&lt;br/&gt;
 	/*&lt;/li&gt;
	&lt;li&gt;* TODO: gperf/re2c this&lt;br/&gt;
+	 * TODO: gperf/re2c this&lt;br/&gt;
 	 */&lt;br/&gt;
 	if (strcmp(type_str, &quot;string&quot;) == 0) 
{
 		*type = AVRO_STRING;
@@ -1259,7 +1277,7 @@ avro_schema_from_json_length(const char *jsontext, size_t length,
 	return avro_schema_from_json_root(root, schema);
 }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
+avro_schema_t avro_schema_copy_root(avro_schema_t schema, st_table *named_schemas)&lt;br/&gt;
 {&lt;br/&gt;
 	long i;&lt;br/&gt;
 	avro_schema_t new_schema = NULL;&lt;br/&gt;
@@ -1276,7 +1294,7 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
 	case AVRO_BOOLEAN:&lt;br/&gt;
 	case AVRO_NULL:&lt;br/&gt;
 		/*&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* No need to copy primitives since they&apos;re static&lt;br/&gt;
+		 * No need to copy primitives since they&apos;re static&lt;br/&gt;
 		 */&lt;br/&gt;
 		new_schema = schema;&lt;br/&gt;
 		break;&lt;br/&gt;
@@ -1288,6 +1306,10 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
 			new_schema =&lt;br/&gt;
 			    avro_schema_record(record_schema-&amp;gt;name,&lt;br/&gt;
 					       record_schema-&amp;gt;space);&lt;br/&gt;
+		    if (save_named_schemas(new_schema, named_schemas)) 
{
+   				avro_set_error(&quot;Cannot save enum schema&quot;);
+   				return NULL;
+   			}
&lt;p&gt; 			for (i = 0; i &amp;lt; record_schema-&amp;gt;fields-&amp;gt;num_entries; i++) {&lt;br/&gt;
 				union &lt;/p&gt;
{
 					st_data_t data;
@@ -1295,10 +1317,11 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)
 				}
&lt;p&gt; val;&lt;br/&gt;
 				st_lookup(record_schema-&amp;gt;fields, i, &amp;amp;val.data);&lt;br/&gt;
 				avro_schema_t type_copy =&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;avro_schema_copy(val.field-&amp;gt;type);&lt;br/&gt;
+				    avro_schema_copy_root(val.field-&amp;gt;type, named_schemas);&lt;br/&gt;
 				avro_schema_record_field_append(new_schema,&lt;br/&gt;
 								val.field-&amp;gt;name,&lt;br/&gt;
 								type_copy);&lt;br/&gt;
+				avro_schema_decref(type_copy);&lt;br/&gt;
 			}&lt;br/&gt;
 		}&lt;br/&gt;
 		break;&lt;br/&gt;
@@ -1309,6 +1332,10 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
 			    avro_schema_to_enum(schema);&lt;br/&gt;
 			new_schema = avro_schema_enum_ns(enum_schema-&amp;gt;name,&lt;br/&gt;
 					enum_schema-&amp;gt;space);&lt;br/&gt;
+			if (save_named_schemas(new_schema, named_schemas)) 
{
+				avro_set_error(&quot;Cannot save enum schema&quot;);
+				return NULL;
+			}
&lt;p&gt; 			for (i = 0; i &amp;lt; enum_schema-&amp;gt;symbols-&amp;gt;num_entries; i++) {&lt;br/&gt;
 				union &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: { 					st_data_t data;@@ -1329,6 +1356,10 @@ avro_schema_t avro_schema_copy(avro_schema_t schema) 			    avro_schema_fixed_ns(fixed_schema-&amp;gt;name, 					         fixed_schema-&amp;gt;space, 					         fixed_schema-&amp;gt;size);+ 			if (save_named_schemas(new_schema, named_schemas)) {
+ 				avro_set_error(&quot;Cannot save fixed schema&quot;);
+ 				return NULL;
+ 			} 		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; 		break;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -1337,11 +1368,12 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
 			struct avro_map_schema_t *map_schema =&lt;br/&gt;
 			    avro_schema_to_map(schema);&lt;br/&gt;
 			avro_schema_t values_copy =&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;avro_schema_copy(map_schema-&amp;gt;values);&lt;br/&gt;
+			    avro_schema_copy_root(map_schema-&amp;gt;values, named_schemas);&lt;br/&gt;
 			if (!values_copy) 
{
 				return NULL;
 			}&lt;br/&gt;
 			new_schema = avro_schema_map(values_copy);&lt;br/&gt;
+			avro_schema_decref(values_copy);&lt;br/&gt;
 		}&lt;br/&gt;
 		break;&lt;br/&gt;
 &lt;br/&gt;
@@ -1350,11 +1382,12 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
 			struct avro_array_schema_t *array_schema =&lt;br/&gt;
 			    avro_schema_to_array(schema);&lt;br/&gt;
 			avro_schema_t items_copy =&lt;br/&gt;
-			    avro_schema_copy(array_schema-&amp;gt;items);&lt;br/&gt;
+			    avro_schema_copy_root(array_schema-&amp;gt;items, named_schemas);&lt;br/&gt;
 			if (!items_copy) { 				return NULL; 			}
&lt;p&gt; 			new_schema = avro_schema_array(items_copy);&lt;br/&gt;
+			avro_schema_decref(items_copy);&lt;br/&gt;
 		}&lt;br/&gt;
 		break;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -1372,12 +1405,13 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
 					avro_schema_t schema;&lt;br/&gt;
 				} val;&lt;br/&gt;
 				st_lookup(union_schema-&amp;gt;branches, i, &amp;amp;val.data);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;schema_copy = avro_schema_copy(val.schema);&lt;br/&gt;
+				schema_copy = avro_schema_copy_root(val.schema, named_schemas);&lt;br/&gt;
 				if (avro_schema_union_append&lt;br/&gt;
 				    (new_schema, schema_copy)) 
{
 					avro_schema_decref(new_schema);
 					return NULL;
 				}
&lt;p&gt;+				avro_schema_decref(schema_copy);&lt;br/&gt;
 			}&lt;br/&gt;
 		}&lt;br/&gt;
 		break;&lt;br/&gt;
@@ -1386,12 +1420,12 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;/p&gt;
 		{
 			struct avro_link_schema_t *link_schema =
 			    avro_schema_to_link(schema);
-			/*
-			 * TODO: use an avro_schema_copy of to instead of pointing to
-			 * the same reference 
-			 */
-			avro_schema_incref(link_schema-&amp;gt;to);
-			new_schema = avro_schema_link(link_schema-&amp;gt;to);
+			avro_schema_t to;
+
+			to = find_named_schemas(avro_schema_name(link_schema-&amp;gt;to),
+									avro_schema_namespace(link_schema-&amp;gt;to),
+									named_schemas);
+			new_schema = avro_schema_link(to);
 		}
&lt;p&gt; 		break;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -1401,6 +1435,23 @@ avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
 	return new_schema;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;+avro_schema_t avro_schema_copy(avro_schema_t schema)&lt;br/&gt;
+{&lt;br/&gt;
+	avro_schema_t new_schema;&lt;br/&gt;
+	st_table *named_schemas;&lt;br/&gt;
+&lt;br/&gt;
+	named_schemas = st_init_strtable_with_size(DEFAULT_TABLE_SIZE);&lt;br/&gt;
+	if (!named_schemas) &lt;/p&gt;
{
+		avro_set_error(&quot;Cannot allocate named schema map&quot;);
+		return NULL;
+	}
&lt;p&gt;+&lt;br/&gt;
+	new_schema = avro_schema_copy_root(schema, named_schemas);&lt;br/&gt;
+	st_foreach(named_schemas, HASH_FUNCTION_CAST named_schema_free_foreach, 0);&lt;br/&gt;
+	st_free_table(named_schemas);&lt;br/&gt;
+	return new_schema;&lt;br/&gt;
+}&lt;br/&gt;
+&lt;br/&gt;
 avro_schema_t avro_schema_get_subschema(const avro_schema_t schema,&lt;br/&gt;
          const char *name)&lt;br/&gt;
 {&lt;br/&gt;
diff --git a/lang/c/tests/CMakeLists.txt b/lang/c/tests/CMakeLists.txt&lt;br/&gt;
index 445e689a7..0870ef5ec 100644&lt;br/&gt;
&amp;#8212; a/lang/c/tests/CMakeLists.txt&lt;br/&gt;
+++ b/lang/c/tests/CMakeLists.txt&lt;br/&gt;
@@ -48,12 +48,14 @@ add_avro_test(test_data_structures)&lt;br/&gt;
 add_avro_test(test_avro_schema)&lt;br/&gt;
 add_avro_test(test_avro_schema_names)&lt;br/&gt;
 add_avro_test(test_avro_values)&lt;br/&gt;
+add_avro_test(test_avro_766)&lt;br/&gt;
 add_avro_test(test_avro_968)&lt;br/&gt;
 add_avro_test(test_avro_984)&lt;br/&gt;
 add_avro_test(test_avro_1034)&lt;br/&gt;
 add_avro_test(test_avro_1084)&lt;br/&gt;
 add_avro_test(test_avro_1087)&lt;br/&gt;
 add_avro_test(test_avro_1165)&lt;br/&gt;
+add_avro_test(test_avro_1167)&lt;br/&gt;
 add_avro_test(test_avro_1237)&lt;br/&gt;
 add_avro_test(test_avro_1238)&lt;br/&gt;
 add_avro_test(test_avro_1279)&lt;br/&gt;
diff --git a/lang/c/tests/test_avro_1167.c b/lang/c/tests/test_avro_1167.c&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 000000000..869b37d17&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/lang/c/tests/test_avro_1167.c&lt;br/&gt;
@@ -0,0 +1,84 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to you under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or&lt;br/&gt;
+ * implied.  See the License for the specific language governing&lt;br/&gt;
+ * permissions and limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+#include &amp;lt;stdio.h&amp;gt;&lt;br/&gt;
+#include &amp;lt;string.h&amp;gt;&lt;br/&gt;
+#include &amp;lt;avro.h&amp;gt;&lt;br/&gt;
+&lt;br/&gt;
+/* To see the &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt; memory leak, run this test program through&lt;br/&gt;
+ * valgrind.  The specific valgrind commandline to use from the&lt;br/&gt;
+ * avro-trunk/lang/c/tests directory is:&lt;br/&gt;
+ *    valgrind -v --track-origins=yes --leak-check=full&lt;br/&gt;
+ *          --show-reachable = yes ../build/tests/test_avro_1167&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+int main(int argc, char **argv)&lt;br/&gt;
+{&lt;br/&gt;
+	const char  *json =&lt;br/&gt;
+		&quot;{&quot;&lt;br/&gt;
+		&quot;  \&quot;name\&quot;: \&quot;repeated_subrecord_array\&quot;,&quot;&lt;br/&gt;
+		&quot;  \&quot;type\&quot;: \&quot;record\&quot;,&quot;&lt;br/&gt;
+		&quot;  \&quot;fields\&quot;: [&quot;&lt;br/&gt;
+		&quot;    { \&quot;name\&quot;: \&quot;subrecord_one\&quot;,&quot;&lt;br/&gt;
+		&quot;      \&quot;type\&quot;: {&quot;&lt;br/&gt;
+		&quot;                  \&quot;name\&quot;: \&quot;SubrecordType\&quot;,&quot;&lt;br/&gt;
+		&quot;                  \&quot;type\&quot;: \&quot;record\&quot;,&quot;&lt;br/&gt;
+		&quot;                  \&quot;fields\&quot;: [&quot;&lt;br/&gt;
+		&quot;                    &lt;/p&gt;
{ \&quot;name\&quot;: \&quot;x\&quot;, \&quot;type\&quot;: \&quot;int\&quot; }
&lt;p&gt;,&quot;&lt;br/&gt;
+		&quot;                    &lt;/p&gt;
{ \&quot;name\&quot;: \&quot;y\&quot;, \&quot;type\&quot;: \&quot;int\&quot; }
&lt;p&gt;&quot;&lt;br/&gt;
+		&quot;                  ]&quot;&lt;br/&gt;
+		&quot;                }&quot;&lt;br/&gt;
+		&quot;    },&quot;&lt;br/&gt;
+		&quot;    &lt;/p&gt;
{ \&quot;name\&quot;: \&quot;subrecord_two\&quot;, \&quot;type\&quot;: \&quot;SubrecordType\&quot; }
&lt;p&gt;,&quot;&lt;br/&gt;
+		&quot;    { \&quot;name\&quot;: \&quot;subrecord_array\&quot;, \&quot;type\&quot;: &lt;/p&gt;
{&quot;
+		&quot;                                                 \&quot;type\&quot;:\&quot;array\&quot;,&quot;
+		&quot;                                                 \&quot;items\&quot;: \&quot;SubrecordType\&quot;&quot;
+		&quot;                                               }
&lt;p&gt;&quot;&lt;br/&gt;
+		&quot;    }&quot;&lt;br/&gt;
+		&quot;  ]&quot;&lt;br/&gt;
+		&quot;}&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	int rval;&lt;br/&gt;
+	avro_schema_t schema = NULL;&lt;br/&gt;
+	avro_schema_t schema_copy = NULL;&lt;br/&gt;
+	avro_schema_error_t error;&lt;br/&gt;
+&lt;br/&gt;
+	(void) argc;&lt;br/&gt;
+	(void) argv;&lt;br/&gt;
+&lt;br/&gt;
+	rval = avro_schema_from_json(json, strlen(json), &amp;amp;schema, &amp;amp;error);&lt;br/&gt;
+	if ( rval )&lt;br/&gt;
+	&lt;/p&gt;
{
+		printf(&quot;Failed to read schema from JSON.\n&quot;);
+		exit(EXIT_FAILURE);
+	}&lt;br/&gt;
+	else&lt;br/&gt;
+	{
+		printf(&quot;Successfully read schema from JSON.\n&quot;);
+	}&lt;br/&gt;
+&lt;br/&gt;
+	schema_copy = avro_schema_copy( schema );&lt;br/&gt;
+	if ( ! avro_schema_equal(schema, schema_copy) )&lt;br/&gt;
+	{
+		printf(&quot;Failed avro_schema_equal(schema, schema_copy)\n&quot;);
+		exit(EXIT_FAILURE);
+	}&lt;br/&gt;
+&lt;br/&gt;
+	avro_schema_decref(schema);&lt;br/&gt;
+	avro_schema_decref(schema_copy);&lt;br/&gt;
+	return 0;&lt;br/&gt;
+}&lt;br/&gt;
diff --git a/lang/c/tests/test_avro_766.c b/lang/c/tests/test_avro_766.c&lt;br/&gt;
new file mode 100755&lt;br/&gt;
index 000000000..4e21368c4&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/lang/c/tests/test_avro_766.c&lt;br/&gt;
@@ -0,0 +1,76 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to you under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or&lt;br/&gt;
+ * implied.  See the License for the specific language governing&lt;br/&gt;
+ * permissions and limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+#include &amp;lt;stdio.h&amp;gt;&lt;br/&gt;
+#include &amp;lt;string.h&amp;gt;&lt;br/&gt;
+#include &amp;lt;avro.h&amp;gt;&lt;br/&gt;
+&lt;br/&gt;
+/* To see the &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; memory leak, run this test program through&lt;br/&gt;
+ * valgrind.  The specific valgrind commandline to use from the&lt;br/&gt;
+ * avro-trunk/lang/c/tests directory is:&lt;br/&gt;
+ *    valgrind -v --track-origins=yes --leak-check=full&lt;br/&gt;
+ *          --show-reachable = yes ../build/tests/test_avro_766&lt;br/&gt;
+ */&lt;br/&gt;
+int main(int argc, char **argv)&lt;br/&gt;
+{&lt;br/&gt;
+	const char  *json =&lt;br/&gt;
+		&quot;{&quot;&lt;br/&gt;
+		&quot;  \&quot;type\&quot;: \&quot;record\&quot;,&quot;&lt;br/&gt;
+		&quot;  \&quot;name\&quot;: \&quot;list\&quot;,&quot;&lt;br/&gt;
+		&quot;  \&quot;fields\&quot;: [&quot;&lt;br/&gt;
+		&quot;    { \&quot;name\&quot;: \&quot;x\&quot;, \&quot;type\&quot;: \&quot;int\&quot; },&quot;&lt;br/&gt;
+		&quot;    { \&quot;name\&quot;: \&quot;y\&quot;, \&quot;type\&quot;: \&quot;int\&quot; },&quot;&lt;br/&gt;
+		&quot;    { \&quot;name\&quot;: \&quot;next\&quot;, \&quot;type\&quot;: [\&quot;null\&quot;,\&quot;list\&quot;]},&quot;&lt;br/&gt;
+		&quot;    { \&quot;name\&quot;: \&quot;arraylist\&quot;, \&quot;type\&quot;: { \&quot;type\&quot;:\&quot;array\&quot;, \&quot;items\&quot;: \&quot;list\&quot; } }&quot;&lt;br/&gt;
+		&quot;  ]&quot;&lt;br/&gt;
+		&quot;}&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	int rval;&lt;br/&gt;
+	avro_schema_t schema = NULL;&lt;br/&gt;
+	avro_schema_error_t error;&lt;br/&gt;
+&lt;br/&gt;
+	(void) argc;&lt;br/&gt;
+	(void) argv;&lt;br/&gt;
+&lt;br/&gt;
+	rval = avro_schema_from_json(json, strlen(json), &amp;amp;schema, &amp;amp;error);&lt;br/&gt;
+	if ( rval )&lt;br/&gt;
+	{+		printf(&quot;Failed to read schema from JSON.n&quot;);+		exit(EXIT_FAILURE);+	}
&lt;p&gt;+	else&lt;br/&gt;
+	&lt;/p&gt;
{
+		printf(&quot;Successfully read schema from JSON.\n&quot;);
+	}
&lt;p&gt;+&lt;br/&gt;
+#define TEST_AVRO_1167 (1)&lt;br/&gt;
+       #if TEST_AVRO_1167&lt;br/&gt;
+	{&lt;br/&gt;
+		avro_schema_t schema_copy = NULL;&lt;br/&gt;
+		schema_copy = avro_schema_copy( schema );&lt;br/&gt;
+		if ( ! avro_schema_equal(schema, schema_copy) )&lt;br/&gt;
+		&lt;/p&gt;
{
+			printf(&quot;Failed avro_schema_equal(schema, schema_copy)\n&quot;);
+			exit(EXIT_FAILURE);
+		}
&lt;p&gt;+		avro_schema_decref(schema_copy);&lt;br/&gt;
+	}&lt;br/&gt;
+       #endif&lt;br/&gt;
+&lt;br/&gt;
+	avro_schema_decref(schema);&lt;br/&gt;
+	return 0;&lt;br/&gt;
+}&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715358" author="jira-bot" created="Mon, 10 Dec 2018 18:56:14 +0000"  >&lt;p&gt;Commit 1f00b1a7a2f76921325ba073de3212a4a22524de in avro&apos;s branch refs/heads/branch-1.8 from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                            <comment id="16715360" author="jira-bot" created="Mon, 10 Dec 2018 18:56:17 +0000"  >&lt;p&gt;Commit 1f00b1a7a2f76921325ba073de3212a4a22524de in avro&apos;s branch refs/heads/branch-1.8 from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                            <comment id="16715363" author="jira-bot" created="Mon, 10 Dec 2018 18:56:22 +0000"  >&lt;p&gt;Commit 1f00b1a7a2f76921325ba073de3212a4a22524de in avro&apos;s branch refs/heads/branch-1.8 from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                            <comment id="16715364" author="jira-bot" created="Mon, 10 Dec 2018 18:56:47 +0000"  >&lt;p&gt;Commit b597c3ab93ef1c6a37a9c1fa3584d86d20723784 in avro&apos;s branch refs/heads/master from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=b597c3a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=b597c3a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                            <comment id="16715366" author="jira-bot" created="Mon, 10 Dec 2018 18:56:51 +0000"  >&lt;p&gt;Commit b597c3ab93ef1c6a37a9c1fa3584d86d20723784 in avro&apos;s branch refs/heads/master from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=b597c3a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=b597c3a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                            <comment id="16715369" author="jira-bot" created="Mon, 10 Dec 2018 18:56:55 +0000"  >&lt;p&gt;Commit b597c3ab93ef1c6a37a9c1fa3584d86d20723784 in avro&apos;s branch refs/heads/master from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=b597c3a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=b597c3a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                            <comment id="16717797" author="jira-bot" created="Tue, 11 Dec 2018 19:14:48 +0000"  >&lt;p&gt;Commit 1f00b1a7a2f76921325ba073de3212a4a22524de in avro&apos;s branch refs/heads/branch-1.8 from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                            <comment id="16717799" author="jira-bot" created="Tue, 11 Dec 2018 19:14:51 +0000"  >&lt;p&gt;Commit 1f00b1a7a2f76921325ba073de3212a4a22524de in avro&apos;s branch refs/heads/branch-1.8 from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                            <comment id="16717803" author="jira-bot" created="Tue, 11 Dec 2018 19:14:56 +0000"  >&lt;p&gt;Commit 1f00b1a7a2f76921325ba073de3212a4a22524de in avro&apos;s branch refs/heads/branch-1.8 from John Gill&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=1f00b1a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Fix c AVRO_LINK memory leaks (#217)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;: Enhance avro_schema_copy for AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hash of named schemas found during copy&lt;/li&gt;
	&lt;li&gt;Find saved named  schema for copy of AVRO_LINK&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt;: Correct memory leaks in AVRO_LINK copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-766&quot; title=&quot;C: Memory leak from reference count cycles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-766&quot;&gt;AVRO-766&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1167&quot; title=&quot;Avro-C: avro_schema_copy() does not copy AVRO_LINKs properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1167&quot;&gt;AVRO-1167&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Corrects reference counting for avro_schema_copy&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Enable TEST_AVRO_1167 in test_avro_766&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This ensures that both fixes work together and that no valgrind errors are produced from a recrusive schema.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12498542">AVRO-766</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12545232" name="AVRO-1167-TEST.patch" size="3367" author="vnadkarni" created="Fri, 14 Sep 2012 22:37:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 15 Apr 2017 20:12:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253715</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4r3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80532</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-1168] IDL Tool - Field properties are added against schema instead of field</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1168</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;In Idl.jj, field properties are added against the field &lt;b&gt;schema&lt;/b&gt; instead of the field, resulting in an error if different fields of the same &lt;b&gt;record&lt;/b&gt;&lt;br/&gt;
type are annotated with the same property name.&lt;/p&gt;

&lt;p&gt;Example:&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
record RecordA {&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;record RecordB {&lt;br/&gt;
 @Prop(&quot;&quot;)&lt;br/&gt;
 RecordA a1&lt;/p&gt;

&lt;p&gt; @Prop(&quot;&quot;)&lt;br/&gt;
 RecordA a2&lt;br/&gt;
}&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;Note this fails even if a1 and a2 are in different records (since the Schema instance is shared)&lt;/p&gt;

&lt;p&gt;Proposed fix: - change Idl.jj to add props agains the fields props, not the schema:&lt;/p&gt;

&lt;p&gt;&amp;lt;code&amp;gt;&lt;br/&gt;
    for (String key : props.keySet())&lt;br/&gt;
      type.addProp(key, getTextProp(key, props, token));&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;should read:&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
 field.addProp(...)&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608089">AVRO-1168</key>
            <summary>IDL Tool - Field properties are added against schema instead of field</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="onetoinfinity@yahoo.com">Cristian Opris</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2012 16:34:23 +0000</created>
                <updated>Tue, 25 Sep 2012 21:22:59 +0000</updated>
                            <resolved>Tue, 18 Sep 2012 16:57:04 +0000</resolved>
                                    <version>1.7.1</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13457956" author="cutting" created="Tue, 18 Sep 2012 17:03:15 +0000"  >&lt;p&gt;For the record, the ability to separately annotate the field and its schema is documented at:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://avro.apache.org/docs/current/idl.html#minutiae_annotations&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://avro.apache.org/docs/current/idl.html#minutiae_annotations&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Sep 2012 17:03:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253716</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4rb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80533</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Actually I realized you can annotate both the field schema and the field itself.&lt;br/&gt;
&lt;br/&gt;
string @Prop field&lt;br/&gt;
&lt;br/&gt;
Strange, but it works, so closing</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1169] Reduce memory footprint of ResolvingGrammarGenerator</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1169</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;We noticed an OutOfMemory error in one of our client applications (GUI) when trying to decode messages that require resolving.&lt;/p&gt;

&lt;p&gt;It turns out the use of Schema.toString(true) in method generate(Schema, Schema, Map&amp;lt;LitS,Symbol&amp;gt;) (and to a less extent resolveRecords(Schema, Schema, Map&amp;lt;LitS,Symbol&amp;gt;) too) in our very-large-Schema use-case is the main reason for this.&lt;/p&gt;

&lt;p&gt;We found that patching this class to use Schema.getFullName() instead of Schema.toString(true) resolves our issue, and we thought this might benefit other users (and shouldn&apos;t affect anybody as this message is not actually being logged/reported).&lt;/p&gt;

&lt;p&gt;The change involves changing this (in method generate()):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Symbol.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Found &quot;&lt;/span&gt; + writer.toString(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
                        + &lt;span class=&quot;code-quote&quot;&gt;&quot;, expecting &quot;&lt;/span&gt; + reader.toString(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;into this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Symbol.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Found &quot;&lt;/span&gt; + writer.getFullName()
                        + &lt;span class=&quot;code-quote&quot;&gt;&quot;, expecting &quot;&lt;/span&gt; + reader.getFullName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this (in method resolveRecords()):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            result = Symbol.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Found &quot;&lt;/span&gt; + writer.toString(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
                                  + &lt;span class=&quot;code-quote&quot;&gt;&quot;, expecting &quot;&lt;/span&gt; + reader.toString(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;into this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            result = Symbol.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Found &quot;&lt;/span&gt; + writer.getFullName()
                                  + &lt;span class=&quot;code-quote&quot;&gt;&quot;, expecting &quot;&lt;/span&gt; + reader.getFullName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thanks in advance,&lt;/p&gt;

&lt;p&gt;Hernan&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608110">AVRO-1169</key>
            <summary>Reduce memory footprint of ResolvingGrammarGenerator</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hernan.otero">Hernan Otero</assignee>
                                    <reporter username="hernan.otero">Hernan Otero</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2012 18:52:36 +0000</created>
                <updated>Mon, 10 Dec 2012 17:57:37 +0000</updated>
                            <resolved>Mon, 24 Sep 2012 21:14:51 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.3</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13458252" author="cutting" created="Tue, 18 Sep 2012 22:35:48 +0000"  >&lt;p&gt;Here is the proposed change as a patch file.&lt;/p&gt;</comment>
                            <comment id="13458253" author="cutting" created="Tue, 18 Sep 2012 22:36:35 +0000"  >&lt;p&gt;This seems like a reasonable change to me.&lt;/p&gt;

&lt;p&gt;If there are no objections I&apos;ll commit it.&lt;/p&gt;</comment>
                            <comment id="13462146" author="cutting" created="Mon, 24 Sep 2012 21:14:51 +0000"  >&lt;p&gt;I just committed this.  Thanks, Hernan!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545632" name="AVRO-1169.patch" size="1330" author="cutting" created="Tue, 18 Sep 2012 22:35:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Sep 2012 22:35:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253717</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4rj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80534</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
