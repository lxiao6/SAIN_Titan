<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:16:39 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2012-1-17+AND+created+%3C%3D+2012-1-24+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="7" total="7"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-995] Java: Update Dependencies for 1.6.2</title>
                <link>https://issues.apache.org/jira/browse/AVRO-995</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;A few of our dependencies need upgrading.  In particular, I have been hit by a bug in Jackson that is fixed by the latest release (&lt;a href=&quot;http://jira.codehaus.org/browse/JACKSON-462&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://jira.codehaus.org/browse/JACKSON-462&lt;/a&gt;).&lt;/p&gt;


&lt;p&gt;Summary:  I will submit a patch that updates everything to the next bugfix or very minor release, other than paranamer, thrift, and hadoop.&lt;/p&gt;


&lt;p&gt;Details:&lt;br/&gt;
(using maven versions plugin)&lt;/p&gt;

&lt;p&gt;On the dependency side:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   com.thoughtworks.paranamer:paranamer ................ 2.3 -&amp;gt; 2.4-debug&lt;br/&gt;
  could not find info about what is new in 2.4.  I do not think we should upgrade until we have more info&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   net.sf.jopt-simple:jopt-simple ............................ 4.1 -&amp;gt; 4.3&lt;br/&gt;
  minor extra features (&lt;a href=&quot;http://pholser.github.com/jopt-simple/changes.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pholser.github.com/jopt-simple/changes.html&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   org.apache.hadoop:hadoop-core .................... 0.20.205.0 -&amp;gt; 1.0.0&lt;br/&gt;
  renamed 0.20.205, no need to update yet.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   org.codehaus.jackson:jackson-mapper-asl ............... 1.8.6 -&amp;gt; 1.9.3&lt;br/&gt;
  I suggest we upgrade to 1.8.7.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   org.jboss.netty:netty ..................... 3.2.6.Final -&amp;gt; 3.2.7.Final&lt;br/&gt;
  bugfix release&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   org.apache.thrift:libthrift ........................... 0.7.0 -&amp;gt; 0.8.0&lt;br/&gt;
  Is this a minor / bugfix release?  If so we should update, otherwise wait until Avro 1.7.x&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   org.slf4j:slf4j-api ................................... 1.6.3 -&amp;gt; 1.6.4&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   org.slf4j:slf4j-simple ................................ 1.6.3 -&amp;gt; 1.6.4&lt;br/&gt;
  Minor bugfixes (&lt;a href=&quot;http://www.slf4j.org/news.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.slf4j.org/news.html&lt;/a&gt;)&lt;/p&gt;


&lt;p&gt;On the plugin side: (mvn versions:display-plugin-updates)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   maven-antrun-plugin ...................................... 1.6 -&amp;gt; 1.7 &lt;br/&gt;
  minor, looks safe: (&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/maven-announce/201111.mbox/%3CCALhtWke1=w6Nv2U85NkGqm0Zxo3KHyzDc8hAZkHhVywJbuv-7g@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/maven-announce/201111.mbox/%3CCALhtWke1=w6Nv2U85NkGqm0Zxo3KHyzDc8hAZkHhVywJbuv-7g@mail.gmail.com%3E&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   maven-gpg-plugin ......................................... 1.3 -&amp;gt; 1.4&lt;br/&gt;
  minor update (&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/maven-announce/201108.mbox/%3CCA+nPnMw_3zQQCpzybQvo-QZFMCogvH31WEhxQnZ=cdzgxsRR7w@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/maven-announce/201108.mbox/%3CCA+nPnMw_3zQQCpzybQvo-QZFMCogvH31WEhxQnZ=cdzgxsRR7w@mail.gmail.com%3E&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   maven-checkstyle-plugin .................................. 2.6 -&amp;gt; 2.8&lt;br/&gt;
  we avoided 2.7 before for some reason: (&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/maven-dev/201108.mbox/%3CCAPoyBqSvu+KuP5VucE8Rc6Mjb9rYkr2Cpig+rVBE5O8Teo6Xcw@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/maven-dev/201108.mbox/%3CCAPoyBqSvu+KuP5VucE8Rc6Mjb9rYkr2Cpig+rVBE5O8Teo6Xcw@mail.gmail.com%3E&lt;/a&gt;)&lt;br/&gt;
  useful new feature: (&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/maven-announce/201111.mbox/%3C15365449.01320142181746.JavaMail.mark@MARK%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/maven-announce/201111.mbox/%3C15365449.01320142181746.JavaMail.mark@MARK%3E&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   maven-surefire-plugin .................................. 2.10 -&amp;gt; 2.11&lt;br/&gt;
  lots of bug fixes and long requested new features: (&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/maven-announce/201112.mbox/%3CCA+jQputH_uA2Ue6JqiHp1YeNo=qQxgcpDTgq9vv1AW_PSQk1sQ@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/maven-announce/201112.mbox/%3CCA+jQputH_uA2Ue6JqiHp1YeNo=qQxgcpDTgq9vv1AW_PSQk1sQ@mail.gmail.com%3E&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   maven-shade-plugin ....................................... 1.4 -&amp;gt; 1.5&lt;br/&gt;
  minor looks  safe: (&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/maven-announce/201111.mbox/%3C1076639049.01320107865464.JavaMail.benson@tinfoilhat.local%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/maven-announce/201111.mbox/%3C1076639049.01320107865464.JavaMail.benson@tinfoilhat.local%3E&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;   maven-archetype-plugin ................................... 2.1 -&amp;gt; 2.2&lt;br/&gt;
  &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/maven-announce/201111.mbox/%3CCALhtWkeLyc-tA2NCh3xYR06W+eGiWd46fS=R=NgJOn14zrdDaw@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/maven-announce/201111.mbox/%3CCALhtWkeLyc-tA2NCh3xYR06W+eGiWd46fS=R=NgJOn14zrdDaw@mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538596">AVRO-995</key>
            <summary>Java: Update Dependencies for 1.6.2</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="scott_carey">Scott Carey</assignee>
                                    <reporter username="scott_carey">Scott Carey</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jan 2012 03:04:22 +0000</created>
                <updated>Wed, 15 Feb 2012 00:46:24 +0000</updated>
                            <resolved>Wed, 8 Feb 2012 18:46:44 +0000</resolved>
                                                    <fixVersion>1.6.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13187447" author="scott_carey" created="Tue, 17 Jan 2012 04:55:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-995&quot; title=&quot;Java: Update Dependencies for 1.6.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-995&quot;&gt;&lt;del&gt;AVRO-995&lt;/del&gt;&lt;/a&gt;.patch  Updates as described, except for surefire 2.11 which has a bug.&lt;/p&gt;

&lt;p&gt;Tested the patch with the full build.  Compile and test work without anything in the local repo or with.  &apos;mvn clean install&apos; from toplevel works.&lt;/p&gt;</comment>
                            <comment id="13191624" author="cutting" created="Mon, 23 Jan 2012 23:36:35 +0000"  >&lt;p&gt;Should we include this in 1.6.2 or not?&lt;/p&gt;</comment>
                            <comment id="13191866" author="scott_carey" created="Tue, 24 Jan 2012 04:28:54 +0000"  >&lt;p&gt;At minimum, we should upgrade Jackson from 1.8.6 to 1.8.7.  This fixes a bug that prevents the JSON encoding from working reliably, in particular the &apos;tojson&apos; avro-tools tool frequently fails with 1.8.6 but works with 1.8.7.&lt;/p&gt;

&lt;p&gt;The other updates do not fix any known bugs, but I thought it might be good to update our dependencies while I was fixing the Jackson issue.&lt;/p&gt;</comment>
                            <comment id="13191868" author="scott_carey" created="Tue, 24 Jan 2012 04:32:41 +0000"  >&lt;p&gt;Additionally, I will not be able to commit this, or review or commit any other tickets in the next 11 days due to very limited Internet access.&lt;/p&gt;

&lt;p&gt;I am +1 on this one as is.&lt;/p&gt;</comment>
                            <comment id="13192567" author="cutting" created="Tue, 24 Jan 2012 21:47:13 +0000"  >&lt;p&gt;Should we be concerned about updating versions of dependencies for non-bugfix reasons in a bugfix release?  It&apos;s possible that updating one of our dependencies could break a project that depends on Avro.  So it might be safer to simply update Jackson in 1.6.2 and save the rest of these for 1.7.0.  Am I being too paranoid?&lt;/p&gt;</comment>
                            <comment id="13193162" author="lars_francke" created="Wed, 25 Jan 2012 18:08:35 +0000"  >&lt;p&gt;Just one more thing to add:&#160;Jetty has changed groupId to org.eclipse.jetty and they are up to version 8.x now. It&apos;s worth upgrading that at some point too but I guess that should definitely go into a minor- and not a bugfix release.&lt;/p&gt;

&lt;p&gt;I don&apos;t have a strong opinion about updating the others but sometimes builds that depend on Avro might be broken or need workarounds because of outdated dependencies. So it can go both ways.&lt;/p&gt;</comment>
                            <comment id="13201827" author="scott_carey" created="Mon, 6 Feb 2012 23:54:08 +0000"  >&lt;p&gt;I will provide another patch with reduced changes to the most safe things:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;end user dependencies - fix the jackson issue, and some other very safe ones (slf4j, netty)&lt;/li&gt;
	&lt;li&gt;plugin dependencies - all updates, this only affects our build.&lt;/li&gt;
	&lt;li&gt;pom file cleanup - moving versions to properties&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;These may collide with the other pom file cleanups in progress however (&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1012&quot; title=&quot;Improve avro-service-archetype: POM and IT changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1012&quot;&gt;&lt;del&gt;AVRO-1012&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1011&quot; title=&quot;Improve POM structure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1011&quot;&gt;&lt;del&gt;AVRO-1011&lt;/del&gt;&lt;/a&gt;).  I will review and commit those first before providing a new patch here.&lt;/p&gt;</comment>
                            <comment id="13201833" author="scott_carey" created="Mon, 6 Feb 2012 23:58:45 +0000"  >&lt;p&gt;Re: Jetty &amp;#8211;&lt;/p&gt;

&lt;p&gt;We shouldn&apos;t upgrade a major version dependency until 1.7.0 IMO.&lt;br/&gt;
As for 8.x, will Avro work with 8.x if a user is simultaneously using 6.x or 7.x?   We could create two HTTP IPC modules if necessary, otherwise it would be good to move to 8.x for Avro 1.7.0 and use a supported version of the software.&lt;/p&gt;</comment>
                            <comment id="13203300" author="scott_carey" created="Wed, 8 Feb 2012 05:54:54 +0000"  >&lt;p&gt;This latest patch updates all plugin versions in the build, and updates Jackson to 1.8.8 for the latest bugfixes in the 1.8.x line, and uses the latest bugfix versions for netty and slf4j as well.&lt;/p&gt;

&lt;p&gt;Thrift, Hadoop, jopt-simple, and paranamer are left unchanged.&lt;/p&gt;</comment>
                            <comment id="13203301" author="scott_carey" created="Wed, 8 Feb 2012 05:55:48 +0000"  >&lt;p&gt;I will commit this tomorrow if there are no objections.&lt;/p&gt;</comment>
                            <comment id="13203823" author="cutting" created="Wed, 8 Feb 2012 18:33:29 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13203834" author="scott_carey" created="Wed, 8 Feb 2012 18:46:44 +0000"  >&lt;p&gt;Committed @revision 1242039&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12513767" name="AVRO-995.2.patch" size="4512" author="scott_carey" created="Wed, 8 Feb 2012 05:54:54 +0000"/>
                            <attachment id="12510808" name="AVRO-995.patch" size="5255" author="scott_carey" created="Tue, 17 Jan 2012 04:55:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 23 Jan 2012 23:36:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224100</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-996] Java: SpecificRecord builder pattern object copy fails with unions in some cases</title>
                <link>https://issues.apache.org/jira/browse/AVRO-996</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;I have a union of multiple records that fails to copy correctly with the MySpecificRecord.newBuilder(recordToCopy).build(); pattern.&lt;/p&gt;

&lt;p&gt;I have a reproducible test case that I will attach shortly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538602">AVRO-996</key>
            <summary>Java: SpecificRecord builder pattern object copy fails with unions in some cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbaldassari">James Baldassari</assignee>
                                    <reporter username="scott_carey">Scott Carey</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jan 2012 06:44:51 +0000</created>
                <updated>Wed, 15 Feb 2012 00:46:25 +0000</updated>
                            <resolved>Tue, 7 Feb 2012 07:24:54 +0000</resolved>
                                    <version>1.6.0</version>
                    <version>1.6.1</version>
                                    <fixVersion>1.6.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13187493" author="scott_carey" created="Tue, 17 Jan 2012 06:56:52 +0000"  >&lt;p&gt;contains a new context.avdl with a record containing a union of records, and a test that fails when using it.&lt;/p&gt;

&lt;p&gt;We probably need a Specific record for testing containing every type, and some non-trivial complex unions, arrays, and maps as well as various field with and without defaults. &lt;/p&gt;</comment>
                            <comment id="13191869" author="scott_carey" created="Tue, 24 Jan 2012 04:37:43 +0000"  >&lt;p&gt;I would like to see this bug fixed for 1.6.2+ but I have not had time to look into it in more detail and cannot do so for the next couple weeks.&lt;/p&gt;</comment>
                            <comment id="13191876" author="jbaldassari" created="Tue, 24 Jan 2012 04:48:53 +0000"  >&lt;p&gt;I&apos;ll try to find some time this week to take a look at it.  Thanks for attaching the test case.&lt;/p&gt;</comment>
                            <comment id="13192854" author="jbaldassari" created="Wed, 25 Jan 2012 04:32:30 +0000"  >&lt;p&gt;I had some time to work on it tonight.  I found that the root cause of this bug was the incorrect handling of union types by GenericData#deepCopy(Schema, Object).  Patch coming soon.&lt;/p&gt;</comment>
                            <comment id="13192873" author="jbaldassari" created="Wed, 25 Jan 2012 06:10:46 +0000"  >&lt;p&gt;While investigating this issue I also found a couple of other bugs related to the specific record builder, this time in the generated code:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The build() method does not validate that all required (i.e. non-nullable) fields have been set&lt;/li&gt;
	&lt;li&gt;It&apos;s possible for build() to throw NPE when defaultValue(Field) returns null and then the result of that call is set in a primitive field&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m also going to include the fixes for the above issues in this patch, unless anyone thinks it would be better to split them out into a separate issue/patch.&lt;/p&gt;</comment>
                            <comment id="13192877" author="jbaldassari" created="Wed, 25 Jan 2012 06:18:36 +0000"  >&lt;p&gt;Thinking about this some more, fixing the first issue (lack of validation in build()) may technically not be backwards-compatible.  The code will be, but the behavior might not be.  The second change (fixing the NPE in build()) should be fine.&lt;/p&gt;</comment>
                            <comment id="13192912" author="jbaldassari" created="Wed, 25 Jan 2012 07:26:19 +0000"  >&lt;p&gt;Here&apos;s a patch that fixes union copying in a builder.  This includes Scott&apos;s original test (which now passes) as well as a new test I created which copies Interop instances.  I decided not to include the other fixes I mentioned in this patch.  I&apos;ll create separate issues for those.&lt;/p&gt;</comment>
                            <comment id="13201487" author="scott_carey" created="Mon, 6 Feb 2012 19:18:27 +0000"  >&lt;p&gt;+1 looks good!&lt;/p&gt;</comment>
                            <comment id="13201717" author="cutting" created="Mon, 6 Feb 2012 22:39:46 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13202132" author="jbaldassari" created="Tue, 7 Feb 2012 07:24:54 +0000"  >&lt;p&gt;Thanks for the review.  Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12510815" name="AVRO-996.bug.patch" size="3143" author="scott_carey" created="Tue, 17 Jan 2012 06:56:51 +0000"/>
                            <attachment id="12511814" name="AVRO-996.fix.patch" size="6370" author="jbaldassari" created="Wed, 25 Jan 2012 07:26:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 24 Jan 2012 04:48:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224106</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3qv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80369</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-997] Generic API should require GenericEnumSymbol when writing Avro Enums</title>
                <link>https://issues.apache.org/jira/browse/AVRO-997</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;I have a schema like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt;&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Gender&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;symbols&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;M&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;F&quot;&lt;/span&gt;]
},

{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Foo&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt; : [
    { &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : [&lt;span class=&quot;code-quote&quot;&gt;&quot;Gender&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;gender&quot;&lt;/span&gt; },
    ...
  ]
}
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I build a record like &lt;tt&gt;Foo foo = new Foo(); foo.gender = Gender.M;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;When I go to serialize this, I get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Not in union [{&lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt;&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Gender&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;symbols&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;M&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;F&quot;&lt;/span&gt;]},&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;]: M
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericData.resolveUnion(GenericData.java:482)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:70)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.writeRecord(GenericDatumWriter.java:104)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:65)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:57)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12538833">AVRO-997</key>
            <summary>Generic API should require GenericEnumSymbol when writing Avro Enums</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="busbey">Sean Busbey</assignee>
                                    <reporter username="kimballa">Aaron Kimball</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Jan 2012 16:40:54 +0000</created>
                <updated>Thu, 10 Nov 2016 09:56:20 +0000</updated>
                            <resolved>Fri, 3 Oct 2014 20:34:09 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>1.8.0</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13188873" author="scott_carey" created="Thu, 19 Jan 2012 01:58:45 +0000"  >&lt;p&gt;The following works in Avro 1.6.1, not sure about Avro 1.5.1 (it would need to be modified since it uses Schema.Parser)&lt;br/&gt;
This does not test an object created by the Specific Record API.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testWriteNullableEnum() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    Schema.Parser p = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema.Parser();
    Schema genderSchema = p.parse(
        &lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt;
        + &lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;type\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;
        + &lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;name\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;Gender\&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;
        + &lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;symbols\&lt;span class=&quot;code-quote&quot;&gt;&quot;: [\&quot;&lt;/span&gt;M\&lt;span class=&quot;code-quote&quot;&gt;&quot;, \&quot;&lt;/span&gt;F\&lt;span class=&quot;code-quote&quot;&gt;&quot;]&quot;&lt;/span&gt;
        +&lt;span class=&quot;code-quote&quot;&gt;&quot;}&quot;&lt;/span&gt;);
    Schema fooSchema = p.parse(
        &lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt;
        + &lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;type\&lt;span class=&quot;code-quote&quot;&gt;&quot; : \&quot;&lt;/span&gt;record\&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;
        + &lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;name\&lt;span class=&quot;code-quote&quot;&gt;&quot; : \&quot;&lt;/span&gt;Foo\&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;
        + &lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;fields\&lt;span class=&quot;code-quote&quot;&gt;&quot; : [&quot;&lt;/span&gt;
        + &lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;type\&lt;span class=&quot;code-quote&quot;&gt;&quot; : [\&quot;&lt;/span&gt;Gender\&lt;span class=&quot;code-quote&quot;&gt;&quot;, \&quot;&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;], \&quot;&lt;/span&gt;name\&lt;span class=&quot;code-quote&quot;&gt;&quot; : \&quot;&lt;/span&gt;gender\&lt;span class=&quot;code-quote&quot;&gt;&quot; }&quot;&lt;/span&gt;
        +&lt;span class=&quot;code-quote&quot;&gt;&quot;]}&quot;&lt;/span&gt;);
    
    GenericData.Record foo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericData.Record(fooSchema);
    
    foo.put(0, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericData.EnumSymbol(genderSchema, &lt;span class=&quot;code-quote&quot;&gt;&quot;M&quot;&lt;/span&gt;));
    
    GenericDatumWriter&amp;lt;GenericData.Record&amp;gt; w = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericDatumWriter&amp;lt;GenericData.Record&amp;gt;(fooSchema);
    
    ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
    Encoder e = EncoderFactory.get().binaryEncoder(baos, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    
    w.write(foo, e);
    
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Note that with a SpecificRecord, the enum must be a GenericData.EnumSymbol, it does not currently support a Java enum.&lt;/p&gt;</comment>
                            <comment id="13188881" author="kimballa" created="Thu, 19 Jan 2012 02:15:47 +0000"  >&lt;p&gt;&lt;tt&gt;Foo&lt;/tt&gt; is a SpecificRecord. The &lt;tt&gt;Gender&lt;/tt&gt; type generated by Avro is a Java &lt;tt&gt;enum&lt;/tt&gt;; is this a bug in the Avro code generator, or am I just misusing it?&lt;/p&gt;</comment>
                            <comment id="13188894" author="scott_carey" created="Thu, 19 Jan 2012 02:49:13 +0000"  >&lt;p&gt;If that is the case, then this is a bug.  GenericData.resolveUnion() only operates on &apos;instanceof GenericEnumSymbol&apos; for enums.&lt;/p&gt;

&lt;p&gt;This means that an Enum in a union of any kind cannot be serialized in a SpecificRecord.  This is either a bug where SpecificData should override GenericData&apos;s behavior and handle the Java enum, or GenericData should handle java Enums as well.&lt;/p&gt;

&lt;p&gt;It also means we need better test coverage on SpecificRecords.&lt;/p&gt;</comment>
                            <comment id="13188896" author="scott_carey" created="Thu, 19 Jan 2012 02:52:44 +0000"  >&lt;p&gt;As a work-around, you may be able to wrap the Enum inside another record.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt;&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Gender&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;symbols&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;M&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;F&quot;&lt;/span&gt;]
},

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;GenderWrapper&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;: [
  {&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;gender&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Gender&quot;&lt;/span&gt;}
  ]
},

{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Foo&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt; : [
    { &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : [&lt;span class=&quot;code-quote&quot;&gt;&quot;GenderWrapper&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;gender&quot;&lt;/span&gt; },
    ...
  ]
}
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13188900" author="kimballa" created="Thu, 19 Jan 2012 02:56:43 +0000"  >&lt;p&gt;For now I&apos;m working around this by adding a third &lt;tt&gt;Unspecified&lt;/tt&gt; symbol to my enum, and removing the union with null entirely. Thanks for taking a look.&lt;/p&gt;</comment>
                            <comment id="13189289" author="cutting" created="Thu, 19 Jan 2012 18:59:02 +0000"  >&lt;p&gt;SpecificData#isEnum() overrides GenericData#isEnum() and returns true for instances of Enum.  So this should work.  Also, TestSpecificDatumWriter#testResolveUnion writes and reads an instance of a record with a field whose type is a union of &quot;null&quot; and an enum using generated, specific code.  So this appears to be tested.&lt;/p&gt;

&lt;p&gt;Aaron, can you provide a simple, complete test that fails?  Also, what version of Avro are you using?&lt;/p&gt;</comment>
                            <comment id="13189311" author="scott_carey" created="Thu, 19 Jan 2012 19:23:25 +0000"  >&lt;p&gt;Ah, I missed that test.  &lt;/p&gt;

&lt;p&gt;In that case, a GenericDatumWriter may be being used to serialize a SpecificRecord, which won&apos;t work.  SpecificRecord however is an instance of IndexedRecord, so the API won&apos;t complain and it will work for &apos;most&apos; operations.&lt;/p&gt;
</comment>
                            <comment id="13189382" author="kimballa" created="Thu, 19 Jan 2012 21:19:49 +0000"  >&lt;p&gt;Doug, I&apos;m using Avro 1.5.1 as noted in the affectsVersion field of this ticket.&lt;/p&gt;

&lt;p&gt;Scott, you&apos;re correct: our system uses a single codepath to serialize all values passed in from the client/data layer to the underlying storage. This codepath accepts generic and specific values, and we currently always allocate a GenericDatumWriter for each schema. At least until this particular schema, this has always worked.&lt;/p&gt;

&lt;p&gt;Is this an illegal use of GenericDatumWriter? If so, maybe its write() method could warn (or more strongly, throw an exception) if an instance of SpecificRecord is passed as an argument?&lt;/p&gt;</comment>
                            <comment id="13189446" author="cutting" created="Thu, 19 Jan 2012 22:34:39 +0000"  >&lt;p&gt;SpecificDatumWriter can write both generic and specific instances, while GenericDatumWriter is only intended to correctly write generic instances.&lt;/p&gt;</comment>
                            <comment id="13189451" author="kimballa" created="Thu, 19 Jan 2012 22:38:29 +0000"  >&lt;p&gt;Thanks. In that case, this might be resolved as Invalid, unless you think it merits an exception, documentation fix, etc. as I suggest above.&lt;/p&gt;</comment>
                            <comment id="13192672" author="cutting" created="Tue, 24 Jan 2012 23:46:07 +0000"  >&lt;p&gt;I think in current trunk you&apos;d get &quot;Unknown datum type: M&quot; which is somewhat more informative than the 1.5.1 message.  Maybe this could be improved to something like, &quot;Unknown datum for GenericData: M&quot; to hint that specific, reflect, thrift, protobuf or some other data model might be better?&lt;/p&gt;</comment>
                            <comment id="13471575" author="busbey" created="Mon, 8 Oct 2012 14:27:30 +0000"  >&lt;p&gt;I just ran into this as part of Hive&apos;s integration with Avro 1.7.1 (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3538&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HIVE-3538&lt;/a&gt;). AFAICT, Hive only makes use of the Generic API.&lt;/p&gt;

&lt;p&gt;GenericData.validate returns true for a record with an Avro enum or a union that contains an Avro enum so long as the result of datum.toString is in the set of elements. Actually serializing works fine for arbitrary incoming values when the field is an Avro enum, but fails in the union case if the value isn&apos;t GenericEnumSymbol. In addition to Java enums, this seems likely to come up for GenericData users when they attempt to use Strings.&lt;/p&gt;

&lt;p&gt;This seems like a bug for GenericData. I could provide a patch that makes GenericDatumWriter.write consistent with GenericData.validate for the union case, if there&apos;s interest. Alternatively, I could provide one that causes the validate and write calls to be stricter wrt to the plain enum case, which I think would help avoid user confusion if enums are only supposed to be GenericEnumSybmol.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13471728" author="cutting" created="Mon, 8 Oct 2012 18:26:14 +0000"  >&lt;p&gt;I think GenericData#validate() and GenericDatumWriter#writeEnum() could both be stricter, failing when isEnum(datum) is false.  That would be an incompatible change though, possibly breaking applications.&lt;/p&gt;

&lt;p&gt;Here&apos;s the patch I used to try this.  Tests pass.  We should probably add some tests that fail without this change too before committing something like this.&lt;/p&gt;</comment>
                            <comment id="13471791" author="busbey" created="Mon, 8 Oct 2012 19:29:13 +0000"  >&lt;p&gt;I can add some tests that fail suitably. To ease fixing existing users of the generic api, would it be fine if I added a constructor to GenericData.EnumSymbol that allowed for Java Enums for the passed in symbol?&lt;/p&gt;</comment>
                            <comment id="13471802" author="cutting" created="Mon, 8 Oct 2012 19:37:49 +0000"  >&lt;p&gt;&amp;gt; I can add some tests that fail suitably.&lt;/p&gt;

&lt;p&gt;Great!  Thanks!&lt;/p&gt;

&lt;p&gt;&amp;gt; would it be fine if I added a constructor to GenericData.EnumSymbol that allowed for Java Enums for the passed in symbol?&lt;/p&gt;

&lt;p&gt;I don&apos;t see a problem with that.  We might have a constructor that accepts Object and calls toString()?&lt;/p&gt;</comment>
                            <comment id="13471876" author="busbey" created="Mon, 8 Oct 2012 21:29:00 +0000"  >&lt;p&gt;Updated patch with tests that fail if GenericData.validate or GenericDatumWriter.write allow the use of String/Java Enum with an Avro enum schema.&lt;/p&gt;

&lt;p&gt;Also adds a constructor to GenericData.EnumSymbol to ease proper use of the generic api.&lt;/p&gt;</comment>
                            <comment id="13471962" author="cutting" created="Mon, 8 Oct 2012 23:45:15 +0000"  >&lt;p&gt;Thanks, Sean.  The tests look great.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this soon unless there are objections.&lt;/p&gt;

&lt;p&gt;I think the minor incompatible runtime change here should cause our next release to be called 1.8.0 rather than 1.7.3.  But I&apos;ll delay changing the Fix-for on other 1.7.3 issues for now though in case we decide to do a compatible 1.7.3 bugfix release.&lt;/p&gt;</comment>
                            <comment id="13473831" author="scott_carey" created="Thu, 11 Oct 2012 04:28:24 +0000"  >&lt;p&gt;Without looking at this in depth:&lt;/p&gt;

&lt;p&gt;Why is it not a good idea to let the Generic API use a String or Java Enum?  It would not break compatibility.  What is the downside of expanding what GenericDatumWriter can handle for Enums?&lt;/p&gt;</comment>
                            <comment id="13474376" author="cutting" created="Thu, 11 Oct 2012 18:03:10 +0000"  >&lt;p&gt;Representations of the different types must be distinguishable at runtime to correctly write unions.  If you have a union like [&quot;string&quot;, &lt;/p&gt;
{&quot;type&quot;:&quot;enum&quot;, ...}
&lt;p&gt;] and an enum symbol could be represented as a string then you wouldn&apos;t know which branch of the union was intended.  (The implementation of union writing uses a hash-table keyed by type name, so types are not tried in order.)&lt;/p&gt;

&lt;p&gt;Currently generic accepts strings when writing enums outside of unions, but when writing a union an enum must be represented as a GenericEnumSymbol.  Enum values are always read by generic as GenericEnumSymbol.  The patch I attached changes generic to be consistent, so that strings are not acceptable as enum symbols anywhere, a GenericEnumSymbol must always be used.  With specific &amp;amp; reflect this is extended to include Java Enum types.&lt;/p&gt;</comment>
                            <comment id="13474548" author="busbey" created="Thu, 11 Oct 2012 22:04:30 +0000"  >&lt;p&gt;Scott, I could write a patch that maintains the current behavior for unions of &quot;things that look like enum members when toString is called&quot; and enums, which is to say the non-enum type gets picked if it is present. eg [&quot;string&quot;, &quot;long&quot;, &lt;/p&gt;
{&quot;type&quot;:&quot;enum&quot;, &quot;symbols&quot;:[&quot;ONE&quot;, &quot;TWO&quot;, &quot;42&quot;]}
&lt;p&gt;] says that &quot;ONE&quot; is a string and 42 is a long. Since it would be consistent with current behavior, a warning in the API about the coercion might be sufficient. It would be less efficient than picking the enum member, but doing that would be just as breaking as reworking the generic api to be strict.&lt;/p&gt;

&lt;p&gt;The only time I&apos;ve seen this come up is when someone has a union field and then wants to mark it as optional so they move it to a union with null. While their original use of Java String for field values was incorrect, the generic api as is would have worked fine up until the addition of the union. In general I&apos;m a fan of &quot;just works&quot; behavior from APIs, but I can understand Doug&apos;s desire to favor consistent strict application as a way of steering users away from behavior that will lead to confusing non-roundtrip-able edge cases.&lt;/p&gt;</comment>
                            <comment id="13474561" author="cutting" created="Thu, 11 Oct 2012 22:23:30 +0000"  >&lt;p&gt;Sean: To be clear, I won&apos;t be upset if we don&apos;t commit this.  I don&apos;t feel very strongly one way or the other.  I thought that you felt the current implementation was a bug.  I wrote the patch to see how hard this would be to change, and, having it written it, posted it.  Right now the implementation is lenient, only requiring GenericEnumSymbol when writing a union containing an enum, otherwise accepting anything whose toString() returns a matching symbol.  That can be confusing, but it also simplifies many programs.&lt;/p&gt;

&lt;p&gt;Maybe this is just a documentation issue?&lt;/p&gt;</comment>
                            <comment id="13474573" author="busbey" created="Thu, 11 Oct 2012 22:38:33 +0000"  >&lt;p&gt;Oh no, I definitely think the current behavior is a bug. Specifically having validate pass but write fail is incorrect. I also think that my enum shouldn&apos;t stop working just because it&apos;s in a union, omitting ambiguities such as the string-enum union.&lt;/p&gt;

&lt;p&gt;Making everything consistent by checking to see if the toString is in the enum member of a union after &lt;a href=&quot;http://svn.apache.org/viewvc/avro/trunk/lang/java/avro/src/main/java/org/apache/avro/generic/GenericData.java?view=markup&amp;amp;pathrev=1384500&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;GenericDate.resolveUnion has done the existing membership checks (~line 574)&lt;/a&gt; would solve the part of this that I consider a bug, while making things easier for existing users (like the Hive issue that brought me here). I&apos;ll post a patch tomorrow showing how this would work (and an alternate set of tests that would correspond to the failing prior to the fix).&lt;/p&gt;

&lt;p&gt;I think in any case there&apos;ll be a documentation component, either calling out the use of GenericEnumSymbol or warning users about the possibly surprising case of enum members ending up as avro strings in serialized data.&lt;/p&gt;</comment>
                            <comment id="13476413" author="busbey" created="Mon, 15 Oct 2012 20:31:51 +0000"  >&lt;p&gt;Alternative non-breaking patch. Makes the generic api more permissive about use of things other than GenericEnumSymbol with enum schemas. See &lt;a href=&quot;https://reviews.apache.org/r/7606/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;review board&lt;/a&gt; for details.&lt;/p&gt;</comment>
                            <comment id="13492693" author="cutting" created="Wed, 7 Nov 2012 21:03:00 +0000"  >&lt;p&gt;Sean, I prefer the simpler more consistent approach of my patch.  All other schemas use distinct types in Java, why shouldn&apos;t enums?&lt;/p&gt;</comment>
                            <comment id="13494555" author="busbey" created="Sat, 10 Nov 2012 03:51:49 +0000"  >&lt;p&gt;The only reason I think enums are different is because I&apos;ve seen people use them differently to date. Going with a consistent, stict enforcement would be fine; the only down side is pain to existing users. I only included the patch so we have a clearer view of the additional maintenance cost of maintaining compatibility.&lt;/p&gt;

&lt;p&gt;I&apos;m more concerned that &lt;em&gt;one&lt;/em&gt; of the patches get applied then I am with which one it is. I&apos;m fine with fixing Hive downstream whichever way this goes.&lt;/p&gt;</comment>
                            <comment id="13919659" author="mtthwcmpbll" created="Tue, 4 Mar 2014 17:28:28 +0000"  >&lt;p&gt;We&apos;re running into this issue as well on Avro 1.7.6.  We&apos;ve got a IDL that imports some enum schemas in JSON format (provided by another tool) and we want to have some optional fields in a record of the enum type.  These types can&apos;t be serialized, though.  Just putting a +1 in for this being a blocker for us.  We&apos;ll work around it in our model for now, but I wanted to leave a note here since the issue has a patch but hasn&apos;t been touched in a while.&lt;/p&gt;</comment>
                            <comment id="14085360" author="busbey" created="Mon, 4 Aug 2014 21:47:57 +0000"  >&lt;p&gt;Updated patch for current trunk; some parts OBE by other tickets, fixed some newer tests.&lt;/p&gt;</comment>
                            <comment id="14155480" author="cutting" created="Wed, 1 Oct 2014 20:46:31 +0000"  >&lt;p&gt;I still think we&apos;re inviting confusion by not consistently requiring that isEnum() is true of enum values.  Things are clearer if we throw exceptions when folks try to use other types for enum symbols.  Automagically accepting any type whose toString() implementation returns a symbol in the enumeration only works in some cases.  There are cases where a distinct type is required.  Think about documenting this: it gets harder to document if we&apos;re more permissive, and complex documentation is a sign of a confusing API.&lt;/p&gt;</comment>
                            <comment id="14155722" author="busbey" created="Wed, 1 Oct 2014 22:48:04 +0000"  >&lt;p&gt;AFAIK, this patch does require isEnum everywhere; that&apos;s why it was originally pushed out to 1.8.0. It even adds tests to make sure using a String or Java enum fails.&lt;/p&gt;

&lt;p&gt;Can you be more specific about where there&apos;s a gap?&lt;/p&gt;</comment>
                            <comment id="14155759" author="cutting" created="Wed, 1 Oct 2014 23:12:21 +0000"  >&lt;p&gt;Sorry, I was looking at the wrong patch!&lt;/p&gt;

&lt;p&gt;I&apos;m +1 on the latest version of the patch &amp;amp; will commit it soon if there are no objections.&lt;/p&gt;</comment>
                            <comment id="14158492" author="jira-bot" created="Fri, 3 Oct 2014 20:33:39 +0000"  >&lt;p&gt;Commit 1629315 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cutting&quot; class=&quot;user-hover&quot; rel=&quot;cutting&quot;&gt;Doug Cutting&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1629315&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1629315&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-997&quot; title=&quot;Generic API should require GenericEnumSymbol when writing Avro Enums&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-997&quot;&gt;&lt;del&gt;AVRO-997&lt;/del&gt;&lt;/a&gt;. Java: For enum values, no longer sometimes permit any Object whose toString() names an enum symbol, but rather always require use of distinct enum types.  Contributed by Sean Busbey.&lt;/p&gt;</comment>
                            <comment id="14158493" author="cutting" created="Fri, 3 Oct 2014 20:34:09 +0000"  >&lt;p&gt;I committed this.  Thanks, Sean!&lt;/p&gt;</comment>
                            <comment id="14158537" author="busbey" created="Fri, 3 Oct 2014 21:20:11 +0000"  >&lt;p&gt;Updated subject to reflect the change that happened. Also added a release note since this is an incompatible change.&lt;/p&gt;</comment>
                            <comment id="14158557" author="hudson" created="Fri, 3 Oct 2014 21:37:32 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #484 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/484/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/484/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-997&quot; title=&quot;Generic API should require GenericEnumSymbol when writing Avro Enums&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-997&quot;&gt;&lt;del&gt;AVRO-997&lt;/del&gt;&lt;/a&gt;. Java: For enum values, no longer sometimes permit any Object whose toString() names an enum symbol, but rather always require use of distinct enum types.  Contributed by Sean Busbey. (cutting: rev 1629315)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/avro/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/avro/trunk/lang/java/avro/src/main/java/org/apache/avro/generic/GenericData.java&lt;/li&gt;
	&lt;li&gt;/avro/trunk/lang/java/avro/src/main/java/org/apache/avro/generic/GenericDatumWriter.java&lt;/li&gt;
	&lt;li&gt;/avro/trunk/lang/java/avro/src/test/java/org/apache/avro/TestSchemaCompatibility.java&lt;/li&gt;
	&lt;li&gt;/avro/trunk/lang/java/avro/src/test/java/org/apache/avro/generic/TestGenericData.java&lt;/li&gt;
	&lt;li&gt;/avro/trunk/lang/java/avro/src/test/java/org/apache/avro/generic/TestGenericDatumWriter.java&lt;/li&gt;
	&lt;li&gt;/avro/trunk/lang/java/ipc/src/test/java/org/apache/avro/TestCompare.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12610465">HIVE-3538</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13019527">PIG-5056</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12659735" name="AVRO-997.patch" size="7166" author="busbey" created="Mon, 4 Aug 2014 21:47:57 +0000"/>
                            <attachment id="12548300" name="AVRO-997.patch" size="6964" author="busbey" created="Mon, 8 Oct 2012 21:29:00 +0000"/>
                            <attachment id="12548271" name="AVRO-997.patch" size="2952" author="cutting" created="Mon, 8 Oct 2012 18:26:14 +0000"/>
                            <attachment id="12549202" name="AVRO-997.permissive-generic-api.patch" size="15491" author="busbey" created="Mon, 15 Oct 2012 20:31:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 19 Jan 2012 01:58:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224336</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06bp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34828</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Previous versions of Avro&amp;#39;s Java library allowed String and Java Enum values to be used in the Generic API when writing fields that are Avro Enums. This change makes the Generic API strict by requiring GenericEnumSymbol instances. To ease updating downstream projects it also adds a constructor for GenericData.EnumSymbol that calls toString on a passed Object.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-998] The Avro tools-jar isn&apos;t going to work in the classpath of most projects, since it has all of the dependencies inside</title>
                <link>https://issues.apache.org/jira/browse/AVRO-998</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The Avro tools-jar isn&apos;t going to work in the class path of most projects, since it has all of the dependencies inside of it like SLF4J. I know that SLF4J works fine with warning in case of multiple warning but still is there any way to get to fix issue? &lt;br/&gt;
I am using only one ReflectionToStringBuilder class from avro-tools.jar file. FYI&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538864">AVRO-998</key>
            <summary>The Avro tools-jar isn&apos;t going to work in the classpath of most projects, since it has all of the dependencies inside</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nimeshs">Nimesh</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Jan 2012 19:05:38 +0000</created>
                <updated>Thu, 8 Oct 2015 02:59:08 +0000</updated>
                            <resolved>Wed, 18 Jan 2012 23:18:24 +0000</resolved>
                                    <version>1.6.0</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13188673" author="nimeshs" created="Wed, 18 Jan 2012 20:19:30 +0000"  >&lt;p&gt;So I need only one class from avro-tools because other dependencies added in tools jar are already there in my project dependencies like SLF4J &amp;amp; javax.servlet.&lt;br/&gt;
In summary, I need avro-tools jar with Reflection feature.&lt;/p&gt;</comment>
                            <comment id="13188793" author="scott_carey" created="Wed, 18 Jan 2012 23:14:46 +0000"  >&lt;p&gt;Avro builds two versions of the tools jar:&lt;/p&gt;

&lt;p&gt;avro-tools-VERSION.jar   which contains all dependencies and is intended to be used by command line.&lt;br/&gt;
avro-tools-VERSION-nodeps.jar  which does not bundle dependencies.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/org/apache/avro/avro-tools/1.6.1/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://repo1.maven.org/maven2/org/apache/avro/avro-tools/1.6.1/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The latter can be accessed with a &lt;br/&gt;
&apos;nodeps&apos; classifier in maven:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.avro&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;avro-tools&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;classifier&amp;gt;&lt;/span&gt;nodeps&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/classifier&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13188796" author="scott_carey" created="Wed, 18 Jan 2012 23:18:24 +0000"  >&lt;p&gt;avro-tools jar with &apos;nodeps&apos; classifier meets this requirement.&lt;/p&gt;</comment>
                            <comment id="13189209" author="nimeshs" created="Thu, 19 Jan 2012 17:14:24 +0000"  >&lt;p&gt;Thanks, Scott!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12903224">AVRO-1745</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 18 Jan 2012 23:14:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224367</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3r3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80370</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-999] NPE in Java, RecordBuilderBase.defaultValue</title>
                <link>https://issues.apache.org/jira/browse/AVRO-999</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;If you have a union with a default of null, the code in RecordBuilderBase.defaultValue will cause an NPE in ConcurrentHashMap, since it is trying to add a null to the map.&lt;/p&gt;

&lt;p&gt;Sample union:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;record Sample {
    union{&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, string} value = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// If not cached, get the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; Java value by encoding the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; JSON
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// value and then decoding it:
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (defaultValue == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
  encoder = EncoderFactory.get().binaryEncoder(baos, encoder);
  ResolvingGrammarGenerator.encode(encoder, field.schema(), defaultJsonValue);
  encoder.flush();
  decoder = DecoderFactory.get().binaryDecoder(baos.toByteArray(), decoder);
  defaultValue = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericDatumReader(field.schema()).read(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, decoder);
  defaultSchemaValues.putIfAbsent(field.pos(), defaultValue); &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;-- NPE from here
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Java&lt;/p&gt;</environment>
        <key id="12539028">AVRO-999</key>
            <summary>NPE in Java, RecordBuilderBase.defaultValue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jrutten">Jay Rutten</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Jan 2012 20:10:32 +0000</created>
                <updated>Tue, 25 Sep 2012 21:24:32 +0000</updated>
                            <resolved>Thu, 23 Feb 2012 22:14:46 +0000</resolved>
                                    <version>1.6.1</version>
                                    <fixVersion>1.6.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13189567" author="jbaldassari" created="Fri, 20 Jan 2012 01:39:09 +0000"  >&lt;p&gt;Good catch.  Here&apos;s a patch with a unit test for this case.&lt;/p&gt;</comment>
                            <comment id="13214103" author="cutting" created="Wed, 22 Feb 2012 23:24:08 +0000"  >&lt;p&gt;I think this was already fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1007&quot; title=&quot;Insufficient validation in generated specific record builder implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1007&quot;&gt;&lt;del&gt;AVRO-1007&lt;/del&gt;&lt;/a&gt;.  Can I close it as a duplicate?&lt;/p&gt;</comment>
                            <comment id="13214263" author="jbaldassari" created="Thu, 23 Feb 2012 03:30:45 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-999&quot; title=&quot;NPE in Java, RecordBuilderBase.defaultValue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-999&quot;&gt;&lt;del&gt;AVRO-999&lt;/del&gt;&lt;/a&gt; is slightly different from &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1007&quot; title=&quot;Insufficient validation in generated specific record builder implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1007&quot;&gt;&lt;del&gt;AVRO-1007&lt;/del&gt;&lt;/a&gt; as &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-999&quot; title=&quot;NPE in Java, RecordBuilderBase.defaultValue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-999&quot;&gt;&lt;del&gt;AVRO-999&lt;/del&gt;&lt;/a&gt; is specifically related to unions with null types.  I&apos;m not positive, though.  Either way I think we should commit the new test case this patch introduces to TestGenericRecordBuilder.  That should verify whether the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1007&quot; title=&quot;Insufficient validation in generated specific record builder implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1007&quot;&gt;&lt;del&gt;AVRO-1007&lt;/del&gt;&lt;/a&gt; actually fix this problem.&lt;/p&gt;</comment>
                            <comment id="13214909" author="cutting" created="Thu, 23 Feb 2012 18:24:08 +0000"  >&lt;p&gt;The test case added in this patch passes with the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1007&quot; title=&quot;Insufficient validation in generated specific record builder implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1007&quot;&gt;&lt;del&gt;AVRO-1007&lt;/del&gt;&lt;/a&gt;.  Also, the tests added in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1007&quot; title=&quot;Insufficient validation in generated specific record builder implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1007&quot;&gt;&lt;del&gt;AVRO-1007&lt;/del&gt;&lt;/a&gt; are substantially similar to the test added here.&lt;/p&gt;</comment>
                            <comment id="13214916" author="jbaldassari" created="Thu, 23 Feb 2012 18:32:23 +0000"  >&lt;p&gt;OK, great.  Then it should be fine to resolve this one if the &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1007&quot; title=&quot;Insufficient validation in generated specific record builder implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1007&quot;&gt;&lt;del&gt;AVRO-1007&lt;/del&gt;&lt;/a&gt; tests cover this case.&lt;/p&gt;</comment>
                            <comment id="13215182" author="scott_carey" created="Thu, 23 Feb 2012 23:14:10 +0000"  >&lt;p&gt;Fixed in 1.6.2 as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1007&quot; title=&quot;Insufficient validation in generated specific record builder implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1007&quot;&gt;&lt;del&gt;AVRO-1007&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12511210" name="AVRO-999.patch" size="3228" author="jbaldassari" created="Fri, 20 Jan 2012 01:39:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Jan 2012 01:39:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224530</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3rb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80371</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1000] GenericArray breaks List.equals specification [java]</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1000</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;GenericArray (or more precisely GenericData$Array) implements the java.util.List interface but breaks the equals specification (and the hashCode one if it&apos;s coherent though I haven&apos;t checked). More precisely, no List can be equal to a GenericArray unless it is a GenericArray itself. It makes using a &quot;List&quot; from an Avro Object fairly dangerous to use.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java API&lt;/p&gt;</environment>
        <key id="12539121">AVRO-1000</key>
            <summary>GenericArray breaks List.equals specification [java]</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cutting">Doug Cutting</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Jan 2012 10:48:29 +0000</created>
                <updated>Wed, 15 Feb 2012 00:46:25 +0000</updated>
                            <resolved>Mon, 23 Jan 2012 23:32:05 +0000</resolved>
                                                    <fixVersion>1.6.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13189923" author="cutting" created="Fri, 20 Jan 2012 17:19:54 +0000"  >&lt;p&gt;Here&apos;s a patch that fixes this.&lt;/p&gt;</comment>
                            <comment id="13189928" author="cutting" created="Fri, 20 Jan 2012 17:22:54 +0000"  >&lt;p&gt;I think it&apos;s safe to simply remove these methods.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this soon if there are no objections.&lt;/p&gt;</comment>
                            <comment id="13191620" author="cutting" created="Mon, 23 Jan 2012 23:32:05 +0000"  >&lt;p&gt;I committed this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12511279" name="AVRO-1000.patch" size="1860" author="cutting" created="Fri, 20 Jan 2012 17:19:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Jan 2012 17:19:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224623</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3rj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80372</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1001] Adding thread pool to NettyServerAvroHandler</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1001</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Request code review.&lt;/p&gt;

&lt;p&gt;The current NettyServer implementation processes each request/response sequentially on a single channel.  Thus in the case where a second request is received from the same client while a request is still being processed, the behavior is undefined.&lt;/p&gt;

&lt;p&gt;This patch updates NettyServerAvroHandler.messageReceived() to process each request in a separate thread using an ExecutorService. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12539184">AVRO-1001</key>
            <summary>Adding thread pool to NettyServerAvroHandler</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="shaunw">Shaun Williams</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Fri, 20 Jan 2012 17:55:36 +0000</created>
                <updated>Wed, 15 Feb 2012 00:49:22 +0000</updated>
                            <resolved>Tue, 7 Feb 2012 05:29:28 +0000</resolved>
                                    <version>1.6.1</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13189951" author="shaunw" created="Fri, 20 Jan 2012 17:58:38 +0000"  >&lt;p&gt;patch for non-blocking request handling in NettyServer.&lt;/p&gt;</comment>
                            <comment id="13189989" author="shaunw" created="Fri, 20 Jan 2012 18:39:32 +0000"  >&lt;p&gt;changed patch name to follow convention.&lt;/p&gt;</comment>
                            <comment id="13190801" author="jbaldassari" created="Sun, 22 Jan 2012 22:03:44 +0000"  >&lt;p&gt;Thanks for the patch.  I was surprised to see this issue because when the NettyServer is initialized it actually passes two different thread pools to the NioServerSocketChannelFactory:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; NettyServer(Responder responder, InetSocketAddress addr) {
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(responder, addr, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NioServerSocketChannelFactory
       (Executors .newCachedThreadPool(), Executors.newCachedThreadPool()));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first thread pool is for the Netty &quot;boss&quot; threads, and the second is for the Netty &quot;worker&quot; threads.  When I dug into the Netty code I found that Netty only starts a single pair of boss and worker threads for each Netty channel.  The worker thread sits in a for (;; ) loop selecting on the channel and then processing each message it receives in order.  So you&apos;re correct that only one RPC can be executing concurrently on a per-channel basis.  I was also able to reproduce this issue in a unit test.&lt;/p&gt;

&lt;p&gt;Given how Netty works, one work-around is to create a new client for each concurrent RPC that you want to execute.  This is not an ideal long-term solution, and I think your idea to add a new thread pool in NettyServer is a good fix.  However, the cached thread pool might not be the best implementation for all use cases.  For example, cached thread pools can be problematic in high-throughput environments because they are unbounded by definition.  So let&apos;s allow the ExecutorService to be passed into the NettyServer constructor if the user wants to specify a different/custom implementation.  As the default implementation, the cached thread pool should be fine, as long as it can be changed if necessary.&lt;/p&gt;

&lt;p&gt;I&apos;ll add my unit test to your patch to verify that this change fixes the issue.&lt;/p&gt;</comment>
                            <comment id="13190807" author="jbaldassari" created="Sun, 22 Jan 2012 22:36:07 +0000"  >&lt;p&gt;Actually, I wonder if &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-976&quot; title=&quot;NettyServer: enable use of an ExecutionHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-976&quot;&gt;&lt;del&gt;AVRO-976&lt;/del&gt;&lt;/a&gt; fixes this?&lt;/p&gt;</comment>
                            <comment id="13190812" author="jbaldassari" created="Sun, 22 Jan 2012 23:02:40 +0000"  >&lt;p&gt;I&apos;ve verified that &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-976&quot; title=&quot;NettyServer: enable use of an ExecutionHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-976&quot;&gt;&lt;del&gt;AVRO-976&lt;/del&gt;&lt;/a&gt; does in fact address this issue.  Just create the NettyServer like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Server server = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NettyServer(
  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpecificResponder(ProtocolInterface.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProtocolImplementation()), 
  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InetSocketAddress(0), 
  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NioServerSocketChannelFactory(
    Executors.newCachedThreadPool(), Executors.newCachedThreadPool()), 
  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecutionHandler(Executors.newCachedThreadPool()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I don&apos;t believe any changes are required in NettyServer to make RPCs execute concurrently, now that &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-976&quot; title=&quot;NettyServer: enable use of an ExecutionHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-976&quot;&gt;&lt;del&gt;AVRO-976&lt;/del&gt;&lt;/a&gt; has been committed.  However, I think we may want to specify an ExecutionHandler by default in the NettyServer, or at least make the documentation very clear that if an ExecutionHandler is not specified then each connection will be able to execute only one RPC at a time.  I&apos;ll clean up my unit test and submit it anyway.&lt;/p&gt;</comment>
                            <comment id="13190813" author="jbaldassari" created="Sun, 22 Jan 2012 23:07:40 +0000"  >&lt;p&gt;One other thing keep in mind is that the first RPC has to complete before any any subsequent RPCs can be executed.  That is, any subsequent RPCs will block until the first RPC has returned.  The reason is that the Avro handshake must be completed before any other communication can proceed.&lt;/p&gt;</comment>
                            <comment id="13190824" author="jbaldassari" created="Sun, 22 Jan 2012 23:53:53 +0000"  >&lt;p&gt;Here&apos;s a patch with a unit test showing that &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-976&quot; title=&quot;NettyServer: enable use of an ExecutionHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-976&quot;&gt;&lt;del&gt;AVRO-976&lt;/del&gt;&lt;/a&gt; is sufficient to allow concurrent execution of RPCs in NettyServer.&lt;/p&gt;</comment>
                            <comment id="13192967" author="jbaldassari" created="Wed, 25 Jan 2012 10:05:32 +0000"  >&lt;p&gt;Shaun, when you get a chance please let us know whether passing in an ExecutionHandler works for you.  If so, then maybe we could resolve this issue as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-976&quot; title=&quot;NettyServer: enable use of an ExecutionHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-976&quot;&gt;&lt;del&gt;AVRO-976&lt;/del&gt;&lt;/a&gt;, although we should still commit the unit test.&lt;/p&gt;</comment>
                            <comment id="13193189" author="shaunw" created="Wed, 25 Jan 2012 18:37:51 +0000"  >&lt;p&gt;Yes this does indeed resolve my issue.  Thanks!&lt;/p&gt;</comment>
                            <comment id="13202087" author="jbaldassari" created="Tue, 7 Feb 2012 05:29:28 +0000"  >&lt;p&gt;Resolving as duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-976&quot; title=&quot;NettyServer: enable use of an ExecutionHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-976&quot;&gt;&lt;del&gt;AVRO-976&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13202092" author="jbaldassari" created="Tue, 7 Feb 2012 05:42:50 +0000"  >&lt;p&gt;I submitted the patch that adds a unit test for concurrent execution as &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1019&quot; title=&quot;Add unit test for Netty server concurrent execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1019&quot;&gt;&lt;del&gt;AVRO-1019&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12534804">AVRO-976</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12541564">AVRO-1019</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12511458" name="AVRO-1001-test.patch" size="7534" author="jbaldassari" created="Sun, 22 Jan 2012 23:53:53 +0000"/>
                            <attachment id="12511301" name="AVRO-1001.patch" size="2523" author="shaunw" created="Fri, 20 Jan 2012 18:39:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 22 Jan 2012 22:03:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224686</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3rr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80373</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
