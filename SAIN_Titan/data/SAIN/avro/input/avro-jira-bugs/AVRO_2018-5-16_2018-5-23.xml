<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:26:42 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2018-5-16+AND+created+%3C%3D+2018-5-23+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="1" total="1"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-2179] Malformed data, the BinaryDecoder allocates large arrays</title>
                <link>https://issues.apache.org/jira/browse/AVRO-2179</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Recentlly I use avro find it has this problem:The memory suddenly explode and trigger the fullgc, So I dump the memory file. And then I use jvisualvm tool to analysis I found a org.apache.avro.util.Utf8 object and the bytes array length was over 1610470037.&lt;/p&gt;

&lt;p&gt;The method of readInt() shouldn&apos;t over limit, So I think it should be restricted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13160011">AVRO-2179</key>
            <summary>Malformed data, the BinaryDecoder allocates large arrays</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="zhy4013">Jonny</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 May 2018 12:34:37 +0000</created>
                <updated>Thu, 8 Nov 2018 19:17:43 +0000</updated>
                            <resolved>Thu, 8 Nov 2018 19:17:43 +0000</resolved>
                                    <version>1.8.2</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="16488307" author="githubbot" created="Thu, 24 May 2018 02:08:01 +0000"  >&lt;p&gt;zhy4013 opened a new pull request #311: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2179&quot; title=&quot;Malformed data, the BinaryDecoder allocates large arrays&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2179&quot;&gt;&lt;del&gt;AVRO-2179&lt;/del&gt;&lt;/a&gt;: Malformed data, the BinaryDecoder allocates large arrays&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/311&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/311&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16503902" author="githubbot" created="Wed, 6 Jun 2018 20:53:58 +0000"  >&lt;p&gt;cutting commented on a change in pull request #311: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2179&quot; title=&quot;Malformed data, the BinaryDecoder allocates large arrays&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2179&quot;&gt;&lt;del&gt;AVRO-2179&lt;/del&gt;&lt;/a&gt;: Malformed data, the BinaryDecoder allocates large arrays&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/311#discussion_r193555719&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/311#discussion_r193555719&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lang/java/avro/src/main/java/org/apache/avro/io/BinaryDecoder.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -257,6 +257,9 @@ public double readDouble() throws IOException {&lt;br/&gt;
   @Override&lt;br/&gt;
   public Utf8 readString(Utf8 old) throws IOException {&lt;br/&gt;
     int length = readInt();&lt;br/&gt;
+    if (limit &amp;gt; 0 &amp;amp;&amp;amp; length &amp;gt; limit) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I don&apos;t think &apos;limit&apos; will always work here.  That&apos;s just the end of the current valid input buffer, which may or may not always include the current string being read.  From a file it might always include the current compression block, which would always include the string, but there are other cases where it might not.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16504358" author="githubbot" created="Thu, 7 Jun 2018 07:52:48 +0000"  >&lt;p&gt;zhy4013 commented on a change in pull request #311: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2179&quot; title=&quot;Malformed data, the BinaryDecoder allocates large arrays&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2179&quot;&gt;&lt;del&gt;AVRO-2179&lt;/del&gt;&lt;/a&gt;: Malformed data, the BinaryDecoder allocates large arrays&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/311#discussion_r193655247&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/311#discussion_r193655247&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lang/java/avro/src/main/java/org/apache/avro/io/BinaryDecoder.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -257,6 +257,9 @@ public double readDouble() throws IOException {&lt;br/&gt;
   @Override&lt;br/&gt;
   public Utf8 readString(Utf8 old) throws IOException {&lt;br/&gt;
     int length = readInt();&lt;br/&gt;
+    if (limit &amp;gt; 0 &amp;amp;&amp;amp; length &amp;gt; limit) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I don&apos;t think &apos;length&apos; should exceed the end of the current valid input buffer when &apos;limit&apos; is greater than 0. If it&apos;s a file, ignore this condition judgment.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16506312" author="githubbot" created="Fri, 8 Jun 2018 17:40:48 +0000"  >&lt;p&gt;cutting commented on a change in pull request #311: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2179&quot; title=&quot;Malformed data, the BinaryDecoder allocates large arrays&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2179&quot;&gt;&lt;del&gt;AVRO-2179&lt;/del&gt;&lt;/a&gt;: Malformed data, the BinaryDecoder allocates large arrays&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/311#discussion_r194131263&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/311#discussion_r194131263&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lang/java/avro/src/main/java/org/apache/avro/io/BinaryDecoder.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -257,6 +257,9 @@ public double readDouble() throws IOException {&lt;br/&gt;
   @Override&lt;br/&gt;
   public Utf8 readString(Utf8 old) throws IOException {&lt;br/&gt;
     int length = readInt();&lt;br/&gt;
+    if (limit &amp;gt; 0 &amp;amp;&amp;amp; length &amp;gt; limit) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   If we can&apos;t be certain that limit will always be less than length then we cannot make this change.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16680118" author="githubbot" created="Thu, 8 Nov 2018 18:07:20 +0000"  >&lt;p&gt;dkulp commented on issue #311: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2179&quot; title=&quot;Malformed data, the BinaryDecoder allocates large arrays&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2179&quot;&gt;&lt;del&gt;AVRO-2179&lt;/del&gt;&lt;/a&gt;: Malformed data, the BinaryDecoder allocates large arrays&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/311#issuecomment-437099326&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/311#issuecomment-437099326&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This is definitely invalid.   If the stream is coming via http or something, the input buffer may be relatively small and definitely may not contain the entire string.  &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16680119" author="githubbot" created="Thu, 8 Nov 2018 18:07:21 +0000"  >&lt;p&gt;dkulp closed pull request #311: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2179&quot; title=&quot;Malformed data, the BinaryDecoder allocates large arrays&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2179&quot;&gt;&lt;del&gt;AVRO-2179&lt;/del&gt;&lt;/a&gt;: Malformed data, the BinaryDecoder allocates large arrays&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/311&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/311&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/lang/java/avro/src/main/java/org/apache/avro/io/BinaryDecoder.java b/lang/java/avro/src/main/java/org/apache/avro/io/BinaryDecoder.java&lt;br/&gt;
index 3711d2bd2..622d2db4e 100644&lt;br/&gt;
&amp;#8212; a/lang/java/avro/src/main/java/org/apache/avro/io/BinaryDecoder.java&lt;br/&gt;
+++ b/lang/java/avro/src/main/java/org/apache/avro/io/BinaryDecoder.java&lt;br/&gt;
@@ -257,6 +257,9 @@ public double readDouble() throws IOException {&lt;br/&gt;
   @Override&lt;br/&gt;
   public Utf8 readString(Utf8 old) throws IOException {&lt;br/&gt;
     int length = readInt();&lt;br/&gt;
+    if (limit &amp;gt; 0 &amp;amp;&amp;amp; length &amp;gt; limit) &lt;/p&gt;
{
+      throw new AvroRuntimeException(&quot;Malformed data. Length is too long: &quot; + length + &quot;, limit: &quot; + limit);
+    }
&lt;p&gt;     Utf8 result = (old != null ? old : new Utf8());&lt;br/&gt;
     result.setByteLength(length);&lt;br/&gt;
     if (0 != length) {&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16680219" author="dkulp" created="Thu, 8 Nov 2018 19:17:43 +0000"  >&lt;p&gt;For 1.9.0, I&apos;ve added a system property of &quot;org.apache.avro.limits.string.maxLength&quot; that can be used to set a maximum string length to read for Utf8 strings.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12923916" name="image2018-5-10_11-7-40.png" size="238167" author="zhy4013" created="Thu, 17 May 2018 12:06:38 +0000"/>
                            <attachment id="12923915" name="image2018-5-11_21-27-56.png" size="45243" author="zhy4013" created="Thu, 17 May 2018 12:11:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 May 2018 02:08:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ttx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
