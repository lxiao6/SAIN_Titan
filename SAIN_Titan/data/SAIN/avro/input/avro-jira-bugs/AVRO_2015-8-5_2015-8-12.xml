<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:22:12 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2015-8-5+AND+created+%3C%3D+2015-8-12+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="5" total="5"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-1712] NettyAvroRpcClient.configure() prevents timeouts less than one second</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1712</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The NettyAvroRpcClient prevents connection or request timeouts less than one second.  I would like to remove this restriction.  I&apos;m hoping to specify values down to around the tens-of-millisecond ranges.&lt;/p&gt;

&lt;p&gt;My actual use case is log4j/Flume with Load-Balancing Log4jAppender using Avro.  I have 50 clients hosts sending to 70 Flume collectors.  Under high load, log4j/Flume can spend a long time in timeouts to multiple destinations with the 1 second request/connect timeouts.  I would like to bring the NettyAvroRpcClient timeouts down into the 50 millisecond-or-so range to help avoid buffer overflows when one or more destinations are down.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12852578">AVRO-1712</key>
            <summary>NettyAvroRpcClient.configure() prevents timeouts less than one second</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jtbaldwin">Todd Baldwin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Aug 2015 13:45:29 +0000</created>
                <updated>Thu, 6 Aug 2015 13:45:29 +0000</updated>
                                            <version>1.7.7</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2if53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-1713] Typo - Extra character in pom</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1713</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;There is an extra character &apos;a&apos; at the end of outputDirectory in mapreduce&apos;s pom.&lt;/p&gt;

&lt;p&gt;&amp;lt;configuration&amp;gt;&lt;br/&gt;
              &amp;lt;stringType&amp;gt;String&amp;lt;/stringType&amp;gt;&lt;br/&gt;
              &amp;lt;includes&amp;gt;&lt;br/&gt;
                &amp;lt;include&amp;gt;*&lt;b&gt;/mapred/tether/&lt;/b&gt;.avpr&amp;lt;/include&amp;gt;&lt;br/&gt;
              &amp;lt;/includes&amp;gt;&lt;br/&gt;
            &amp;lt;sourceDirectory&amp;gt;${parent.project.basedir}/../../../../share/schemas/&amp;lt;/sourceDirectory&amp;gt;&lt;br/&gt;
              &amp;lt;outputDirectory&amp;gt;${project.build.directory}/generated-sources/java&amp;lt;/outputDirectory&amp;gt;a&lt;br/&gt;
            &amp;lt;/configuration&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12852612">AVRO-1713</key>
            <summary>Typo - Extra character in pom</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdblue">Ryan Blue</assignee>
                                    <reporter username="achalaggarwal">Achal Aggarwal</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Aug 2015 15:53:19 +0000</created>
                <updated>Fri, 7 Aug 2015 20:39:26 +0000</updated>
                            <resolved>Fri, 7 Aug 2015 19:41:57 +0000</resolved>
                                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14662048" author="rdblue" created="Fri, 7 Aug 2015 16:19:18 +0000"  >&lt;p&gt;Good catch! Looks like it&apos;s been there since 2011, so it is somehow not causing problems. Did you run into an issue caused by this or just happen to notice?&lt;/p&gt;</comment>
                            <comment id="14662101" author="achalaggarwal" created="Fri, 7 Aug 2015 17:16:05 +0000"  >&lt;p&gt;I was trying to import it in Intellij and just couldn&apos;t do it. Then I noticed this little fellow sitting there.&lt;/p&gt;</comment>
                            <comment id="14662325" author="jira-bot" created="Fri, 7 Aug 2015 19:41:41 +0000"  >&lt;p&gt;Commit 1694739 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blue%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;blue@cloudera.com&quot;&gt;Ryan Blue&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694739&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1694739&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1713&quot; title=&quot;Typo - Extra character in pom&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1713&quot;&gt;&lt;del&gt;AVRO-1713&lt;/del&gt;&lt;/a&gt;: Remove extra character in mapred POM.&lt;/p&gt;</comment>
                            <comment id="14662326" author="rdblue" created="Fri, 7 Aug 2015 19:41:57 +0000"  >&lt;p&gt;Fixed. Thanks for letting us know.&lt;/p&gt;</comment>
                            <comment id="14662401" author="hudson" created="Fri, 7 Aug 2015 20:39:26 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #539 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/539/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/539/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1713&quot; title=&quot;Typo - Extra character in pom&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1713&quot;&gt;&lt;del&gt;AVRO-1713&lt;/del&gt;&lt;/a&gt;: Remove extra character in mapred POM. (blue: rev 1694739)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/avro/trunk/lang/java/mapred/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Aug 2015 16:19:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ifcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1714] Nullable Named Schema definition in IDL fails.</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1714</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;According to Section 7.2 of the Avro IDL, named schemata may be treated as primitive types.&lt;/p&gt;

&lt;p&gt;As such, I believe it should be possible to create a nullable schema reference:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   record coordinate {
      string type;
   }

   record tweet {
      union {&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, coordinate} coordinate;
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to accommodate&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{  
   &lt;span class=&quot;code-quote&quot;&gt;&quot;coordinate&quot;&lt;/span&gt;:{  
      &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;point&quot;&lt;/span&gt;
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; and &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{  
   &lt;span class=&quot;code-quote&quot;&gt;&quot;coordinate&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;however, any attempt to store data against that schema results in&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.avro.AvroTypeException: Unknown union branch type
	at org.apache.avro.io.JsonDecoder.readIndex(JsonDecoder.java:445)
	at org.apache.avro.io.ResolvingDecoder.doAction(ResolvingDecoder.java:290)
	at org.apache.avro.io.parsing.Parser.advance(Parser.java:88)
	at org.apache.avro.io.ResolvingDecoder.readIndex(ResolvingDecoder.java:267)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.read(GenericDatumReader.java:155)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.readField(GenericDatumReader.java:193)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.readRecord(GenericDatumReader.java:183)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.read(GenericDatumReader.java:151)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.read(GenericDatumReader.java:142)
	at org.apache.avro.tool.DataFileWriteTool.run(DataFileWriteTool.java:99)
	at org.apache.avro.tool.Main.run(Main.java:85)
	at org.apache.avro.tool.Main.main(Main.java:74)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12852960">AVRO-1714</key>
            <summary>Nullable Named Schema definition in IDL fails.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="MarkPerris">Mark Perris</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Aug 2015 13:53:30 +0000</created>
                <updated>Sun, 30 Dec 2018 05:35:22 +0000</updated>
                                            <version>1.7.6</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2igwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-1715] Compiling a schema leaves the schema file open</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1715</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The schema compiler leaves the schema file open. This is demonstrated on the following code:&lt;/p&gt;

&lt;p&gt;File schemaFile = new File(&quot;schema.avsc&quot;);&lt;br/&gt;
SpecificCompiler.compileSchema(new File[] &lt;/p&gt;
{ schemaFile }
&lt;p&gt;, new File(&quot;output&quot;));&lt;br/&gt;
Files.delete(schemaFile.toPath());&lt;/p&gt;

&lt;p&gt;On Windows I get &quot;java.nio.file.FileSystemException: schema.avsc: The process cannot access the file because it is being used by another process.&quot;&lt;/p&gt;

&lt;p&gt;The problem is in Schema.java, method parse(File). This method creates a JsonParser for the schema file but never closes it, so the parser stays open together with the FileInputStream created by it. Closing the parser fixes the problem. I believe the same should be done for the other types of inputs as the json parsers do use more resources that should be freed. So I propose to close the parser in the parse(JsonParser) method. I will attach the patch.&lt;/p&gt;

&lt;p&gt;This is almost a blocker for our project and I would really appreciate if we can have this resolved for 1.8. Please let me know if that&apos;s possible and whether I should go ahead with merging the change myself (it&apos;s my first contribution here).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12852992">AVRO-1715</key>
            <summary>Compiling a schema leaves the schema file open</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pavel.safrata">Pavel Safrata</assignee>
                                    <reporter username="pavel.safrata">Pavel Safrata</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Aug 2015 16:13:03 +0000</created>
                <updated>Mon, 1 Feb 2016 14:55:56 +0000</updated>
                            <resolved>Wed, 7 Oct 2015 21:09:39 +0000</resolved>
                                    <version>1.7.7</version>
                    <version>1.8.0</version>
                                    <fixVersion>1.8.0</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14662037" author="pavel.safrata" created="Fri, 7 Aug 2015 16:14:02 +0000"  >&lt;p&gt;Please review the patch and let me know how to proceed. Thanks.&lt;/p&gt;</comment>
                            <comment id="14941914" author="rdblue" created="Fri, 2 Oct 2015 22:48:48 +0000"  >&lt;p&gt;Thanks for looking at this, Pavel. My main concern with your patch is that it calls close on a parser that is passed into the internal parse method. That parser could be instantiated for an InputStream, Reader, or File. I think that it should only be closed for the File case because the underlying stream must be closed. I&apos;d prefer to put the try/finally in just the &lt;tt&gt;public Schema parse(File)&lt;/tt&gt; method.&lt;/p&gt;

&lt;p&gt;For the other two input sources, InputStream and Reader, the situation is a little more difficult because close wasn&apos;t being called before. So streams that were passed in weren&apos;t being closed by the parser. In that case, we should continue to not close those streams, but the parser by default closes the underlying stream because Jackson&apos;s Feature.AUTO_CLOSE_SOURCE defaults to enabled.&lt;/p&gt;

&lt;p&gt;We should probably disable that auto close feature and call close on the reader when done, so I&apos;m fine with either a solution that does that or one that just wraps the file variant in a try/finally. Do you agree? If so, could you update your patch with one of those strategies?&lt;/p&gt;</comment>
                            <comment id="14941915" author="rdblue" created="Fri, 2 Oct 2015 22:50:36 +0000"  >&lt;p&gt;Sorry, looks like I was wrong, the Reader one is an internal StringReader so we can (and should) safely close its parser.&lt;/p&gt;</comment>
                            <comment id="14945343" author="pavel.safrata" created="Tue, 6 Oct 2015 16:55:17 +0000"  >&lt;p&gt;Thank you for your comments, understood. I think the right approach is closing the parser in all three cases because the parsers have more resources to release besides the passed data input. Unfortunately, if I go with disabling AUTO_CLOSE_SOURCE and closing the parser, the behavior for streams still won&apos;t be fully backward compatible. The reason is that AUTO_CLOSE_SOURCE also closes the stream  &quot;when end-of-input is encountered&quot;. So it looks like now, with AUTO_CLOSE_SOURCE=true and no explicit close() call, the stream is sometimes closed and sometimes not, depending on whether the parser reads it to the end. With the proposed modification in place, the stream would always stay open.&lt;/p&gt;

&lt;p&gt;I feel uncomfortable contributing a 2/3 fix, but I&apos;m too afraid of fixing the open files problem and introducing a new one by leaving open streams.&lt;/p&gt;

&lt;p&gt;Please review the new patch.&lt;/p&gt;</comment>
                            <comment id="14945459" author="rdblue" created="Tue, 6 Oct 2015 17:57:13 +0000"  >&lt;p&gt;I think it&apos;s reasonable to set AUTO_CLOSE_SOURCE to false. I would rather err on the side of not closing streams that aren&apos;t owned than ensuring some streams at the end are closed as they are now. We could also add a check to see if the stream is at end-of-input and close it to mimic, right?&lt;/p&gt;</comment>
                            <comment id="14946480" author="pavel.safrata" created="Wed, 7 Oct 2015 08:10:53 +0000"  >&lt;p&gt;OK. I&apos;m attaching third patch which always closes the parser and disables AUTO_CLOSE_SOURCE for the stream one.&lt;br/&gt;
I&apos;m not aware of any way of unobtrusively checking input stream&apos;s end of input.&lt;/p&gt;</comment>
                            <comment id="14947118" author="rdblue" created="Wed, 7 Oct 2015 16:14:27 +0000"  >&lt;p&gt;That sounds great. I&apos;d rather have a slight behavior change of leaving a stream open that Avro doesn&apos;t own than closing ones that Avro does. Thanks for putting this together, Pavel! I&apos;ll do a review and hopefully commit later today.&lt;/p&gt;</comment>
                            <comment id="14947336" author="rdblue" created="Wed, 7 Oct 2015 18:36:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pavel.safrata&quot; class=&quot;user-hover&quot; rel=&quot;pavel.safrata&quot;&gt;Pavel Safrata&lt;/a&gt; could you take a look at the diff I&apos;m attaching? I realized that the avro-tools usage wasn&apos;t updated so I went ahead and added try/finally blocks to ensure the streams were properly closed. If you can verify that looks okay, then I&apos;ll commit the patch. Thanks!&lt;/p&gt;</comment>
                            <comment id="14947491" author="pavel.safrata" created="Wed, 7 Oct 2015 20:09:20 +0000"  >&lt;p&gt;Thank you for your help, it looks good. I offer a small refactoring to avoid the code duplication, please see the fifth version of the patch. It adds a method to the API which I don&apos;t know if I&apos;m allowed to do, feel free to ignore this and commit your version.&lt;/p&gt;</comment>
                            <comment id="14947588" author="jira-bot" created="Wed, 7 Oct 2015 21:06:29 +0000"  >&lt;p&gt;Commit 1707389 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blue%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;blue@cloudera.com&quot;&gt;Ryan Blue&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1707389&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1707389&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1715&quot; title=&quot;Compiling a schema leaves the schema file open&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1715&quot;&gt;&lt;del&gt;AVRO-1715&lt;/del&gt;&lt;/a&gt;. Java: Close files opened by the Schema parser. Contributed by Pavel Safrata.&lt;/p&gt;

&lt;p&gt;This also clarifies the InputStream parse method, which does not own the&lt;br/&gt;
stream that is passed in and does not close it. The tools have been&lt;br/&gt;
updated to correctly close streams passed to the parser.&lt;/p&gt;</comment>
                            <comment id="14947597" author="rdblue" created="Wed, 7 Oct 2015 21:09:39 +0000"  >&lt;p&gt;Thanks for the contribution, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pavel.safrata&quot; class=&quot;user-hover&quot; rel=&quot;pavel.safrata&quot;&gt;Pavel Safrata&lt;/a&gt;! I&apos;ve committed your latest patch. Good call on the refactoring.&lt;/p&gt;</comment>
                            <comment id="14947605" author="pavel.safrata" created="Wed, 7 Oct 2015 21:11:57 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="14947676" author="hudson" created="Wed, 7 Oct 2015 21:56:30 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #548 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/548/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/548/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1715&quot; title=&quot;Compiling a schema leaves the schema file open&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1715&quot;&gt;&lt;del&gt;AVRO-1715&lt;/del&gt;&lt;/a&gt;. Java: Close files opened by the Schema parser. Contributed by Pavel Safrata.&lt;/p&gt;

&lt;p&gt;This also clarifies the InputStream parse method, which does not own the&lt;br/&gt;
stream that is passed in and does not close it. The tools have been&lt;br/&gt;
updated to correctly close streams passed to the parser. (blue: rev 1707389)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/avro/src/main/java/org/apache/avro/Schema.java&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/tools/src/main/java/org/apache/avro/tool/BinaryFragmentToJsonTool.java&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/tools/src/main/java/org/apache/avro/tool/CreateRandomFileTool.java&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/tools/src/main/java/org/apache/avro/tool/DataFileWriteTool.java&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/tools/src/main/java/org/apache/avro/tool/JsonToBinaryFragmentTool.java&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/tools/src/main/java/org/apache/avro/tool/Util.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12765431" name="AVRO-1715.4.diff" size="5200" author="rdblue" created="Wed, 7 Oct 2015 18:36:12 +0000"/>
                            <attachment id="12765446" name="AVRO-1715.5.diff" size="4791" author="pavel.safrata" created="Wed, 7 Oct 2015 20:09:20 +0000"/>
                            <attachment id="12749299" name="Schema_close_parser.patch" size="492" author="pavel.safrata" created="Fri, 7 Aug 2015 16:14:02 +0000"/>
                            <attachment id="12765199" name="Schema_close_parser_v2.patch" size="1201" author="pavel.safrata" created="Tue, 6 Oct 2015 16:58:20 +0000"/>
                            <attachment id="12765344" name="Schema_close_parser_v3.patch" size="1070" author="pavel.safrata" created="Wed, 7 Oct 2015 08:10:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Oct 2015 22:48:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ih3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1716] Java Schema Generated sources, non nullable, default defined fails on setField(null)</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1716</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;I define a schema descriptor like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;namespace&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;some.namespace&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;SomeBean&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;: [
        {&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;someField&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;: &quot;&quot;},
    ]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then I generate some java classes, using org.apache.avro:avro-maven-plugin. In the builder methods I will get the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; some.namespace.SomeBean.Builder setSomeField(java.lang.CharSequence value) {
      validate(fields()[0], value);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.someField = value;
      fieldSetFlags()[0] = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;; 
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Validate methode is like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void validate(Field field, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!isValidValue(field, value)) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(field.defaultValue() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AvroRuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Field &quot;&lt;/span&gt; + field + &lt;span class=&quot;code-quote&quot;&gt;&quot; does not accept &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; values&quot;&lt;/span&gt;);
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So if I perform SomeBean.setSomeField(null), as the defaultValue is defined, no exception will raise. However, someField will get a null value. That lead to the following type of error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; of string in field someField of some.namespace.SomeBean	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.npe(GenericDatumWriter.java:93)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:87)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:58)
...
Caused by: java.lang.NullPointerException
	at org.apache.avro.io.Encoder.writeString(Encoder.java:121)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.writeString(GenericDatumWriter.java:213)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.writeString(GenericDatumWriter.java:208)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:76)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.writeField(GenericDatumWriter.java:114)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.writeRecord(GenericDatumWriter.java:104)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:66)
	... 7 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I believe that in such case we should protect the field from being set to null, and remain at its default value.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12853806">AVRO-1716</key>
            <summary>Java Schema Generated sources, non nullable, default defined fails on setField(null)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="secherre">Francois Secherre</reporter>
                        <labels>
                            <label>starter</label>
                    </labels>
                <created>Mon, 10 Aug 2015 11:20:34 +0000</created>
                <updated>Thu, 12 May 2016 15:40:04 +0000</updated>
                                            <version>1.7.7</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15281631" author="mattread90" created="Thu, 12 May 2016 15:40:04 +0000"  >&lt;p&gt;I was about to raise this issue myself. I am seeing this same problem using 1.8.0 also. In my mind, the Builder shouldn&apos;t be able to build a record object that can&apos;t be encoded to Avro.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 May 2016 15:40:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ij0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>
