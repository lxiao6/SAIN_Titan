<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:17:39 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2012-9-5+AND+created+%3C%3D+2012-9-12+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="10" total="10"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-1147] Allow Stringable Map keys in addition to pure String keys (avro reflection)</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1147</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;I&apos;m using avro reflection for some serialization that doesn&apos;t require the best performance for some short-lived data. &lt;/p&gt;

&lt;p&gt;However, the object I&apos;m trying to serialize uses a &lt;tt&gt;Map&lt;/tt&gt; with non-String keys (the key class is &lt;tt&gt;Integer&lt;/tt&gt;) and, because of the strict restriction on Map keys being Strings, it fails. &lt;/p&gt;

&lt;p&gt;Could we consider allowing Map keys to be &lt;b&gt;&lt;tt&gt;Stringable&lt;/tt&gt;&lt;/b&gt; classes (I&apos;m thinking of something similar to Doug&apos;s solution in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1146&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AVRO-1146&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606287">AVRO-1147</key>
            <summary>Allow Stringable Map keys in addition to pure String keys (avro reflection)</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alexandre.normand">Alexandre Normand</assignee>
                                    <reporter username="alexandre.normand">Alexandre Normand</reporter>
                        <labels>
                            <label>newbie</label>
                            <label>patch</label>
                    </labels>
                <created>Wed, 5 Sep 2012 19:38:11 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:14 +0000</updated>
                            <resolved>Mon, 10 Sep 2012 23:42:20 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13450334" author="alexandre.normand" created="Fri, 7 Sep 2012 04:30:13 +0000"  >&lt;p&gt;I&apos;ve been playing around with the code to add a property on map schemas for which the key is a stringable class. It&apos;s working but before I put more time and effort into this to make this more real, I would love to hear some opinions either for or against that feature. &lt;/p&gt;

&lt;p&gt;Anyone?&lt;/p&gt;</comment>
                            <comment id="13451139" author="cutting" created="Fri, 7 Sep 2012 23:40:51 +0000"  >&lt;p&gt;I think this is reasonable.  I have some code that implements this but I&apos;d like to improve it a bit still.  I&apos;ll try to post something Monday unless you post something first.&lt;/p&gt;</comment>
                            <comment id="13451255" author="alexandre.normand" created="Sat, 8 Sep 2012 05:49:51 +0000"  >&lt;p&gt;Not trying to beat you to the punch but I thought I&apos;d share my re-worked version of the patch now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I may be violating the rules here as the patch is actually a superset of your latest patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1146&quot; title=&quot;Can&amp;#39;t use ReflectData to get schema when the type has a BigDecimal or BigInteger field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1146&quot;&gt;&lt;del&gt;AVRO-1146&lt;/del&gt;&lt;/a&gt; (I needed it to make this work). &lt;/p&gt;

&lt;p&gt;I moved &lt;tt&gt;TestReflect&lt;/tt&gt; under the &lt;tt&gt;org.apache.avro.reflect&lt;/tt&gt; package as it both seemed like the right place for it and it allowed me to use the &lt;tt&gt;protected&lt;/tt&gt; version of &lt;tt&gt;ReflectData.compare&lt;/tt&gt; for the new tests. &lt;/p&gt;

&lt;p&gt;Note that I&apos;m adding Integer.class to stringables on ReflectData in the &lt;tt&gt;TestReflect&lt;/tt&gt; unit test and I &lt;em&gt;did&lt;/em&gt; pause for a minute to think about implications of adding it as the stringableClasses set is shared for both map keys as well as straight types. Since &lt;tt&gt;Integer.class&lt;/tt&gt; is already bucketed as a primitive before we check for stringableClasses in a non-map scenario, it should be fine though. &lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13452460" author="cutting" created="Mon, 10 Sep 2012 21:25:10 +0000"  >&lt;p&gt;I merged your patch and mine.  You missed the case where the map key had a @Stringable annotation, also the parameter to writeMapKey can just be a Decoder, not a ResolvingDecoder.  Mine was still rough, using the old &quot;java-class&quot; property and readString methods rather than defining a new property and method as you did.&lt;/p&gt;

&lt;p&gt;Does this look reasonable?  If so, I&apos;ll commit it.&lt;/p&gt;</comment>
                            <comment id="13452465" author="cutting" created="Mon, 10 Sep 2012 21:33:47 +0000"  >&lt;p&gt;Sorry, I lost your test changes and used the test I&apos;d written instead in my patch.  If you like, we can use your tests; please post a patch that includes them instead.&lt;/p&gt;

&lt;p&gt;As for adding Integer.class as a stringable, it would be safest to do that with something like:&lt;/p&gt;

&lt;p&gt;ReflectData data = new ReflectData().addStringable(Integer.class);&lt;/p&gt;

&lt;p&gt;That way it wouldn&apos;t alter the default instance.&lt;/p&gt;</comment>
                            <comment id="13452466" author="alexandre.normand" created="Mon, 10 Sep 2012 21:35:00 +0000"  >&lt;p&gt;It looks good. Indeed, I had missed the @Stringable on map keys. I thought I had cleaned up the writeMapKey signature and used Decoder though...but I think I may have selected the wrong patch version when uploading. I&apos;ll be more careful next time. &lt;/p&gt;

&lt;p&gt;I think you can go ahead with the commit. It&apos;s going to be very useful. Thanks for the quick response!&lt;/p&gt;</comment>
                            <comment id="13452473" author="alexandre.normand" created="Mon, 10 Sep 2012 21:39:13 +0000"  >&lt;p&gt;My last comment was written while you were writing yours...let me post a patch that brings those tests back...&lt;/p&gt;</comment>
                            <comment id="13452517" author="alexandre.normand" created="Mon, 10 Sep 2012 22:15:36 +0000"  >&lt;p&gt;I brought by my changes to TestReflect and made that modification to add the Integer.class to stringables on a new instance of ReflectData. &lt;/p&gt;</comment>
                            <comment id="13452580" author="cutting" created="Mon, 10 Sep 2012 23:42:20 +0000"  >&lt;p&gt;I just committed this.  Thanks, Alexandre!&lt;/p&gt;

&lt;p&gt;(BTW, we used the Assignee field to indicate who&apos;s written the majority of the patch committed.)&lt;/p&gt;</comment>
                            <comment id="13452615" author="alexandre.normand" created="Tue, 11 Sep 2012 00:38:38 +0000"  >&lt;p&gt;Got it. Thanks Doug.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544547" name="AVRO-1147.patch" size="32195" author="alexandre.normand" created="Mon, 10 Sep 2012 22:15:36 +0000"/>
                            <attachment id="12544532" name="AVRO-1147.patch" size="6137" author="cutting" created="Mon, 10 Sep 2012 21:25:10 +0000"/>
                            <attachment id="12544344" name="AVRO-1147.patch" size="36948" author="alexandre.normand" created="Sat, 8 Sep 2012 05:50:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Sep 2012 23:40:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253696</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4mv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80513</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1148] SpecificData.java has a bug creating a schema for a map</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1148</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;in the SepcificData class, the protected Schema createSchema(java.lang.reflect.Type type, Map&amp;lt;String,Schema&amp;gt; names) fails in creating a schema for the Map type.&lt;/p&gt;

&lt;p&gt;Looking at this excerpt, &lt;/p&gt;

&lt;p&gt;else if (Map.class.isAssignableFrom(raw)) &lt;/p&gt;
{   // map
        java.lang.reflect.Type key = params[0];
        java.lang.reflect.Type value = params[1];
        if (!(type instanceof Class
              &amp;amp;&amp;amp; CharSequence.class.isAssignableFrom((Class)type)))
          throw new AvroTypeException(&quot;Map key class not CharSequence: &quot;+key);
        return Schema.createMap(createSchema(value, names));
      }

&lt;p&gt;The type is a map, the key is a string. therefore instead of  &quot;if (&lt;span class=&quot;error&quot;&gt;Unable to render embedded object: File ((type instanceof Class&amp;quot; it should be &amp;quot;if () not found.&lt;/span&gt;(key instanceof Class&quot;.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac&lt;/p&gt;</environment>
        <key id="12606650">AVRO-1148</key>
            <summary>SpecificData.java has a bug creating a schema for a map</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="netvisao">Amine R.</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Fri, 7 Sep 2012 20:12:36 +0000</created>
                <updated>Tue, 12 Feb 2013 18:43:51 +0000</updated>
                            <resolved>Tue, 12 Feb 2013 18:43:51 +0000</resolved>
                                    <version>1.6.3</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13576808" author="ted.m" created="Tue, 12 Feb 2013 17:34:24 +0000"  >&lt;p&gt;Just looked at the code in the trunk and looks like this JIRA has been addressed.&lt;/p&gt;

&lt;p&gt;Here is code that I just pulled from trunk.&lt;/p&gt;

&lt;p&gt;else if (Map.class.isAssignableFrom(raw)) &lt;/p&gt;
{   // map
        java.lang.reflect.Type key = params[0];
        java.lang.reflect.Type value = params[1];
        if (!(key instanceof Class
              &amp;amp;&amp;amp; CharSequence.class.isAssignableFrom((Class)key)))
          throw new AvroTypeException(&quot;Map key class not CharSequence: &quot;+key);
        return Schema.createMap(createSchema(value, names));
      }
&lt;p&gt; &lt;/p&gt;</comment>
                            <comment id="13576822" author="cutting" created="Tue, 12 Feb 2013 17:48:19 +0000"  >&lt;p&gt;Yes, I think this is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1166&quot; title=&quot;IDL return type of map&amp;lt;record&amp;gt; fails in schema processing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1166&quot;&gt;&lt;del&gt;AVRO-1166&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13576825" author="ted.m" created="Tue, 12 Feb 2013 17:50:23 +0000"  >&lt;p&gt;I did nothing but report that this patch is fixed&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12607704">AVRO-1166</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12607704">AVRO-1166</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Feb 2013 17:34:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253697</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 49 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80514</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1149] Add all-args constructor to generated class definitions</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1149</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Having an all-args constructor (in addition to the default no-args constructor) can make it a lot easier to work with generated Avro classes directly, as it allows setting up the state of the class in one call.&lt;/p&gt;

&lt;p&gt;The included builders are useful for this, but the use of the builder can be overly verbose and not very readable when a small number of parameters are involved.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606670">AVRO-1149</key>
            <summary>Add all-args constructor to generated class definitions</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gabriel.reid">Gabriel Reid</assignee>
                                    <reporter username="gabriel.reid">Gabriel Reid</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Sep 2012 20:43:33 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:13 +0000</updated>
                            <resolved>Tue, 11 Sep 2012 22:38:48 +0000</resolved>
                                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13450960" author="gabriel.reid" created="Fri, 7 Sep 2012 20:45:29 +0000"  >&lt;p&gt;Patch to add all-args constructor to generated java files. Passes all unit tests under lang/java.&lt;/p&gt;</comment>
                            <comment id="13452507" author="cutting" created="Mon, 10 Sep 2012 22:08:16 +0000"  >&lt;p&gt;Using such constructors makes code more fragile.  For example, adding a new field with a default value would require changes that builder-based code would not need to make.  Also, if you change the order of fields of the same type then code that&apos;s probably now buggy will continue to compile without warning.  But just because we emit such constructors doesn&apos;t mean folks have to use them.&lt;/p&gt;

&lt;p&gt;So I&apos;m okay committing this.  Does anyone else have any objections?&lt;/p&gt;</comment>
                            <comment id="13453500" author="cutting" created="Tue, 11 Sep 2012 22:38:48 +0000"  >&lt;p&gt;I committed this.  Thanks, Gabriel!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544284" name="AVRO-1149.patch" size="2331" author="gabriel.reid" created="Fri, 7 Sep 2012 20:45:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Sep 2012 22:08:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253698</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4nb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1150] TestSpecificCompiler leaks temporary directories</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1150</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The test class org.apache.avro.compiler.TestSpecificCompiler (in the compiler sub-project) creates a temporary directory, but only deletes the contents of the directory at the end of the test, and not the directory itself.&lt;/p&gt;

&lt;p&gt;This will cause a (small) issue on the long term when running in CI.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606672">AVRO-1150</key>
            <summary>TestSpecificCompiler leaks temporary directories</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gabriel.reid">Gabriel Reid</assignee>
                                    <reporter username="gabriel.reid">Gabriel Reid</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Sep 2012 20:48:31 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:13 +0000</updated>
                            <resolved>Mon, 17 Sep 2012 20:43:39 +0000</resolved>
                                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13450963" author="gabriel.reid" created="Fri, 7 Sep 2012 20:48:57 +0000"  >&lt;p&gt;Simple patch to resolve the issue.&lt;/p&gt;</comment>
                            <comment id="13452512" author="cutting" created="Mon, 10 Sep 2012 22:12:07 +0000"  >&lt;p&gt;I generally prefer it when tests leave their files around until they&apos;re run the next time so that one can better examine output when debugging.  The &apos;clean&apos; target should remove them.  Is that not sufficient?&lt;/p&gt;</comment>
                            <comment id="13453792" author="gabriel.reid" created="Wed, 12 Sep 2012 06:57:37 +0000"  >&lt;p&gt;That makes sense. This specific test isn&apos;t doing that though &amp;#8211; instead, it&apos;s doing a partial job of cleaning up after itself, and the files that it&apos;s making aren&apos;t under target, they&apos;re under the system&apos;s temp directory. For now this patch is just fixing the incomplete cleanup.&lt;/p&gt;

&lt;p&gt;If you think it&apos;s useful, I&apos;d be happy to go through the tests and make it more consistent so that a temp directory under target is used, with cleanup of temporary files/directories only being done as part of the clean target. What do you think?&lt;/p&gt;</comment>
                            <comment id="13454272" author="cutting" created="Wed, 12 Sep 2012 19:21:57 +0000"  >&lt;p&gt;Yes, I think we should fix tests so they don&apos;t create files outside of the target/ directory.  In particular, we shouldn&apos;t use /tmp.&lt;/p&gt;</comment>
                            <comment id="13455663" author="gabriel.reid" created="Fri, 14 Sep 2012 08:18:35 +0000"  >&lt;p&gt;There&apos;s a AvroTestUtil class that handles creation of temporary directories under target/ &amp;#8211; however, it&apos;s copied in the avro, ipc, and tools modules. &lt;/p&gt;

&lt;p&gt;I was thinking of making an avro-test module to contain a single copy of this class, and build it out a bit to include segregating temp files per test class. Any objections to this approach, particularly about the creation of a new module?&lt;/p&gt;</comment>
                            <comment id="13455875" author="cutting" created="Fri, 14 Sep 2012 15:44:30 +0000"  >&lt;p&gt;I think you can instead just add a dependency on the test code from another module.  For example, to have ipc tests rely on avro tests, add the following to ipc/pom.xml:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &amp;lt;dependency&amp;gt;
      &amp;lt;groupId&amp;gt;org.apache.avro&amp;lt;/groupId&amp;gt;
      &amp;lt;artifactId&amp;gt;avro&amp;lt;/artifactId&amp;gt;
      &amp;lt;classifier&amp;gt;tests&amp;lt;/classifier&amp;gt;
      &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
      &amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The classifier says you want the classes from lang/java/avro/src/test/java, and the scope says you want to use these in lang/java/ipc/src/test/java.&lt;/p&gt;

&lt;p&gt;I think we can eliminate the redundancy this way without publishing a test module, which might require us to keep test APIs back-compatible.&lt;/p&gt;</comment>
                            <comment id="13456044" author="gabriel.reid" created="Fri, 14 Sep 2012 19:09:19 +0000"  >&lt;p&gt;Ok, thanks for the pointer on that, I&apos;ll go for that approach.&lt;/p&gt;</comment>
                            <comment id="13456352" author="gabriel.reid" created="Sat, 15 Sep 2012 08:16:38 +0000"  >&lt;p&gt;Patch that moves to a single AvroTestUtil class, and removes all creation of temporary files and directories under tmp (or java.io.tmpdir). &lt;/p&gt;

&lt;p&gt;All temporary files and directories are now created under target/tmpfiles in a directory specific to the test class that is creating the file or directory.&lt;/p&gt;

&lt;p&gt;Run successfully against &quot;mvn verify&quot;.&lt;/p&gt;</comment>
                            <comment id="13457301" author="cutting" created="Mon, 17 Sep 2012 20:43:39 +0000"  >&lt;p&gt;I committed this.  Thanks, Gabriel!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545270" name="AVRO-1150.patch" size="16246" author="gabriel.reid" created="Sat, 15 Sep 2012 08:16:38 +0000"/>
                            <attachment id="12544285" name="AVRO-1150.patch" size="522" author="gabriel.reid" created="Fri, 7 Sep 2012 20:48:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Sep 2012 22:12:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253699</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80516</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1151] Netty Avro server should expose the number of connections currently open.</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1151</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;It would be good to expose the number of currently open connections to the NettyServer for metrics for applications using the server.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606817">AVRO-1151</key>
            <summary>Netty Avro server should expose the number of connections currently open.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hshreedharan">Hari Shreedharan</assignee>
                                    <reporter username="hshreedharan">Hari Shreedharan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Sep 2012 06:25:13 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:12 +0000</updated>
                            <resolved>Tue, 11 Sep 2012 11:34:50 +0000</resolved>
                                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13451795" author="hshreedharan" created="Mon, 10 Sep 2012 07:05:57 +0000"  >&lt;p&gt;Initial patch, which removes the channel from the set when the channel is closed or disconnected. Also exposes the number of open connections.&lt;/p&gt;</comment>
                            <comment id="13451936" author="tomwhite" created="Mon, 10 Sep 2012 12:58:47 +0000"  >&lt;p&gt;A few comments on the patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Why close the channel and remove from allChannels in the channelDisconnected() method? Does it not suffice to just have the channelClosed() method?&lt;/li&gt;
	&lt;li&gt;The channel should also be removed from allChannels in exceptionCaught().&lt;/li&gt;
	&lt;li&gt;There are some whitespace-only changes in the patch which should be removed.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13451959" author="hshreedharan" created="Mon, 10 Sep 2012 13:27:11 +0000"  >&lt;p&gt;Thanks Tom. I will post an updated patch with these changes. In case of the second comment, the channel is being removed from all channels in exceptionCaught() in this patch itself. &lt;/p&gt;</comment>
                            <comment id="13451966" author="hshreedharan" created="Mon, 10 Sep 2012 13:36:31 +0000"  >&lt;p&gt;Updated patch incorporating Tom&apos;s feedback.&lt;/p&gt;</comment>
                            <comment id="13451984" author="tomwhite" created="Mon, 10 Sep 2012 13:57:31 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13452936" author="tomwhite" created="Tue, 11 Sep 2012 11:34:50 +0000"  >&lt;p&gt;I just committed this. Thanks Hari!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544466" name="AVRO-1151-2.patch" size="2483" author="hshreedharan" created="Mon, 10 Sep 2012 13:36:31 +0000"/>
                            <attachment id="12544436" name="AVRO-1151.patch" size="6966" author="hshreedharan" created="Mon, 10 Sep 2012 07:03:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Sep 2012 12:58:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253700</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4nr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80517</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1152] TestTraceSingletons failing with JDK 7</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1152</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;TestTraceSingletons depends on the tests being run in the order they are defined.  In Java 7, JUnit tests no longer always run in the order they were defined causing this test to often fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606968">AVRO-1152</key>
            <summary>TestTraceSingletons failing with JDK 7</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cutting">Doug Cutting</assignee>
                                    <reporter username="cutting">Doug Cutting</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Sep 2012 23:36:51 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:14 +0000</updated>
                            <resolved>Mon, 10 Sep 2012 23:43:51 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13452582" author="cutting" created="Mon, 10 Sep 2012 23:43:51 +0000"  >&lt;p&gt;I committed a fix for this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253701</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4nz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80518</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1153] Exception when trying to write object with Nullable field that is of Stringable type</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1153</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;There seems to be an issue with &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1146&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;stringable fields&lt;/a&gt; that are nullable. I&apos;m mostly using ReflectData.AllowNull in my real usage of this feature and I&apos;m seeing it fail with this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.avro.AvroRuntimeException: Unknown datum type: 10
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericData.getSchemaName(GenericData.java:574)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericData.resolveUnion(GenericData.java:539)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.resolveUnion(GenericDatumWriter.java:137)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:70)
	at org.apache.avro.reflect.ReflectDatumWriter.write(ReflectDatumWriter.java:104)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.writeRecord(GenericDatumWriter.java:105)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:65)
	at org.apache.avro.reflect.ReflectDatumWriter.write(ReflectDatumWriter.java:104)
	at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumWriter.write(GenericDatumWriter.java:57)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s a quick test that shows this problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;N1 {
      BigDecimal number;
  }

  @Test &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testNullableStringableField() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
      N1 datum = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; N1();
      datum.number = BigDecimal.TEN;

      checkBinary(ReflectData.AllowNull.get(), ReflectData.AllowNull.get().getSchema(N1.class), datum, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12606972">AVRO-1153</key>
            <summary>Exception when trying to write object with Nullable field that is of Stringable type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alexandre.normand">Alexandre Normand</assignee>
                                    <reporter username="alexandre.normand">Alexandre Normand</reporter>
                        <labels>
                            <label>newbie</label>
                            <label>reflection</label>
                    </labels>
                <created>Tue, 11 Sep 2012 00:02:00 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:13 +0000</updated>
                            <resolved>Wed, 12 Sep 2012 23:54:08 +0000</resolved>
                                    <version>1.7.2</version>
                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13452723" author="alexandre.normand" created="Tue, 11 Sep 2012 05:12:12 +0000"  >&lt;p&gt;The getSchemaName didn&apos;t take into consideration that the object&apos;s schema type is effectively a String if that object&apos;s class is in the stringableClasses. I&apos;ve added the getSchemaName override in ReflectData to do that check. &lt;/p&gt;

&lt;p&gt;This passes the unit test that I had written to show the problem.&lt;/p&gt;</comment>
                            <comment id="13453145" author="alexandre.normand" created="Tue, 11 Sep 2012 16:19:06 +0000"  >&lt;p&gt;It was late last night when I did this and apparently, I didn&apos;t attach my latest patch. The null check was missing. Here&apos;s the one I meant to attach last night. &lt;/p&gt;</comment>
                            <comment id="13453168" author="alexandre.normand" created="Tue, 11 Sep 2012 16:50:56 +0000"  >&lt;p&gt;The way I&apos;ve been checking if a datum&apos;s class is in the stringable before looking if it matches one of the primitive types seems flawed. It doesn&apos;t really align with the priorities we use when we create the schema (where we use a primitive schema even if the type is stringable because that&apos;s what we do first). &lt;/p&gt;

&lt;p&gt;This patch aligns better with the schema creation logic. I have to catch the &lt;tt&gt;AvroRuntimeException&lt;/tt&gt; in &lt;tt&gt;ReflectData.getSchemaName&lt;/tt&gt;, which is not so nice but I don&apos;t have a better solution at the moment.&lt;/p&gt;

&lt;p&gt;To give some context, I was having problems otherwise because I had Integer.class in stringables to allow it as a Map key class. Maybe it would be worth having in stringableKeyClasses but I kind of like the simple interface with the single set of stringables. &lt;/p&gt;</comment>
                            <comment id="13453201" author="cutting" created="Tue, 11 Sep 2012 17:26:15 +0000"  >&lt;p&gt;The getSchemaName(Object) method is called for every instance written and is hence performance sensitive.  Catching an exception is expensive.  Rather we might code this something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c = datum.getClass()
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (c.isAnnotationPresent(Stringable.class) ||
    stringableClasses.contains(c))
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Schema.Type.STRING.getName();
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getSchemaName(datum);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Perhaps we should also add a private method like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isStringable(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; c.isAnnotationPresent(Stringable.class) ||
    stringableClasses.contains(c);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since otherwise this idiom will now be repeated in three places.&lt;/p&gt;</comment>
                            <comment id="13454164" author="alexandre.normand" created="Wed, 12 Sep 2012 17:46:23 +0000"  >&lt;p&gt;What you&apos;re suggesting was actually what I had in my first version. The problem with that though is that if I add Integer.class to stringables, then this code becomes flawed because this would return the String type when it should actually be an Integer. Now, why would I need to add Integer.class to stringables? To allow Integer Map keys, that&apos;s why. &lt;/p&gt;

&lt;p&gt;Maybe this is a good argument for splitting plain stringables from map keys stringables. What do you think?&lt;/p&gt;</comment>
                            <comment id="13454203" author="cutting" created="Wed, 12 Sep 2012 18:21:49 +0000"  >&lt;p&gt;&amp;gt; Maybe this is a good argument for splitting plain stringables from map keys stringables. What do you think?&lt;/p&gt;

&lt;p&gt;I think it would add more complexity than it&apos;s worth.&lt;/p&gt;

&lt;p&gt;How critical is it that you can serialize a Map&amp;lt;Integer,Foo&amp;gt;?  A more general approach might be to extend Avro&apos;s reflection to handle arbitrary map keys by, when the key is not a string or a stringable, generate a Schema like List&amp;lt;Pair&amp;lt;Integer,Foo&amp;gt;&amp;gt;.  That would be a more portable way to preserve type information.&lt;/p&gt;</comment>
                            <comment id="13454213" author="alexandre.normand" created="Wed, 12 Sep 2012 18:30:41 +0000"  >&lt;p&gt;I do need to serialize maps with Integer keys but extending the reflection to do that seems fair. &lt;/p&gt;

&lt;p&gt;I&apos;ll revert to my initial patch which was more like you had suggested in your earlier comment while also doing the refactoring to add the isStringable method. &lt;/p&gt;</comment>
                            <comment id="13454248" author="alexandre.normand" created="Wed, 12 Sep 2012 18:56:57 +0000"  >&lt;p&gt;This is the new patch that reflects what we&apos;ve discussed here. &lt;/p&gt;

&lt;p&gt;Comments?&lt;/p&gt;</comment>
                            <comment id="13454500" author="cutting" created="Wed, 12 Sep 2012 23:54:08 +0000"  >&lt;p&gt;I committed this.  Thanks, Alexandre!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544862" name="AVRO-1153.patch" size="3250" author="alexandre.normand" created="Wed, 12 Sep 2012 18:56:57 +0000"/>
                            <attachment id="12544669" name="AVRO-1153.patch" size="1752" author="alexandre.normand" created="Tue, 11 Sep 2012 16:50:56 +0000"/>
                            <attachment id="12544658" name="AVRO-1153.patch" size="1686" author="alexandre.normand" created="Tue, 11 Sep 2012 16:19:06 +0000"/>
                            <attachment id="12544593" name="AVRO-1153.patch" size="1669" author="alexandre.normand" created="Tue, 11 Sep 2012 05:12:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Sep 2012 17:26:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253702</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80519</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1154] NettyTransceiver: cancel channelFuture on close</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1154</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-747&quot; title=&quot;NettyTransceiver: release semaphores on close so that clients are not blocked.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-747&quot;&gt;&lt;del&gt;AVRO-747&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
When the server is stopped, threads calling writeDataPacket() will hang for &apos;connectTimeoutMillis&apos;.&lt;br/&gt;
If another thread calls disconnect() (with the first thread still waiting), it would be nice if that writeDataPacket() call immediately throw an IOException.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607025">AVRO-1154</key>
            <summary>NettyTransceiver: cancel channelFuture on close</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karel1980">Karel Vervaeke</assignee>
                                    <reporter username="karel1980">Karel Vervaeke</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Sep 2012 09:36:32 +0000</created>
                <updated>Tue, 25 Sep 2012 21:16:13 +0000</updated>
                            <resolved>Thu, 13 Sep 2012 20:37:07 +0000</resolved>
                                                    <fixVersion>1.7.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13452860" author="karel1980" created="Tue, 11 Sep 2012 09:53:20 +0000"  >&lt;p&gt;Attached patch calls channelFuture.cancel() on close().&lt;/p&gt;</comment>
                            <comment id="13452863" author="karel1980" created="Tue, 11 Sep 2012 09:58:50 +0000"  >&lt;p&gt;The description is a bit too concise.&lt;br/&gt;
NettyTransceiver.writeDataPack() calls getChannel(), which in turn calls channelFuture.awaitUninterruptibly(connectTimeoutMillis).&lt;/p&gt;

&lt;p&gt;NettyTransceiver.close() calls disconnect(), which hangs while the first call is waiting until the specified timeout is reached.&lt;br/&gt;
The attached patch immediately cancels the channelFuture, so the first clients are no longer blocked.&lt;/p&gt;

&lt;p&gt;It&apos;s difficult to write a test case for this, since you need a server thread and two client threads, performing operations in the correct order.&lt;/p&gt;</comment>
                            <comment id="13452917" author="karel1980" created="Tue, 11 Sep 2012 11:07:18 +0000"  >&lt;p&gt;Updated patch to deal with a few potential concurrency issues.&lt;/p&gt;</comment>
                            <comment id="13453508" author="cutting" created="Tue, 11 Sep 2012 22:44:56 +0000"  >&lt;p&gt;Can you please add a test that fails without this patch and succeeds with it?&lt;/p&gt;

&lt;p&gt;How much stress testing of this have you done?&lt;/p&gt;</comment>
                            <comment id="13454913" author="bruno" created="Thu, 13 Sep 2012 14:17:28 +0000"  >&lt;p&gt;I&apos;ve added a testcase which shows the problem. See the line I&apos;ve marked with &quot;Without the patch, this close seems to hang forever&quot;&lt;/p&gt;

&lt;p&gt;What basically happens is that when a server is stopped and then restarted, requests don&apos;t continue immediately. This is because the client (NettyTransceiver) get stuck on channelFuture.awaitUninterruptibly():&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Thread-65&quot; prio=10 tid=0x00007f2bac67e000 nid=0x7179 in Object.wait() [0x00007f2ad21e0000]
   java.lang.Thread.State: TIMED_WAITING (on object monitor)
        at java.lang.Object.wait(Native Method)
        - waiting on &amp;lt;0x00000007d8d8dd28&amp;gt; (a org.jboss.netty.channel.DefaultChannelFuture)
        at java.lang.Object.wait(Object.java:443)
        at org.jboss.netty.channel.DefaultChannelFuture.await0(DefaultChannelFuture.java:283)
        - locked &amp;lt;0x00000007d8d8dd28&amp;gt; (a org.jboss.netty.channel.DefaultChannelFuture)
        at org.jboss.netty.channel.DefaultChannelFuture.awaitUninterruptibly(DefaultChannelFuture.java:255)
        at org.apache.avro.ipc.NettyTransceiver.getChannel(NettyTransceiver.java:247)
        at org.apache.avro.ipc.NettyTransceiver.getRemoteName(NettyTransceiver.java:364)
        at org.apache.avro.ipc.Requestor.writeHandshake(Requestor.java:202)
        at org.apache.avro.ipc.Requestor.access$300(Requestor.java:52)
        at org.apache.avro.ipc.Requestor$Request.getBytes(Requestor.java:478)
        at org.apache.avro.ipc.Requestor.request(Requestor.java:147)
        at org.apache.avro.ipc.Requestor.request(Requestor.java:101)
        at org.apache.avro.ipc.specific.SpecificRequestor.invoke(SpecificRequestor.java:72)
        at $Proxy6.send(Unknown Source)
        at org.apache.avro.ipc.TestNettyTransceiverWhenServerStops$1.run(TestNettyTransceiverWhenServerStops.java:45)
        at java.lang.Thread.run(Thread.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The strange thing is that it blocks even when there is no server available (e.g. try telnet&apos;ting to a port where no daemon is listing: it will fail immediately and not take a minute to decide nobody is listening). This seems like an issue to me, but just to be clear this is not what this patch addresses (there is a commented out section in the patch that covers it).&lt;/p&gt;

&lt;p&gt;Now, in our situation, when a server disappears we also get notified about that via ZooKeeper and then decide to close the corresponding NettyTransceiver. However, this call to close also hangs, and that&apos;s what the patch on this issue solves:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;main&quot; prio=10 tid=0x00007f2bac008000 nid=0x7126 waiting on condition [0x00007f2bb0aaf000]
   java.lang.Thread.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  &amp;lt;0x0000000783e798e0&amp;gt; (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178)
        at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(ReentrantReadWriteLock.java:807)
        at org.apache.avro.ipc.NettyTransceiver.disconnect(NettyTransceiver.java:286)
        at org.apache.avro.ipc.NettyTransceiver.close(NettyTransceiver.java:353)
        at org.apache.avro.ipc.TestNettyTransceiverWhenServerStops.testNettyTransceiverWhenServerStops(TestNettyTransceiverWhenServerStops.java:105)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It hangs because it tries to acquire a lock which is already obtained by the above thread that waits on channelFuture.awaitUninterruptibly().&lt;/p&gt;

&lt;p&gt;What the patch basically does is cancel this channelFuture, so that the thread calling close can obtain the lock and do its work. Before that, it sets a boolean variable (called stopping) so that no new threads would try to connect to the channel (and cause again the same situation) while we want to stop.&lt;/p&gt;</comment>
                            <comment id="13455249" author="cutting" created="Thu, 13 Sep 2012 20:37:07 +0000"  >&lt;p&gt;I committed this.  Thanks Karel &amp;amp; Bruno!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544615" name="AVRO-1154.patch" size="2821" author="karel1980" created="Tue, 11 Sep 2012 09:53:20 +0000"/>
                            <attachment id="12544629" name="AVRO-1154.v2.patch" size="3114" author="karel1980" created="Tue, 11 Sep 2012 11:09:54 +0000"/>
                            <attachment id="12544985" name="testcase.patch.txt" size="4992" author="bruno" created="Thu, 13 Sep 2012 14:04:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Sep 2012 22:44:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80520</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1155] Stringable Date test in TestReflect fails if timezone doesn&apos;t match locale&apos;s default</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1155</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The problem is that java.util.Date&apos;s string contructor cannot reliably parse its toString() representation in some combinations of timezone and locale.&lt;/p&gt;

&lt;p&gt;This started happening after &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1146&quot; title=&quot;Can&amp;#39;t use ReflectData to get schema when the type has a BigDecimal or BigInteger field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1146&quot;&gt;&lt;del&gt;AVRO-1146&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607036">AVRO-1155</key>
            <summary>Stringable Date test in TestReflect fails if timezone doesn&apos;t match locale&apos;s default</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tomwhite">Tom White</assignee>
                                    <reporter username="tomwhite">Tom White</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Sep 2012 11:05:49 +0000</created>
                <updated>Tue, 27 Aug 2013 17:00:19 +0000</updated>
                            <resolved>Wed, 12 Sep 2012 08:22:08 +0000</resolved>
                                                    <fixVersion>1.7.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13452921" author="tomwhite" created="Tue, 11 Sep 2012 11:10:41 +0000"  >&lt;p&gt;Here&apos;s the error I get when running with US locale settings and a UK timezone:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------------------------------
Test set: org.apache.avro.reflect.TestReflect
-------------------------------------------------------------------------------
Tests run: 40, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.408 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!
testStringables(org.apache.avro.reflect.TestReflect)  Time elapsed: 0.012 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
org.apache.avro.AvroRuntimeException: java.lang.reflect.InvocationTargetException
        at org.apache.avro.reflect.ReflectDatumReader.readString(ReflectDatumReader.java:129)
        at org.apache.avro.reflect.ReflectDatumReader.readString(ReflectDatumReader.java:114)
        at org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:150)
        at org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:135)
        at org.apache.avro.reflect.TestReflect.checkBinary(TestReflect.java:659)
        at org.apache.avro.reflect.TestReflect.checkBinary(TestReflect.java:668)
        at org.apache.avro.reflect.TestReflect.checkStringable(TestReflect.java:620)
        at org.apache.avro.reflect.TestReflect.testStringables(TestReflect.java:611)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)
        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47)
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)
        at org.junit.runners.ParentRunner.run(ParentRunner.java:300)
        at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:236)
        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:134)
        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:113)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189)
        at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165)
        at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:103)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:74)
Caused by: java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
        at org.apache.avro.reflect.ReflectDatumReader.readString(ReflectDatumReader.java:121)
        ... 36 more
Caused by: java.lang.IllegalArgumentException
        at java.util.Date.parse(Date.java:598)
        at java.util.Date.&amp;lt;init&amp;gt;(Date.java:255)
        ... 41 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13452923" author="tomwhite" created="Tue, 11 Sep 2012 11:16:00 +0000"  >&lt;p&gt;Here&apos;s a fix to use a stable string representation for the Date object.&lt;/p&gt;</comment>
                            <comment id="13453204" author="cutting" created="Tue, 11 Sep 2012 17:32:43 +0000"  >&lt;p&gt;Fixing this with Date-specific code in ReflectDatumWriter feels wrong.  Rather perhaps Date is not a candidate for Stringable treatment after all, since it&apos;s toString() method does not always return a string that can be used to construct an equivalent Date instance.  If that&apos;s the case, then I think we should instead just remove Date from the default stringableClasses list in ReflectData.java and remove it from the tests in TestReflectData.java.  Thoughts?&lt;/p&gt;</comment>
                            <comment id="13453280" author="tomwhite" created="Tue, 11 Sep 2012 18:39:44 +0000"  >&lt;p&gt;I agree. The fact that Date&apos;s String constructor and toString() methods are deprecated is another reason not to rely on them.&lt;/p&gt;

&lt;p&gt;Here&apos;s a patch to remove Date from the list of built-in Stringables.&lt;/p&gt;</comment>
                            <comment id="13453319" author="cutting" created="Tue, 11 Sep 2012 19:20:48 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13453827" author="tomwhite" created="Wed, 12 Sep 2012 08:22:08 +0000"  >&lt;p&gt;I just committed this.&lt;/p&gt;</comment>
                            <comment id="13751394" author="jira-bot" created="Tue, 27 Aug 2013 16:17:31 +0000"  >&lt;p&gt;Commit 1517866 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cutting&quot; class=&quot;user-hover&quot; rel=&quot;cutting&quot;&gt;Doug Cutting&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1517866&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1517866&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1268&quot; title=&quot;Add java-class, java-key-class and java-element-class support for stringable types to SpecificData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1268&quot;&gt;&lt;del&gt;AVRO-1268&lt;/del&gt;&lt;/a&gt;.  Corrected change log message.  Date is not supported as a&lt;br/&gt;
stringable.  That support was removed in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1155&quot; title=&quot;Stringable Date test in TestReflect fails if timezone doesn&amp;#39;t match locale&amp;#39;s default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1155&quot;&gt;&lt;del&gt;AVRO-1155&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13751442" author="hudson" created="Tue, 27 Aug 2013 17:00:19 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #394 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/394/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/394/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1268&quot; title=&quot;Add java-class, java-key-class and java-element-class support for stringable types to SpecificData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1268&quot;&gt;&lt;del&gt;AVRO-1268&lt;/del&gt;&lt;/a&gt;.  Corrected change log message.  Date is not supported as a&lt;br/&gt;
stringable.  That support was removed in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1155&quot; title=&quot;Stringable Date test in TestReflect fails if timezone doesn&amp;#39;t match locale&amp;#39;s default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1155&quot;&gt;&lt;del&gt;AVRO-1155&lt;/del&gt;&lt;/a&gt;. (cutting: rev 1517866)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/avro/trunk/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544684" name="AVRO-1155.patch" size="1259" author="tomwhite" created="Tue, 11 Sep 2012 18:39:44 +0000"/>
                            <attachment id="12544630" name="AVRO-1155.patch" size="2251" author="tomwhite" created="Tue, 11 Sep 2012 11:16:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Sep 2012 17:32:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253704</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1156] Avro responder swallows thrown Errors</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1156</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The Avro responder wraps caught Errors, such as OutOfMemoryErrors, in Exceptions and rethrows them. That&apos;s problematic because an Error should be allowed to crash the JVM, since it&apos;s often irrecoverable.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607122">AVRO-1156</key>
            <summary>Avro responder swallows thrown Errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mpercy">Mike Percy</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Sep 2012 20:45:59 +0000</created>
                <updated>Sun, 30 Dec 2018 05:27:56 +0000</updated>
                                                                            <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13453404" author="mpercy" created="Tue, 11 Sep 2012 20:56:34 +0000"  >&lt;p&gt;Small patch so that if the Throwable is an Error, throw it as an Error.&lt;/p&gt;</comment>
                            <comment id="13453428" author="philip" created="Tue, 11 Sep 2012 21:27:37 +0000"  >&lt;p&gt;Patch looks good to me.  If there aren&apos;t any objections, I&apos;ll be happy to commit it.&lt;/p&gt;

&lt;p&gt;Thanks, Mike!&lt;/p&gt;</comment>
                            <comment id="13453436" author="cutting" created="Tue, 11 Sep 2012 21:33:05 +0000"  >&lt;p&gt;I think this change will just close the connection rather than kill the JVM.  There are recoverable conditions that result in OutOfMemoryError, like &apos;new long&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer.MAX_VALUE&amp;#93;&lt;/span&gt;&apos;, so killing the JVM may be overkill.  The net effect of this change would be that clients, instead of receiving an exception that names the server-side error that occurred, will just see the connection closed.  That seems like a step backwards, no?&lt;/p&gt;

&lt;p&gt;If we really wanted to kill the JVM in a multi-threaded server I think we&apos;d need to call Runtime.exit().  In some cases this might be better, since the alternative might leave a zombie server.  But in other common cases, e.g., where a badly formatted request attempts a huge allocation, this will kill a healthy server.  So I&apos;m not very enthusiastic about this approach.  The normal way to detect zombie servers is to add an isZombie() method to protocols and ping periodically to see whether the server is still responding sensibly.&lt;/p&gt;</comment>
                            <comment id="13453452" author="cutting" created="Tue, 11 Sep 2012 21:46:25 +0000"  >&lt;p&gt;Also, if we want to go with the kill-the-JVM-on-Error approach, we should add some tests to make sure this happens.  Such a change might be considered an incompatible change and might be pushed into 1.8.0 (or we might rename the next release 1.8.0 instead of 1.7.2).&lt;/p&gt;

&lt;p&gt;What do servlet containers do with Errors in servlets?  Do they close the connection, returning and logging nothing?  Or do they risk zombification?&lt;/p&gt;</comment>
                            <comment id="13453455" author="philip" created="Tue, 11 Sep 2012 21:51:50 +0000"  >&lt;p&gt;I misunderstood the patch, so withdraw my +1 for the time being. &lt;/p&gt;</comment>
                            <comment id="13453461" author="scott_carey" created="Tue, 11 Sep 2012 21:56:58 +0000"  >&lt;p&gt;Usually if you do something like throw new Throwable() in a servlet container, the result is a HTTP 500 response.&lt;/p&gt;</comment>
                            <comment id="13453462" author="mpercy" created="Tue, 11 Sep 2012 21:57:28 +0000"  >&lt;p&gt;Thanks for the feedback guys! Re. the zombie detection, makes sense... there appear to be many benefits to doing it that way.&lt;/p&gt;

&lt;p&gt;The issue I think I&apos;m seeing is that an OOM error gets thrown while trying to service the request, so we wrap it in an Exception and try to handle it, so the Responder tries to allocate memory to serialize the error response and at that point another OOM error gets thrown by the JVM and we lose the original error.&lt;/p&gt;

&lt;p&gt;I think trying to handle certain Errors in general is a tough proposition... maybe most Errors can be marshalled but OutOfMemoryError or VirtualMachineError should be special cased to just propagate? Or if we really want to try, maybe we should just log the Errors before wrapping them so at least we know if we are hitting a double-throw exception clobbering situation like I am suspecting.&lt;/p&gt;</comment>
                            <comment id="13453470" author="brocknoland" created="Tue, 11 Sep 2012 22:05:00 +0000"  >&lt;p&gt;I am +1 for throwing Error. Outside of some cases where you are actually allocating large amounts of memory or loading native libraries, catching Error(s) is dangerous. I have seen a large number of scenarios where this causes problems which are very hard to debug, as Mike mentions.&lt;/p&gt;</comment>
                            <comment id="13453473" author="mpercy" created="Tue, 11 Sep 2012 22:09:39 +0000"  >&lt;p&gt;To add a bit more information here, I&apos;m seeing stack traces along the lines of the following:&lt;/p&gt;

&lt;p&gt;WARN ipc.Responder: user error &lt;br/&gt;
java.lang.Exception: java.lang.OutOfMemoryError: Java heap space &lt;br/&gt;
at org.apache.avro.ipc.specific.SpecificResponder.respond(SpecificResponder.java:93) &lt;br/&gt;
at org.apache.avro.ipc.Responder.respond(Responder.java:149) &lt;br/&gt;
at org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.messageReceived(NettyServer.java:158) &lt;br/&gt;
at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:80) &lt;br/&gt;
at org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:143) &lt;br/&gt;
at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) &lt;br/&gt;
at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:783) &lt;br/&gt;
at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:302) &lt;br/&gt;
at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:321) &lt;br/&gt;
at org.jboss.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:299) &lt;br/&gt;
at org.jboss.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:214) &lt;br/&gt;
at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:80) &lt;br/&gt;
... snip ...&lt;br/&gt;
Caused by: java.lang.OutOfMemoryError: Java heap space &lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;WARN ipc.Responder: system error &lt;br/&gt;
org.apache.avro.AvroRuntimeException: Unknown datum type: java.lang.Exception: java.lang.OutOfMemoryError: Java heap space &lt;br/&gt;
at org.apache.avro.generic.GenericData.getSchemaName(GenericData.java:574) &lt;br/&gt;
at org.apache.avro.generic.GenericData.resolveUnion(GenericData.java:539) &lt;br/&gt;
at org.apache.avro.generic.GenericDatumWriter.resolveUnion(GenericDatumWriter.java:137) &lt;br/&gt;
at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:70) &lt;br/&gt;
at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:57) &lt;br/&gt;
at org.apache.avro.ipc.specific.SpecificResponder.writeError(SpecificResponder.java:71) &lt;br/&gt;
at org.apache.avro.ipc.Responder.respond(Responder.java:167) &lt;br/&gt;
at org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.messageReceived(NettyServer.java:158) &lt;br/&gt;
at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:80) &lt;br/&gt;
at org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:143) &lt;br/&gt;
at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) &lt;br/&gt;
at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:783) &lt;br/&gt;
at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:302) &lt;br/&gt;
at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:321)&lt;br/&gt;
... snip ...&lt;br/&gt;
at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</comment>
                            <comment id="13453477" author="cutting" created="Tue, 11 Sep 2012 22:13:16 +0000"  >&lt;p&gt;If there&apos;s a memory leak through a static field then wrapping an exception for an OutOfMemoryError might cause another OutOfMemoryError.  But if the OutOfMemoryError was caused by data only pointed to by the stack of the request then it should be collectable by the time we catch the exception and wrapping it shouldn&apos;t cause another OutOfMemoryError.  Are you sure that&apos;s what&apos;s happening?&lt;/p&gt;

&lt;p&gt;Try adding the extra logging there.  If that gets something logged that wouldn&apos;t be otherwise then it&apos;s probably a good idea.  But if it just results in double-logging of the error (since the container probably already logs errors) then it&apos;s probably not useful.&lt;/p&gt;</comment>
                            <comment id="13453490" author="cutting" created="Tue, 11 Sep 2012 22:25:07 +0000"  >&lt;p&gt;That logging doesn&apos;t look to me like a double OutOfMemoryError.  The first message logs that the user code threw some exception (a wrapped OutOfMemoryError).  The second message logs that the exception thrown by the user code is not one expected by the protocol.&lt;/p&gt;

&lt;p&gt;This logging could probably be improved.  If the Error wasn&apos;t caught by SpecificResponder then we&apos;d probably want to change the &quot;system error&quot; catch clause in Responder.java to catch Throwable so the OutOfMemoryError is still logged and sent back to the user.  In that case there&apos;d only be a &quot;system error&quot; logged and not a &quot;user error&quot; as well.&lt;/p&gt;</comment>
                            <comment id="13453639" author="mpercy" created="Wed, 12 Sep 2012 01:54:53 +0000"  >&lt;p&gt;Doug I agree with your last comment about improving the logging. The double OOM error is a hunch, I will try to find more evidence of it.&lt;/p&gt;</comment>
                            <comment id="13457318" author="cutting" created="Mon, 17 Sep 2012 20:59:34 +0000"  >&lt;p&gt;Let&apos;s hold off committing this just yet.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12526156">AVRO-914</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12544709" name="AVRO-1156-1.patch" size="786" author="mpercy" created="Tue, 11 Sep 2012 20:56:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Sep 2012 21:27:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80522</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>
