<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:23:41 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2016-7-6+AND+created+%3C%3D+2016-7-13+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="6" total="6"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-1877] AVRO-1847 accidentally breaks javaUnbox method in SpecificCompiler</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1877</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt; accidentally removes the logical type conversion logic in method &lt;tt&gt;SpecificCompiler.javaUnbox&lt;/tt&gt;, which breaks the data time type compiling in specific compiler.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12987398">AVRO-1877</key>
            <summary>AVRO-1847 accidentally breaks javaUnbox method in SpecificCompiler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Yibing">Yibing Shi</assignee>
                                    <reporter username="Yibing">Yibing Shi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jul 2016 07:44:20 +0000</created>
                <updated>Thu, 21 Jul 2016 23:37:56 +0000</updated>
                            <resolved>Thu, 21 Jul 2016 16:04:52 +0000</resolved>
                                    <version>1.9.0</version>
                    <version>1.8.2</version>
                                    <fixVersion>1.9.0</fixVersion>
                    <fixVersion>1.8.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15366280" author="rdblue" created="Thu, 7 Jul 2016 15:36:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yibing&quot; class=&quot;user-hover&quot; rel=&quot;Yibing&quot;&gt;Yibing Shi&lt;/a&gt;, could you please explain what caused this bug? It isn&apos;t clear from the patches.&lt;/p&gt;</comment>
                            <comment id="15367651" author="yibing" created="Fri, 8 Jul 2016 13:12:33 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdblue&quot; class=&quot;user-hover&quot; rel=&quot;rdblue&quot;&gt;Ryan Blue&lt;/a&gt;, it was my fault. I accidentally deleted a part of method &lt;tt&gt;javaUnbox&lt;/tt&gt;. I am not sure how it happened though. &lt;br/&gt;
Before &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt;, the javaUnbox method is like below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; javaType(Schema schema) {
    Conversion&amp;lt;?&amp;gt; conversion = SPECIFIC
        .getConversionFor(schema.getLogicalType());
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conversion != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; conversion.getConvertedType().getName();
    }

    &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; (schema.getType()) {
......
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt; somehow deleted the conversion part and made it like below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; javaType(Schema schema) {
    &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; (schema.getType()) {
......
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As a result, for logical type timestamp_ms, date and time_ms, method &lt;tt&gt;javaUnbox&lt;/tt&gt; returns &quot;int&quot; instead of JODA classes, which breaks the generated Specific Record.&lt;/p&gt;

&lt;p&gt;I submitted a patch in this JIRA. Instead of using the original code, I rely on method &lt;tt&gt;javaType&lt;/tt&gt; to do the conversion to avoid maintain the same code in 2 places, especially when now we have more and more parameters to control whether to use upper level classes for a logical type. I also added 2 unit tests in this patch to cover this function. Please let me know whether you think this is appropriate or not.&lt;/p&gt;</comment>
                            <comment id="15369372" author="mwong" created="Sun, 10 Jul 2016 01:03:46 +0000"  >&lt;p&gt;Hi, I noticed there are still a couple of issues:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The way you call &lt;tt&gt;javaType&lt;/tt&gt; from &lt;tt&gt;javaUnbox&lt;/tt&gt; in this latest patch is not correct. For example, if you have a &lt;tt&gt;union {null, double&lt;/tt&gt;}, javaType() will turn it into a boxed &lt;tt&gt;java.lang.Double&lt;/tt&gt; that is nullable. Your changes to javaUnbox will then incorrectly convert that to a primitive type &lt;tt&gt;double&lt;/tt&gt;. My suggestion is to revert to the old code and &lt;b&gt;maybe&lt;/b&gt; refactor the duplicate SPECIFIC conversion part into a separate method.&lt;/li&gt;
	&lt;li&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt;, you had added this to javaType:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@@ -564,10 +575,13 @@ &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getStringType(JsonNode overrideClassProperty) {
 
   &lt;span class=&quot;code-comment&quot;&gt;/** Utility &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; template use.  Returns the java type &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a Schema. */&lt;/span&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; javaType(Schema schema) {
-    Conversion&amp;lt;?&amp;gt; conversion = SPECIFIC
-        .getConversionFor(schema.getLogicalType());
-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conversion != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
-      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; conversion.getConvertedType().getName();
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (enableDecimalLogicalType
+        || !(schema.getLogicalType() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; LogicalTypes.Decimal)) {
+      Conversion&amp;lt;?&amp;gt; conversion = SPECIFIC
+          .getConversionFor(schema.getLogicalType());
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conversion != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; conversion.getConvertedType().getName();
+      }
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem is that &lt;tt&gt;enableDecimalLogicalType&lt;/tt&gt; only applies to the Decimal logical type. For the other logical types, such as &lt;tt&gt;date&lt;/tt&gt; or &lt;tt&gt;timestamp-millis&lt;/tt&gt;, they would be converted even if you didn&apos;t enableDecimalLogicalType. That&apos;s at least how it was in 1.8.1. You can test this is the case by compiling some date or timestamp-millis logical types without setting enableDecimalLogicalType.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Much appreciated if you can fix these.&lt;/p&gt;</comment>
                            <comment id="15369631" author="yibing" created="Sun, 10 Jul 2016 12:53:45 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The way you call javaType from javaUnbox in this latest patch is not correct. For example, if you have a &lt;tt&gt;union {null, double&lt;/tt&gt;}, javaType() will turn it into a boxed java.lang.Double that is nullable. Your changes to javaUnbox will then incorrectly convert that to a primitive type double. My suggestion is to revert to the old code and maybe refactor the duplicate SPECIFIC conversion part into a separate method.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Very good point! I will correct this. Thanks for the idea!&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The problem is that enableDecimalLogicalType only applies to the Decimal logical type. For the other logical types, such as date or timestamp-millis, they would be converted even if you didn&apos;t enableDecimalLogicalType. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is done on purpose. It is to keep backwards compatibility with 1.8.0. When date/time logical types were added in 1.8.0, they always use logical types instead of backing raw types in SpecificRecord. Please see &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847?focusedCommentId=15327757&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15327757&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;this comment&lt;/a&gt; for more details.&lt;/p&gt;</comment>
                            <comment id="15369646" author="yibing" created="Sun, 10 Jul 2016 13:46:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mwong&quot; class=&quot;user-hover&quot; rel=&quot;mwong&quot;&gt;Michael Wong&lt;/a&gt;, I have uploaded another patch, but fixes the problem in a different way than your suggestion. Please help have another look.&lt;/p&gt;</comment>
                            <comment id="15369707" author="mwong" created="Sun, 10 Jul 2016 16:20:13 +0000"  >&lt;p&gt;Hi Yibing, thanks for the quick reply. Honestly, I like the old code better. It&apos;s a lot more efficient and less verbose. It doesn&apos;t convert from enum to String and then do a bunch of String compares and return another String again. The extra test for UNION also smells like a hack.&lt;/p&gt;

&lt;p&gt;As for enableDecimalLogicalType. If truly the intent is to use converted logical types at all, then this should be renamed to enableLogicalType. It&apos;s confusing to say it&apos;s for Decimal but mean it for all.&lt;/p&gt;

&lt;p&gt;More importantly, after applying your &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt;, if you have date or timestamp-millis without setting enableDecmialLogicalType, the compiled SpecificRecord code will NOT compile. Please confirm for yourself. So we should do one of the following:&lt;/p&gt;

&lt;p&gt;1. Decide that enableDecmialLogicalType means to apply to all logical types. Then rename it to enableLogicalType and fix the code accordingly. (Most likely in conversionInstance, just return null). Or,&lt;/p&gt;

&lt;p&gt;2. Decide that enableDecimalLogicalType only applies to Decimal as before and not break compatability. Then just fix javaType method as I pointed out above.&lt;/p&gt;</comment>
                            <comment id="15369995" author="yibing" created="Sun, 10 Jul 2016 23:26:06 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Honestly, I like the old code better.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The problem with the old code is that it checks for conversions twice: once in &lt;tt&gt;javaUnbox&lt;/tt&gt;, once again in &lt;tt&gt;javaType&lt;/tt&gt;&lt;br/&gt;
That said, I have a look at the code again and the extra test for UNION does smells bad. I will refactor the code a bit more and upload another patch here.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;As for enableDecimalLogicalType. If truly the intent is to use converted logical types at all, then this should be renamed to enableLogicalType. It&apos;s confusing to say it&apos;s for Decimal but mean it for all.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;As said before, &lt;tt&gt;enableDecimalLogicalType&lt;/tt&gt; should only applies to decimal type, not the date/time logical types, which should always use Joda/Java date/time classes instead of raw types if these classes are present.&lt;br/&gt;
Please have a look at the unit tests added in &lt;tt&gt;TestSpecificCompiler&lt;/tt&gt; (testJavaTypeWithDecimalLogicalTypeDisabled/Enabled). They clearly show the intent of &lt;tt&gt;enableDecimalLogicalType&lt;/tt&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;More importantly, after applying your &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt;, if you have date or timestamp-millis without setting enableDecmialLogicalType, the compiled SpecificRecord code will NOT compile.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This problem is caused because the problem tracked in this JIRA (&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1877&quot; title=&quot;AVRO-1847 accidentally breaks javaUnbox method in SpecificCompiler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1877&quot;&gt;&lt;del&gt;AVRO-1877&lt;/del&gt;&lt;/a&gt;). Please try apply &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1877&quot; title=&quot;AVRO-1847 accidentally breaks javaUnbox method in SpecificCompiler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1877&quot;&gt;&lt;del&gt;AVRO-1877&lt;/del&gt;&lt;/a&gt; on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt; and see whether it fixes the problem for you.&lt;/p&gt;</comment>
                            <comment id="15369996" author="yibing" created="Sun, 10 Jul 2016 23:37:46 +0000"  >&lt;p&gt;Upload a new patch with code refactored &lt;/p&gt;</comment>
                            <comment id="15370521" author="mwong" created="Mon, 11 Jul 2016 10:24:44 +0000"  >&lt;p&gt;Yes, this looks better. I applied &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1877&quot; title=&quot;AVRO-1847 accidentally breaks javaUnbox method in SpecificCompiler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1877&quot;&gt;&lt;del&gt;AVRO-1877&lt;/del&gt;&lt;/a&gt; as you suggest and the enableDecimalLogicalType problem went away as well. Thanks Yibing.&lt;/p&gt;</comment>
                            <comment id="15387739" author="busbey" created="Thu, 21 Jul 2016 14:08:06 +0000"  >&lt;p&gt;While I review, can someone tell me if this impacts branch-1.8?&lt;/p&gt;</comment>
                            <comment id="15387884" author="busbey" created="Thu, 21 Jul 2016 15:20:36 +0000"  >&lt;p&gt;confirmed it does impact branch-1.8&lt;/p&gt;</comment>
                            <comment id="15387931" author="busbey" created="Thu, 21 Jul 2016 15:54:08 +0000"  >&lt;p&gt;(nit for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yibing&quot; class=&quot;user-hover&quot; rel=&quot;Yibing&quot;&gt;Yibing Shi&lt;/a&gt;, please use `git format-patch` in the future to make your patch files)&lt;/p&gt;</comment>
                            <comment id="15387948" author="jira-bot" created="Thu, 21 Jul 2016 16:01:55 +0000"  >&lt;p&gt;Commit 5259f26ecee6c268f0ddc86ef45104fe967f267a in avro&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yibing&quot; class=&quot;user-hover&quot; rel=&quot;Yibing&quot;&gt;Yibing Shi&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=5259f26&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=5259f26&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1877&quot; title=&quot;AVRO-1847 accidentally breaks javaUnbox method in SpecificCompiler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1877&quot;&gt;&lt;del&gt;AVRO-1877&lt;/del&gt;&lt;/a&gt; restore correct javaUnbox in Specific Compiler.&lt;/p&gt;

&lt;p&gt;Time logical types were broken by the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt;, this&lt;br/&gt;
patch restores correct behavior with some minor refactoring to&lt;br/&gt;
clean up duplicate code.&lt;/p&gt;

&lt;p&gt;Signed-off-by: Sean Busbey &amp;lt;busbey@cloudera.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="15387951" author="jira-bot" created="Thu, 21 Jul 2016 16:04:30 +0000"  >&lt;p&gt;Commit 941187a2295197d9da2d9a865fda41e621813f4e in avro&apos;s branch refs/heads/branch-1.8 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yibing&quot; class=&quot;user-hover&quot; rel=&quot;Yibing&quot;&gt;Yibing Shi&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=941187a&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=941187a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1877&quot; title=&quot;AVRO-1847 accidentally breaks javaUnbox method in SpecificCompiler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1877&quot;&gt;&lt;del&gt;AVRO-1877&lt;/del&gt;&lt;/a&gt; restore correct javaUnbox in Specific Compiler.&lt;/p&gt;

&lt;p&gt;Time logical types were broken by the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1847&quot; title=&quot;IDL compiler should use BigDecimal to represent decimal logical type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1847&quot;&gt;&lt;del&gt;AVRO-1847&lt;/del&gt;&lt;/a&gt;, this&lt;br/&gt;
patch restores correct behavior with some minor refactoring to&lt;br/&gt;
clean up duplicate code.&lt;/p&gt;

&lt;p&gt;Signed-off-by: Sean Busbey &amp;lt;busbey@cloudera.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="15387954" author="busbey" created="Thu, 21 Jul 2016 16:04:53 +0000"  >&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yibing&quot; class=&quot;user-hover&quot; rel=&quot;Yibing&quot;&gt;Yibing Shi&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15388623" author="yibing" created="Thu, 21 Jul 2016 23:37:56 +0000"  >&lt;p&gt;Thanks for the tip, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12970780">AVRO-1847</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12816589" name="AVRO-1877.1.patch" size="3953" author="Yibing" created="Thu, 7 Jul 2016 08:05:35 +0000"/>
                            <attachment id="12817038" name="AVRO-1877.2.patch" size="7067" author="Yibing" created="Sun, 10 Jul 2016 13:44:31 +0000"/>
                            <attachment id="12817059" name="AVRO-1877.3.patch" size="7921" author="Yibing" created="Sun, 10 Jul 2016 23:37:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 Jul 2016 15:36:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30mz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1878] ResolvingGrammarGenerator doesn&apos;t handle aliases</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1878</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;While testing &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1704&quot; title=&quot;Standardized format for encoding messages with Avro&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1704&quot;&gt;&lt;del&gt;AVRO-1704&lt;/del&gt;&lt;/a&gt;, I tested schema evolution using an aliased field and  found that the ResolvingGrammarGenerator doesn&apos;t support field aliases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12988078">AVRO-1878</key>
            <summary>ResolvingGrammarGenerator doesn&apos;t handle aliases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="rdblue">Ryan Blue</assignee>
                                    <reporter username="rdblue">Ryan Blue</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Jul 2016 01:33:25 +0000</created>
                <updated>Sun, 14 May 2017 23:14:51 +0000</updated>
                                            <version>1.8.1</version>
                                    <fixVersion>1.8.3</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15369385" author="githubbot" created="Sun, 10 Jul 2016 01:47:06 +0000"  >&lt;p&gt;GitHub user rdblue opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1878&quot; title=&quot;ResolvingGrammarGenerator doesn&amp;#39;t handle aliases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1878&quot;&gt;AVRO-1878&lt;/a&gt;: Add support for field aliases to ResolvingGrammarGenerator.&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rdblue/avro&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/rdblue/avro&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1878&quot; title=&quot;ResolvingGrammarGenerator doesn&amp;#39;t handle aliases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1878&quot;&gt;AVRO-1878&lt;/a&gt;-fix-field-aliases&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/106.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/106.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #106&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2029bc34146630fdb3e93710ca655c8f1b699c1e&lt;br/&gt;
Author: Ryan Blue &amp;lt;blue@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-07-10T01:45:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1878&quot; title=&quot;ResolvingGrammarGenerator doesn&amp;#39;t handle aliases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1878&quot;&gt;AVRO-1878&lt;/a&gt;: Add support for field aliases to ResolvingGrammarGenerator.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15369386" author="rdblue" created="Sun, 10 Jul 2016 01:50:19 +0000"  >&lt;p&gt;Implemented in PR #106.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cutting&quot; class=&quot;user-hover&quot; rel=&quot;cutting&quot;&gt;Doug Cutting&lt;/a&gt;, do you know why this wasn&apos;t supported already? I thought that this was a commonly-used part of schema evolution so I&apos;m surprised to find that it doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;Also, there are tests that exercise this in the PR for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1704&quot; title=&quot;Standardized format for encoding messages with Avro&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1704&quot;&gt;&lt;del&gt;AVRO-1704&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15371239" author="cutting" created="Mon, 11 Jul 2016 17:35:44 +0000"  >&lt;p&gt;Ryan, I&apos;m not sure what you think is missing.  Aliases are implemented in GenericDatumReader#read() when Schema#applyAliases() rewrites the writer&apos;s schema, renaming things according to aliases in the reader&apos;s schema.  The resolver is then created using the rewritten schema.  Alias processing is handled by the rewrite.  The resolver should thus not need to be aware of aliases.  Or am I missing something?&lt;/p&gt;

&lt;p&gt;What is the use case you feel is handled incorrectly?&lt;/p&gt;</comment>
                            <comment id="15371441" author="rdblue" created="Mon, 11 Jul 2016 19:14:04 +0000"  >&lt;p&gt;Thanks for the background. I knew I was missing something when it didn&apos;t look like renames were implemented.&lt;/p&gt;

&lt;p&gt;I&apos;ve added a &lt;a href=&quot;https://github.com/apache/avro/pull/106/commits/5807fbfb403806fb6481611a9c7214b16ab7840b&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;test case that fails on master&lt;/a&gt;. It renames a field and adds the old name as an alias in the new schema. Is this supported?&lt;/p&gt;</comment>
                            <comment id="15371607" author="cutting" created="Mon, 11 Jul 2016 20:59:12 +0000"  >&lt;p&gt;Could the problem be that you change the name of the record from TestRecord to TestRecord2 but don&apos;t provide an alias for that renaming?  Avro sometimes doesn&apos;t check that record names match, but might require them for aliasing?&lt;/p&gt;</comment>
                            <comment id="15371672" author="rdblue" created="Mon, 11 Jul 2016 21:28:39 +0000"  >&lt;p&gt;Yeah, that&apos;s it. The test passes if I rename the record or add an alias for the old name.&lt;/p&gt;

&lt;p&gt;I think we should go ahead with this patch and make the resolver handle renames. Why should the resolver require pre-processing the schemas that are passed in to work correctly? It seems like this kind of resolution is not only part of the resolver&apos;s contract, but also something we should keep to one place in the code. For instance, union resolution has similar logic based on field names.&lt;/p&gt;</comment>
                            <comment id="15371749" author="cutting" created="Mon, 11 Jul 2016 22:10:28 +0000"  >&lt;p&gt;Is your proposal to get rid of Schema#applyAliases and just use the resolver?  If so, I&apos;m not sure it&apos;s that simple, since this patch only handles fields, not records, enums, etc.  So we&apos;d need to somehow implement those renamings too in the resolver.  Also, implementing this as the patch does, by adding aliases to RecordSchema#fieldMap, has other consequences, e.g., GenericData.Record#put(String,Object) will now work for aliases as well as current field names.  Is that desirable?  Perhaps all alias renaming could be easily woven into the resolver rather than implemented in a separate pass as it is now, but the renaming tables should probably be internal to the resolver, not overloaded into RecordSchema#fieldMap, no?&lt;/p&gt;

&lt;p&gt;The current alias behavior is correct.  Record names should match.  Avro&apos;s Java implementation failed to check these long ago in some cases and that can&apos;t be fixed compatibly.  Other implementations may be strict about this.  We could perhaps loosen the record name matching required for aliases to function (as this patch does) but that seems like a step backwards.&lt;/p&gt;
</comment>
                            <comment id="15372153" author="rdblue" created="Tue, 12 Jul 2016 04:23:37 +0000"  >&lt;p&gt;Yeah, I agree that this patch isn&apos;t a solution to the problem and it would be some work to make the resolver responsible for it all. And I do want to consider whether the alias map should be updated. This caught a couple of malformed schemas in our own tests, which means that it&apos;s a breaking change and that we should be more strict in the future to make sure behavior is obvious and well-defined (no guessing which alias wins).&lt;/p&gt;

&lt;p&gt;The current behavior is correct, but it&apos;s still surprising when passing in two compatible schemas yields bad data instead of an error. I think that test case should definitely work, and I think the right design is to keep the resolver code responsible for all of these. If we all agree in principle on that, then I can start moving the logic into the resolver with the current patch as starting place.&lt;/p&gt;</comment>
                            <comment id="15373128" author="cutting" created="Tue, 12 Jul 2016 15:58:45 +0000"  >&lt;p&gt;The test case should probably NOT work with mismatched record names: that&apos;s consistent with the spec if not the Java implementation.  Perhaps we should alter the Java resolution implementation to more consistently require matching of record names.  This could be disabled for compatible behavior and eventually enabled by default in some future release.&lt;/p&gt;

&lt;p&gt;The spec says,&lt;/p&gt;

&lt;p&gt;It is an error if the two schemas do not match.&lt;br/&gt;
To match, one of the following must hold:&lt;br/&gt;
[ ... ]&lt;br/&gt;
both schemas are records with the same name&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://avro.apache.org/docs/current/spec.html#Schema+Resolution&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://avro.apache.org/docs/current/spec.html#Schema+Resolution&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 10 Jul 2016 01:47:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30r4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-1879] Make conversions field transient in compiled SpecificRecord</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1879</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Add a transient modifier to the conversions field as such&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; org.apache.avro.Conversion&amp;lt;?&amp;gt;[] conversions
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will allow Serializers and type inference systems like Flink&apos;s TypeExtractor to not consider the &lt;tt&gt;conversions&lt;/tt&gt; field and not try to serialize it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12988118">AVRO-1879</key>
            <summary>Make conversions field transient in compiled SpecificRecord</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mwong">Michael Wong</assignee>
                                    <reporter username="mwong">Michael Wong</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Jul 2016 10:39:35 +0000</created>
                <updated>Mon, 5 Sep 2016 07:04:22 +0000</updated>
                            <resolved>Sun, 4 Sep 2016 20:57:11 +0000</resolved>
                                    <version>1.8.1</version>
                                    <fixVersion>1.9.0</fixVersion>
                    <fixVersion>1.8.2</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15370501" author="githubbot" created="Mon, 11 Jul 2016 10:09:38 +0000"  >&lt;p&gt;GitHub user mwong38 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/107&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1879&quot; title=&quot;Make conversions field transient in compiled SpecificRecord&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1879&quot;&gt;&lt;del&gt;AVRO-1879&lt;/del&gt;&lt;/a&gt;: Make conversions field transient&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mwong38/avro&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/mwong38/avro&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1879&quot; title=&quot;Make conversions field transient in compiled SpecificRecord&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1879&quot;&gt;&lt;del&gt;AVRO-1879&lt;/del&gt;&lt;/a&gt;-transient-field&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/107.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/107.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #107&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 903143f1f572c9fb20f326525964615e61cea27d&lt;br/&gt;
Author: Michael Wong &amp;lt;mwong38@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-11T10:07:19Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1879&quot; title=&quot;Make conversions field transient in compiled SpecificRecord&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1879&quot;&gt;&lt;del&gt;AVRO-1879&lt;/del&gt;&lt;/a&gt;: Make conversions field transient&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15371913" author="githubbot" created="Mon, 11 Jul 2016 23:42:49 +0000"  >&lt;p&gt;GitHub user mwong38 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1879&quot; title=&quot;Make conversions field transient in compiled SpecificRecord&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1879&quot;&gt;&lt;del&gt;AVRO-1879&lt;/del&gt;&lt;/a&gt;: Make conversions field static&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mwong38/avro&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/mwong38/avro&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1879&quot; title=&quot;Make conversions field transient in compiled SpecificRecord&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1879&quot;&gt;&lt;del&gt;AVRO-1879&lt;/del&gt;&lt;/a&gt;-static-conversion-field&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/108.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/108.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #108&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ccbf9c6f54236f6c60992d0c5b4f36094394c15a&lt;br/&gt;
Author: Michael Wong &amp;lt;mwong38@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-11T22:56:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1879&quot; title=&quot;Make conversions field transient in compiled SpecificRecord&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1879&quot;&gt;&lt;del&gt;AVRO-1879&lt;/del&gt;&lt;/a&gt;: Make conversions field static&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15371916" author="githubbot" created="Mon, 11 Jul 2016 23:43:00 +0000"  >&lt;p&gt;Github user mwong38 closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/107&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15383823" author="chunfy.tseng" created="Tue, 19 Jul 2016 08:56:57 +0000"  >&lt;p&gt;If I use AVRO PRC, can I use httpclient request?&lt;/p&gt;</comment>
                            <comment id="15384025" author="busbey" created="Tue, 19 Jul 2016 12:08:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chunfy.tseng&quot; class=&quot;user-hover&quot; rel=&quot;chunfy.tseng&quot;&gt;Chunfy.Tseng&lt;/a&gt; please post questions to the &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/avro-user/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;user@avro mailing list&lt;/a&gt; and please do not post your question multiple times.&lt;/p&gt;</comment>
                            <comment id="15463494" author="jira-bot" created="Sun, 4 Sep 2016 20:56:16 +0000"  >&lt;p&gt;Commit c37d05e87957d7b46c32c5fadcb569dc9be44117 in avro&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mwong&quot; class=&quot;user-hover&quot; rel=&quot;mwong&quot;&gt;Michael Wong&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=c37d05e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=c37d05e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1879&quot; title=&quot;Make conversions field transient in compiled SpecificRecord&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1879&quot;&gt;&lt;del&gt;AVRO-1879&lt;/del&gt;&lt;/a&gt;: Make conversions field static.&lt;/p&gt;</comment>
                            <comment id="15463496" author="rdblue" created="Sun, 4 Sep 2016 20:57:12 +0000"  >&lt;p&gt;Merged #108. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mwong&quot; class=&quot;user-hover&quot; rel=&quot;mwong&quot;&gt;Michael Wong&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15464279" author="githubbot" created="Mon, 5 Sep 2016 07:04:22 +0000"  >&lt;p&gt;Github user mwong38 closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/108&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12990761">AVRO-1885</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12817030" name="conversions-transient.patch" size="1167" author="mwong" created="Sun, 10 Jul 2016 10:49:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jul 2016 10:09:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30rdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1880] Py3 Implementation vs Py2 Implementation API compatibility</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1880</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;The Python3 API has been changed from the Python2 API and this can affect backwards compatibility when migrating or building libraries that work with both Python3 and Python2.&lt;/p&gt;

&lt;p&gt;The exact case I&apos;ve found was &apos;validate&apos; vs &apos;Validate&apos;.  Arguably, the python2 version is more correct from a Pep8 (see: &lt;a href=&quot;https://www.python.org/dev/peps/pep-0008/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://www.python.org/dev/peps/pep-0008/&lt;/a&gt;) standpoint.  I found no reason mentioned that I&apos;ve found why the API might have been changed.  In addition, the Python 3 API is inconsistent within itself:  some functions are CamelCase and some are snake_case.&lt;/p&gt;

&lt;p&gt;While this may be out of scope for the issue above, I&apos;m not sure why the current implementations are segregated.  There doesn&apos;t appear to be a reason why there are two separate implementations for python:  one for python 3 and one for python 2.&lt;/p&gt;

&lt;p&gt;Proposal is to create an API that is directly compatible with Python 2 and then deprecate the current Python 3 API where it is different.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12988142">AVRO-1880</key>
            <summary>Py3 Implementation vs Py2 Implementation API compatibility</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bbruggeman">Brian Bruggeman</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Jul 2016 17:02:41 +0000</created>
                <updated>Wed, 30 May 2018 03:17:20 +0000</updated>
                                            <version>1.8.1</version>
                                                    <component>python</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="16494624" author="kojiromike" created="Wed, 30 May 2018 03:17:20 +0000"  >&lt;p&gt;I agree, for whatever my opinion is worth. I&apos;d also point out that schema.parse became schema.Parse in the py3 implementation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 30 May 2018 03:17:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30rj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>python</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-1881] Avro (Java) Memory Leak when reusing JsonDecoder instance</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1881</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;&lt;tt&gt;JsonDecoder&lt;/tt&gt; maintains state for each record decoded, leading to a memory leak if the same instance is used for multiple inputs. Using &lt;tt&gt;JsonDecoder.configure&lt;/tt&gt; to change the input does not correctly clean up the state stored in &lt;tt&gt;JsonDecoder.reorderBuffers&lt;/tt&gt;, which leads to an unbounded number of &lt;tt&gt;ReorderBuffer&lt;/tt&gt; instances being accumulated. If a new &lt;tt&gt;JsonDecoder&lt;/tt&gt; is created for each input there is no memory leak, but it is significantly more expensive than reusing the same instance.&lt;/p&gt;

&lt;p&gt;This problem seems to only occur when the input schema contains a record, which is consistent with the &lt;tt&gt;reorderBuffers&lt;/tt&gt; being the source of the leak. My first look at the &lt;tt&gt;JsonDecoder&lt;/tt&gt; code leads me to believe that the &lt;tt&gt;reorderBuffers&lt;/tt&gt; stack should be empty after a record is fully processed, so there may be other behavior at play here.&lt;/p&gt;

&lt;p&gt;The following is a minimal example which will exhaust a 50MB heap (-Xmx50m) after about 5.25 million iterations. The first section demonstrates that no memory leak is encountered when creating a fresh &lt;tt&gt;JsonDecoder&lt;/tt&gt; instance for each input.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;JsonDecoderMemoryLeak.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.avro.Schema;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.avro.io.*;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.*;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JsonDecoderMemoryLeak {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DecoderFactory decoderFactory = DecoderFactory.get();

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; JsonDecoder createDecoder(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; input, Schema schema) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; decoderFactory.jsonDecoder(schema, input);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; decodeAvro(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; input, Schema schema, JsonDecoder decoder) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (decoder == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            decoder = createDecoder(input, schema);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            decoder.configure(input);
        }
        GenericDatumReader reader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericDatumReader&amp;lt;GenericRecord&amp;gt;(schema);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; reader.read(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, decoder);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Schema.Parser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema.Parser();
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Schema schema = parser.parse(&lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;name\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;TestRecord\&lt;span class=&quot;code-quote&quot;&gt;&quot;, \&quot;&lt;/span&gt;type\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;record\&lt;span class=&quot;code-quote&quot;&gt;&quot;, \&quot;&lt;/span&gt;fields\&lt;span class=&quot;code-quote&quot;&gt;&quot;: [{\&quot;&lt;/span&gt;name\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;field1\&lt;span class=&quot;code-quote&quot;&gt;&quot;, \&quot;&lt;/span&gt;type\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;}]}&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; record(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; i) {
        StringBuilder builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder(&lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;field1\&lt;span class=&quot;code-quote&quot;&gt;&quot;: &quot;&lt;/span&gt;);
        builder.append(i);
        builder.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;}&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; builder.toString();
    }


    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-comment&quot;&gt;// No memory issues when creating a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; decoder &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; each record
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Running with fresh JsonDecoder instances &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 6000000 iterations&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; i = 0; i &amp;lt; 6000000; i++) {
            decodeAvro(record(i), schema, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        }
        
        &lt;span class=&quot;code-comment&quot;&gt;// Runs out of memory after ~5250000 records
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Running with a single reused JsonDecoder instance&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; count = 0;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            JsonDecoder decoder = createDecoder(record(0), schema);
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
                decodeAvro(record(count), schema, decoder);
                count++;
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (OutOfMemoryError e) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Out of memory after &quot;&lt;/span&gt; + count + &lt;span class=&quot;code-quote&quot;&gt;&quot; records&quot;&lt;/span&gt;);
            e.printStackTrace();
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Output&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ java -Xmx50m -jar json-decoder-memory-leak.jar 
Running with fresh JsonDecoder instances &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 6000000 iterations
Running with a single reused JsonDecoder instance
Out of memory after 5242880 records
java.lang.OutOfMemoryError: Java heap space
        at java.util.Arrays.copyOf(Arrays.java:3210)
        at java.util.Arrays.copyOf(Arrays.java:3181)
        at java.util.Vector.grow(Vector.java:266)
        at java.util.Vector.ensureCapacityHelper(Vector.java:246)
        at java.util.Vector.addElement(Vector.java:620)
        at java.util.Stack.push(Stack.java:67)
        at org.apache.avro.io.JsonDecoder.doAction(JsonDecoder.java:487)
        at org.apache.avro.io.parsing.Parser.advance(Parser.java:88)
        at org.apache.avro.io.JsonDecoder.advance(JsonDecoder.java:139)
        at org.apache.avro.io.JsonDecoder.readLong(JsonDecoder.java:178)
        at org.apache.avro.io.ResolvingDecoder.readLong(ResolvingDecoder.java:162)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.readWithoutConversion(GenericDatumReader.java:183)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.read(GenericDatumReader.java:152)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.readField(GenericDatumReader.java:240)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.readRecord(GenericDatumReader.java:230)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.readWithoutConversion(GenericDatumReader.java:174)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.read(GenericDatumReader.java:152)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.read(GenericDatumReader.java:144)
        at com.spiceworks.App.decodeAvro(App.java:25)
        at com.spiceworks.App.main(App.java:52)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Ubuntu 15.04&lt;br/&gt;
Oracle 1.8.0_91 and OpenJDK 1.8.0_45&lt;/p&gt;</environment>
        <key id="12988451">AVRO-1881</key>
            <summary>Avro (Java) Memory Leak when reusing JsonDecoder instance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkollar">Nandor Kollar</assignee>
                                    <reporter username="matt343">Matt Allen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jul 2016 22:05:09 +0000</created>
                <updated>Wed, 7 Nov 2018 22:08:24 +0000</updated>
                            <resolved>Tue, 10 Jan 2017 15:00:02 +0000</resolved>
                                    <version>1.8.1</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15798162" author="githubbot" created="Wed, 4 Jan 2017 12:43:30 +0000"  >&lt;p&gt;GitHub user nandorKollar opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/183&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/183&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1881&quot; title=&quot;Avro (Java) Memory Leak when reusing JsonDecoder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1881&quot;&gt;&lt;del&gt;AVRO-1881&lt;/del&gt;&lt;/a&gt; - Avro (Java) Memory Leak when reusing JsonDecoder instance&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nandorKollar/avro&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/nandorKollar/avro&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1881&quot; title=&quot;Avro (Java) Memory Leak when reusing JsonDecoder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1881&quot;&gt;&lt;del&gt;AVRO-1881&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/183.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/183.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #183&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d58c0e210d6338343bd9a97ae545435dfbfac120&lt;br/&gt;
Author: Nandor Kollar &amp;lt;nkollar@cloudera.com&amp;gt;&lt;br/&gt;
Date:   2017-01-04T12:36:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1881&quot; title=&quot;Avro (Java) Memory Leak when reusing JsonDecoder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1881&quot;&gt;&lt;del&gt;AVRO-1881&lt;/del&gt;&lt;/a&gt; - Avro (Java) Memory Leak when reusing JsonDecoder instance&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15801140" author="tomwhite" created="Thu, 5 Jan 2017 11:39:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;Nandor Kollar&lt;/a&gt;, have you tried running JsonDecoderMemoryLeak to see if your fix works? &lt;/p&gt;</comment>
                            <comment id="15801220" author="nkollar" created="Thu, 5 Jan 2017 12:21:27 +0000"  >&lt;p&gt;Yes, I have, and it didn&apos;t get OutOfMemory error. I also noticed that the reorderBuffers was filled with null elements, wondering if it make sense to add nulls when the currentReorderBuffer is null:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (top == Symbol.RECORD_START) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (in.getCurrentToken() == JsonToken.START_OBJECT) {
        in.nextToken();
        reorderBuffers.push(currentReorderBuffer);
        currentReorderBuffer = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; error(&lt;span class=&quot;code-quote&quot;&gt;&quot;record-start&quot;&lt;/span&gt;);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nevertheless, JsonDecoderMemoryLeak didn&apos;t fail with OOM in my pull request.&lt;/p&gt;</comment>
                            <comment id="15815188" author="jira-bot" created="Tue, 10 Jan 2017 14:59:40 +0000"  >&lt;p&gt;Commit 4f53fa933447865d7afb22c5d7d472d87fc2a4ae in avro&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;Nandor Kollar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=4f53fa9&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=4f53fa9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1881&quot; title=&quot;Avro (Java) Memory Leak when reusing JsonDecoder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1881&quot;&gt;&lt;del&gt;AVRO-1881&lt;/del&gt;&lt;/a&gt; - Avro (Java) Memory Leak when reusing JsonDecoder instance. Contributed by Nandor Kollar.&lt;/p&gt;</comment>
                            <comment id="15815190" author="tomwhite" created="Tue, 10 Jan 2017 15:00:02 +0000"  >&lt;p&gt;I just committed this. Thanks Nandor!&lt;/p&gt;</comment>
                            <comment id="16678198" author="githubbot" created="Wed, 7 Nov 2018 12:59:58 +0000"  >&lt;p&gt;Fokko commented on issue #183: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1881&quot; title=&quot;Avro (Java) Memory Leak when reusing JsonDecoder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1881&quot;&gt;&lt;del&gt;AVRO-1881&lt;/del&gt;&lt;/a&gt; - Avro (Java) Memory Leak when reusing JsonDecoder instance&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/183#issuecomment-436614946&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/183#issuecomment-436614946&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @nandorKollar Interesting patch, can you rebase onto master?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16678212" author="githubbot" created="Wed, 7 Nov 2018 13:21:48 +0000"  >&lt;p&gt;nandorKollar commented on issue #183: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1881&quot; title=&quot;Avro (Java) Memory Leak when reusing JsonDecoder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1881&quot;&gt;&lt;del&gt;AVRO-1881&lt;/del&gt;&lt;/a&gt; - Avro (Java) Memory Leak when reusing JsonDecoder instance&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/183#issuecomment-436620460&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/183#issuecomment-436620460&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @Fokko interesting, it seems that this is already merged to master: &lt;a href=&quot;https://github.com/apache/avro/commit/4f53fa933447865d7afb22c5d7d472d87fc2a4ae&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/commit/4f53fa933447865d7afb22c5d7d472d87fc2a4ae&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   The Jira is already resolved, looks like the PR was merged but wasn&apos;t closed for some reason.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16678854" author="githubbot" created="Wed, 7 Nov 2018 22:08:23 +0000"  >&lt;p&gt;Fokko commented on issue #183: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1881&quot; title=&quot;Avro (Java) Memory Leak when reusing JsonDecoder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1881&quot;&gt;&lt;del&gt;AVRO-1881&lt;/del&gt;&lt;/a&gt; - Avro (Java) Memory Leak when reusing JsonDecoder instance&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/183#issuecomment-436795704&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/183#issuecomment-436795704&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for the clarification @nandorKollar &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16678855" author="githubbot" created="Wed, 7 Nov 2018 22:08:24 +0000"  >&lt;p&gt;Fokko closed pull request #183: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1881&quot; title=&quot;Avro (Java) Memory Leak when reusing JsonDecoder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1881&quot;&gt;&lt;del&gt;AVRO-1881&lt;/del&gt;&lt;/a&gt; - Avro (Java) Memory Leak when reusing JsonDecoder instance&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/183&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/183&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/lang/java/avro/src/main/java/org/apache/avro/io/JsonDecoder.java b/lang/java/avro/src/main/java/org/apache/avro/io/JsonDecoder.java&lt;br/&gt;
index 34a1862de..78fafaa83 100644&lt;br/&gt;
&amp;#8212; a/lang/java/avro/src/main/java/org/apache/avro/io/JsonDecoder.java&lt;br/&gt;
+++ b/lang/java/avro/src/main/java/org/apache/avro/io/JsonDecoder.java&lt;br/&gt;
@@ -105,6 +105,8 @@ public JsonDecoder configure(InputStream in) throws IOException &lt;/p&gt;
{
       throw new NullPointerException(&quot;InputStream to read from cannot be null!&quot;);
     }
&lt;p&gt;     parser.reset();&lt;br/&gt;
+    reorderBuffers.clear();&lt;br/&gt;
+    currentReorderBuffer = null;&lt;br/&gt;
     this.in = jsonFactory.createJsonParser(in);&lt;br/&gt;
     this.in.nextToken();&lt;br/&gt;
     return this;&lt;br/&gt;
@@ -127,6 +129,8 @@ public JsonDecoder configure(String in) throws IOException &lt;/p&gt;
{
       throw new NullPointerException(&quot;String to read from cannot be null!&quot;);
     }
&lt;p&gt;     parser.reset();&lt;br/&gt;
+    reorderBuffers.clear();&lt;br/&gt;
+    currentReorderBuffer = null;&lt;br/&gt;
     this.in = new JsonFactory().createJsonParser(in);&lt;br/&gt;
     this.in.nextToken();&lt;br/&gt;
     return this;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Jan 2017 12:43:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30tfr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1882] ConcurrentHashMap with non-string keys fails in Java 1.8</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1882</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Support for ConcurrentHashMaps with non-string keys seems to be broken when 1.8 version of Java is used because the newer ConcurrentHashMap uses the names &quot;key&quot; and &quot;val&quot; instead of &quot;key&quot; and &quot;values&quot; for its Map.Entry class.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b14/java/util/concurrent/ConcurrentHashMap.java#218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HashEntry in 1.7&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/8u40-b25/java/util/concurrent/ConcurrentHashMap.java?av=h#3468&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MapEntry in 1.8&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hence avro-code that assumes the presence of key/value breaks.&lt;br/&gt;
(&lt;a href=&quot;https://github.com/apache/avro/blob/master/lang/java/avro/src/main/java/org/apache/avro/reflect/ReflectData.java#L434-L443&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;ReflectData.java:L434-L443&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Run the attached test to see the same.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12988470">AVRO-1882</key>
            <summary>ConcurrentHashMap with non-string keys fails in Java 1.8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sachingoyal">Sachin Goyal</assignee>
                                    <reporter username="sachingoyal">Sachin Goyal</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jul 2016 23:23:52 +0000</created>
                <updated>Sun, 6 Nov 2016 16:30:04 +0000</updated>
                            <resolved>Sun, 30 Oct 2016 21:14:18 +0000</resolved>
                                    <version>1.8.1</version>
                                    <fixVersion>1.8.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15371885" author="sachingoyal" created="Mon, 11 Jul 2016 23:26:33 +0000"  >&lt;p&gt;Exception for the above test is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.avro.file.DataFileWriter$AppendWriteException: java.lang.NullPointerException: 
in org.apache.avro.reflect.MapsPojo in union in array 
in org.apache.avro.reflect.PairIntegerString null
of org.apache.avro.reflect.PairIntegerString of array of union in field map2
of org.apache.avro.reflect.MapsPojo
	at org.apache.avro.reflect.ReflectData.getField(ReflectData.java:158)
	at org.apache.avro.generic.GenericDatumWriter.writeField(GenericDatumWriter.java:164)
	at org.apache.avro.specific.SpecificDatumWriter.writeField(SpecificDatumWriter.java:90)
	at org.apache.avro.reflect.ReflectDatumWriter.writeField(ReflectDatumWriter.java:182)
	at org.apache.avro.generic.GenericDatumWriter.writeRecord(GenericDatumWriter.java:156)
	at org.apache.avro.generic.GenericDatumWriter.writeWithoutConversion(GenericDatumWriter.java:118)
	at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:75)
	at org.apache.avro.reflect.ReflectDatumWriter.write(ReflectDatumWriter.java:150)
	at org.apache.avro.generic.GenericDatumWriter.writeArray(GenericDatumWriter.java:192)
	at org.apache.avro.reflect.ReflectDatumWriter.writeArray(ReflectDatumWriter.java:65)
	at org.apache.avro.generic.GenericDatumWriter.writeWithoutConversion(GenericDatumWriter.java:120)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15383825" author="chunfy.tseng" created="Tue, 19 Jul 2016 08:58:31 +0000"  >&lt;p&gt;If I use AVRO PRC, can I use httpclient request?&lt;/p&gt;</comment>
                            <comment id="15384022" author="busbey" created="Tue, 19 Jul 2016 12:07:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chunfy.tseng&quot; class=&quot;user-hover&quot; rel=&quot;chunfy.tseng&quot;&gt;Chunfy.Tseng&lt;/a&gt; please post questions to the &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/avro-user/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;user@avro mailing list&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15392714" author="githubbot" created="Mon, 25 Jul 2016 21:37:42 +0000"  >&lt;p&gt;GitHub user sachingsachin opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/113&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/113&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1882&quot; title=&quot;ConcurrentHashMap with non-string keys fails in Java 1.8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1882&quot;&gt;&lt;del&gt;AVRO-1882&lt;/del&gt;&lt;/a&gt;: ConcurrentHashMap with non-string keys fails in Java 1.8&lt;/p&gt;

&lt;p&gt;    Also updating maven-shade-plugin as per &lt;span class=&quot;error&quot;&gt;&amp;#91;this thread&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://search-hadoop.com/m/F2svI1oJXGf1htLgb&amp;amp;subj=Re+Unable+to+build+clean+checkout+of+avro+from+master&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://search-hadoop.com/m/F2svI1oJXGf1htLgb&amp;amp;subj=Re+Unable+to+build+clean+checkout+of+avro+from+master&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sachingsachin/avro&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/sachingsachin/avro&lt;/a&gt; AVRO_1882&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/113.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/113.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #113&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit faf46e81434adfd4b37844de67c01b39ab478ba2&lt;br/&gt;
Author: Sachin Goyal &amp;lt;sgoyal6@l-sb8m1heg8w-m.local&amp;gt;&lt;br/&gt;
Date:   2016-07-25T21:32:46Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1882&quot; title=&quot;ConcurrentHashMap with non-string keys fails in Java 1.8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1882&quot;&gt;&lt;del&gt;AVRO-1882&lt;/del&gt;&lt;/a&gt;: ConcurrentHashMap with non-string keys fails in Java 1.8&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15620575" author="jira-bot" created="Sun, 30 Oct 2016 21:09:59 +0000"  >&lt;p&gt;Commit 420824c13381c4014d102c8e51e231c694ddacf2 in avro&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sachingoyal&quot; class=&quot;user-hover&quot; rel=&quot;sachingoyal&quot;&gt;Sachin Goyal&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=420824c&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=420824c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1882&quot; title=&quot;ConcurrentHashMap with non-string keys fails in Java 1.8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1882&quot;&gt;&lt;del&gt;AVRO-1882&lt;/del&gt;&lt;/a&gt;: ConcurrentHashMap with non-string keys fails in Java 1.8&lt;/p&gt;</comment>
                            <comment id="15620580" author="rdblue" created="Sun, 30 Oct 2016 21:14:19 +0000"  >&lt;p&gt;Merged #113. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sachingoyal&quot; class=&quot;user-hover&quot; rel=&quot;sachingoyal&quot;&gt;Sachin Goyal&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15640514" author="jira-bot" created="Sat, 5 Nov 2016 20:20:30 +0000"  >&lt;p&gt;Commit b2a2256775b56eb21c7b3599dc9a766067cd6c27 in avro&apos;s branch refs/heads/branch-1.8 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sachingoyal&quot; class=&quot;user-hover&quot; rel=&quot;sachingoyal&quot;&gt;Sachin Goyal&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=b2a2256&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=b2a2256&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1882&quot; title=&quot;ConcurrentHashMap with non-string keys fails in Java 1.8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1882&quot;&gt;&lt;del&gt;AVRO-1882&lt;/del&gt;&lt;/a&gt;: ConcurrentHashMap with non-string keys fails in Java 1.8&lt;/p&gt;</comment>
                            <comment id="15642038" author="githubbot" created="Sun, 6 Nov 2016 16:30:04 +0000"  >&lt;p&gt;Github user sachingsachin closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/avro/pull/113&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/113&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12817290" name="TestNonStringConcurrentMap.java" size="8871" author="sachingoyal" created="Mon, 11 Jul 2016 23:26:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Jul 2016 08:58:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30tjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
