<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:16:32 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2011-12-20+AND+created+%3C%3D+2011-12-27+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="2" total="2"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-985] Remove byte-by-byte copying in RecordBuilderBase.defaultValue for non-complex types</title>
                <link>https://issues.apache.org/jira/browse/AVRO-985</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;In one section of RecordBuilderBase.defaultValue(Field) (quoted below) a bytewise copy of the default object is created based on the JSON value provided. However, this is an extremely inefficient operation and causes large slowdowns when building large object sets, including latency spikes when the binary encoder flushes. &lt;/p&gt;

&lt;p&gt;A simple workaround for a majority of cases would be to have a separate code path for &quot;primitives&quot; (fixed, string, boolean, int, double, enum, float, bytes) that allows direct creation rather than a full bytewise copy (and subsequent deep copy).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;em&gt;RecordBuilderBase.java&lt;/em&gt;&lt;/b&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-comment&quot;&gt;// If not cached, get the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; Java value by encoding the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; JSON
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// value and then decoding it:
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (defaultValue == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
      encoder = EncoderFactory.get().binaryEncoder(baos, encoder);
      ResolvingGrammarGenerator.encode(
          encoder, field.schema(), defaultJsonValue);
      encoder.flush();
      decoder = DecoderFactory.get().binaryDecoder(
          baos.toByteArray(), decoder);
      defaultValue = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericDatumReader(
          field.schema()).read(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, decoder);
      defaultSchemaValues.putIfAbsent(field.pos(), defaultValue);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12535908">AVRO-985</key>
            <summary>Remove byte-by-byte copying in RecordBuilderBase.defaultValue for non-complex types</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dkaminsky">Douglas Kaminsky</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Dec 2011 21:48:12 +0000</created>
                <updated>Thu, 5 Jan 2012 22:52:45 +0000</updated>
                                            <version>1.6.1</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13180913" author="scott_carey" created="Thu, 5 Jan 2012 22:52:45 +0000"  >&lt;p&gt;This is a big performance problem, We could use some sort of Avro Value API (perhaps simply GenericData and friends, in immutable form) instead of the JSON objecs to represent default values.  Then, when serializing the serialized bytes can be cached instead and output, and when deserializing the immutable Generic object can be substituted.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12510523">AVRO-839</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Jan 2012 22:52:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221591</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 3 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80358</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-986] Avro files generated from avro-c dont work with the Java mapred implementation.</title>
                <link>https://issues.apache.org/jira/browse/AVRO-986</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;When a file generated from the Avro-C implementation is fed into Hadoop, it will fail with &quot;Block size invalid or too large for this implementation: -49&quot;.&lt;/p&gt;

&lt;p&gt;This is caused by the sync marker, namely the one that Avro-C puts into the header...&lt;/p&gt;

&lt;p&gt;The org.apache.avro.mapred.AvroRecordReader uses a FileSplit object to work out where it should read from, but this class is not particularly smart, it just divides the file up into equal size chunks, the first being with position 0.&lt;/p&gt;

&lt;p&gt;So org.apache.avro.mapred.AvroRecordReader gets 0 as the start of its chunk, and calls&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;AvroRecordReader.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;reader.sync(split.getStart());   &lt;span class=&quot;code-comment&quot;&gt;// sync to start&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then the org.apache.avro.file.DataFileReader::seek() goes to 0, then searches for a sync marker....&lt;br/&gt;
It encounters one at position 32, the one in the header metadata map, &quot;avro.sync&quot;&lt;/p&gt;

&lt;p&gt;No other implementations add the sync marker in the metadata map, and none read it from there, not even the C version.&lt;/p&gt;

&lt;p&gt;I suggest we remove this from the header as the simplest solution.&lt;br/&gt;
Another solution would be to create an AvroFileSplit class in mapred that knows where the blocks are, and provides the correct locations in the first place.&lt;/p&gt;</description>
                <environment>&lt;p&gt;avro-c 1.6.2-SNAPSHOT&lt;br/&gt;
avro-java 1.6.2-SNAPSHOT&lt;br/&gt;
hadoop 0.20.2&lt;/p&gt;</environment>
        <key id="12536121">AVRO-986</key>
            <summary>Avro files generated from avro-c dont work with the Java mapred implementation.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mic159">Michael Cooper</reporter>
                        <labels>
                            <label>c</label>
                            <label>hadoop</label>
                            <label>java</label>
                            <label>mapreduce</label>
                    </labels>
                <created>Thu, 22 Dec 2011 04:08:30 +0000</created>
                <updated>Wed, 15 Feb 2012 00:46:29 +0000</updated>
                            <resolved>Thu, 26 Jan 2012 16:48:14 +0000</resolved>
                                                    <fixVersion>1.6.2</fixVersion>
                                    <component>c</component>
                    <component>java</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13174607" author="mic159" created="Thu, 22 Dec 2011 04:27:06 +0000"  >&lt;p&gt;Attaching patch to remove sync marker from the metadata in avro-c.&lt;/p&gt;</comment>
                            <comment id="13174936" author="cutting" created="Thu, 22 Dec 2011 18:09:25 +0000"  >&lt;p&gt;+1 This patch sounds like the right way to fix this to me.&lt;/p&gt;

&lt;p&gt;If we were to instead fix this in Java then I don&apos;t think we should try to make the splitter smarter, since splitting is single-threaded and that&apos;s not scalable.  Rather we should make sync(0) skip over the metadata.  But there probably shouldn&apos;t be any sync markers in the metadata anyway...&lt;/p&gt;</comment>
                            <comment id="13174955" author="dcreager" created="Thu, 22 Dec 2011 18:27:05 +0000"  >&lt;p&gt;+1  Should we apply the patch to 1.5, too?&lt;/p&gt;

&lt;p&gt;Also, it&apos;ll still be the case that any existing C-produced files will be unreadable in Java mapred.  Should we also provide a fixup script of some kind?&lt;/p&gt;</comment>
                            <comment id="13175116" author="cutting" created="Thu, 22 Dec 2011 22:31:32 +0000"  >&lt;p&gt;Perhaps we should fix the Java code too.&lt;/p&gt;

&lt;p&gt;Here&apos;s a patch that should do the trick.  To test this we should probably add a file to share/test/data that has &quot;avro.sync&quot; in its metadata and test that reads after a DataFileReader#sync(0) on this work correctly.&lt;/p&gt;</comment>
                            <comment id="13176184" author="dcreager" created="Tue, 27 Dec 2011 14:30:39 +0000"  >&lt;p&gt;I&apos;ve attached a copy of the quickstop.db Avro file; this is generated by one of the C test cases.  It contains the avro.sync metadata field.  I&apos;m happy to add this to the share directory also, but unfortunately I don&apos;t know enough about the Java build scripts to write a test case for Doug&apos;s patch.&lt;/p&gt;</comment>
                            <comment id="13176201" author="dcreager" created="Tue, 27 Dec 2011 15:06:17 +0000"  >&lt;p&gt;Here&apos;s a patch that adds a new &quot;avromod&quot; command-line utility.  It can be used as a fixup script to remove the avro.sync field from the header (once I commit Michael&apos;s patch).  It&apos;s also useful in its own right since you can create copies of Avro files with different compression codecs and block sizes.  Eventually, we can also add options for changing the schema of the data in the file.&lt;/p&gt;</comment>
                            <comment id="13189954" author="cutting" created="Fri, 20 Jan 2012 18:02:33 +0000"  >&lt;p&gt;Here&apos;s a version of the java changes that includes a test.&lt;/p&gt;</comment>
                            <comment id="13191629" author="cutting" created="Mon, 23 Jan 2012 23:39:11 +0000"  >&lt;p&gt;It would be good to get this into 1.6.2.  Douglas, do you want to commit it, or should I?&lt;/p&gt;</comment>
                            <comment id="13192180" author="dcreager" created="Tue, 24 Jan 2012 14:34:39 +0000"  >&lt;p&gt;Sure, I&apos;ll commit the patches now.&lt;/p&gt;</comment>
                            <comment id="13192181" author="dcreager" created="Tue, 24 Jan 2012 14:36:55 +0000"  >&lt;p&gt;Actually, it looks like the java patch file you uploaded doesn&apos;t contain the contents of the binary syncInMeta.avro file.  Can you upload that separately?&lt;/p&gt;</comment>
                            <comment id="13192387" author="cutting" created="Tue, 24 Jan 2012 19:14:47 +0000"  >&lt;p&gt;share/test/data/syncInMeta.avro was just where I placed the quickstop.db file already attached to this issue.&lt;/p&gt;</comment>
                            <comment id="13193957" author="dcreager" created="Thu, 26 Jan 2012 16:48:14 +0000"  >&lt;p&gt;Committed all of these to SVN.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508345" name="0001-Remove-sync-marker-from-metadata-in-header.patch" size="1057" author="mic159" created="Thu, 22 Dec 2011 04:27:06 +0000"/>
                            <attachment id="12508683" name="0001-avromod-utility.patch" size="6858" author="dcreager" created="Tue, 27 Dec 2011 15:06:17 +0000"/>
                            <attachment id="12511289" name="AVRO-986-java.patch" size="2002" author="cutting" created="Fri, 20 Jan 2012 18:02:33 +0000"/>
                            <attachment id="12508457" name="AVRO-986-java.patch" size="733" author="cutting" created="Thu, 22 Dec 2011 22:31:32 +0000"/>
                            <attachment id="12508679" name="quickstop.db" size="22609" author="dcreager" created="Tue, 27 Dec 2011 14:30:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Dec 2011 18:09:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221804</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80359</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mapreduce hadoop avro sync</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
