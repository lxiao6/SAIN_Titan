<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:17:21 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2012-6-27+AND+created+%3C%3D+2012-7-4+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="2" total="2"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-1122] Java: Avro RPC Requestor can block during handshake in async mode</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1122</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;We are seeing an issue in Flume where the Avro RPC Requestor is blocking for long periods of time waiting for the Avro handshake to complete. Since we are using the API with Futures, this should not block.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12596045">AVRO-1122</key>
            <summary>Java: Avro RPC Requestor can block during handshake in async mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mpercy">Mike Percy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jun 2012 07:30:32 +0000</created>
                <updated>Sun, 30 Dec 2018 05:26:36 +0000</updated>
                                            <version>1.6.3</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13402030" author="mpercy" created="Wed, 27 Jun 2012 07:42:02 +0000"  >&lt;p&gt;Seeing against Avro 1.6.3. Still figuring out how to reproduce since we are seeing this in a load testing environment.&lt;/p&gt;</comment>
                            <comment id="13402036" author="mpercy" created="Wed, 27 Jun 2012 07:45:53 +0000"  >&lt;p&gt;YourKit screenshot attached.&lt;/p&gt;</comment>
                            <comment id="13481440" author="jbaldassari" created="Mon, 22 Oct 2012 15:34:49 +0000"  >&lt;p&gt;This is the expected behavior with the current implementation of NettyTransceiver.  The first request always blocks until the handshake is completed.  All subsequent requests are asynchronous.  There is an existing issue to improve this for Netty and other asynchronous implementations: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1008&quot; title=&quot;Allow IPC clients to perform the IPC handshake before the first RPC is invoked&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1008&quot;&gt;&lt;del&gt;AVRO-1008&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;IIRC there is a workaround.  You can call getRemote() on the NettyTransceiver (or maybe the Responder?) immediately after you create it.  This will force the handshake to happen so that the first RPC will be asynchronous.  However, I think calling this method results in a stack trace being logged on the server side because the server gets a request with an empty RPC name.  It&apos;s harmless but just kind of annoying.&lt;/p&gt;

&lt;p&gt;Another approach might be writing a patch to perform an asynchronous handshake, but the basic problem is that the handshake needs to be completed prior to invoking any RPC.  So there has to be some mechanism to block/prevent RPCs until the handshake is completed, unless anyone can think of another way to do it.&lt;/p&gt;</comment>
                            <comment id="13486585" author="mpercy" created="Tue, 30 Oct 2012 01:24:50 +0000"  >&lt;p&gt;Hi James, yep now I know it pretty much has to block based on the Transceiver API and the way the Proxy is implemented. It&apos;s a little tricky, since at the moment you can&apos;t perform the handshake before the proxy object is instantiated AFAICT. Based on my experience with Avro RPC in Flume, I&apos;d like to be able to use a client API that provides something along the lines of:&lt;/p&gt;

&lt;p&gt;1. set address &amp;amp; port of endpoint (NettyTransceiver does this today)&lt;br/&gt;
2. set interface (SpecificRequestor.getClient() does this today)&lt;br/&gt;
3. async TCP connection using a CallFuture (not possible today)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throws if address/port not set properly&lt;br/&gt;
4. async handshake using a CallFuture (not possible today)&lt;/li&gt;
	&lt;li&gt;throws if not connected, or if interface not set properly&lt;/li&gt;
	&lt;li&gt;alternatively, specify a boolean flag to connect if needed&lt;br/&gt;
5. async RPC calls (possible using the CallFuture / Callback APIs)&lt;/li&gt;
	&lt;li&gt;throws if handshake not completed or connection is not open&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m not sure how to weave that into the existing framework yet, though.&lt;/p&gt;</comment>
                            <comment id="13623978" author="jbaldassari" created="Fri, 5 Apr 2013 19:33:58 +0000"  >&lt;p&gt;I noticed that &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1008&quot; title=&quot;Allow IPC clients to perform the IPC handshake before the first RPC is invoked&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1008&quot;&gt;&lt;del&gt;AVRO-1008&lt;/del&gt;&lt;/a&gt; has been committed, so it is now possible to perform the handshake before the first async RPC.  However, if NettyTransceiver loses its connection to the server and has to reconnect, subsequent RPCs will block until the handshake is reestablished.&lt;/p&gt;

&lt;p&gt;It would be great to eventually support an asynchronous handshake, but it raises the question of what should happen when code is trying to execute an RPC before the async handshake has completed.  Should the Requestor/Transceiver simply throw an Exception and let the client deal with it?  That would be one way to handle it, but it&apos;s more work for users of the library.  A compromise might be to have the Requestor/Transceiver throw an exception when the handshake has not completed but also provide an event listener interface (or future/callback) that allows other code to detect when the handshake is complete.  It should also be possible to implement an optional wrapper class that would provide the block-until-complete behavior.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12539736">AVRO-1008</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12596068">FLUME-1329</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12533618" name="Screen Shot 2012-06-27 at 12.43.32 AM.png" size="34404" author="mpercy" created="Wed, 27 Jun 2012 07:45:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Oct 2012 15:34:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250359</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 42 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0axvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-1123] SpecificData is not using the custom ClassLoader in newRecord</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1123</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-873&quot; title=&quot;SpecificDatumReader should allow users to specify the ClassLoader used.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-873&quot;&gt;&lt;del&gt;AVRO-873&lt;/del&gt;&lt;/a&gt; added support for a custom ClassLoader in SpecificData and a custom SpecificData in SpecificDatumReader. However the SpecificData doesn&apos;t use this custom ClassLoader in the newRecord method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12596136">AVRO-1123</key>
            <summary>SpecificData is not using the custom ClassLoader in newRecord</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stevenwillis">Steven Willis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jun 2012 18:55:27 +0000</created>
                <updated>Tue, 25 Sep 2012 21:22:59 +0000</updated>
                            <resolved>Wed, 1 Aug 2012 21:16:28 +0000</resolved>
                                    <version>1.6.0</version>
                    <version>1.7.1</version>
                    <version>1.7.2</version>
                                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13402493" author="stevenwillis" created="Wed, 27 Jun 2012 19:16:57 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;SpecificRecord.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; newRecord(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; old, Schema schema) {
    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c = SpecificData.get().getClass(schema);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (c == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.newRecord(old, schema); &lt;span class=&quot;code-comment&quot;&gt;// punt to &lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (c.isInstance(old) ? old : newInstance(c, schema));
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When &lt;tt&gt;SpecificData.get()&lt;/tt&gt; is called, the singleton instance is returned, which doesn&apos;t have the custom &lt;tt&gt;ClassLoader&lt;/tt&gt; which was passed in to the constructor of the instance of &lt;tt&gt;SpecificData&lt;/tt&gt; making this call. I think it should simply be changed to getClass(schema).&lt;/p&gt;

&lt;p&gt;For example, I have:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;MyClass.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  SpecificData specificData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpecificData(MyRecord.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader());
  DatumReader&amp;lt;MyRecord&amp;gt; reader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpecificDatumReader&amp;lt;MyRecord&amp;gt;(MyRecord.SCHEMA$,
                                                                   MyRecord.SCHEMA$,
                                                                   specificData);
  DataFileStream&amp;lt;MyRecord&amp;gt; stream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataFileStream&amp;lt;MyRecord&amp;gt;(bufInStream, reader);

  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(MyRecord record : stream) {
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;%s\n&quot;&lt;/span&gt;, record.field);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When run, I get: Exception in thread &quot;main&quot; java.lang.ClassCastException: org.apache.avro.generic.GenericData$Record cannot be cast to com.compete.avro.MyRecord&lt;/p&gt;

&lt;p&gt;If I add the jar containing &lt;tt&gt;MyRecord.class&lt;/tt&gt; to the classpath, then it works, but I&apos;d like to not have to do that since it should be found anyway.&lt;/p&gt;</comment>
                            <comment id="13421438" author="stevenwillis" created="Tue, 24 Jul 2012 14:25:19 +0000"  >&lt;p&gt;Patch to SpecificData.java&lt;/p&gt;</comment>
                            <comment id="13422671" author="cutting" created="Wed, 25 Jul 2012 22:12:32 +0000"  >&lt;p&gt;This is a subset of the changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1103&quot; title=&quot;New AvroDeserializer should Locate Appropriate Classloader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1103&quot;&gt;&lt;del&gt;AVRO-1103&lt;/del&gt;&lt;/a&gt;.  I think all of the changes there are warranted, and that includes a test.  So I&apos;m +1 for this, but I&apos;d rather commit the entire patch over on &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1103&quot; title=&quot;New AvroDeserializer should Locate Appropriate Classloader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1103&quot;&gt;&lt;del&gt;AVRO-1103&lt;/del&gt;&lt;/a&gt; since it also fixes this for reflect and for mapreduce.&lt;/p&gt;</comment>
                            <comment id="13426905" author="cutting" created="Wed, 1 Aug 2012 21:16:28 +0000"  >&lt;p&gt;The fix for this was included in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1103&quot; title=&quot;New AvroDeserializer should Locate Appropriate Classloader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1103&quot;&gt;&lt;del&gt;AVRO-1103&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12558254">AVRO-1103</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537695" name="AVRO-1123.patch" size="973" author="stevenwillis" created="Tue, 24 Jul 2012 14:25:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Jul 2012 22:12:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253673</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Adding support for a custom ClassLoader to SpecificData</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
