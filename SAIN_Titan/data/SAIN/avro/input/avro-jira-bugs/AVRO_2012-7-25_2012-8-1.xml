<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:17:29 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2012-7-25+AND+created+%3C%3D+2012-8-1+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="1" total="1"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-1134] Ruby datafile serialization fails with UTF-8 characters</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1134</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;When trying to deserialize a data file containing a string with UTF-8 characters the ruby avro client fails with a variety of errors (error message varies with each run, see below). The attached script can be used to replicate this problem. Changing the type in the schema between bytes and string doesn&apos;t make a difference.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:46:in `&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;!&lt;span class=&quot;code-quote&quot;&gt;&apos;: undefined method `unpack&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nil:NilClass (NoMethodError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:63:in `read_long&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:380:in `read_union&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:316:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:46:in `&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;!&lt;span class=&quot;code-quote&quot;&gt;&apos;: undefined method `unpack&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nil:NilClass (NoMethodError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:63:in `read_long&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:380:in `read_union&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:316:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:46:in `&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;!&lt;span class=&quot;code-quote&quot;&gt;&apos;: undefined method `unpack&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nil:NilClass (NoMethodError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:63:in `read_long&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:380:in `read_union&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:316:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:105:in `read&apos;: failed to allocate memory (NoMemoryError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:105:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:93:in `read_bytes&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:100:in `read_string&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:306:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:229:in `match_schemas&lt;span class=&quot;code-quote&quot;&gt;&apos;: undefined method `type&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nil:NilClass (NoMethodError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:287:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:383:in `read_union&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:316:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:105:in `read&apos;: negative length -7638 given (ArgumentError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:105:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:93:in `read_bytes&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:100:in `read_string&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:306:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:105:in `read&apos;: negative length -50 given (ArgumentError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:105:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:93:in `read_bytes&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:100:in `read_string&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:306:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:46:in `&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;!&lt;span class=&quot;code-quote&quot;&gt;&apos;: undefined method `unpack&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nil:NilClass (NoMethodError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:63:in `read_long&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:380:in `read_union&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:316:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:105:in `read&apos;: negative length -47 given (ArgumentError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:105:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:93:in `read_bytes&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:100:in `read_string&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:306:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;

% ruby avro_utf8_test.rb
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2x2&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;broken&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;=&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;2\xC3\x97&quot;&lt;/span&gt;}
vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:229:in `match_schemas&lt;span class=&quot;code-quote&quot;&gt;&apos;: undefined method `type&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nil:NilClass (NoMethodError)
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:287:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:383:in `read_union&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:316:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:391:in `block in read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:389:in `read_record&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:317:in `read_data&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/io.rb:282:in `read&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:223:in `block in each&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `loop&apos;
  from vendor/ruby/1.9.1/gems/avro-1.7.0/lib/avro/data_file.rb:211:in `each&apos;
  from avro_utf8_test.rb:29:in `&amp;lt;main&amp;gt;&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Linux and Mac OS X tested, identical on both.&lt;/p&gt;</environment>
        <key id="12600411">AVRO-1134</key>
            <summary>Ruby datafile serialization fails with UTF-8 characters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pdlug">Paul Dlug</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jul 2012 01:11:59 +0000</created>
                <updated>Mon, 10 Dec 2012 18:00:12 +0000</updated>
                            <resolved>Wed, 28 Nov 2012 22:34:44 +0000</resolved>
                                    <version>1.7.1</version>
                                                    <component>ruby</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13423609" author="pdlug" created="Fri, 27 Jul 2012 01:12:56 +0000"  >&lt;p&gt;Ruby script to replicate reported problem, first string is plain ASCII and deserializes cleanly. Second string contains a UTF-8 character and fails on deserialization.&lt;/p&gt;</comment>
                            <comment id="13495425" author="nfo" created="Mon, 12 Nov 2012 17:12:37 +0000"  >&lt;p&gt;Here is my fix: &lt;a href=&quot;https://github.com/nfo/avro/commit/f692322f40a3e0ce2a948d14bd1359694c9125f1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/nfo/avro/commit/f692322f40a3e0ce2a948d14bd1359694c9125f1&lt;/a&gt; . Note that it&apos;s not compatible with Ruby 1.8.6.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;icantbelievethishasntbeenfixedalready.diff&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/lang/ruby/lib/avro/io.rb b/lang/ruby/lib/avro/io.rb
index b548b46..dbbd971 100644
--- a/lang/ruby/lib/avro/io.rb
+++ b/lang/ruby/lib/avro/io.rb
@@ -201,7 +201,7 @@ module Avro
 
       # Bytes are encoded as a &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; followed by that many bytes of data.
       def write_bytes(datum)
-        write_long(datum.size)
+        write_long(datum.bytesize)
         @writer.write(datum)
       end
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It just fixes the writing, not the reading phase. When reading, it&apos;s the goal of the client to tell that strings are encoded in UTF-8. In Ruby 1.9+:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;string.force_encoding(&lt;span class=&quot;code-quote&quot;&gt;&apos;UTF-8&apos;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13500624" author="cutting" created="Mon, 19 Nov 2012 20:27:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1206&quot; title=&quot;utf-8 serialisation problems &quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1206&quot;&gt;&lt;del&gt;AVRO-1206&lt;/del&gt;&lt;/a&gt; is a duplicate of this.  I&apos;m trying to develop a unit test for this there.&lt;/p&gt;</comment>
                            <comment id="13505987" author="cutting" created="Wed, 28 Nov 2012 22:34:44 +0000"  >&lt;p&gt;Resolving as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1206&quot; title=&quot;utf-8 serialisation problems &quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1206&quot;&gt;&lt;del&gt;AVRO-1206&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12616408">AVRO-1206</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12616408">AVRO-1206</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12538106" name="avro_utf8_test.rb" size="564" author="pdlug" created="Fri, 27 Jul 2012 01:12:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 12 Nov 2012 17:12:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4k7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80501</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
