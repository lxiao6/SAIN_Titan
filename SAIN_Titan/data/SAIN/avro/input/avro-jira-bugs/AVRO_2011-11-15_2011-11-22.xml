<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:16:23 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2011-11-15+AND+created+%3C%3D+2011-11-22+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="1" total="1"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-957] Added Codec Support to Avro-C</title>
                <link>https://issues.apache.org/jira/browse/AVRO-957</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;We (Experian Hitwise) have added codec support to avro-c (as per the avro spec), with preliminary deflate/inflate support (as well as null codec support).&lt;/p&gt;

&lt;p&gt;This changes the way blocks are written to the file, with the block data being passed through the codec interface, before being written to file.&lt;/p&gt;

&lt;p&gt;This also changes the way blocks are read from a file, with the block data first being read into a buffer, before being passed through the codec interface, then a memory reader is set to the decoded data, which is read by the user calls avro_file_reader_read_value() and avro_file_reader_read()&lt;/p&gt;

&lt;p&gt;Please feel free to make changes, as although I did try to emulate the coding style of the rest of the avro c library, there may be things I&apos;ve done &quot;differently&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Code is available from Github:  &lt;a href=&quot;https://github.com/hitwise/avro&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/hitwise/avro&lt;/a&gt;  (branch: codec)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12532115">AVRO-957</key>
            <summary>Added Codec Support to Avro-C</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lmartinking">Lucas Martin-King</reporter>
                        <labels>
                            <label>c</label>
                            <label>codec</label>
                            <label>deflate</label>
                    </labels>
                <created>Mon, 21 Nov 2011 06:54:24 +0000</created>
                <updated>Thu, 22 Aug 2013 06:23:49 +0000</updated>
                            <resolved>Tue, 20 Dec 2011 02:28:11 +0000</resolved>
                                                    <fixVersion>1.6.2</fixVersion>
                                    <component>c</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13164991" author="mic159" created="Thu, 8 Dec 2011 04:58:35 +0000"  >&lt;p&gt;I have done some further work on the codecs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Added LZMA codec&lt;/li&gt;
	&lt;li&gt;Removed debug code that was causing compiler warnings.&lt;/li&gt;
	&lt;li&gt;Codecs are now not mandatory and only get compiled in if the system has the library.&lt;/li&gt;
	&lt;li&gt;Updated quickstop example to write two blocks to cover encoding/decoding multiple blocks.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The work was done in the codec-lzma branch on the hitwise/avro fork. &lt;a href=&quot;https://github.com/hitwise/avro/tree/codec-lzma&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/hitwise/avro/tree/codec-lzma&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13167376" author="mic159" created="Mon, 12 Dec 2011 06:55:43 +0000"  >&lt;p&gt;More work:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Decoding of blocks now has no hardcoded buffer size. It now grows the buffer until it can decode the whole block, then keeps reusing that block size.&lt;/li&gt;
	&lt;li&gt;Fixed errors in the cmake configuration (the cache caught me out).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13168129" author="mic159" created="Tue, 13 Dec 2011 04:37:02 +0000"  >&lt;p&gt;I just added a way to set the block size (datum_buffer size). Its a new parameter on the end of the avro_file_writer_create_with_codec function.&lt;br/&gt;
The default is still 16KB.&lt;/p&gt;

&lt;p&gt;I also fixed some error messages in quickstop to include a newline in some of the error messages.&lt;/p&gt;

&lt;p&gt;The branch has now been moved to a branch called &quot;codec&quot;.&lt;br/&gt;
&lt;a href=&quot;https://github.com/hitwise/avro/tree/codec&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/hitwise/avro/tree/codec&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13168735" author="dcreager" created="Tue, 13 Dec 2011 21:20:28 +0000"  >&lt;p&gt;I&apos;ve had a chance to look through this, and I think it&apos;s very good.  I only have a couple of questions/comments, and then I can commit this.&lt;/p&gt;

&lt;p&gt;First, there are a couple of places where it looks like you&apos;re calling avro_realloc once for each block in a file.  (In codec.c:encode_deflate and datafile.c:file_read_block_count.)  You should first check that the buffer isn&apos;t already big enough to hold the requested space.  (avro_realloc doesn&apos;t do this for you; it does a realloc each time you call it.)  That will save some memory allocation overhead when reading from huge files.&lt;/p&gt;

&lt;p&gt;Second, in codec.c:avro_codec, can you add an avro_set_error call in the switch&apos;s default block?  Something like &quot;Unknown codec %s&quot;.&lt;/p&gt;

&lt;p&gt;Third, CMake actually has some built-in logic for finding zlib, and we can use pkg-config to find liblzma.  I&apos;ve created a patch that does this, which I&apos;ll attach after I finish typing in this comment.&lt;/p&gt;

&lt;p&gt;Lastly, there are some nit-picky whitespace inconsistencies; since you&apos;re using git, you can use the --color option to &quot;git diff&quot; or &quot;git show&quot; to see some of them.  (It&apos;ll show trailing whitespace in super-bright red.)  And there are some places where things aren&apos;t lining up when you&apos;ve got multiple lines inside of some parentheses; make sure you&apos;re using real tabs, and that your tab stops are at 8 spaces, when you line things up.&lt;/p&gt;

&lt;p&gt;Other than that, this looks great.  As we mentioned on the dev mailing list, we&apos;ll need to have an actual patch file uploaded to this ticket, marked that you grant permission to the ASF to include it in the codebase, before we can merge the changes into SVN.  (We can&apos;t use the git branch or github Pull Request directly &#8212; the patches on this JIRA ticket are how ASF keeps track of the copyright assignment for legal purposes.)  It looks like the best way to do this will be to change your github Pull Request to use the codec branch.  Then you can use the &lt;a href=&quot;https://github.com/apache/avro/pull/5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/5.patch&lt;/a&gt; link to obtain a patch file that you can upload.&lt;/p&gt;</comment>
                            <comment id="13168737" author="dcreager" created="Tue, 13 Dec 2011 21:21:57 +0000"  >&lt;p&gt;A patch on top of the latest codec branch that uses CMake&apos;s built-in support for finding zlib, and uses pkg-config to find lzma.&lt;/p&gt;

&lt;p&gt;Once we get the patch file for the codec branch uploaded and committed, I&apos;ll commit this on top of it before closing the ticket.&lt;/p&gt;</comment>
                            <comment id="13169049" author="mic159" created="Wed, 14 Dec 2011 03:29:45 +0000"  >&lt;p&gt;Hi Douglas,&lt;/p&gt;

&lt;p&gt;I have just fixed up those things.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;It now checks if the buffer length is already big enough before using realloc.&lt;/li&gt;
	&lt;li&gt;Improved error messages.
	&lt;ul&gt;
		&lt;li&gt;Set the error message when deflate breaks&lt;/li&gt;
		&lt;li&gt;Set the error message when codec is not known&lt;/li&gt;
		&lt;li&gt;Return 1(error) when avro_codec_* cannot determine the codec.&lt;/li&gt;
		&lt;li&gt;Show the error messages in quickstop for debugging.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;The cmake changes you sent did not work right out of the box for me, the package names were different (case sensitive?).
	&lt;ul&gt;
		&lt;li&gt;zlib -&amp;gt; ZLIB&lt;/li&gt;
		&lt;li&gt;pkgconfig -&amp;gt; PkgConfig&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;The CODEC_LIB variable was renamed, but it was still used elsewhere. Turns out that its not needed now that you added target_link_libraries.&lt;/li&gt;
	&lt;li&gt;Fixed whitespace issues&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;One thing I&apos;m not sure about is in encode_deflate, where apparently deflate() resizes the buffer?&lt;/p&gt;

&lt;p&gt;I have closed and re-opened the pull request with the new branch.&lt;br/&gt;
I will attach the patch shortly.&lt;/p&gt;</comment>
                            <comment id="13169086" author="mic159" created="Wed, 14 Dec 2011 05:04:19 +0000"  >&lt;p&gt;Attaching patch file &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-957&quot; title=&quot;Added Codec Support to Avro-C&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-957&quot;&gt;&lt;del&gt;AVRO-957&lt;/del&gt;&lt;/a&gt;.patch:&lt;/p&gt;

&lt;p&gt;We (Hitwise Pty Ltd) hereby assign all rights to the code contained within this patch over to the Apache Software Foundation (ASF) under the Apache Licence.&lt;/p&gt;</comment>
                            <comment id="13172866" author="dcreager" created="Tue, 20 Dec 2011 02:28:11 +0000"  >&lt;p&gt;Committed to SVN&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12532382">AVRO-958</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12507246" name="0001-Use-builtin-CMake-logic-to-find-zlib-and-lzma.patch" size="3034" author="dcreager" created="Tue, 13 Dec 2011 21:21:57 +0000"/>
                            <attachment id="12507304" name="AVRO-957.patch" size="103181" author="mic159" created="Wed, 14 Dec 2011 05:05:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 8 Dec 2011 04:58:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e3if:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80331</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
