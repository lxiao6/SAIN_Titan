<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Mon Jan 21 19:22:52 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+AVRO+AND+created+%3E%3D+2016-1-5+AND+created+%3C%3D+2016-1-12+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="7" total="7"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[AVRO-1777] Select best matching record when writing a union in python</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1777</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Unlike javascript, python is not using wrapped types.&lt;br/&gt;
So when writing a union it needs to guess find out which type it will output.&lt;br/&gt;
At the moment it takes the last validating type.&lt;/p&gt;

&lt;p&gt;I propose to take the type with the most matching fields.&lt;/p&gt;

&lt;p&gt;So I propose to change in &lt;tt&gt;io.py&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# resolve union
index_of_schema = -1
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i, candidate_schema in enumerate(writers_schema.schemas):
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; validate(candidate_schema, datum):
    index_of_schema = i
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; index_of_schema &amp;lt; 0: raise AvroTypeException(writers_schema, datum)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;into&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# resolve union
index_of_schema = -1
found_fields = -1
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i, candidate_schema in enumerate(writers_schema.schemas):
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; validate(candidate_schema, datum):
    nr_fields = candidate_schema.type in [&lt;span class=&quot;code-quote&quot;&gt;&apos;record&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;error&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;request&apos;&lt;/span&gt;] and len(candidate_schema.fields) or 1
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; nr_fields &amp;gt; found_fields:
      index_of_schema = i
      found_fields = nr_fields
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; index_of_schema &amp;lt; 0: raise AvroTypeException(writers_schema, datum)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you want, I can create a pull request for this.  And apply it both on py3 as py.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12927276">AVRO-1777</key>
            <summary>Select best matching record when writing a union in python</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="steven.aerts">Steven Aerts</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2016 13:44:12 +0000</created>
                <updated>Sun, 23 Dec 2018 08:05:53 +0000</updated>
                                            <version>1.7.7</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>python</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15291226" author="movermeyer" created="Thu, 19 May 2016 14:58:39 +0000"  >&lt;p&gt;The result of this issue is that data that was serialized in one schema gets deserialized as an object of a different schema.&lt;/p&gt;

&lt;p&gt;This problem has also been reported to &lt;a href=&quot;https://github.com/tebeka/fastavro/issues/48&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;fastavro&lt;/a&gt;.&lt;br/&gt;
In that issue you can see a simple example IDL that exhibits the problem.&lt;/p&gt;

&lt;p&gt; Steven, if you&apos;d be willing to submit a pull request, that would be appreciated.&lt;/p&gt;</comment>
                            <comment id="15318105" author="shiraeeshi" created="Tue, 7 Jun 2016 08:15:35 +0000"  >&lt;p&gt;I believe my PR is relevant to this issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/avro/pull/95&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/95&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Following the Java logic, I&apos;ve added the GenericRecord type that stores the schema.&lt;/p&gt;</comment>
                            <comment id="16717713" author="githubbot" created="Tue, 11 Dec 2018 18:28:07 +0000"  >&lt;p&gt;dkulp closed pull request #95: &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1777&quot; title=&quot;Select best matching record when writing a union in python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1777&quot;&gt;AVRO-1777&lt;/a&gt;: Select best matching record when writing a union in python&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/avro/pull/95&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/avro/pull/95&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/lang/py/src/avro/io.py b/lang/py/src/avro/io.py&lt;br/&gt;
index b2fd2f9ba..63907e17c 100644&lt;br/&gt;
&amp;#8212; a/lang/py/src/avro/io.py&lt;br/&gt;
+++ b/lang/py/src/avro/io.py&lt;br/&gt;
@@ -94,6 +94,10 @@ def _&lt;em&gt;init&lt;/em&gt;_(self, fail_msg, writers_schema=None, readers_schema=None):&lt;br/&gt;
     if readers_schema: fail_msg += &quot;\nReader&apos;s Schema: %s&quot; % pretty_readers&lt;br/&gt;
     schema.AvroException._&lt;em&gt;init&lt;/em&gt;_(self, fail_msg)&lt;/p&gt;

&lt;p&gt;+class RecordInitializationException(schema.AvroException):&lt;br/&gt;
+    def _&lt;em&gt;init&lt;/em&gt;_(self, fail_msg):&lt;br/&gt;
+        schema.AvroException._&lt;em&gt;init&lt;/em&gt;_(self, fail_msg)&lt;br/&gt;
+&lt;br/&gt;
 #&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Validate&lt;br/&gt;
 #&lt;br/&gt;
@@ -110,14 +114,17 @@ def validate(expected_schema, datum):&lt;br/&gt;
   elif schema_type == &apos;bytes&apos;:&lt;br/&gt;
     return isinstance(datum, str)&lt;br/&gt;
   elif schema_type == &apos;int&apos;:&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return ((isinstance(datum, int) or isinstance(datum, long))&lt;/li&gt;
	&lt;li&gt;and INT_MIN_VALUE &amp;lt;= datum &amp;lt;= INT_MAX_VALUE)&lt;br/&gt;
+    return (((isinstance(datum, int) and not isinstance(datum, bool)) or&lt;br/&gt;
+            isinstance(datum, long)) and&lt;br/&gt;
+            INT_MIN_VALUE &amp;lt;= datum &amp;lt;= INT_MAX_VALUE)&lt;br/&gt;
   elif schema_type == &apos;long&apos;:&lt;/li&gt;
	&lt;li&gt;return ((isinstance(datum, int) or isinstance(datum, long))&lt;/li&gt;
	&lt;li&gt;and LONG_MIN_VALUE &amp;lt;= datum &amp;lt;= LONG_MAX_VALUE)&lt;br/&gt;
+    return (((isinstance(datum, int) and not isinstance(datum, bool)) or&lt;br/&gt;
+            isinstance(datum, long)) and&lt;br/&gt;
+            LONG_MIN_VALUE &amp;lt;= datum &amp;lt;= LONG_MAX_VALUE)&lt;br/&gt;
   elif schema_type in &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;float&amp;#39;, &amp;#39;double&amp;#39;&amp;#93;&lt;/span&gt;:&lt;/li&gt;
	&lt;li&gt;return (isinstance(datum, int) or isinstance(datum, long)&lt;/li&gt;
	&lt;li&gt;or isinstance(datum, float))&lt;br/&gt;
+    return (isinstance(datum, long) or&lt;br/&gt;
+            (isinstance(datum, int) and not isinstance(datum, bool)) or&lt;br/&gt;
+            isinstance(datum, float))&lt;br/&gt;
   elif schema_type == &apos;fixed&apos;:&lt;br/&gt;
     return isinstance(datum, str) and len(datum) == expected_schema.size&lt;br/&gt;
   elif schema_type == &apos;enum&apos;:&lt;br/&gt;
@@ -132,6 +139,8 @@ def validate(expected_schema, datum):&lt;br/&gt;
         &lt;span class=&quot;error&quot;&gt;&amp;#91;validate(expected_schema.values, v) for v in datum.values()&amp;#93;&lt;/span&gt;)&lt;br/&gt;
   elif schema_type in &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;union&amp;#39;, &amp;#39;error_union&amp;#39;&amp;#93;&lt;/span&gt;:&lt;br/&gt;
     return True in &lt;span class=&quot;error&quot;&gt;&amp;#91;validate(s, datum) for s in expected_schema.schemas&amp;#93;&lt;/span&gt;&lt;br/&gt;
+  elif schema_type == &apos;record&apos; and isinstance(datum, GenericRecord):&lt;br/&gt;
+      return expected_schema == datum.schema&lt;br/&gt;
   elif schema_type in &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;record&amp;#39;, &amp;#39;error&amp;#39;, &amp;#39;request&amp;#39;&amp;#93;&lt;/span&gt;:&lt;br/&gt;
     return (isinstance(datum, dict) and&lt;br/&gt;
       False not in&lt;br/&gt;
@@ -683,7 +692,7 @@ def read_record(self, writers_schema, readers_schema, decoder):&lt;br/&gt;
     &quot;&quot;&quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
	&lt;li&gt;schema resolution&lt;br/&gt;
     readers_fields_dict = readers_schema.fields_dict&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;read_record = {}&lt;br/&gt;
+    read_record = GenericRecord(readers_schema)&lt;br/&gt;
     for field in writers_schema.fields:&lt;br/&gt;
       readers_field = readers_fields_dict.get(field.name)&lt;br/&gt;
       if readers_field is not None:&lt;br/&gt;
@@ -888,3 +897,23 @@ def write_record(self, writers_schema, datum, encoder):&lt;br/&gt;
     &quot;&quot;&quot;&lt;br/&gt;
     for field in writers_schema.fields:&lt;br/&gt;
       self.write_data(field.type, datum.get(field.name), encoder)&lt;br/&gt;
+&lt;br/&gt;
+class GenericRecord(dict):&lt;br/&gt;
+&lt;br/&gt;
+    def _&lt;em&gt;init&lt;/em&gt;_(self, record_schema, lst = []):&lt;br/&gt;
+        if (record_schema is None or&lt;br/&gt;
+                not isinstance(record_schema, schema.Schema)):&lt;br/&gt;
+            raise RecordInitializationException(&lt;br/&gt;
+                    &quot;Cannot initialize a record with schema: 
{sc}
&lt;p&gt;&quot;.format(sc = record_schema))&lt;br/&gt;
+        dict._&lt;em&gt;init&lt;/em&gt;_(self, lst)&lt;br/&gt;
+        self.schema = record_schema&lt;br/&gt;
+&lt;br/&gt;
+    def _&lt;em&gt;eq&lt;/em&gt;_(self, other):&lt;br/&gt;
+        if other is None or not isinstance(other, dict):&lt;br/&gt;
+            return False&lt;br/&gt;
+        if not dict._&lt;em&gt;eq&lt;/em&gt;_(self, other):&lt;br/&gt;
+            return False&lt;br/&gt;
+        if isinstance(other, GenericRecord):&lt;br/&gt;
+            return self.schema == other.schema&lt;br/&gt;
+        else:&lt;br/&gt;
+            return True&lt;br/&gt;
diff --git a/lang/py/test/test_io.py b/lang/py/test/test_io.py&lt;br/&gt;
index 1e79d3e89..d6e341a47 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/lang/py/test/test_io.py&lt;br/&gt;
+++ b/lang/py/test/test_io.py&lt;br/&gt;
@@ -39,6 +39,8 @@&lt;br/&gt;
   (&apos;
{&quot;type&quot;: &quot;array&quot;, &quot;items&quot;: &quot;long&quot;}
&lt;p&gt;&apos;, &lt;span class=&quot;error&quot;&gt;&amp;#91;1, 3, 2&amp;#93;&lt;/span&gt;),&lt;br/&gt;
   (&apos;&lt;/p&gt;
{&quot;type&quot;: &quot;map&quot;, &quot;values&quot;: &quot;long&quot;}
&lt;p&gt;&apos;, &lt;/p&gt;
{&apos;a&apos;: 1, &apos;b&apos;: 3, &apos;c&apos;: 2}
&lt;p&gt;),&lt;br/&gt;
   (&apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;string&amp;quot;, &amp;quot;null&amp;quot;, &amp;quot;long&amp;quot;&amp;#93;&lt;/span&gt;&apos;, None),&lt;br/&gt;
+  (&apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;double&amp;quot;, &amp;quot;boolean&amp;quot;&amp;#93;&lt;/span&gt;&apos;, True),&lt;br/&gt;
+  (&apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;boolean&amp;quot;, &amp;quot;double&amp;quot;&amp;#93;&lt;/span&gt;&apos;, True),&lt;br/&gt;
   (&quot;&quot;&quot;\&lt;br/&gt;
    {&quot;type&quot;: &quot;record&quot;,&lt;br/&gt;
     &quot;name&quot;: &quot;Test&quot;,&lt;br/&gt;
@@ -190,6 +192,13 @@ def test_validate(self):&lt;br/&gt;
   def test_round_trip(self):&lt;br/&gt;
     print_test_name(&apos;TEST ROUND TRIP&apos;)&lt;br/&gt;
     correct = 0&lt;br/&gt;
+    def are_equal(datum, round_trip_datum):&lt;br/&gt;
+        if datum != round_trip_datum:&lt;br/&gt;
+            return False&lt;br/&gt;
+        if type(datum) == bool:&lt;br/&gt;
+            return type(round_trip_datum) == bool&lt;br/&gt;
+        else:&lt;br/&gt;
+            return True&lt;br/&gt;
     for example_schema, datum in SCHEMAS_TO_VALIDATE:&lt;br/&gt;
       print &apos;Schema: %s&apos; % example_schema&lt;br/&gt;
       print &apos;Datum: %s&apos; % datum&lt;br/&gt;
@@ -199,7 +208,7 @@ def test_round_trip(self):&lt;br/&gt;
       round_trip_datum = read_datum(writer, writers_schema)&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       print &apos;Round Trip Datum: %s&apos; % round_trip_datum&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if datum == round_trip_datum: correct += 1&lt;br/&gt;
+      if are_equal(datum, round_trip_datum): correct += 1&lt;br/&gt;
     self.assertEquals(correct, len(SCHEMAS_TO_VALIDATE))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   #&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16717714" author="jira-bot" created="Tue, 11 Dec 2018 18:28:10 +0000"  >&lt;p&gt;Commit beef86697a0dbd09d4d99a735f8a5afe37e5d976 in avro&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shiraeeshi&quot; class=&quot;user-hover&quot; rel=&quot;shiraeeshi&quot;&gt;shiraeeshi&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=beef866&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=beef866&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1777&quot; title=&quot;Select best matching record when writing a union in python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1777&quot;&gt;AVRO-1777&lt;/a&gt;: Select best matching record when writing a union in python (#95)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;make numeric schemas not valid for boolean datums&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix formatting&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix int and long schemas&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix brackets&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix brackets&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;add GenericRecord type&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16719938" author="jira-bot" created="Thu, 13 Dec 2018 08:56:58 +0000"  >&lt;p&gt;Commit beef86697a0dbd09d4d99a735f8a5afe37e5d976 in avro&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-2238&quot; title=&quot;Update Docker image from java to openjdk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-2238&quot;&gt;AVRO-2238&lt;/a&gt; from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shiraeeshi&quot; class=&quot;user-hover&quot; rel=&quot;shiraeeshi&quot;&gt;shiraeeshi&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=beef866&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=beef866&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1777&quot; title=&quot;Select best matching record when writing a union in python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1777&quot;&gt;AVRO-1777&lt;/a&gt;: Select best matching record when writing a union in python (#95)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;make numeric schemas not valid for boolean datums&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix formatting&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix int and long schemas&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix brackets&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix brackets&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;add GenericRecord type&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16727508" author="thiru_mg" created="Sat, 22 Dec 2018 17:54:52 +0000"  >&lt;p&gt;Reopening the issue because the fix breaks interop tests.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here is a &lt;a href=&quot;https://github.com/apache/avro/pull/413&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;pull request&lt;/a&gt; that reverts the change. We can merge it back once the interop problem is fixed.&lt;/p&gt;</comment>
                            <comment id="16727829" author="jira-bot" created="Sun, 23 Dec 2018 08:05:53 +0000"  >&lt;p&gt;Commit 52a53e9520d7657bd237cae3e92e3ed015c71811 in avro&apos;s branch refs/heads/master from Thiruvalluvan M. G.&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=avro.git;h=52a53e9&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gitbox.apache.org/repos/asf?p=avro.git;h=52a53e9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Reverting the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1777&quot; title=&quot;Select best matching record when writing a union in python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1777&quot;&gt;AVRO-1777&lt;/a&gt; which failed in Travis (#413)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 19 May 2016 14:58:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qt0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[AVRO-1778] IPC/RPC for JavaScript</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1778</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;This patch adds protocols to the JavaScript implementation.&lt;/p&gt;

&lt;p&gt;The API was designed to:&lt;/p&gt;

&lt;p&gt;+ Be simple and idiomatic. The `Protocol` class added here is heavily inspired by node.js&apos; core `EventEmitter` to keep things as familiar as possible &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. Getting a client and server working is straightforward and requires very few lines of code &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;+ Support arbitrary transports, both stateful and stateless. Built-in node.js streams are supported out of the box (e.g. TCP/UNIX sockets, or even stdin/stdout). Exchanging messages over a custom transport requires implementing a single simple function (see &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; for an example).&lt;/p&gt;

&lt;p&gt;+ Work both server-side and in the browser!&lt;/p&gt;

&lt;p&gt;Ps: I also tested against both the Java and Python implementations over HTTP and communication worked. &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/mtth/avsc/wiki/API#ipc--rpc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/mtth/avsc/wiki/API#ipc--rpc&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/mtth/avsc/wiki/Advanced-usage#remote-procedure-calls&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/mtth/avsc/wiki/Advanced-usage#remote-procedure-calls&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/mtth/avsc/wiki/Advanced-usage#transient-streams&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/mtth/avsc/wiki/Advanced-usage#transient-streams&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12929045">AVRO-1778</key>
            <summary>IPC/RPC for JavaScript</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdblue">Ryan Blue</assignee>
                                    <reporter username="mtth">Matthieu Monsch</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Jan 2016 22:10:49 +0000</created>
                <updated>Tue, 19 Jul 2016 09:00:08 +0000</updated>
                            <resolved>Sat, 6 Feb 2016 18:57:00 +0000</resolved>
                                                                    <component>javascript</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15092852" author="rdblue" created="Mon, 11 Jan 2016 22:46:46 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mtth&quot; class=&quot;user-hover&quot; rel=&quot;mtth&quot;&gt;Matthieu Monsch&lt;/a&gt;! I&apos;ll have a look sometime this week. I&apos;m just back from PTO so I have a few things in the pipeline ahead of it.&lt;/p&gt;</comment>
                            <comment id="15107974" author="rdblue" created="Wed, 20 Jan 2016 04:22:43 +0000"  >&lt;p&gt;Sorry I&apos;m a bit late with this review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mtth&quot; class=&quot;user-hover&quot; rel=&quot;mtth&quot;&gt;Matthieu Monsch&lt;/a&gt;. I&apos;m trying to get a 1.8.0 release out ahead of it. Thanks for your patience!&lt;/p&gt;</comment>
                            <comment id="15110896" author="mtth" created="Thu, 21 Jan 2016 16:54:20 +0000"  >&lt;p&gt;No problem &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdblue&quot; class=&quot;user-hover&quot; rel=&quot;rdblue&quot;&gt;Ryan Blue&lt;/a&gt;, thanks for the heads up.&lt;/p&gt;</comment>
                            <comment id="15128691" author="rdblue" created="Tue, 2 Feb 2016 18:08:44 +0000"  >&lt;p&gt;Having a look now.&lt;/p&gt;</comment>
                            <comment id="15129054" author="rdblue" created="Tue, 2 Feb 2016 21:21:55 +0000"  >&lt;p&gt;This looks mostly good to me. Tests pass and coverage is at 100% (nice!). I have a couple of comments, which I&apos;ve posted on my branch here: &lt;a href=&quot;https://github.com/rdblue/avro/commit/aa64961b&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/rdblue/avro/commit/aa64961b&lt;/a&gt;. Nothing major since all of the license stuff looks good.&lt;/p&gt;</comment>
                            <comment id="15132969" author="rdblue" created="Thu, 4 Feb 2016 20:29:59 +0000"  >&lt;p&gt;+1. Thanks for the quick replies to my questions, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mtth&quot; class=&quot;user-hover&quot; rel=&quot;mtth&quot;&gt;Matthieu Monsch&lt;/a&gt;. Since you&apos;re a committer now, can you commit the patch?&lt;/p&gt;</comment>
                            <comment id="15133065" author="rdblue" created="Thu, 4 Feb 2016 21:26:27 +0000"  >&lt;p&gt;So I posted that and then started the switch to git. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; The repo is currently read-only for the move and then we&apos;ll have to push to the new one. Should be good to go once &lt;a href=&quot;https://issues.apache.org/jira/browse/INFRA-11205&quot; title=&quot;Please migrate Avro project from SVN to git&quot; class=&quot;issue-link&quot; data-issue-key=&quot;INFRA-11205&quot;&gt;&lt;del&gt;INFRA-11205&lt;/del&gt;&lt;/a&gt; is done.&lt;/p&gt;</comment>
                            <comment id="15133732" author="mtth" created="Fri, 5 Feb 2016 06:09:02 +0000"  >&lt;p&gt;Thanks Ryan. Will do. Awesome for the move to git!&lt;/p&gt;</comment>
                            <comment id="15135941" author="jira-bot" created="Sat, 6 Feb 2016 18:52:35 +0000"  >&lt;p&gt;Commit 9101a42badd32f0540caa28e27ca053a36e936e3 in avro&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mtth&quot; class=&quot;user-hover&quot; rel=&quot;mtth&quot;&gt;Matthieu Monsch&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=9101a42&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=avro.git;h=9101a42&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1778&quot; title=&quot;IPC/RPC for JavaScript&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1778&quot;&gt;&lt;del&gt;AVRO-1778&lt;/del&gt;&lt;/a&gt;. JavaScript: Add IPC/RPC support.&lt;/p&gt;

&lt;p&gt;This commit adds protocols to the JavaScript implementation.&lt;/p&gt;

&lt;p&gt;The API was designed to:&lt;/p&gt;

&lt;p&gt;+ Be simple and idiomatic. The `Protocol` class added here is heavily&lt;br/&gt;
  inspired by node.js&apos; core `EventEmitter` to keep things as familiar as&lt;br/&gt;
  possible. Getting a client and server working is straightforward&lt;br/&gt;
  and requires very few lines of code.&lt;br/&gt;
+ Support arbitrary transports, both stateful and stateless. Built-in&lt;br/&gt;
  node.js streams are supported out of the box (e.g. TCP/UNIX sockets,&lt;br/&gt;
  or even stdin/stdout). Exchanging messages over a custom transport&lt;br/&gt;
  requires implementing a single simple function.&lt;br/&gt;
+ Work both server-side and in the browser!&lt;/p&gt;</comment>
                            <comment id="15135945" author="mtth" created="Sat, 6 Feb 2016 18:56:55 +0000"  >&lt;p&gt;Thanks again for all the help &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdblue&quot; class=&quot;user-hover&quot; rel=&quot;rdblue&quot;&gt;Ryan Blue&lt;/a&gt;! I renamed `utils.getFingerprint` to `utils.getHash` (and fixed the documentation typos) and just committed the patch.&lt;/p&gt;</comment>
                            <comment id="15356536" author="mtth" created="Thu, 30 Jun 2016 05:18:01 +0000"  >&lt;p&gt;Since you&apos;re using wrapped unions, the `nameSpace` field should be `&lt;/p&gt;
{string: &apos;tz_ns&apos;}
&lt;p&gt;`. More generally, wrapped union values should be an object with the branch&apos;s name as single key and the corresponding value (similar to their JSON encoding).&lt;/p&gt;</comment>
                            <comment id="15356544" author="chunfy.tseng" created="Thu, 30 Jun 2016 05:31:58 +0000"  >
&lt;p&gt;When I do not use &quot;wrapUnions&quot; complains, the message is &quot;Error: ambiguous unwrapped the union: [&quot; null,&quot; {&quot; name &quot;:&quot;. Com. HBS avro. Dto. RowKeyFilter &quot;..., when I use &quot;wrapUnions&quot;, not an Error, but I don&apos;t know exactly how to use?&lt;/p&gt;

&lt;p&gt;I hope you can for me how I can modify the &quot;protocol&quot; specific in js, thank you very much.&lt;/p&gt;</comment>
                            <comment id="15356573" author="chunfy.tseng" created="Thu, 30 Jun 2016 05:53:49 +0000"  >&lt;p&gt;Could you tell me how to write client js what?&lt;br/&gt;
I didn&apos;t understand &quot;wrapUnions&quot; detailed how to use&lt;/p&gt;</comment>
                            <comment id="15357202" author="mtth" created="Thu, 30 Jun 2016 14:53:46 +0000"  >&lt;p&gt;Your example is somewhat hard to read because of formatting but it looks like you are instantiating the client properly. The problem is that you are emitting incorrect data (confirmed by the error message: invalid request: invalid &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;null&amp;quot;, &amp;quot;string&amp;quot;&amp;#93;&lt;/span&gt;: &quot;tz_ns&quot;).&lt;/p&gt;

&lt;p&gt;As we discussed earlier, you have to use wrapped unions (since your protocol contains a union with multiple records - the filters - see again here for motivation on this: &lt;a href=&quot;https://github.com/mtth/avsc/wiki/API#class-unwrappeduniontypeattrs-opts&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/mtth/avsc/wiki/API#class-unwrappeduniontypeattrs-opts&lt;/a&gt;). The data you are emitting for each union should therefore also be wrapped (similar to how their JSON encoding is defined here: &lt;a href=&quot;https://avro.apache.org/docs/1.8.0/spec.html#json_encoding&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://avro.apache.org/docs/1.8.0/spec.html#json_encoding&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;More concretely, using your example for a query message, the following records are valid:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;table&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;qBeoBPxHeHsADmfB&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;nameSpace&quot;&lt;/span&gt;: {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;kIlafv&quot;&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;// Note how &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; string is &lt;span class=&quot;code-quote&quot;&gt;&quot;wrapped&quot;&lt;/span&gt;.
&lt;/span&gt;  },
  &lt;span class=&quot;code-quote&quot;&gt;&quot;queryORSaveArgses&quot;&lt;/span&gt;: [
    {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;rowKey&quot;&lt;/span&gt;: &quot;&quot;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;families&quot;&lt;/span&gt;: []
    }
  ],
  &lt;span class=&quot;code-quote&quot;&gt;&quot;filterType&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;table&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;TKbOlkvExOjCTdvKUqgjhTSnvrwM&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;nameSpace&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-comment&quot;&gt;// nulls aren&apos;t wrapped (see how JSON encoding is defined)
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;queryORSaveArgses&quot;&lt;/span&gt;: [],
  &lt;span class=&quot;code-quote&quot;&gt;&quot;filterType&quot;&lt;/span&gt;: {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;com.hbs.avro.dto.FilterType&quot;&lt;/span&gt;: { &lt;span class=&quot;code-comment&quot;&gt;// Likewise, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; value is wrapped.
&lt;/span&gt;      &lt;span class=&quot;code-quote&quot;&gt;&quot;rowFilterType&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;com.hbs.avro.dto.FirstKeyOnlyFilter&quot;&lt;/span&gt;: {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;firstKeyOnlyFilter&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
        }
      },
      &lt;span class=&quot;code-quote&quot;&gt;&quot;familyFilterType&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;com.hbs.avro.dto.FamilyFilter&quot;&lt;/span&gt;: {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;byteArrayComparable&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;RegexStringComparator&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;compareOp&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;LESS_OR_EQUAL&quot;&lt;/span&gt;
        }
      },
      &lt;span class=&quot;code-quote&quot;&gt;&quot;columnFilterType&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;com.hbs.avro.dto.ColumnRangeFilter&quot;&lt;/span&gt;: {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;minColumn&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;bBkcoCJvCkNiSWq&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;minColumnInclusive&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;maxColumn&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;wvOW&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;maxColumnInclusive&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
        }
      },
      &lt;span class=&quot;code-quote&quot;&gt;&quot;columnValueFilterType&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;pageFilterType&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you pass either of these records to your emit call, the request should go through. Hopefully this makes sense; if you have any further questions, please open a new ticket rather than overload this one.&lt;/p&gt;</comment>
                            <comment id="15383827" author="chunfy.tseng" created="Tue, 19 Jul 2016 09:00:08 +0000"  >&lt;p&gt;If I use AVRO PRC, can I use httpclient request?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12781474" name="AVRO-1778.patch" size="101636" author="mtth" created="Sun, 10 Jan 2016 22:13:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jan 2016 22:46:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r3xb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1779] Avro docs convenience artifact missing LICENSE/NOTICE</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1779</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;for releases we generate a convenience artifact with our docs. at present, this tarball is missing our needed LICENSE/NOTICE files&lt;/p&gt;</description>
                <environment></environment>
        <key id="12929213">AVRO-1779</key>
            <summary>Avro docs convenience artifact missing LICENSE/NOTICE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdblue">Ryan Blue</assignee>
                                    <reporter username="busbey">Sean Busbey</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2016 15:58:09 +0000</created>
                <updated>Mon, 1 Feb 2016 14:56:07 +0000</updated>
                            <resolved>Mon, 18 Jan 2016 10:57:06 +0000</resolved>
                                    <version>1.8.0</version>
                                    <fixVersion>1.8.0</fixVersion>
                                    <component>doc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15092946" author="rdblue" created="Mon, 11 Jan 2016 23:39:18 +0000"  >&lt;p&gt;I&apos;m attaching a patch that fixes the build script to include LICENSE and NOTICE from &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1771&quot; title=&quot;Add LICENSE and NOTICE to avro-doc artifact&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1771&quot;&gt;&lt;del&gt;AVRO-1771&lt;/del&gt;&lt;/a&gt;. The problem was that the tar command was run from build/ but the copy used the same path. That caused the commands to copy the files to avro-doc-VERS instead of into build/avro-doc-VERS/. I ran dist and verified that the files are included, which I evidently failed to do for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1771&quot; title=&quot;Add LICENSE and NOTICE to avro-doc artifact&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1771&quot;&gt;&lt;del&gt;AVRO-1771&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The attached diff also fixes a problem I ran into while testing this. The C++ build would halt dist because the &quot;doc&quot; folder was missing. Evidently, the default output directory for my version of doxygen is . but for others it must be doc. Since the output directory is expected to be doc, I added it to the Doxyfile. I confirmed that this produces the same documentation structure as the last RC in my local copy.&lt;/p&gt;</comment>
                            <comment id="15093746" author="jira-bot" created="Tue, 12 Jan 2016 11:10:15 +0000"  >&lt;p&gt;Commit 1724203 from tomwhite@apache.org in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724203&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1724203&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1779&quot; title=&quot;Avro docs convenience artifact missing LICENSE/NOTICE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1779&quot;&gt;&lt;del&gt;AVRO-1779&lt;/del&gt;&lt;/a&gt;. Avro docs convenience artifact missing LICENSE/NOTICE. Contributed by blue.&lt;/p&gt;</comment>
                            <comment id="15093748" author="jira-bot" created="Tue, 12 Jan 2016 11:12:28 +0000"  >&lt;p&gt;Commit 1724205 from tomwhite@apache.org in branch &apos;avro/branches/branch-1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724205&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1724205&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1779&quot; title=&quot;Avro docs convenience artifact missing LICENSE/NOTICE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1779&quot;&gt;&lt;del&gt;AVRO-1779&lt;/del&gt;&lt;/a&gt;. Avro docs convenience artifact missing LICENSE/NOTICE. Contributed by blue.&lt;/p&gt;</comment>
                            <comment id="15093770" author="hudson" created="Tue, 12 Jan 2016 11:35:57 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #566 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/566/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/566/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1779&quot; title=&quot;Avro docs convenience artifact missing LICENSE/NOTICE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1779&quot;&gt;&lt;del&gt;AVRO-1779&lt;/del&gt;&lt;/a&gt;. Avro docs convenience artifact missing LICENSE/NOTICE. Contributed by blue. (tomwhite: rev 1724203)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;trunk/build.sh&lt;/li&gt;
	&lt;li&gt;trunk/lang/c++/Doxyfile&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15093774" author="tomwhite" created="Tue, 12 Jan 2016 11:42:20 +0000"  >&lt;p&gt;+1. I ran a docker build and confirmed that the doc artifact contained LICENSE and NOTICE.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12923495">AVRO-1771</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12781678" name="AVRO-1779.1.diff" size="822" author="rdblue" created="Mon, 11 Jan 2016 23:34:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jan 2016 23:39:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r4yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1780] Avro tools jar fails with NPE</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1780</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;following our license/notice updates, teh avro-tools jar fails with a NPE because it wants to print out a NOTICE.txt in the root of the jar.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;busbey$ java -jar avro-tools-1.8.0.jar
Version 1.8.0 of Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException
	at org.apache.avro.tool.Main.printStream(Main.java:105)
	at org.apache.avro.tool.Main.run(Main.java:92)
	at org.apache.avro.tool.Main.main(Main.java:74)
busbey$ java -jar avro-tools-1.8.0.jar --help
Version 1.8.0 of Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException
	at org.apache.avro.tool.Main.printStream(Main.java:105)
	at org.apache.avro.tool.Main.run(Main.java:92)
	at org.apache.avro.tool.Main.main(Main.java:74)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should probably not print the entire NOTICE unless a cli arg is given, since it is much bigger now.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12929216">AVRO-1780</key>
            <summary>Avro tools jar fails with NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tomwhite">Tom White</assignee>
                                    <reporter username="busbey">Sean Busbey</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2016 15:59:43 +0000</created>
                <updated>Mon, 1 Feb 2016 14:56:07 +0000</updated>
                            <resolved>Tue, 12 Jan 2016 17:09:18 +0000</resolved>
                                    <version>1.8.0</version>
                                    <fixVersion>1.8.0</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15093791" author="tomwhite" created="Tue, 12 Jan 2016 11:54:26 +0000"  >&lt;p&gt;Here&apos;s a fix that prints the top part of the notice file.&lt;/p&gt;</comment>
                            <comment id="15094307" author="jira-bot" created="Tue, 12 Jan 2016 17:08:00 +0000"  >&lt;p&gt;Commit 1724287 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blue%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;blue@cloudera.com&quot;&gt;Ryan Blue&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724287&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1724287&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1780&quot; title=&quot;Avro tools jar fails with NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1780&quot;&gt;&lt;del&gt;AVRO-1780&lt;/del&gt;&lt;/a&gt;: Java: Fix NPE in tools. Contributed by Tom White.&lt;/p&gt;

&lt;p&gt;Changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1728&quot; title=&quot;Update LICENSE and NOTICE files included in Java binaries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1728&quot;&gt;&lt;del&gt;AVRO-1728&lt;/del&gt;&lt;/a&gt; moved NOTICE, which was used to create the&lt;br/&gt;
no-argument output for Java&apos;s avro-tools. Using the new location fixed&lt;br/&gt;
the NPE and this also includes an update to show just the top of NOTICE&lt;br/&gt;
since it is now much longer.&lt;/p&gt;</comment>
                            <comment id="15094309" author="rdblue" created="Tue, 12 Jan 2016 17:09:05 +0000"  >&lt;p&gt;Thanks for fixing this, Tom! I committed your patch.&lt;/p&gt;</comment>
                            <comment id="15094358" author="hudson" created="Tue, 12 Jan 2016 17:36:08 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #567 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/567/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/567/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1780&quot; title=&quot;Avro tools jar fails with NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1780&quot;&gt;&lt;del&gt;AVRO-1780&lt;/del&gt;&lt;/a&gt;: Java: Fix NPE in tools. Contributed by Tom White.&lt;/p&gt;

&lt;p&gt;Changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1728&quot; title=&quot;Update LICENSE and NOTICE files included in Java binaries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1728&quot;&gt;&lt;del&gt;AVRO-1728&lt;/del&gt;&lt;/a&gt; moved NOTICE, which was used to create the&lt;br/&gt;
no-argument output for Java&apos;s avro-tools. Using the new location fixed&lt;br/&gt;
the NPE and this also includes an update to show just the top of NOTICE&lt;br/&gt;
since it is now much longer. (blue: rev 1724287)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/lang/java/tools/src/main/java/org/apache/avro/tool/Main.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15096018" author="jira-bot" created="Wed, 13 Jan 2016 11:01:05 +0000"  >&lt;p&gt;Commit 1724395 from tomwhite@apache.org in branch &apos;avro/branches/branch-1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1724395&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1780&quot; title=&quot;Avro tools jar fails with NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1780&quot;&gt;&lt;del&gt;AVRO-1780&lt;/del&gt;&lt;/a&gt;: Java: Fix NPE in tools. Contributed by Tom White.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12781813" name="AVRO-1780.patch" size="1351" author="tomwhite" created="Tue, 12 Jan 2016 11:54:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Jan 2016 11:54:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r4zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1781] Schema.parse is not thread safe</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1781</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;Post &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1497&quot; title=&quot;Add LogicalType support to Java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1497&quot;&gt;&lt;del&gt;AVRO-1497&lt;/del&gt;&lt;/a&gt;, Schema.parse calls &lt;tt&gt;LogicalTypes.fromSchemaIgnoreInvalid&lt;/tt&gt; on any schema that is expressed as a JSON object (anything except bare primitives).&lt;/p&gt;

&lt;p&gt;That static method relies on a static cache based on WeakIdentityHashMap (WIHM).&lt;/p&gt;

&lt;p&gt;WIHM clearly states that it isn&apos;t threadsafe &lt;a href=&quot;https://github.com/apache/avro/blob/branch-1.8/lang/java/avro/src/main/java/org/apache/avro/util/WeakIdentityHashMap.java#L42&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;ref&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; * 
 * Note that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; implementation is not &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;.
 * &amp;lt;/b&amp;gt;
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;WeakIdentityHashMap&amp;lt;K, V&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Map&amp;lt;K, V&amp;gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All of the Schema.Parser instances use that same static Schema.parse method.&lt;/p&gt;

&lt;p&gt;The end result is that as-is it&apos;s only safe to have a single thread parsing schemas in a given JVM.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12929229">AVRO-1781</key>
            <summary>Schema.parse is not thread safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdblue">Ryan Blue</assignee>
                                    <reporter username="busbey">Sean Busbey</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2016 16:49:44 +0000</created>
                <updated>Mon, 1 Feb 2016 14:55:54 +0000</updated>
                            <resolved>Wed, 20 Jan 2016 04:20:02 +0000</resolved>
                                    <version>1.8.0</version>
                                    <fixVersion>1.8.0</fixVersion>
                                    <component>java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="15092283" author="busbey" created="Mon, 11 Jan 2016 17:07:25 +0000"  >&lt;p&gt;2 main approaches I see:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;externalize the cache and store one per Schema.Parser instance, so you get caching if you reuse and the app can decide on parallelism trade-offs&lt;/li&gt;
	&lt;li&gt;switch to using a R/W lock based cache so that it is threadsafe.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15092454" author="rdblue" created="Mon, 11 Jan 2016 18:45:16 +0000"  >&lt;p&gt;I think this is the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1773&quot; title=&quot;Infinite loop caused by race condition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1773&quot;&gt;&lt;del&gt;AVRO-1773&lt;/del&gt;&lt;/a&gt;. Another option is to use a better weak hash map from guava that supports concurrency. That&apos;s the solution recommended for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1760&quot; title=&quot;Thread scalability problem with the use of SynchronizedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1760&quot;&gt;&lt;del&gt;AVRO-1760&lt;/del&gt;&lt;/a&gt; as well.&lt;/p&gt;

&lt;p&gt;I have reservations about adding a dependency on Guava since the suggestion is currently to shade it, but it would avoid many issues like this one.&lt;/p&gt;</comment>
                            <comment id="15092860" author="martinkl" created="Mon, 11 Jan 2016 22:49:06 +0000"  >&lt;p&gt;I&apos;d also be wary of adding a Guava dependency (unless we shade it) &#8212; had too much pain with classpath conflicts in the past.&lt;/p&gt;</comment>
                            <comment id="15093022" author="rdblue" created="Tue, 12 Jan 2016 00:49:16 +0000"  >&lt;p&gt;I don&apos;t like the idea of shading much either. Guava 19.0 is 2.2MB. I&apos;m not a fan of adding that much to all of the artifacts and anything that shades Avro downstream.&lt;/p&gt;

&lt;p&gt;One option to get the size down is to use &lt;tt&gt;minimizeJar&lt;/tt&gt; to select just the classes we use, but that applies to everything being shaded. So we have to create a temporary artifact, like avro-guava-dependencies, minimize that and then shade it from the other modules. Using that method, I got the size down to 892k. That makes the base avro jar 1.4MB. I&apos;m attaching a patch that does all this and fixes the thread safety problem to see what you guys think of the minimized jar approach.&lt;/p&gt;</comment>
                            <comment id="15093689" author="tomwhite" created="Tue, 12 Jan 2016 10:25:29 +0000"  >&lt;p&gt;This is probably the most pragmatic approach to take. Do you want to incorporate the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1760&quot; title=&quot;Thread scalability problem with the use of SynchronizedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1760&quot;&gt;&lt;del&gt;AVRO-1760&lt;/del&gt;&lt;/a&gt; at the same time?&lt;/p&gt;

&lt;p&gt;I get a NPE when I run &lt;tt&gt;mvn clean install -DskipTests -e&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ERROR] Failed to execute goal org.apache.avro:avro-maven-plugin:1.9.0-SNAPSHOT:schema (schemas) on project avro-ipc: Execution schemas of goal org.apache.avro:avro-maven-plugin:1.9.0-SNAPSHOT:schema failed. NullPointerException -&amp;gt; [Help 1]
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal org.apache.avro:avro-maven-plugin:1.9.0-SNAPSHOT:schema (schemas) on project avro-ipc: Execution schemas of goal org.apache.avro:avro-maven-plugin:1.9.0-SNAPSHOT:schema failed.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15094503" author="rdblue" created="Tue, 12 Jan 2016 18:58:31 +0000"  >&lt;p&gt;The problem is that Guava&apos;s MapMaker maps don&apos;t allow Null. I&apos;ve updated the patch to use Optional and tests are passing.&lt;/p&gt;

&lt;p&gt;I also ran into trouble with the mapred module because the Guava dependency, despite being shaded, was overriding Hadoop&apos;s guava dependency. I&apos;ve added a ban for all versions of Guava other than 11.0.2 and for avro-guava-dependencies (to make sure it doesn&apos;t leak Guava classes into the classpath). Unfortunately, the only way to avoid hitting the Guava ban is to use version 11.0.2. If I use 19.0 and build/test from the mapred directory it correctly uses 11.0.2, but if I build from the lang/java directory the dependencies are all resolved at once and 19.0 overrides the transitive dependency&apos;s version. Luckily, everything works with 11.0.2 and the jar is even a little smaller.&lt;/p&gt;

&lt;p&gt;I also had to update this to exclude Google&apos;s JSR301 jar, which might be GPL and is banned by avro-tools. I&apos;m attaching a new patch.&lt;/p&gt;</comment>
                            <comment id="15096051" author="tomwhite" created="Wed, 13 Jan 2016 11:39:53 +0000"  >&lt;p&gt;The patch now works for me. Overall I&apos;m +1 on this. Could you add a comment to the line where the Guava version number is defined to document the restrictions on changing it.&lt;/p&gt;</comment>
                            <comment id="15096712" author="jira-bot" created="Wed, 13 Jan 2016 18:14:55 +0000"  >&lt;p&gt;Commit 1724473 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blue%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;blue@cloudera.com&quot;&gt;Ryan Blue&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724473&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1724473&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1781&quot; title=&quot;Schema.parse is not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1781&quot;&gt;&lt;del&gt;AVRO-1781&lt;/del&gt;&lt;/a&gt;: Use Guava for a thread-safe weak identity cache.&lt;/p&gt;

&lt;p&gt;This adds avro-guava-dependencies to minimize just Guava classes that&lt;br/&gt;
are shaded without minimizing classes from other dependencies. This&lt;br/&gt;
filtered artifact is then shaded and relocated in the avro module to&lt;br/&gt;
avoid leaking Guava classes to downstream consumers.&lt;/p&gt;</comment>
                            <comment id="15096719" author="rdblue" created="Wed, 13 Jan 2016 18:18:17 +0000"  >&lt;p&gt;Thanks, Tom! I&apos;ve added the comment and committed this.&lt;/p&gt;</comment>
                            <comment id="15096788" author="hudson" created="Wed, 13 Jan 2016 18:54:27 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #568 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/568/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/568/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1781&quot; title=&quot;Schema.parse is not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1781&quot;&gt;&lt;del&gt;AVRO-1781&lt;/del&gt;&lt;/a&gt;: Use Guava for a thread-safe weak identity cache.&lt;/p&gt;

&lt;p&gt;This adds avro-guava-dependencies to minimize just Guava classes that&lt;br/&gt;
are shaded without minimizing classes from other dependencies. This&lt;br/&gt;
filtered artifact is then shaded and relocated in the avro module to&lt;br/&gt;
avoid leaking Guava classes to downstream consumers. (blue: rev 1724473)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/avro/pom.xml&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/avro/src/main/java/org/apache/avro/LogicalTypes.java&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/avro/src/main/resources&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/avro/src/main/resources/META-INF&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/avro/src/main/resources/META-INF/LICENSE&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/pom.xml&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main/java&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main/java/org&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main/java/org/apache&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main/java/org/apache/avro&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main/java/org/apache/avro/GuavaClasses.java&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main/resources&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main/resources/META-INF&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/guava/src/main/resources/META-INF/LICENSE&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/mapred/pom.xml&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/pom.xml&lt;/li&gt;
	&lt;li&gt;trunk/lang/java/tools/src/main/resources/META-INF/LICENSE&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15098014" author="jira-bot" created="Thu, 14 Jan 2016 11:39:22 +0000"  >&lt;p&gt;Commit 1724591 from tomwhite@apache.org in branch &apos;avro/branches/branch-1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724591&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1724591&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1781&quot; title=&quot;Schema.parse is not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1781&quot;&gt;&lt;del&gt;AVRO-1781&lt;/del&gt;&lt;/a&gt;: Use Guava for a thread-safe weak identity cache.&lt;/p&gt;</comment>
                            <comment id="15107902" author="rdblue" created="Wed, 20 Jan 2016 03:13:39 +0000"  >&lt;p&gt;I&apos;m reopening this because after looking into it more, I don&apos;t think we need the cache at all. It was originally used to avoid parsing the logical type from a Schema&apos;s properties several times, but is now only used by the Schema parse method to do this once. The LogicalType instance is then set on the Schema and is available through Schema#getLogicalType. That&apos;s a much better way to keep track of them.&lt;/p&gt;</comment>
                            <comment id="15107908" author="rdblue" created="Wed, 20 Jan 2016 03:14:17 +0000"  >&lt;p&gt;I&apos;m attaching a patch that remotes the cache entirely since it is no longer needed.&lt;/p&gt;</comment>
                            <comment id="15107915" author="busbey" created="Wed, 20 Jan 2016 03:18:08 +0000"  >&lt;p&gt;is the addendum meant to be applied after reverting the previous patch?&lt;/p&gt;</comment>
                            <comment id="15107916" author="rdblue" created="Wed, 20 Jan 2016 03:21:11 +0000"  >&lt;p&gt;No, the previous patch was still needed since we are moving to guava for other caches. &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1760&quot; title=&quot;Thread scalability problem with the use of SynchronizedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1760&quot;&gt;&lt;del&gt;AVRO-1760&lt;/del&gt;&lt;/a&gt; is based on the other changes in that patch. It just happens that this cache isn&apos;t needed.&lt;/p&gt;</comment>
                            <comment id="15107920" author="busbey" created="Wed, 20 Jan 2016 03:24:22 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.google.common.base.Optional;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.google.common.collect.MapMaker;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Both of these imports are no longer needed.&lt;/p&gt;</comment>
                            <comment id="15107922" author="rdblue" created="Wed, 20 Jan 2016 03:28:36 +0000"  >&lt;p&gt;Removed unused import statements. Sorry about that oversight.&lt;/p&gt;</comment>
                            <comment id="15107950" author="busbey" created="Wed, 20 Jan 2016 04:04:07 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15107965" author="rdblue" created="Wed, 20 Jan 2016 04:18:28 +0000"  >&lt;p&gt;Thanks for having a look, Sean!&lt;/p&gt;</comment>
                            <comment id="15107968" author="jira-bot" created="Wed, 20 Jan 2016 04:19:32 +0000"  >&lt;p&gt;Commit 1725668 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blue%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;blue@cloudera.com&quot;&gt;Ryan Blue&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1725668&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1725668&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1781&quot; title=&quot;Schema.parse is not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1781&quot;&gt;&lt;del&gt;AVRO-1781&lt;/del&gt;&lt;/a&gt; ADDENDUM: Remove LogicalTypes cache.&lt;/p&gt;

&lt;p&gt;This cache maps a Schema to its corresponding LogicalType that has been&lt;br/&gt;
constructed from the Schema&apos;s properties, by object identity. This is no&lt;br/&gt;
longer needed now that the LogicalType is set on the schema instance&lt;br/&gt;
when it is parsed. The cache was necessary when we were trying to avoid&lt;br/&gt;
all changes to the Schema class.&lt;/p&gt;</comment>
                            <comment id="15107993" author="hudson" created="Wed, 20 Jan 2016 04:36:44 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #572 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/572/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/572/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1781&quot; title=&quot;Schema.parse is not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1781&quot;&gt;&lt;del&gt;AVRO-1781&lt;/del&gt;&lt;/a&gt; ADDENDUM: Remove LogicalTypes cache.&lt;/p&gt;

&lt;p&gt;This cache maps a Schema to its corresponding LogicalType that has been&lt;br/&gt;
constructed from the Schema&apos;s properties, by object identity. This is no&lt;br/&gt;
longer needed now that the LogicalType is set on the schema instance&lt;br/&gt;
when it is parsed. The cache was necessary when we were trying to avoid&lt;br/&gt;
all changes to the Schema class. (blue: rev 1725668)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/lang/java/avro/src/main/java/org/apache/avro/LogicalTypes.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15110417" author="martinkl" created="Thu, 21 Jan 2016 10:52:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdblue&quot; class=&quot;user-hover&quot; rel=&quot;rdblue&quot;&gt;Ryan Blue&lt;/a&gt;: Looks like the addendum only got committed to trunk, not to branch-1.8. Was that deliberate?&lt;/p&gt;</comment>
                            <comment id="15110484" author="jira-bot" created="Thu, 21 Jan 2016 12:06:25 +0000"  >&lt;p&gt;Commit 1725916 from tomwhite@apache.org in branch &apos;avro/branches/branch-1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1725916&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1725916&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1781&quot; title=&quot;Schema.parse is not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1781&quot;&gt;&lt;del&gt;AVRO-1781&lt;/del&gt;&lt;/a&gt; ADDENDUM: Remove LogicalTypes cache.&lt;/p&gt;

&lt;p&gt;This cache maps a Schema to its corresponding LogicalType that has been&lt;br/&gt;
constructed from the Schema&apos;s properties, by object identity. This is no&lt;br/&gt;
longer needed now that the LogicalType is set on the schema instance&lt;br/&gt;
when it is parsed. The cache was necessary when we were trying to avoid&lt;br/&gt;
all changes to the Schema class.&lt;/p&gt;</comment>
                            <comment id="15110485" author="tomwhite" created="Thu, 21 Jan 2016 12:07:26 +0000"  >&lt;p&gt;The intent was to put this into 1.8 - I&apos;ve just backported it.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12924093">AVRO-1773</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12915465">AVRO-1760</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12783270" name="AVRO-1781-ADDENDUM.1.patch" size="1830" author="rdblue" created="Wed, 20 Jan 2016 03:14:17 +0000"/>
                            <attachment id="12783271" name="AVRO-1781-ADDENDUM.2.patch" size="1970" author="rdblue" created="Wed, 20 Jan 2016 03:28:36 +0000"/>
                            <attachment id="12781694" name="AVRO-1781.1.patch" size="33828" author="rdblue" created="Tue, 12 Jan 2016 00:55:47 +0000"/>
                            <attachment id="12781887" name="AVRO-1781.2.patch" size="35601" author="rdblue" created="Tue, 12 Jan 2016 18:58:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jan 2016 18:45:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r527:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1782] Test failures in Ruby 2.1/2.2</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1782</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;When running the Avro Ruby implementation&apos;s test suite in Ruby 2.1 or 2.2, I get several test failures. The distinct errors are:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;NameError: uninitialized constant Avro::SchemaNormalization::JSON
    avro/lang/ruby/lib/avro/schema_normalization.rb:28:in `to_parsing_form&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;TestSchemaNormalization#test_shared_dataset:
NameError: uninitialized constant CaseFinder::StringScanner
    /Users/martin/Applications/avro/lang/ruby/test/case_finder.rb:30:in `initialize&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12929290">AVRO-1782</key>
            <summary>Test failures in Ruby 2.1/2.2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="martinkl">Martin Kleppmann</assignee>
                                    <reporter username="martinkl">Martin Kleppmann</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2016 21:33:40 +0000</created>
                <updated>Wed, 12 Apr 2017 03:39:29 +0000</updated>
                            <resolved>Wed, 13 Jan 2016 20:33:33 +0000</resolved>
                                    <version>1.7.7</version>
                                    <fixVersion>1.7.8</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>ruby</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15092722" author="martinkl" created="Mon, 11 Jan 2016 21:36:37 +0000"  >&lt;p&gt;Attached a patch to fix all the test failures:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Explicitly require strscan to get StringScanner (seems like something else implicitly required it in prior versions, so we got away without requiring it ourselves)&lt;/li&gt;
	&lt;li&gt;Change SchemaNormalization to use MultiJson instead of JSON, bringing it in line with Avro::Schema.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15096749" author="rdblue" created="Wed, 13 Jan 2016 18:38:58 +0000"  >&lt;p&gt;+1. I verified that everything still works fine in 2.0.0 and jruby 1.7.6. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martinkl&quot; class=&quot;user-hover&quot; rel=&quot;martinkl&quot;&gt;Martin Kleppmann&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15096937" author="jira-bot" created="Wed, 13 Jan 2016 20:32:46 +0000"  >&lt;p&gt;Commit 1724507 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martinkl&quot; class=&quot;user-hover&quot; rel=&quot;martinkl&quot;&gt;Martin Kleppmann&lt;/a&gt; in branch &apos;avro/branches/branch-1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724507&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1724507&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1782&quot; title=&quot;Test failures in Ruby 2.1/2.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1782&quot;&gt;&lt;del&gt;AVRO-1782&lt;/del&gt;&lt;/a&gt;. Ruby: Fix unit test failures in new versions of Ruby.&lt;/p&gt;</comment>
                            <comment id="15096939" author="jira-bot" created="Wed, 13 Jan 2016 20:33:04 +0000"  >&lt;p&gt;Commit 1724508 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martinkl&quot; class=&quot;user-hover&quot; rel=&quot;martinkl&quot;&gt;Martin Kleppmann&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724508&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1724508&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1782&quot; title=&quot;Test failures in Ruby 2.1/2.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1782&quot;&gt;&lt;del&gt;AVRO-1782&lt;/del&gt;&lt;/a&gt;. Ruby: Fix unit test failures in new versions of Ruby.&lt;/p&gt;</comment>
                            <comment id="15096941" author="martinkl" created="Wed, 13 Jan 2016 20:33:33 +0000"  >&lt;p&gt;Committed to trunk and branch-1.8.&lt;/p&gt;</comment>
                            <comment id="15097053" author="hudson" created="Wed, 13 Jan 2016 21:41:19 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #569 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/569/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/569/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1782&quot; title=&quot;Test failures in Ruby 2.1/2.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1782&quot;&gt;&lt;del&gt;AVRO-1782&lt;/del&gt;&lt;/a&gt;. Ruby: Fix unit test failures in new versions of Ruby. (martinkl: rev 1724508)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;trunk/lang/ruby/lib/avro/schema_normalization.rb&lt;/li&gt;
	&lt;li&gt;trunk/lang/ruby/test/case_finder.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13059756">AVRO-2013</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12781650" name="AVRO-1782.patch" size="858" author="martinkl" created="Mon, 11 Jan 2016 21:36:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Jan 2016 18:38:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r5fr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[AVRO-1783] Gracefully handle strings with wrong character encoding</title>
                <link>https://issues.apache.org/jira/browse/AVRO-1783</link>
                <project id="12310911" key="AVRO">Apache Avro</project>
                    <description>&lt;p&gt;In the &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/avro-dev/201601.mbox/%3CCAGHyZ6K-oe35%2BOYROK6MSwrHxfPHvjmqhJAfRJL2dzexYw6YSw%40mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;vote thread for Avro 1.8.0-rc2&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; noticed that &lt;a href=&quot;https://github.com/phunt/avro-rpc-quickstart&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;phunt&apos;s avro-rpc-quickstart&lt;/a&gt; fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;busbey$ ruby sample_ipc_client.rb avro_user pat Hello_World
Avro::IO::AvroTypeError: The datum
&lt;span class=&quot;code-quote&quot;&gt;&quot;\x89\xA9\xD1\xFF@NUm\xEA\x9A\xFB\xDAx\xF5Zq&quot;&lt;/span&gt;
is not an example of schema
{&lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;fixed&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;MD5&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;namespace&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.avro.ipc&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;size&quot;&lt;/span&gt;:16}
              write_data at
/Users/busbey/.rvm/gems/jruby-1.7.3/gems/avro-1.8.0/lib/avro/io.rb:543
            write_record at
/Users/busbey/.rvm/gems/jruby-1.7.3/gems/avro-1.8.0/lib/avro/io.rb:610
                    each at org/jruby/RubyArray.java:1613
            write_record at
/Users/busbey/.rvm/gems/jruby-1.7.3/gems/avro-1.8.0/lib/avro/io.rb:609
              write_data at
/Users/busbey/.rvm/gems/jruby-1.7.3/gems/avro-1.8.0/lib/avro/io.rb:561
                   write at
/Users/busbey/.rvm/gems/jruby-1.7.3/gems/avro-1.8.0/lib/avro/io.rb:538
 write_handshake_request at
/Users/busbey/.rvm/gems/jruby-1.7.3/gems/avro-1.8.0/lib/avro/ipc.rb:136
                 request at
/Users/busbey/.rvm/gems/jruby-1.7.3/gems/avro-1.8.0/lib/avro/ipc.rb:105
                 request at
/Users/busbey/.rvm/gems/jruby-1.7.3/gems/avro-1.8.0/lib/avro/ipc.rb:117
                  (root) at sample_ipc_client.rb:49
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tried reproducing the error, and it is quite strange. avro-rpc-quickstart works fine for me in Ruby (MRI) 2.2 and 2.1, and in JRuby 1.7.23. However, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; was using JRuby 1.7.3 (as visible from the path names above), and in this particular version of JRuby I was able to reproduce the issue.&lt;/p&gt;

&lt;p&gt;It seems that in some circumstances (but not always, bizarrely), JRuby 1.7.3 returns a UTF-8 encoded string from &lt;tt&gt;Digest::MD5.digest&lt;/tt&gt;, rather than a binary-encoded string. &lt;tt&gt;Schema.validate&lt;/tt&gt; checks that the string is suitable for writing as datum for a &lt;tt&gt;fixed&lt;/tt&gt; type by calling &lt;tt&gt;#size&lt;/tt&gt;. In this case, although the MD5 digest of the schema is a 16-byte string, if you interpret it as a UTF-8 encoded string, it consists of only 13 characters (i.e. some sequences are interpreted as multibyte characters).&lt;/p&gt;

&lt;p&gt;Rather than trying to divine why JRuby is being weird here, I think this is an opportunity to fix Avro&apos;s handling of strings to make it robust against unexpected encodings.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12929306">AVRO-1783</key>
            <summary>Gracefully handle strings with wrong character encoding</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="martinkl">Martin Kleppmann</assignee>
                                    <reporter username="martinkl">Martin Kleppmann</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2016 22:35:30 +0000</created>
                <updated>Mon, 1 Feb 2016 14:55:55 +0000</updated>
                            <resolved>Thu, 21 Jan 2016 15:28:55 +0000</resolved>
                                    <version>1.7.7</version>
                                    <fixVersion>1.8.0</fixVersion>
                                    <component>ruby</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15092834" author="busbey" created="Mon, 11 Jan 2016 22:38:34 +0000"  >&lt;p&gt;good digging! also, I should update my jruby version. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15092841" author="martinkl" created="Mon, 11 Jan 2016 22:40:17 +0000"  >&lt;p&gt;Attached a patch which I think fixes the broken string handling. It uses &lt;tt&gt;String#bytesize&lt;/tt&gt; rather than &lt;tt&gt;String#size&lt;/tt&gt; to get the length of a string in bytes. For Avro datatype &quot;string&quot;, it ensures that the string is converted to UTF-8 if necessary. For Avro datatypes &quot;binary&quot; and &quot;fixed&quot;, it uses the literal byte sequence passed to the encoder, and ignores any encoding.&lt;/p&gt;

&lt;p&gt;Also added test cases that check for all of this. Checked that tests pass in MRI 1.9.3, 2.1, 2.2, JRuby 1.7.3 and 1.7.23.&lt;/p&gt;</comment>
                            <comment id="15095272" author="rdblue" created="Wed, 13 Jan 2016 00:12:23 +0000"  >&lt;p&gt;The patch looks good to me. I attempted to test it, but everything works in jruby 1.7.6 without the patch and with 1.7.3 I get a NoSuchMethodException before I can hit the problem. Can someone that has reproduced the bug verify that the patch fixes it? Then I&apos;ll commit this.&lt;/p&gt;</comment>
                            <comment id="15096020" author="martinkl" created="Wed, 13 Jan 2016 11:02:32 +0000"  >&lt;p&gt;Can you give the full message and stack trace of the NoSuchMethodException please?&lt;/p&gt;

&lt;p&gt;It&apos;s possible you might be running into the bugs in &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1782&quot; title=&quot;Test failures in Ruby 2.1/2.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1782&quot;&gt;&lt;del&gt;AVRO-1782&lt;/del&gt;&lt;/a&gt; (although those were NameError not NoSuchMethodException). I had to apply both the &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1782&quot; title=&quot;Test failures in Ruby 2.1/2.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1782&quot;&gt;&lt;del&gt;AVRO-1782&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1783&quot; title=&quot;Gracefully handle strings with wrong character encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1783&quot;&gt;&lt;del&gt;AVRO-1783&lt;/del&gt;&lt;/a&gt; patches to get the test suite to pass.&lt;/p&gt;</comment>
                            <comment id="15096730" author="rdblue" created="Wed, 13 Jan 2016 18:22:51 +0000"  >&lt;p&gt;I&apos;m attaching a file with the full stack trace that I produced by running &lt;tt&gt;require &apos;avro&apos;&lt;/tt&gt; in irb. The Ruby exception is a LoadError, but the cause is the missing method.&lt;/p&gt;</comment>
                            <comment id="15096744" author="rdblue" created="Wed, 13 Jan 2016 18:35:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martinkl&quot; class=&quot;user-hover&quot; rel=&quot;martinkl&quot;&gt;Martin Kleppmann&lt;/a&gt;, don&apos;t worry about the trace I just posted. I just tried to verify &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1782&quot; title=&quot;Test failures in Ruby 2.1/2.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1782&quot;&gt;&lt;del&gt;AVRO-1782&lt;/del&gt;&lt;/a&gt; with my jruby 1.7.3 install and I can&apos;t even run bundle install. Looks like either RVM didn&apos;t install it right or something else is messed up with my OpenSSL.&lt;/p&gt;</comment>
                            <comment id="15096947" author="martinkl" created="Wed, 13 Jan 2016 20:39:00 +0000"  >&lt;p&gt;Yeah I can&apos;t make much sense of that stack trace. Looks like some problem with the installation, unrelated to Avro. Please let me know when you&apos;ve had a chance to test the patch.&lt;/p&gt;</comment>
                            <comment id="15107948" author="busbey" created="Wed, 20 Jan 2016 04:02:19 +0000"  >&lt;p&gt;hurm. I tried using this on my jruby 1.7.3 install and got a (different) error&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;busbey$ ruby ./sample_ipc_client.rb avro_user pat Hello_World
Errno::EPIPE: Broken pipe - Broken pipe
                 write at org/jruby/RubyIO.java:1399
          write_buffer at /Users/busbey/.rvm/gems/jruby-1.7.3@AVRO-1783/gems/avro-1.9.0.pre1/lib/avro/ipc.rb:433
  write_framed_message at /Users/busbey/.rvm/gems/jruby-1.7.3@AVRO-1783/gems/avro-1.9.0.pre1/lib/avro/ipc.rb:421
            transceive at /Users/busbey/.rvm/gems/jruby-1.7.3@AVRO-1783/gems/avro-1.9.0.pre1/lib/avro/ipc.rb:389
               request at /Users/busbey/.rvm/gems/jruby-1.7.3@AVRO-1783/gems/avro-1.9.0.pre1/lib/avro/ipc.rb:110
               request at /Users/busbey/.rvm/gems/jruby-1.7.3@AVRO-1783/gems/avro-1.9.0.pre1/lib/avro/ipc.rb:117
                (root) at ./sample_ipc_client.rb:49
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15110568" author="martinkl" created="Thu, 21 Jan 2016 13:24:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt;: I reproduced your issue on JRuby 1.7.3. Looks like another case of wrong character encoding (using UTF-8 strings where binary strings should be used), this time in the IPC module. This is not a new bug &#8212; it looks like it&apos;s been in the code as long as it has existed &#8212; but we might as well fix it.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a v2 patch that also forces all the buffers in the IPC module to be binary. This patch makes phunt/avro-rpc-quickstart work in all versions of Ruby that I tested (jruby-1.7.3, jruby-1.7.23, ruby-1.9.3-p484, ruby-2.1.4, ruby-2.2.3). The unit tests also still pass in all those versions.&lt;/p&gt;

&lt;p&gt;Note the new patch uses String#force_encoding, which was introduced in Ruby 1.9, so this patch is not trying to be compatible with Ruby 1.8.7. We could make it compatible with 1.8.7, at the cost of uglier code, but assuming we&apos;re dropping support for 1.8.7 anyway (&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1785&quot; title=&quot;Ruby: schema_normalization.rb is incompatible with Ruby 1.8.7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1785&quot;&gt;&lt;del&gt;AVRO-1785&lt;/del&gt;&lt;/a&gt;), I think we can keep it as-is.&lt;/p&gt;</comment>
                            <comment id="15110745" author="busbey" created="Thu, 21 Jan 2016 15:20:26 +0000"  >&lt;p&gt;that sounds reasonable.&lt;/p&gt;

&lt;p&gt;+1 confirmed locally that things work.&lt;/p&gt;</comment>
                            <comment id="15110768" author="jira-bot" created="Thu, 21 Jan 2016 15:27:57 +0000"  >&lt;p&gt;Commit 1725987 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martinkl&quot; class=&quot;user-hover&quot; rel=&quot;martinkl&quot;&gt;Martin Kleppmann&lt;/a&gt; in branch &apos;avro/branches/branch-1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1725987&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1725987&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1783&quot; title=&quot;Gracefully handle strings with wrong character encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1783&quot;&gt;&lt;del&gt;AVRO-1783&lt;/del&gt;&lt;/a&gt;. Ruby: Ensure correct binary encoding for byte strings.&lt;/p&gt;</comment>
                            <comment id="15110769" author="jira-bot" created="Thu, 21 Jan 2016 15:28:07 +0000"  >&lt;p&gt;Commit 1725988 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martinkl&quot; class=&quot;user-hover&quot; rel=&quot;martinkl&quot;&gt;Martin Kleppmann&lt;/a&gt; in branch &apos;avro/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1725988&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1725988&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1783&quot; title=&quot;Gracefully handle strings with wrong character encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1783&quot;&gt;&lt;del&gt;AVRO-1783&lt;/del&gt;&lt;/a&gt;. Ruby: Ensure correct binary encoding for byte strings.&lt;/p&gt;</comment>
                            <comment id="15110773" author="martinkl" created="Thu, 21 Jan 2016 15:28:55 +0000"  >&lt;p&gt;Thanks for reviewing. I&apos;ve committed this to trunk and branch-1.8.&lt;/p&gt;</comment>
                            <comment id="15110791" author="hudson" created="Thu, 21 Jan 2016 15:36:37 +0000"  >&lt;p&gt;SUCCESS: Integrated in AvroJava #574 (See &lt;a href=&quot;https://builds.apache.org/job/AvroJava/574/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/AvroJava/574/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-1783&quot; title=&quot;Gracefully handle strings with wrong character encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-1783&quot;&gt;&lt;del&gt;AVRO-1783&lt;/del&gt;&lt;/a&gt;. Ruby: Ensure correct binary encoding for byte strings. (martinkl: rev 1725988)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;trunk/lang/ruby/lib/avro/io.rb&lt;/li&gt;
	&lt;li&gt;trunk/lang/ruby/lib/avro/ipc.rb&lt;/li&gt;
	&lt;li&gt;trunk/lang/ruby/lib/avro/schema.rb&lt;/li&gt;
	&lt;li&gt;trunk/lang/ruby/test/test_io.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12783582" name="AVRO-1783-2.patch" size="6617" author="martinkl" created="Thu, 21 Jan 2016 13:24:07 +0000"/>
                            <attachment id="12781665" name="AVRO-1783.patch" size="2967" author="martinkl" created="Mon, 11 Jan 2016 22:40:17 +0000"/>
                            <attachment id="12782102" name="AVRO-1783.stack.text" size="46274" author="rdblue" created="Wed, 13 Jan 2016 18:22:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jan 2016 22:38:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r5jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
