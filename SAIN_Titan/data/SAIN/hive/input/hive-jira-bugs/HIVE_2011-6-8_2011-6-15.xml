<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Tue Jan 22 15:18:19 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+HIVE+AND+created+%3E%3D+2011-6-8+AND+created+%3C%3D+2011-6-15+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="15" total="15"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[HIVE-2206] add a new optimizer for query correlation discovery and optimization</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2206</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;This issue proposes a new logical optimizer called Correlation Optimizer, which is used to merge correlated MapReduce jobs (MR jobs) into a single MR job. The idea is based on YSmart (&lt;a href=&quot;http://ysmart.cse.ohio-state.edu/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ysmart.cse.ohio-state.edu/&lt;/a&gt;). The paper and slides of YSmart are linked at the bottom.&lt;/p&gt;

&lt;p&gt;Since Hive translates queries in a sentence by sentence fashion, for every operation which may need to shuffle the data (e.g. join and aggregation operations), Hive will generate a MapReduce job for that operation. However, for those operations which may need to shuffle the data, they may involve correlations explained below and thus can be executed in a single MR job.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Input Correlation: Multiple MR jobs have input correlation (IC) if their input relation sets are not disjoint;&lt;/li&gt;
	&lt;li&gt;Transit Correlation: Multiple MR jobs have transit correlation (TC) if they have not only input correlation, but also the same partition key;&lt;/li&gt;
	&lt;li&gt;Job Flow Correlation: An MR has job &#64258;ow correlation (JFC) with one of its child nodes if it has the same partition key as that child node.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The current implementation of correlation optimizer only detect correlations among MR jobs for reduce-side join operators and reduce-side aggregation operators (not map only aggregation). A query will be optimized if it satisfies following conditions.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;There exists a MR job for reduce-side join operator or reduce side aggregation operator which have JFC with all of its parents MR jobs (TCs will be also exploited if JFC exists);&lt;/li&gt;
	&lt;li&gt;All input tables of those correlated MR job are original input tables (not intermediate tables generated by sub-queries); and&lt;/li&gt;
	&lt;li&gt;No self join is involved in those correlated MR jobs.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Correlation optimizer is implemented as a logical optimizer. The main reasons are that it only needs to manipulate the query plan tree and it can leverage the existing component on generating MR jobs.&lt;/p&gt;

&lt;p&gt;Current implementation can serve as a framework for correlation related optimizations. I think that it is better than adding individual optimizers. &lt;/p&gt;

&lt;p&gt;There are several work that can be done in future to improve this optimizer. Here are three examples.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Support queries only involve TC;&lt;/li&gt;
	&lt;li&gt;Support queries in which input tables of correlated MR jobs involves intermediate tables; and&lt;/li&gt;
	&lt;li&gt;Optimize queries involving self join.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;References:&lt;br/&gt;
Paper and presentation of YSmart.&lt;br/&gt;
Paper: &lt;a href=&quot;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&lt;/a&gt;&lt;br/&gt;
Slides: &lt;a href=&quot;http://sdrv.ms/UpwJJc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://sdrv.ms/UpwJJc&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509546">HIVE-2206</key>
            <summary>add a new optimizer for query correlation discovery and optimization</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yhuai">Yin Huai</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jun 2011 06:38:30 +0000</created>
                <updated>Tue, 15 Jul 2014 06:57:49 +0000</updated>
                            <resolved>Thu, 18 Jul 2013 09:19:59 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>41</watches>
                                                                <comments>
                            <comment id="13045811" author="he yongqiang" created="Wed, 8 Jun 2011 06:41:27 +0000"  >&lt;p&gt;a draft patch&lt;/p&gt;

&lt;p&gt;will submit revised version later.&lt;/p&gt;</comment>
                            <comment id="13045935" author="yhuai" created="Wed, 8 Jun 2011 12:45:51 +0000"  >&lt;p&gt;Two queries (TPC-H Q17 and TPC-H Q18) can be used for testing this optimizer. Q17 is the same with the query provided in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-600&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-600&lt;/a&gt;, but to expose the correlation, Q18 is modified. With this optimizer, Q17 and Q18 needs 2 and 4 MapReduce jobs, respectively. Without this optimizer, these two queries need 4 and 8 MapReduce jobs, respectively.&lt;/p&gt;</comment>
                            <comment id="13054816" author="yhuai" created="Sat, 25 Jun 2011 05:22:16 +0000"  >&lt;p&gt;The current optimizer can identify correlations with query plan tree structures like TPC-H Q17 (in attached file Queries). Using Q17 as an example, sub-query (denoted as sub-Q1 and originally executed by MapReduce job J1) &quot;SELECT l_partkey as t_partkey, 0.2 * avg(l_quantity) AS t_avg_quantity FROM lineitem GROUP BY l_partkey&quot; has correlation with sub-query (denoted as sub-Q2 and originally executed by MapReduce job J2) &quot;SELECT l_quantity, l_partkey, l_extendedprice FROM part p JOIN lineitem l ON p.p_partkey = l.l_partkey AND p.p_brand = &apos;Brand#52&apos; AND p.p_container = &apos;JUMBO CAN&apos;&quot;, because (1)sub-Q1 and sub-Q2 share the same input &apos;lineitem&apos;; (2) ReduceSinkOperators in J1 and J2 share the same &apos;key&apos;, which is l_partkey (p_partkey). Also, because intermediate tables generated by sub-Q1 and sub-Q2 will be joined by a MapReduce job J3, of which the &apos;key&apos; of ReduceSinkOperator is &apos;l_partkey&apos;, J3 has correlation with J1 and J2. Thus, J1, J2 and J3 can be merged into one MapReduce job J&apos;. In the map function of J&apos;, a composite operator will be used to execute FilterOperators (if any) for sub-Q1 and sub-Q2. Then, in the reduce function of J&apos;, a dispatch operator is used to dispatch reduce-input records to JoinOperator in J1 and GroupByOperator in J2. Then, the results of JoinOperator and GroupByOperator will be fed to the JoinOperator in J3. &lt;/p&gt;

&lt;p&gt;For this optimizer, there are several issues. &lt;/p&gt;

&lt;p&gt;1: Because for the MapReduce job executing correlated MapReduce jobs, intermediate key/value pairs will be consumed by multiple operators, Map-side Aggregation is disabled. &lt;br/&gt;
2: For the MapReduce job executing correlated MapReduce jobs, if the depth of execution path in the reduce function is not the same (for example &quot;SELECT * FROM lineitem l1 JOIN (SELECT l_partkey FROM part p JOIN lineitem l ON p.p_partkey = l.l_partkey) tmp ON l1.partkey = tmp.partkey&quot;), one or multiple YSmartForwardOperator should be used. I have not completely solved this issue.&lt;br/&gt;
3: For two independent MapReduce jobs J1 and J2, the current correlation identifier only searches ReduceSinkOperators with the same &apos;key(s)&apos; for correlation, actually the set of &apos;key(s)&apos; of the ReduceSinkOperator in J1 is a subset of that in J2, these two MapReduce jobs are correlated. (Also, sub-queries with distinct keyword associated with Group By clause is under this issue, since distinct keyword is handled by using all columns as &apos;keys&apos; in its corresponding ReduceSinkOperator)&lt;br/&gt;
4: The current correlation identifier can not identify correlations represented by columns involving &quot;max(&amp;lt;column name&amp;gt;)&quot; or &quot;min(&amp;lt;column name&amp;gt;)&quot;.&lt;/p&gt;

&lt;p&gt;I will start working on this optimizer in August and will firstly solve issues 2-4 mentioned above.  &lt;/p&gt;</comment>
                            <comment id="13101952" author="yhuai" created="Sat, 10 Sep 2011 03:22:14 +0000"  >&lt;p&gt;Almost finish the patch. I did a preliminary test based on TPC-H Q17 and Q18. My machine has a quad-core Intel Xeon X3220 processor (2.4 GHz), 4GB of RAM, a 500GB hard disk and Ubuntu 11.04. With scale factor 10, the execution time of Q17 is 1216.94s without the patch versus 713.581s with the patch, and that of Q18 is 1737.18s without the patch versus 867.334s with the patch. &lt;/p&gt;

&lt;p&gt;I am facing a issue which I have not found a good way to solve. Suppose that we have a query &quot;SELECT * FROM (SELECT L.c1 as c11, R.c2 as c12 FROM L JOIN R ON L.c1=R.C2) t1 JOIN (SELECT R.c1 as c21, count(distinct R.c2) as c22 FROM R GROUP BY R.c1) ON t1.c11=t2.c21&quot;. In this query, only one MapReduce job is necessary. However, because Hive will use R.c1 and R.c2 as the key columns of the original ReduceSinkOperator for the sub-query involving distinct count function, it is impossible to merged MapReduce jobs of two sub-queries into one. To optimize this kind of query, I write a new UDF function count_distinct(...), e.g. count_distinct(R.c2). This count_distinct function use a HashSet to get the number of distinct records. Is there any better solution for optimizing this kind of queries? Thanks.     &lt;/p&gt;</comment>
                            <comment id="13105098" author="he yongqiang" created="Thu, 15 Sep 2011 04:08:30 +0000"  >&lt;p&gt;Cool! Yin, please let us know when u are mostly done. one small things is that in the hive code let&apos;s call the new optimizer as &quot;cooperative scan&quot; instead of YSmart. But we can add the paper ref in the comment.&lt;/p&gt;</comment>
                            <comment id="13105379" author="yhuai" created="Thu, 15 Sep 2011 14:06:52 +0000"  >&lt;p&gt;Yongqiang: I will change the name of optimizer. But, I&apos;d prefer the name like &quot;query correlation detector&quot; or &quot;multi-query optimizer&quot;, because I think that the name of &quot;cooperative scan&quot; limits the scope of this optimizer. Besides shared-scan, if ReduceSinkOperators of two chained Hive-generated MapReduce jobs share the same key(s), this optimizer can merge the second job into the reduce phase of the first job. &lt;/p&gt;

&lt;p&gt;I will upload a patch by this Sunday.   &lt;/p&gt;


</comment>
                            <comment id="13105619" author="he yongqiang" created="Thu, 15 Sep 2011 19:21:17 +0000"  >&lt;p&gt;ok. how about just &quot;correlation&quot;? &lt;br/&gt;
Also can you take a look if it is possible to the optimization as part of physical optimizer. We need a lot of code cleanup in the current patch.&lt;/p&gt;</comment>
                            <comment id="13105641" author="yhuai" created="Thu, 15 Sep 2011 19:54:35 +0000"  >&lt;p&gt;ok. I will start to cleanup my code and upload updated patch soon.   &lt;/p&gt;</comment>
                            <comment id="13107306" author="yhuai" created="Sun, 18 Sep 2011 01:46:36 +0000"  >&lt;p&gt;The patch is ready. Queries used in testing are included in the file of testQueries.q. &lt;/p&gt;</comment>
                            <comment id="13107307" author="yhuai" created="Sun, 18 Sep 2011 01:49:47 +0000"  >&lt;p&gt;I tested three queries. TPC-H Q17, Q18 and the left-outer-join sub-tree in the Q21. You can check the query plan trees in the paper &lt;a href=&quot;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here are the results. &lt;br/&gt;
        	disabled(s)	enabled(s)&lt;br/&gt;
Q17	        1288.917	655.07&lt;br/&gt;
Q18      	1731.734	911.761&lt;br/&gt;
Q21 subtree	1865.597	658.58&lt;/p&gt;</comment>
                            <comment id="13107530" author="yhuai" created="Sun, 18 Sep 2011 20:45:12 +0000"  >&lt;p&gt;found a bug in the &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.1.patch.txt. will upload a update version later. &lt;/p&gt;</comment>
                            <comment id="13107561" author="yhuai" created="Sun, 18 Sep 2011 23:25:57 +0000"  >&lt;p&gt;there are some failures in TestCliDriver. Some failures seems that the output misses some lines when using keyword &quot;explain&quot;. Other failures are related to queries with index, e.g. index_quth.q. When I tested query index_quth.q manually, there were two errors. One was &quot;java.lang.ClassNotFoundException: org.apache.derby.jdbc.EmbeddedDriver&quot; and another one was &quot;java.lang.NoClassDefFoundError: javaewah/EWAHCompressedBitmap&quot;. &lt;/p&gt;

&lt;p&gt;These errors seems irrelevance to changes I made, but there should be some thing wrong... &lt;/p&gt;

&lt;p&gt;@Yongqiang: Can you have a look at my patch and give me some suggestions on how to fix it? Thanks&lt;/p&gt;</comment>
                            <comment id="13107787" author="yhuai" created="Mon, 19 Sep 2011 12:57:02 +0000"  >&lt;p&gt;I used &quot;ant clean package test tar -logfile ant.log&quot; to test all cases again and all unknown errors are gone... There are four failures left (groupby1, groupby2, groupby3 and groupby5). These four failures are caused by changes I made in the method &quot;genGroupByPlanReduceSinkOperator&quot; in the class &quot;SemanticAnalyzer&quot;. So, current results should be updated. But I am not sure how to change the correct results. Does overwrite current results with the new results work? Or, is there anything I should do?&lt;/p&gt;</comment>
                            <comment id="13107795" author="yhuai" created="Mon, 19 Sep 2011 13:03:15 +0000"  >&lt;p&gt;In unit tests, there are four failures in TestParse (groupby1, groupby2, groupby3 and groupby5). These four failures are caused by changes I made in the method &quot;genGroupByPlanReduceSinkOperator&quot; in the class &quot;SemanticAnalyzer&quot;. Current results should be updated. But I am not sure how to change the correct results. Need some suggestions. Thanks.&lt;/p&gt;</comment>
                            <comment id="13107866" author="ashutoshc" created="Mon, 19 Sep 2011 14:36:24 +0000"  >&lt;p&gt;@Yin,&lt;/p&gt;

&lt;p&gt;To overwrite current results you can do the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant test -Dtestcase=TestCliDriver -Dqfile=groupby1.q -Doverwrite=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13107900" author="yhuai" created="Mon, 19 Sep 2011 15:27:41 +0000"  >&lt;p&gt;@Ashutosh, Thanks&lt;/p&gt;</comment>
                            <comment id="13108217" author="yhuai" created="Mon, 19 Sep 2011 23:08:52 +0000"  >&lt;p&gt;All of unit test cases are passed, except TestParse_groupby1, TestParse_groupby2, TestParse_groupby3 and TestParse_groupby5. Because I made some changes in method &quot;genGroupByPlanReduceSinkOperator&quot; of class &quot;SemanticAnalyzer&quot;, so results of these four cases should be updated. However, I found that when these four cases are tested individually, the results differ from the results when these four cases are tested with all other cases (when I used &quot;ant clean package test tar -logfile ant.log&quot;). Hive-trunk I checked out from svn also has this issue. Is it a bug or did I miss anything?&lt;/p&gt;

&lt;p&gt;This patch does not contain updates on the results of cases TestParse_groupby1, TestParse_groupby2, TestParse_groupby3 and TestParse_groupby5. &lt;/p&gt;</comment>
                            <comment id="13109753" author="jiraposter@reviews.apache.org" created="Wed, 21 Sep 2011 18:35:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This optimizer exploits intra-query correlations and merges multiple correlated MapReduce jobs into one jobs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2206&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1173271 &lt;br/&gt;
  trunk/ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationDispatchOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationFakeReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationManualForwardOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationGenMRRedSink1.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationDispatchDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationFakeReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationManualForwardDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1173271 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFCountDistinct.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java 1173271 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/show_functions.q.out 1173271 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby1.q.xml 1173271 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby2.q.xml 1173271 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby3.q.xml 1173271 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby5.q.xml 1173271 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2001/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Ran all unit tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yin&lt;/p&gt;
</comment>
                            <comment id="13109755" author="yhuai" created="Wed, 21 Sep 2011 18:35:56 +0000"  >&lt;p&gt;Submitted a review request. The link is &lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13156255" author="yhuai" created="Wed, 23 Nov 2011 20:27:00 +0000"  >&lt;p&gt;This is a working-in-progress patch. There are two issues to be addressed before next version of patch. Firstly, I will look at if I can remove the operator FakeReduceSinkOperator. Secondly, I will look at if correlation optimizer can be a one-phase optimizer instead of two-phase one. The current implementation will call the correlation optimizer twice (at the beginning and the end of optimization, respectively). &lt;/p&gt;</comment>
                            <comment id="13162963" author="jiraposter@reviews.apache.org" created="Mon, 5 Dec 2011 19:12:39 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-12-05 19:12:23.087778)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;CorrelationReduceSinkOperator has been merged into ReduceSinkOperator. Detailed comments has been added to new operator.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This optimizer exploits intra-query correlations and merges multiple correlated MapReduce jobs into one jobs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2206&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationFakeReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationManualForwardOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationFakeReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationManualForwardDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1210283 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java 1210283 &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java 1210283 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby1.q.xml 1210283 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby2.q.xml 1210283 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby3.q.xml 1210283 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby5.q.xml 1210283 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2001/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Previous version of diff passed all unit tests. Since the latest trunk (r1209696) cannot finish all of unit tests, the latest version of diff has not been tested.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yin&lt;/p&gt;
</comment>
                            <comment id="13162964" author="yhuai" created="Mon, 5 Dec 2011 19:15:05 +0000"  >&lt;p&gt;New version of patch and testing queries are available. I also updated the diff in the review request (link: &lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13177318" author="jiraposter@reviews.apache.org" created="Thu, 29 Dec 2011 18:51:30 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-12-29 18:50:12.277210)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This optimizer exploits intra-query correlations and merges multiple correlated MapReduce jobs into one jobs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2206&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/BaseReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/BaseReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java 1224666 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java 1224666 &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java 1224666 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby1.q.xml 1224666 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby2.q.xml 1224666 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby3.q.xml 1224666 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby5.q.xml 1224666 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2001/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing (updated)&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yin&lt;/p&gt;
</comment>
                            <comment id="13177319" author="yhuai" created="Thu, 29 Dec 2011 18:51:42 +0000"  >&lt;p&gt;diff in the review board has also been updated (&lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;). &lt;/p&gt;</comment>
                            <comment id="13177324" author="yhuai" created="Thu, 29 Dec 2011 18:57:31 +0000"  >&lt;p&gt;testQueries.2.q have three testing queries&lt;/p&gt;</comment>
                            <comment id="13190147" author="kevinwilfong" created="Fri, 20 Jan 2012 21:50:08 +0000"  >&lt;p&gt;I tried running &lt;/p&gt;

&lt;p&gt;explain select * from (select * from src distribute by key sort by key) a join src b  on a.key = b.key;&lt;/p&gt;

&lt;p&gt;using &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.8.r1224646.patch.txt and I get the following exception:&lt;/p&gt;

&lt;p&gt;FAILED: Hive Internal Error: java.lang.ClassCastException(org.apache.hadoop.hive.ql.exec.SelectOperator cannot be cast to org.apache.hadoop.hive.ql.exec.ReduceSinkOperator)&lt;br/&gt;
java.lang.ClassCastException: org.apache.hadoop.hive.ql.exec.SelectOperator cannot be cast to org.apache.hadoop.hive.ql.exec.ReduceSinkOperator&lt;br/&gt;
	at org.apache.hadoop.hive.ql.optimizer.CorrelationOptimizer$CorrelationNodeProc.findPeerReduceSinkOperators(CorrelationOptimizer.java:256)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.optimizer.CorrelationOptimizer$CorrelationNodeProc.process(CorrelationOptimizer.java:503)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultRuleDispatcher.dispatch(DefaultRuleDispatcher.java:89)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.dispatch(DefaultGraphWalker.java:88)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.walk(DefaultGraphWalker.java:125)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.startWalking(DefaultGraphWalker.java:102)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.optimizer.CorrelationOptimizer.transform(CorrelationOptimizer.java:193)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.optimizer.Optimizer.optimize(Optimizer.java:100)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:7384)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:243)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.ExplainSemanticAnalyzer.analyzeInternal(ExplainSemanticAnalyzer.java:50)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:243)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:430)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:337)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.run(Driver.java:889)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:255)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:212)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:403)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:671)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:554)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;/p&gt;</comment>
                            <comment id="13190151" author="kevinwilfong" created="Fri, 20 Jan 2012 21:52:22 +0000"  >&lt;p&gt;Nevermind, sorry, it was the distribute by followed by sort by.&lt;/p&gt;</comment>
                            <comment id="13190161" author="kevinwilfong" created="Fri, 20 Jan 2012 22:01:23 +0000"  >&lt;p&gt;The above bug is a pre-existing issue with reduce sink reduplication.&lt;/p&gt;

&lt;p&gt;The following new exception is produced by the query:&lt;/p&gt;

&lt;p&gt;set hive.optimize.reducededuplication=false;&lt;br/&gt;
explain select * from (select * from src distribute by key sort by key) a join src b on a.key = b.key;&lt;/p&gt;

&lt;p&gt;FAILED: Hive Internal Error: java.lang.ArrayIndexOutOfBoundsException(1)&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException: 1&lt;br/&gt;
	at org.apache.hadoop.hive.ql.optimizer.CorrelationOptimizerUtils.createCorrelationCompositeReducesinkOperaotr(CorrelationOptimizerUtils.java:599)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.optimizer.CorrelationOptimizerUtils.applyCorrelation(CorrelationOptimizerUtils.java:365)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.optimizer.CorrelationOptimizer.transform(CorrelationOptimizer.java:198)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.optimizer.Optimizer.optimize(Optimizer.java:100)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:7384)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:243)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.ExplainSemanticAnalyzer.analyzeInternal(ExplainSemanticAnalyzer.java:50)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:243)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:430)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:337)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.run(Driver.java:889)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:255)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:212)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:403)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:671)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:554)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;/p&gt;</comment>
                            <comment id="13190276" author="yhuai" created="Sat, 21 Jan 2012 02:35:21 +0000"  >&lt;p&gt;@Kevin,&lt;br/&gt;
I will take a look at it. &lt;/p&gt;</comment>
                            <comment id="13195804" author="yhuai" created="Sun, 29 Jan 2012 17:55:16 +0000"  >&lt;p&gt;@Kevin,&lt;br/&gt;
I wrongly assumed that all output names of the ReduceSinkOperator has a structure of &quot;KEY/VALUE.internalName&quot;. I have solved this issue.&lt;/p&gt;

&lt;p&gt;However, the current optimizer cannot handel the case that a table is directly connect to a post computation operator (in this case, table b directly connects to the operator join). I am planning to solve this issue after this patch. To walkaround, you can use ...&lt;br/&gt;
SET hive.optimize.reducededuplication=false;&lt;br/&gt;
SET hive.optimize.correlation=true;&lt;br/&gt;
SELECT * FROM (SELECT * FROM src DISTRIBUTE BY key SORT BY key) a JOIN (SELECT * FROM src DISTRIBUTE BY key SORT BY key) b ON a.key = b.key;. &lt;br/&gt;
This query will be optimized and be executed in a single MapReduce job. &lt;/p&gt;

&lt;p&gt;Also, I have updated the patch and it is compatible with revision 1237253.&lt;/p&gt;</comment>
                            <comment id="13195805" author="jiraposter@reviews.apache.org" created="Sun, 29 Jan 2012 17:57:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2012-01-29 17:56:48.704757)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;make the patch compatible with latest trunk (revision 1237253).&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This optimizer exploits intra-query correlations and merges multiple correlated MapReduce jobs into one jobs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2206&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/BaseReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/BaseReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java 1237326 &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java 1237326 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby1.q.xml 1237326 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby2.q.xml 1237326 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby3.q.xml 1237326 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby5.q.xml 1237326 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2001/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yin&lt;/p&gt;
</comment>
                            <comment id="13205570" author="jiraposter@reviews.apache.org" created="Fri, 10 Feb 2012 17:38:57 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2001/#review4912&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#review4912&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I&apos;ve started reviewing this, here&apos;s my comments so far.  I&apos;ll continue to look over it.&lt;/p&gt;


&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/#comment11010&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#comment11010&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does this have to default to false, does anything break if it&apos;s true?&lt;/p&gt;

&lt;p&gt;    Similarly, have you tried running the tests with this set to true?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/#comment10818&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#comment10818&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    It&apos;s not clear to me why we need both setRowNumber and processOp.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/#comment10817&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#comment10817&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Putting this code in a helper method would be better than having it both here and in setRowNumber.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/#comment10819&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#comment10819&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does this commented out code need to be kept?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/#comment10820&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#comment10820&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I couldn&apos;t find a CorrelationFakeReduceSinkOperator class.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/#comment10821&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#comment10821&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Tabs are bad, could you change them to spaces, at least in the new code your introducing.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/#comment10850&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#comment10850&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I take it from this line it&apos;s a requirement that in order for this correlation optimization to be attempted every reduce sink has to be followed only by children with a single child.&lt;/p&gt;

&lt;p&gt;    Could this be relaxed?  Could the optimization simply not be applied if there is an operator between two ReduceSinks that has more than one child?&lt;/p&gt;

&lt;p&gt;    Also, if there is a ReduceSink which is not followed by another ReduceSink, but is followed by an operator with more than one child, this prevents the optimization from being used, even though it shouldn&apos;t have an effect.&lt;/p&gt;

&lt;p&gt;    Also, regarding checking if the size &amp;lt;=1, if the size &amp;lt;1 the next line will throw an exception.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/#comment10851&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#comment10851&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    findNextChildReduceSinkOperator can return null, do you need to check for this?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Kevin&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-01-29 17:56:48, Yin Huai wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-01-29 17:56:48)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This optimizer exploits intra-query correlations and merges multiple correlated MapReduce jobs into one jobs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2206&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/BaseReduceSinkOperator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/BaseReduceSinkDesc.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/compiler/plan/groupby1.q.xml 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/compiler/plan/groupby2.q.xml 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/compiler/plan/groupby3.q.xml 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/compiler/plan/groupby5.q.xml 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2001/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yin&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13205654" author="jiraposter@reviews.apache.org" created="Fri, 10 Feb 2012 19:12:58 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; I&apos;ve started reviewing this, here&apos;s my comments so far.  I&apos;ll continue to look over it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I will update this patch soon. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java, line 453&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/diff/4/?file=71297#file71297line453&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff/4/?file=71297#file71297line453&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Does this have to default to false, does anything break if it&apos;s true?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Similarly, have you tried running the tests with this set to true?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have not tried running the tests with this set to true. I will do it when I find a revision which can pass all unit tests (btw, any suggestion on which revision should I use?). In my opinion, since this optimizer is kind of complicated and it is still being developed, it will be safer to default it to false and let users to decide when to use it than default it to true.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java, line 101&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/diff/4/?file=71299#file71299line101&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff/4/?file=71299#file71299line101&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     It&apos;s not clear to me why we need both setRowNumber and processOp.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Since a CorrelationCompositeOperator may have multiple parents, I used a buffer to store the output of parents of the CorrelationCompositeOperator (shown processOp method). The TableScanOperator will trigger the setRowNumber method and then CorrelationCompositeOperator will decide the operationPathTags of this row based on the contents in the buffer and then forward the row in its buffer to its child. So, setRowNumber in here is used to evaluate the operationPathTags of the row in the buffer before the CorrelationCompositeOperator gets the new row. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java, lines 150-177&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/diff/4/?file=71299#file71299line150&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff/4/?file=71299#file71299line150&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Putting this code in a helper method would be better than having it both here and in setRowNumber.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I will do it. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java, line 274&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/diff/4/?file=71300#file71300line274&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff/4/?file=71300#file71300line274&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Does this commented out code need to be kept?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This commented out code is not needed. I will delete it. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java, line 1337&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/diff/4/?file=71303#file71303line1337&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff/4/?file=71303#file71303line1337&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I couldn&apos;t find a CorrelationFakeReduceSinkOperator class.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;CorrelationLocalSimulativeReduceSinkOperator was named as CorrelationFakeReduceSinkOperator. I will use the right name in the comment. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java, line 273&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/diff/4/?file=71305#file71305line273&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff/4/?file=71305#file71305line273&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Tabs are bad, could you change them to spaces, at least in the new code your introducing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I will change the format of my code. Thanks for letting me know.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java, line 239&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/diff/4/?file=71308#file71308line239&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff/4/?file=71308#file71308line239&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I take it from this line it&apos;s a requirement that in order for this correlation optimization to be attempted every reduce sink has to be followed only by children with a single child.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Could this be relaxed?  Could the optimization simply not be applied if there is an operator between two ReduceSinks that has more than one child?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Also, if there is a ReduceSink which is not followed by another ReduceSink, but is followed by an operator with more than one child, this prevents the optimization from being used, even though it shouldn&apos;t have an effect.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Also, regarding checking if the size &amp;lt;=1, if the size &amp;lt;1 the next line will throw an exception.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Only &quot;assert op.getChildOperators().size() &amp;gt; 0;&quot; is needed at here. Thank you for letting me know. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2012-02-10 17:38:09, Kevin Wilfong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java, line 335&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2001/diff/4/?file=71308#file71308line335&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff/4/?file=71308#file71308line335&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     findNextChildReduceSinkOperator can return null, do you need to check for this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;findNextChildReduceSinkOperator will not return null since its input will not be the last ReduceSinkOperator before the FileSinkOperator. For example, suppose that we have a plan tree like (some operators)&lt;del&gt;&amp;gt;RS1&lt;/del&gt;&amp;gt;(some operators)&lt;del&gt;&amp;gt;RS2&lt;/del&gt;&amp;gt;(some operators)-&amp;gt;FS. The input of findNextChildReduceSinkOperator will not be RS2. I will add an assertion and a comment after this line. &lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Yin&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2001/#review4912&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/#review4912&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2012-01-29 17:56:48, Yin Huai wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-01-29 17:56:48)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This optimizer exploits intra-query correlations and merges multiple correlated MapReduce jobs into one jobs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2206&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/BaseReduceSinkOperator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/BaseReduceSinkDesc.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/compiler/plan/groupby1.q.xml 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/compiler/plan/groupby2.q.xml 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/compiler/plan/groupby3.q.xml 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/compiler/plan/groupby5.q.xml 1237326 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2001/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yin&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13205742" author="jiraposter@reviews.apache.org" created="Fri, 10 Feb 2012 20:50:58 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2001/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2012-02-10 20:49:01.177796)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;updated patch on revision 1237253. Will generate the patch based on the latest trunk latter. &lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This optimizer exploits intra-query correlations and merges multiple correlated MapReduce jobs into one jobs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2206&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/BaseReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/BaseReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java 1237326 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java 1237326 &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java 1237326 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby1.q.xml 1237326 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby2.q.xml 1237326 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby3.q.xml 1237326 &lt;br/&gt;
  trunk/ql/src/test/results/compiler/plan/groupby5.q.xml 1237326 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2001/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2001/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yin&lt;/p&gt;
</comment>
                            <comment id="13275188" author="anders8" created="Tue, 15 May 2012 05:31:06 +0000"  >&lt;p&gt;I read about the patch and I think the hive&apos;s optimizer framework is bad.&lt;br/&gt;
Detail: &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3027&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-3027&lt;/a&gt;&lt;br/&gt;
Can you improve it?&lt;/p&gt;</comment>
                            <comment id="13276409" author="yhuai" created="Wed, 16 May 2012 03:06:32 +0000"  >&lt;p&gt;@anders,&lt;br/&gt;
I will try to make this patch more concise and easier to read than the current version. If I have any thought on the optimization framework, I will comment under &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3027&quot; title=&quot;The optimizer architecture of Hive is terrible, need code refactoring&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3027&quot;&gt;HIVE-3027&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13424315" author="he yongqiang" created="Sat, 28 Jul 2012 10:36:49 +0000"  >&lt;p&gt;For the last few months (almost one year), Yin has been actively maintaining this patch, and i think it is in a very good state to check into trunk. &lt;/p&gt;

&lt;p&gt;So i will do some final review, and hope to commit it sometime next month. Please feel free to jump in to review the patch and put any comments here before the commit.&lt;/p&gt;

&lt;p&gt;In the last review, I will make sure this patch will not have big changes to existing execution path, so it can be simply disabled like other optimizations in Hive. And Yin will still be actively maintaining this patch (help fix  bugs etc) after the commit. &lt;/p&gt;</comment>
                            <comment id="13456171" author="yhuai" created="Fri, 14 Sep 2012 21:37:17 +0000"  >&lt;p&gt;The patch is ported to the latest trunk (revision 1384442). I tested this patch with an enabled CorrelationOptimizer (hive.optimize.correlation=true). During the testing, I fixed several bugs and all tests should be ok except those I explained below. &lt;/p&gt;

&lt;p&gt;In case TestParse, there are 42 queries failed. Since I made several minor changes in SemanticAnalyzer. Seems those results should be updated. &lt;/p&gt;

&lt;p&gt;In TestCliDriver, auto_join26.q is failed since it is optimized by the optimizer. Considering I will make the optimizer disabled by default, I will not do any change regarding this query and its result. &lt;/p&gt;

&lt;p&gt;In TestCliDriver, create_view.q and udaf_percentile_approx.q are two weird queries. If hive.map.aggr=false, the original trunk will also fail. Seems bug is involved in the trunk. I have sent an email to dev mailing list regarding create_view.q. For udaf_percentile_approx.q, I have got time to look at it in detail.&lt;/p&gt;

&lt;p&gt;In TestCliDriver, join31.q is failed. For this case, the query should be updated to have &quot;set hive.optimize.correlation=true&quot;. But, since the optimizer is disabled by default, I will not update this query. &lt;/p&gt;

&lt;p&gt;Also, I got some queries which trunk cannot pass. These are cascade_dbdrop_hadoop20.q, hbase_binary_external_table_queries.q, hbase_binary_map_queries.q, hbase_binary_storage_queries.q, hbase_joins.q, hbase_ppd_key_range.q, hbase_pushdown.q, hbase_queries.q, local_mapred_error_cache.q, and TestCase TestHBaseMinimrCliDriver. &lt;/p&gt;

&lt;p&gt;I will run all tests again and will fix any bug related to the patch. &lt;/p&gt;</comment>
                            <comment id="13456509" author="yhuai" created="Sat, 15 Sep 2012 23:18:32 +0000"  >&lt;p&gt;new patch for trunk (revision 1385084). Disabled the optimizer by default and updated test results.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=he+yongqiang&quot; class=&quot;user-hover&quot; rel=&quot;he yongqiang&quot;&gt;He Yongqiang&lt;/a&gt;:&lt;br/&gt;
can you help me test a few cases which the trunk on my machine cannot pass?&lt;br/&gt;
Those are TestHBaseMinimrCliDriver, TestHBaseCliDriver, TestHBaseNegativeCliDriver, testSynchronized in TestEmbeddedHiveMetaStore, testSynchronized in TestRemoteHiveMetaStore, testSynchronized in TestSetUGIOnBothClientServer, testSynchronized in TestSetUGIOnOnlyClient, testSynchronized in TestSetUGIOnOnlyServer, and testNegativeCliDriver_local_mapred_error_cache in TestNegativeCliDriver. Thanks!	&lt;/p&gt;</comment>
                            <comment id="13456511" author="yhuai" created="Sat, 15 Sep 2012 23:41:33 +0000"  >&lt;p&gt;Opened a new review request at &lt;a href=&quot;https://reviews.apache.org/r/7126/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/7126/&lt;/a&gt;, since I have been working on hive-git. &lt;/p&gt;</comment>
                            <comment id="13456733" author="cwsteinbach" created="Mon, 17 Sep 2012 02:03:37 +0000"  >&lt;p&gt;Please explain what is preventing us from enabling this feature by default, e.g. in which cases is it expected not to work, and what are the failure scenarios? &lt;/p&gt;

&lt;p&gt;Based on the current test coverage (not much) I can&apos;t tell if it&apos;s actually possible to use this feature in its current state.&lt;/p&gt;</comment>
                            <comment id="13457114" author="yhuai" created="Mon, 17 Sep 2012 16:10:42 +0000"  >&lt;p&gt;Carl:&lt;br/&gt;
The main reason that Yongqiang and I decided to disable this feature by default first is that we have not got a chance to test this optimizer heavily.&lt;/p&gt;</comment>
                            <comment id="13457484" author="he yongqiang" created="Mon, 17 Sep 2012 23:45:32 +0000"  >&lt;p&gt;The current patch looks ok. &lt;br/&gt;
@Carl, please give more specific comments. &lt;/p&gt;

&lt;p&gt;We should agree on that new big features should not be enabled by default. That&apos;s too risky. &lt;/p&gt;</comment>
                            <comment id="13457954" author="yhuai" created="Tue, 18 Sep 2012 17:01:55 +0000"  >&lt;p&gt;patch updated. bug fix+ 3 test cases&lt;/p&gt;</comment>
                            <comment id="13461873" author="yhuai" created="Mon, 24 Sep 2012 15:55:51 +0000"  >&lt;p&gt;two new tests + bug fix. This patch is ready to review. Diff r4 in &lt;a href=&quot;https://reviews.apache.org/r/7126/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/7126/&lt;/a&gt; is the latest patch. &lt;/p&gt;</comment>
                            <comment id="13462174" author="cwsteinbach" created="Mon, 24 Sep 2012 21:53:06 +0000"  >&lt;p&gt;@Yin: Please see my comments on reviewboard. Thanks.&lt;/p&gt;</comment>
                            <comment id="13462865" author="yhuai" created="Tue, 25 Sep 2012 15:24:38 +0000"  >&lt;p&gt;updated patch at reviewboard.&lt;/p&gt;

&lt;p&gt;@Carl: Pleas also see my comments under yours. Thanks.&lt;/p&gt;</comment>
                            <comment id="13463855" author="yhuai" created="Wed, 26 Sep 2012 14:30:19 +0000"  >&lt;p&gt;I corrected my local configurations related to HBase and checked out &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3507&quot; title=&quot;Some of the tests are not deterministic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3507&quot;&gt;&lt;del&gt;HIVE-3507&lt;/del&gt;&lt;/a&gt;, now all tests pass. &lt;/p&gt;</comment>
                            <comment id="13466552" author="he yongqiang" created="Sun, 30 Sep 2012 19:56:03 +0000"  >&lt;p&gt;All tests passed for me.&lt;/p&gt;</comment>
                            <comment id="13466566" author="he yongqiang" created="Sun, 30 Sep 2012 20:41:57 +0000"  >&lt;p&gt;I just committed. Thanks for the hard work, Yin Huai!&lt;/p&gt;</comment>
                            <comment id="13466576" author="cwsteinbach" created="Sun, 30 Sep 2012 21:40:41 +0000"  >&lt;p&gt;@Yongqiang: I don&apos;t see a +1 vote in this JIRA. According to the project bylaws (&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Bylaws&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/Bylaws&lt;/a&gt;) this patch should not have been committed. Please back this patch out. Thanks.&lt;/p&gt;</comment>
                            <comment id="13466580" author="he yongqiang" created="Sun, 30 Sep 2012 21:58:55 +0000"  >&lt;p&gt;I commented that all tests passed.&lt;/p&gt;

&lt;p&gt;ok, +1.&lt;/p&gt;</comment>
                            <comment id="13466581" author="he yongqiang" created="Sun, 30 Sep 2012 22:02:28 +0000"  >&lt;p&gt;@Carl, btw, i did mentioned a few times on the comments that i am planing to commit this one.&lt;/p&gt;</comment>
                            <comment id="13466582" author="cwsteinbach" created="Sun, 30 Sep 2012 22:04:03 +0000"  >&lt;p&gt;@Yongqiang: Sorry, but that&apos;s not the way it works. You vote +1 first, wait 24 hours, and then commit the patch. This is all covered in the project bylaws. Please revert this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="13466584" author="he yongqiang" created="Sun, 30 Sep 2012 22:07:40 +0000"  >&lt;p&gt;I did not see a 24 hours waiting on the bylaw page?&lt;/p&gt;</comment>
                            <comment id="13466625" author="he yongqiang" created="Mon, 1 Oct 2012 03:54:24 +0000"  >&lt;p&gt;@Carl, i just reverted. I will commit again tomorrow.&lt;/p&gt;</comment>
                            <comment id="13466627" author="namit" created="Mon, 1 Oct 2012 03:56:05 +0000"  >&lt;p&gt;Sorry for jumping in late on this. This is a pretty big feature - can you give me sometime to review this as well ?&lt;/p&gt;</comment>
                            <comment id="13466631" author="cwsteinbach" created="Mon, 1 Oct 2012 04:15:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;I did not see a 24 hours waiting on the bylaw page?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is specified in the &quot;minimum length&quot; column in the table that appears in the &quot;Actions&quot; section of the bylaws document. We could definitely make this easier to undertand, but all of the other committers already follow the convention that you +1 a patch before committing it, and allow some time to elapse in between those two actions in order to give other people a chance to weigh in.&lt;/p&gt;</comment>
                            <comment id="13466638" author="hudson" created="Mon, 1 Oct 2012 04:56:12 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1711 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1711/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1711/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;:add a new optimizer for query correlation discovery and optimization (Yin Huai via He Yongqiang) (Revision 1392105)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
heyongqiang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1392105&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1392105&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/BaseReduceSinkOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/BaseReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby1.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby2.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby5.q.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13466937" author="he yongqiang" created="Mon, 1 Oct 2012 16:56:16 +0000"  >&lt;p&gt;I will be on vacation this whole week. Given this is a very big diff, I will keep this open for another one week or two for more comments. &lt;/p&gt;</comment>
                            <comment id="13467067" author="yhuai" created="Mon, 1 Oct 2012 18:34:24 +0000"  >&lt;p&gt;I just found I can remove the first phase of this optimizer. Apparently there were changes in the trunk, so I do not need to save original ColumnExprMap and OpParseCtx. I have removed unnecessary code and are running tests. Will update the patch later.&lt;/p&gt;</comment>
                            <comment id="13467806" author="yhuai" created="Tue, 2 Oct 2012 15:49:58 +0000"  >&lt;p&gt;@Namit:&lt;br/&gt;
You can review the latest patch. I removed the first phase and other unnecessary contents. &lt;/p&gt;</comment>
                            <comment id="13480878" author="gemini5201314" created="Sun, 21 Oct 2012 02:12:58 +0000"  >&lt;p&gt;Did this jira have a short version description? I know a join followed by group is optimized like pipeline, what else we may want to add to wiki?&lt;/p&gt;</comment>
                            <comment id="13480881" author="yhuai" created="Sun, 21 Oct 2012 02:22:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gemini5201314&quot; class=&quot;user-hover&quot; rel=&quot;gemini5201314&quot;&gt;alex gemini&lt;/a&gt;&lt;br/&gt;
I do not have a short version description right now. Let me write one and create a wiki page.&lt;/p&gt;</comment>
                            <comment id="13489900" author="yhuai" created="Sat, 3 Nov 2012 01:52:40 +0000"  >&lt;p&gt;update a new patch which can be applied to r1404933. Also added the description of this issue. &lt;/p&gt;

&lt;p&gt;However, I do not have the permission to add a page in wiki. Where should I request the permission?&lt;/p&gt;</comment>
                            <comment id="13490432" author="namit" created="Mon, 5 Nov 2012 03:47:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;Yin Huai&lt;/a&gt;, can you file follow-up jiras for the cases that dont work with this optimization ?&lt;br/&gt;
It would be good to link them along with this jira. Adding them in the wiki would be useful too for tracking.&lt;/p&gt;</comment>
                            <comment id="13490681" author="yhuai" created="Mon, 5 Nov 2012 15:14:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=namit&quot; class=&quot;user-hover&quot; rel=&quot;namit&quot;&gt;Namit Jain&lt;/a&gt;&lt;br/&gt;
Sure. I created the umbrella jira (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3667&quot; title=&quot;Umbrella jira for Correlation Optimizer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3667&quot;&gt;HIVE-3667&lt;/a&gt;) for all work related to correlation optimizer and also created several follow-up jiras as sub-tasks. You can also add other sub-tasks into that jira.&lt;/p&gt;</comment>
                            <comment id="13496399" author="he yongqiang" created="Tue, 13 Nov 2012 18:36:52 +0000"  >&lt;p&gt;+1, i will commit after tests pass.&lt;/p&gt;</comment>
                            <comment id="13496521" author="cwsteinbach" created="Tue, 13 Nov 2012 20:38:18 +0000"  >&lt;p&gt;@Yongqiang: Can you please hold off on committing while I take another look? Thanks.&lt;/p&gt;</comment>
                            <comment id="13496528" author="he yongqiang" created="Tue, 13 Nov 2012 20:47:44 +0000"  >&lt;p&gt;@carl, you can go ahead comment, huai will address them in a sperate diff. &lt;/p&gt;</comment>
                            <comment id="13496529" author="he yongqiang" created="Tue, 13 Nov 2012 20:49:53 +0000"  >&lt;p&gt;@Carl, keep in mind that you already months of time to comment. So maybe addressing your comments in new jiras will make more sense.&lt;/p&gt;</comment>
                            <comment id="13496658" author="cwsteinbach" created="Tue, 13 Nov 2012 23:17:00 +0000"  >&lt;p&gt;@Yongqiang: Please hold off on committing this for a day. Thanks.&lt;/p&gt;</comment>
                            <comment id="13496697" author="he yongqiang" created="Wed, 14 Nov 2012 00:09:14 +0000"  >&lt;p&gt;okay, i will target commit it this weekend or earlier next week.&lt;/p&gt;</comment>
                            <comment id="13496701" author="cwsteinbach" created="Wed, 14 Nov 2012 00:14:20 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13497756" author="namit" created="Thu, 15 Nov 2012 04:42:23 +0000"  >&lt;p&gt;It would be a good idea to get &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3671&quot; title=&quot;If a query has been optimized by correlation optimizer, join auto convert cannot optimize it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3671&quot;&gt;&lt;del&gt;HIVE-3671&lt;/del&gt;&lt;/a&gt; in this patch.&lt;br/&gt;
With &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3671&quot; title=&quot;If a query has been optimized by correlation optimizer, join auto convert cannot optimize it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3671&quot;&gt;&lt;del&gt;HIVE-3671&lt;/del&gt;&lt;/a&gt;, the functionality will be much more useful to the whole community.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;Yin Huai&lt;/a&gt;, can you investigate getting &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3671&quot; title=&quot;If a query has been optimized by correlation optimizer, join auto convert cannot optimize it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3671&quot;&gt;&lt;del&gt;HIVE-3671&lt;/del&gt;&lt;/a&gt; as part of this patch, and see how much&lt;br/&gt;
work is it ? Based on that, we can proceed.&lt;/p&gt;</comment>
                            <comment id="13499858" author="yhuai" created="Sun, 18 Nov 2012 17:57:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=namit&quot; class=&quot;user-hover&quot; rel=&quot;namit&quot;&gt;Namit Jain&lt;/a&gt;&lt;br/&gt;
Sure. I just took a look at the code. Seems that once I get all content summaries of input table, I can make the guess on if join auto resolver will work for join operators on input tables. Because, as far as I know, existing util functions on retrieving content summaries (called after logical optimization) cannot be used directly at here, I need to write some util functions to get sizes of input tables. I will start to work on this asap. Also, although &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3671&quot; title=&quot;If a query has been optimized by correlation optimizer, join auto convert cannot optimize it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3671&quot;&gt;&lt;del&gt;HIVE-3671&lt;/del&gt;&lt;/a&gt; seems not hard to do, but it is not a quick fix. I suggest we track this work in a separate jira.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cwsteinbach&quot; class=&quot;user-hover&quot; rel=&quot;cwsteinbach&quot;&gt;Carl Steinbach&lt;/a&gt;&lt;br/&gt;
Have you got time to look at current patch? Any comment?&lt;/p&gt;</comment>
                            <comment id="13500469" author="cwsteinbach" created="Mon, 19 Nov 2012 18:28:08 +0000"  >&lt;p&gt;@Yin: The correlation optimizer is only enabled for a small set of new CliDriver tests. If I enable the correlation optimizer by default, which of the existing CliDriver tests are expected to fail?&lt;/p&gt;</comment>
                            <comment id="13500474" author="david.inbar@pervasive.com" created="Mon, 19 Nov 2012 18:31:57 +0000"  >&lt;p&gt;I will be on vacation through Friday Nov 23rd, but will be checking email and voicemail periodically.&lt;/p&gt;

&lt;p&gt;For all time-critical items, please call my mobile phone.&lt;/p&gt;

&lt;p&gt;Many thanks,&lt;br/&gt;
David&lt;/p&gt;

&lt;p&gt;NOTICE: All information in and attached to this email may be proprietary, confidential, privileged and otherwise protected from improper or erroneous disclosure. If you are not the sender&apos;s intended recipient, you are not authorized to intercept, read, print, retain, copy, forward, or disseminate this message.&lt;/p&gt;
</comment>
                            <comment id="13500499" author="yhuai" created="Mon, 19 Nov 2012 18:50:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cwsteinbach&quot; class=&quot;user-hover&quot; rel=&quot;cwsteinbach&quot;&gt;Carl Steinbach&lt;/a&gt;&lt;br/&gt;
If the optimizer is enabled by default, based on my last tests, only auto_join26.q is expected to fail, because it will be optimized by correlation optimizer. But, except the query plan, the query result of auto_join26.q is correct. Also, once I finished &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3671&quot; title=&quot;If a query has been optimized by correlation optimizer, join auto convert cannot optimize it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3671&quot;&gt;&lt;del&gt;HIVE-3671&lt;/del&gt;&lt;/a&gt; (I am working on it right now), the failure of auto_join26.q should be eliminated.&lt;/p&gt;</comment>
                            <comment id="13500585" author="yhuai" created="Mon, 19 Nov 2012 19:58:52 +0000"  >&lt;p&gt;I just integrate &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3671&quot; title=&quot;If a query has been optimized by correlation optimizer, join auto convert cannot optimize it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3671&quot;&gt;&lt;del&gt;HIVE-3671&lt;/del&gt;&lt;/a&gt; into this patch. At the beginning of correlation optimizer, it will predict if a join operator will be converted by CommonJoinResolver, if so, correlation optimizer will annotate this join operator and in the future optimization, ignore this operator. The prediction can only be made to those join operators the input tables of which are not intermediate tables. The method of the prediction is ported from CommonJoinResolver. Also, a test is added in correlationoptimizer1.q&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=namit&quot; class=&quot;user-hover&quot; rel=&quot;namit&quot;&gt;Namit Jain&lt;/a&gt;&lt;br/&gt;
Please take a look at this patch. Let me know if you have any comment.&lt;/p&gt;</comment>
                            <comment id="13500626" author="cwsteinbach" created="Mon, 19 Nov 2012 20:28:18 +0000"  >&lt;p&gt;I&apos;m surprised that auto_join26 is the only test that fails due to different EXPLAIN output. Is that because this optimization doesn&apos;t affect the queries in most tests, or because we don&apos;t consistently call EXPLAIN in the tests?&lt;/p&gt;

&lt;p&gt;What is preventing us from enabling this by default right now?&lt;/p&gt;</comment>
                            <comment id="13500651" author="yhuai" created="Mon, 19 Nov 2012 21:03:09 +0000"  >&lt;p&gt;I have not looked at test queries in details, but as far as I can tell, most queries in test cases are simple queries, e.g. queries which do not have sub-queries. Also, there are a few queries which involve correlations, but my current implementation does not cover those cases. For example, current optimizer will not try to optimize cases involving MapJoin or self-join. We can make this optimizer support more cases in future.&lt;/p&gt;</comment>
                            <comment id="13505495" author="yhuai" created="Wed, 28 Nov 2012 14:37:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cwsteinbach&quot; class=&quot;user-hover&quot; rel=&quot;cwsteinbach&quot;&gt;Carl Steinbach&lt;/a&gt; I am not sure if unit tests in Hive are comprehensive enough. If not, it might be better that we turn on this optimizer by default in future after we can use more queries to test it.&lt;/p&gt;

&lt;p&gt;I just tested all unit tests with an enabled correlation optimizer. Because, if map side aggregation is on, correlation optimizer also requires regular reduce side aggregation to be generated, if &quot;cube&quot; or &quot;rollup&quot; is used in the query, error message 10209 (org.apache.hadoop.hive.ql.ErrorMsg.HIVE_GROUPING_SETS_AGGR_NOMAPAGGR) will be thrown. Seems &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3508&quot; title=&quot;create cube and rollup operators in hive without mapside aggregation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3508&quot;&gt;HIVE-3508&lt;/a&gt; can solve this issue. Except this issue, a few query plans need to be re-generated because of changing operator ids.&lt;/p&gt;

&lt;p&gt;This jira has taken a long time. Can we wrap it up and I will start to work on follow-up jiras.&lt;/p&gt;</comment>
                            <comment id="13545984" author="liuzongquan" created="Mon, 7 Jan 2013 15:59:23 +0000"  >&lt;p&gt;If I plan to merge &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; into the hive source code, which branch should I use? Can someone tell me?&lt;/p&gt;</comment>
                            <comment id="13546150" author="yhuai" created="Mon, 7 Jan 2013 18:55:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liuzongquan&quot; class=&quot;user-hover&quot; rel=&quot;liuzongquan&quot;&gt;Liu Zongquan&lt;/a&gt; The latest patch was developed based on hive trunk revision 1410581.&lt;/p&gt;</comment>
                            <comment id="13547982" author="hudson" created="Wed, 9 Jan 2013 10:23:50 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;:add a new optimizer for query correlation discovery and optimization (Yin Huai via He Yongqiang) (Revision 1392105)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
heyongqiang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1392105&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1392105&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/BaseReduceSinkOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationCompositeOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/CorrelationOptimizerUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/BaseReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationCompositeDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby1.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby2.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby5.q.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13548809" author="liuzongquan" created="Wed, 9 Jan 2013 18:44:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;Yin Huai&lt;/a&gt; Thanks so much!&lt;/p&gt;</comment>
                            <comment id="13549298" author="ashutoshc" created="Thu, 10 Jan 2013 02:27:30 +0000"  >&lt;p&gt;This patch looks useful, especially since once we have this in, it will open up other optimization possibilities. I have left some comment on &lt;a href=&quot;https://reviews.apache.org/r/7126/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/7126/&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="13549301" author="ashutoshc" created="Thu, 10 Jan 2013 02:30:06 +0000"  >&lt;p&gt;Also, can this work enable or facilitate implementation of optimization which is getting discussed on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3773&quot; title=&quot;Share input scan by unions across multiple queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3773&quot;&gt;HIVE-3773&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="13549321" author="yhuai" created="Thu, 10 Jan 2013 02:53:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;Ashutosh Chauhan&lt;/a&gt; Yes. We can extend correlation optimizer to optimize shared scans. Since shared scans can be considered as a kind of &quot;correlation&quot;, I think it will be good to optimize those cases in correlation optimizer. Also, thanks for your comments. I will address those asap.&lt;/p&gt;</comment>
                            <comment id="13552281" author="liuzongquan" created="Sun, 13 Jan 2013 19:16:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;Yin Huai&lt;/a&gt; I have a question that why not release a patch upon a stable hive release, e.g,branch hive-0.8-r2. Actually I found that the r1410581 is not a stable revision and even I can&apos;t run through &quot;ant test -Dtestcase=TestCliDriver -Dqfile=show_functions.q -Doverwrite=true&quot; on this revision. So, if this patch is based on a stable version, espectially a stable branch, then your honor work will benefit more people. Even so ,just a suggestion. &lt;/p&gt;</comment>
                            <comment id="13552282" author="david.inbar@pervasive.com" created="Sun, 13 Jan 2013 19:20:11 +0000"  >&lt;p&gt;I will be on vacation through January 14th, but will be checking email and voicemail periodically.&lt;/p&gt;

&lt;p&gt;For all time-critical items, please call my mobile phone.&lt;/p&gt;

&lt;p&gt;Many thanks,&lt;br/&gt;
David&lt;/p&gt;

&lt;p&gt;NOTICE: All information in and attached to this email may be proprietary, confidential, privileged and otherwise protected from improper or erroneous disclosure. If you are not the sender&apos;s intended recipient, you are not authorized to intercept, read, print, retain, copy, forward, or disseminate this message.&lt;/p&gt;
</comment>
                            <comment id="13552290" author="ashutoshc" created="Sun, 13 Jan 2013 19:37:11 +0000"  >&lt;p&gt;If Yin wants to provide a patch against a stable (or any) branch, thats his choice. But, for patch to get committed it needs to get committed on trunk first.&lt;/p&gt;</comment>
                            <comment id="13554712" author="ashutoshc" created="Wed, 16 Jan 2013 03:46:27 +0000"  >&lt;p&gt;I did some testing of this on our use-cases. Lets say you have two tables:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table t1 (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
create table t2 (c &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, d &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
select a from ( select * from t1 join t2 on (t1.a = t2.c) )e group by a;
select a from ( select&lt;span class=&quot;code-comment&quot;&gt;/*+ MAPJOIN(t2) */&lt;/span&gt; * from t1 join t2 on (t1.a = t2.c) )e group by a;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, ysmart is able to optimize first query fine, where it fuses 2MR jobs in 1 MR, since join and group-by has same key. &lt;br/&gt;
However this doesn&apos;t work with 2nd query which has mapjoin. This results in 2 MR job. This is especially important since in map-join case you don&apos;t need the condition of join-key being same as groupby key, which is &lt;b&gt;very&lt;/b&gt; important. In our use-cases, we have observed its rarely the case that join and group-by is on same key. But, in most cases we are able to utilize map-join, since data which we are joining on is small enough. And than subsequent group-by which is on different key can happen on the reduce side of this single MR job.&lt;br/&gt;
Any thoughts on how this could be achieved ? &lt;br/&gt;
Though, it looks like for this use-case we don&apos;t need ysmart since we don&apos;t need to detect any correlation. We can walk on query plan and can always fuse map-side join followed by group-by (i.e., no need to detect any correlation among inputs or to detect whether join and group-by keys are same).&lt;/p&gt;</comment>
                            <comment id="13555155" author="yhuai" created="Wed, 16 Jan 2013 16:01:53 +0000"  >&lt;p&gt;So, if a Map join is involved in a plan and the output of this join will be consumed by another subsequent operator, we should leave the Map join in the Map phase of the subsequent operator instead of cutting Map join to a separate MR job. Is my understanding correct? If so, I think that we should change the process on generating Map join Operators. After generating a Map join operator, we do not insert a FileSinkOperator after the Map Join. Seems that Rule 11 in org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genMapRedTasks is the rule for generating a separate MR job for a Map Join.&lt;/p&gt;</comment>
                            <comment id="13555368" author="yhuai" created="Wed, 16 Jan 2013 19:29:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;Ashutosh Chauhan&lt;/a&gt; The only thing I have not addressed is cloning the plan at the beginning of optimization work. Seems that we only can clone a part of the query plan tree. If we backup only a part of the query plan tree, I think it is the same as the current patch (described below), since in this way, we still need to link the backup part to other parts if correlation optimizer cannot optimize the given query. &lt;/p&gt;

&lt;p&gt;In my patch, the original plan tree will be changed to a version without map-side aggregations, firstly. This version of the plan tree will be only changed if there is any correlation detected and new merged Map-side plan and reduce side dispatch have been successfully generated (this query can be optimized). If optimizer cannot optimize this plan, it will change the plan back to the original one. &lt;/p&gt;

&lt;p&gt;Any suggestion on how to address this issue? Or, did I miss any thing which can facilitate the cloning work? I think it will be great if we can clone a ParseContext, so if a optimization is failed, we still have a copy of the original plan.&lt;/p&gt;</comment>
                            <comment id="13555491" author="ashutoshc" created="Wed, 16 Jan 2013 21:38:53 +0000"  >&lt;p&gt;I ran my tests with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3784&quot; title=&quot;de-emphasize mapjoin hint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3784&quot;&gt;&lt;del&gt;HIVE-3784&lt;/del&gt;&lt;/a&gt; and I got a single MR job for my query (i.e., mapjoin followed by group-by on different keys) gets you a single MR job. Thats cool.&lt;/p&gt;</comment>
                            <comment id="13557411" author="ashutoshc" created="Fri, 18 Jan 2013 18:07:38 +0000"  >&lt;p&gt;I am having second thoughts on cloning. Cloning graphs (like query plan) or dense structures (like ParseContext) is fraught with perils. Its likely that cloning will require new code and arguably have hard to detect bugs, since we need to track down every single pointer and clone all the way through. I think to avoid such issues and for simplicity, we can drop the cloning idea. The feature is anyway behind the config option which is off default, so query-plan will be modified only for the users who turn the flag on. &lt;br/&gt;
Yin, if you have addressed my other comments, can you update the patch on RB and upload here on jira, I will take another look at it.&lt;/p&gt;</comment>
                            <comment id="13557416" author="ashutoshc" created="Fri, 18 Jan 2013 18:09:58 +0000"  >&lt;p&gt;Oh.. I see that you have already updated RB and jira. I will take a look at it soon.&lt;/p&gt;</comment>
                            <comment id="13575844" author="yhuai" created="Mon, 11 Feb 2013 15:39:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;Ashutosh Chauhan&lt;/a&gt; have you got a time to look at the patch?&lt;/p&gt;</comment>
                            <comment id="13675536" author="phabricator@reviews.facebook.net" created="Wed, 5 Jun 2013 02:27:20 +0000"  >&lt;p&gt;yhuai requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;update test results&lt;/p&gt;

&lt;p&gt;This issue proposes a new logical optimizer called Correlation Optimizer, which is used to merge correlated MapReduce jobs (MR jobs) into a single MR job. The idea is based on YSmart (&lt;a href=&quot;http://ysmart.cse.ohio-state.edu/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ysmart.cse.ohio-state.edu/&lt;/a&gt;). The paper and slides of YSmart are linked at the bottom.&lt;/p&gt;

&lt;p&gt;Since Hive translates queries in a sentence by sentence fashion, for every operation which may need to shuffle the data (e.g. join and aggregation operations), Hive will generate a MapReduce job for that operation. However, for those operations which may need to shuffle the data, they may involve correlations explained below and thus can be executed in a single MR job.&lt;/p&gt;

&lt;p&gt;	Input Correlation: Multiple MR jobs have input correlation (IC) if their input relation sets are not disjoint;&lt;br/&gt;
	Transit Correlation: Multiple MR jobs have transit correlation (TC) if they have not only input correlation, but also the same partition key;&lt;br/&gt;
	Job Flow Correlation: An MR has job &#64258;ow correlation (JFC) with one of its child nodes if it has the same partition key as that child node.&lt;/p&gt;

&lt;p&gt;The current implementation of correlation optimizer only detect correlations among MR jobs for reduce-side join operators and reduce-side aggregation operators (not map only aggregation). A query will be optimized if it satisfies following conditions.&lt;/p&gt;

&lt;p&gt;	There exists a MR job for reduce-side join operator or reduce side aggregation operator which have JFC with all of its parents MR jobs (TCs will be also exploited if JFC exists);&lt;br/&gt;
	All input tables of those correlated MR job are original input tables (not intermediate tables generated by sub-queries); and&lt;br/&gt;
	No self join is involved in those correlated MR jobs.&lt;/p&gt;

&lt;p&gt;Correlation optimizer is implemented as a logical optimizer. The main reasons are that it only needs to manipulate the query plan tree and it can leverage the existing component on generating MR jobs.&lt;/p&gt;

&lt;p&gt;Current implementation can serve as a framework for correlation related optimizations. I think that it is better than adding individual optimizers.&lt;/p&gt;

&lt;p&gt;There are several work that can be done in future to improve this optimizer. Here are three examples.&lt;/p&gt;

&lt;p&gt;	Support queries only involve TC;&lt;br/&gt;
	Support queries in which input tables of correlated MR jobs involves intermediate tables; and&lt;br/&gt;
	Optimize queries involving self join.&lt;/p&gt;

&lt;p&gt;References:&lt;br/&gt;
Paper and presentation of YSmart.&lt;br/&gt;
Paper: &lt;a href=&quot;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&lt;/a&gt;&lt;br/&gt;
Slides: &lt;a href=&quot;http://sdrv.ms/UpwJJc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://sdrv.ms/UpwJJc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;/p&gt;

&lt;p&gt;MANAGE HERALD RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/26439/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/26439/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;/p&gt;</comment>
                            <comment id="13675569" author="yhuai" created="Wed, 5 Jun 2013 03:44:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.D11097.1.patch is the latest patch for the trunk. I have heavily refactored my code. Here are major changes.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If multiple operation paths share the same input table, I just use a single TableScanOperator and add the bottom operators of these paths as children of this common TableScanOperator. I do not do any deduplication of common columns because deduplication will significantly make the code more complicated and may introduce more problems. If we want to do deduplication, I suggest to tackle it later in a followup work.&lt;/li&gt;
	&lt;li&gt;Without deduplicating columns, the dispatcher at the reduce side has less work to do and some queries involving self join can be optimized in the current version.&lt;/li&gt;
	&lt;li&gt;The fake ReduceSinkOperator (CorrelationLocalSimulativeReduceSinkOperator... I will change the name later) does not do serialization and deserialization as appearing in the previous one.&lt;/li&gt;
	&lt;li&gt;New test cases are added.&lt;/li&gt;
	&lt;li&gt;I also refactor the code ReduceSinkDeDupplication since CorrelationOptimizer can reuse some methods introduced by ReduceSinkDeDupplication. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;Navis&lt;/a&gt; can you take a look at it and see if my changes make sense?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I will run all unit tests soon and will also add more comments.&lt;/p&gt;

&lt;p&gt;btw, there is a issue in correlationoptimizer2.q. Optimized plans cannot generate rows that both join keys (from the left table and right table) are null values for outer joins. I am looking at it&lt;/p&gt;</comment>
                            <comment id="13676441" author="ashutoshc" created="Wed, 5 Jun 2013 22:34:33 +0000"  >&lt;p&gt;In your testcases, some of the patterns you have (e.g., like Join followed by GBY) on same keys, I assume reducesink reduplication optimization will already take care of it such that it will generate only 1 MR job. Is that correct? Is it that for all of your testcases reducesink dedup optimization will not fire. If its former, than it will be good to identify which of those cases are already taken care by RS dedup. If its latter, than it will be good to know why reducesink dedup optimization is not kicking in for those.&lt;/p&gt;</comment>
                            <comment id="13676462" author="yhuai" created="Wed, 5 Jun 2013 23:14:56 +0000"  >&lt;p&gt;RS dedup is on by default. So the explain without CorrelationOptimizer should be optimized by RS dedup. But, seems that it does not fire in any of my cases. Will take a look at it later.&lt;/p&gt;</comment>
                            <comment id="13676643" author="yhuai" created="Thu, 6 Jun 2013 03:36:34 +0000"  >&lt;p&gt;Just found I need to set false for both hive.auto.convert.join and hive.auto.convert.join.noconditionaltask to let RS dedup to work on cases with join. I just tried two cases. It works on &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; x.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;(1) &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; cnt &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; src1 x &lt;span class=&quot;code-keyword&quot;&gt;JOIN&lt;/span&gt; src y &lt;span class=&quot;code-keyword&quot;&gt;ON&lt;/span&gt; (x.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; = y.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; x.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, and it does work on&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT xx.key, xx.cnt, yy.key, yy.cnt
FROM
(SELECT x.a as key, count(*) AS cnt FROM src x group by x.a) xx
JOIN
(SELECT y.a as key, count(*) AS cnt FROM src1 y group by y.a) yy
ON (xx.key=yy.key);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suggest that we let CorrelationOptimizer to handle cases involving join because it supports more cases and has included needed mechanisms.&lt;/p&gt;</comment>
                            <comment id="13677379" author="phabricator@reviews.facebook.net" created="Thu, 6 Jun 2013 18:58:20 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Refactoring&lt;/li&gt;
	&lt;li&gt;Merge branch &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Refactoring&apos; of &lt;a href=&quot;https://github.com/yhuai/hive&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/yhuai/hive&lt;/a&gt; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Refactoring&lt;/li&gt;
	&lt;li&gt;end group is not called correctly&lt;/li&gt;
	&lt;li&gt;reorganize testcases&lt;/li&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Refactoring&lt;/li&gt;
	&lt;li&gt;Bug fix. The logic of comparing if a table is not good to be a big table&lt;/li&gt;
	&lt;li&gt;update results&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34293&amp;amp;id=34329#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34293&amp;amp;id=34329#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationLocalSimulativeReduceSinkOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CorrelationReducerDispatchOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationLocalSimulativeReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/CorrelationReducerDispatchDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;/p&gt;</comment>
                            <comment id="13677381" author="yhuai" created="Thu, 6 Jun 2013 19:00:17 +0000"  >&lt;p&gt;update the diff at &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;. Fixed two bugs. All unit test pass when the optimizer is turned off by default. I am evaluating if there is any issue when the optimizer is turned on by default.&lt;/p&gt;</comment>
                            <comment id="13677760" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 02:16:22 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Have fixed bugs I found from unit tests when the optimizer is enabled by default.&lt;br/&gt;
  Also, refactored the code and updated test results.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34329&amp;amp;id=34383#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34329&amp;amp;id=34383#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;/p&gt;</comment>
                            <comment id="13677762" author="yhuai" created="Fri, 7 Jun 2013 02:18:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;.D11097.3.patch is the latest patch. I have fixed bugs found in unit tests when the optimizer is enabled by default. The patch is ready for review. &lt;/p&gt;</comment>
                            <comment id="13677770" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 02:36:20 +0000"  >&lt;p&gt;brock has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  I was just casually reading this patch and noted a few items.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java:1088 If we are throwing the exception do we need to print the exception? Also, this should be logged not printed.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java:61 We should be returning list of collection not arraylist no? There are a few other occurrences of this.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13677791" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 03:50:21 +0000"  >&lt;p&gt;yhuai has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java:1088 Did not notice it before. I copied the code of closeOp. I do not think we need to print the exception. I will change this class. Also, seems printing the exception also appear in lots of other places. If we want to need to remove all of them, we need a separate jira.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java:61 MuxOperator is used to replace ReduceSinkOperators in an MR job optimized by this optimizer. I basically follow the code of ReduceSinkDesc. Seems the reason that ArrayList is used is for clone. I will leave ArrayList at here right now.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13678116" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 16:22:20 +0000"  >&lt;p&gt;brock has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java:61 Looks like it&apos;s there because ArrayList defines a clone() method.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java:1088 I agree that hive does this often. I don&apos;t mean to suggest you should fix this in all of hive in the patch but let&apos;s not add any additional printStackTraces. I see one additional new printStackTrace in your patch. Would you mind removing that one as well?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13678156" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 17:00:25 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  address brock&apos;s comments&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34383&amp;amp;id=34401#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34383&amp;amp;id=34401#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13678192" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 17:38:21 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;check isTraceEnabled before constructing a trace message&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34401&amp;amp;id=34413#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34401&amp;amp;id=34413#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13681530" author="phabricator@reviews.facebook.net" created="Wed, 12 Jun 2013 19:15:20 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fix the mechanism of processing a key group&lt;/li&gt;
	&lt;li&gt;bug fix&lt;/li&gt;
	&lt;li&gt;refactoring code. make output of optimized plans deterministic. add new&lt;/li&gt;
	&lt;li&gt;use spaces for indentation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34413&amp;amp;id=34623#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34413&amp;amp;id=34623#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13681791" author="phabricator@reviews.facebook.net" created="Thu, 13 Jun 2013 00:19:20 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Improvement&lt;/li&gt;
	&lt;li&gt;make optimized plans deterministic&lt;/li&gt;
	&lt;li&gt;add a new test and update results&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34623&amp;amp;id=34653#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34623&amp;amp;id=34653#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13684570" author="phabricator@reviews.facebook.net" created="Sun, 16 Jun 2013 04:33:21 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;    All tests pass&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new tests&lt;/li&gt;
	&lt;li&gt;Fix a bug related to UnionOperator;&lt;/li&gt;
	&lt;li&gt;wip&lt;/li&gt;
	&lt;li&gt;more comments in tests&lt;/li&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Improvement&lt;/li&gt;
	&lt;li&gt;update comments&lt;/li&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Improvement&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34653&amp;amp;id=34791#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34653&amp;amp;id=34791#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13687197" author="phabricator@reviews.facebook.net" created="Tue, 18 Jun 2013 21:05:20 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;    a few minor updates&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add new tests&lt;/li&gt;
	&lt;li&gt;remove unused methods&lt;/li&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Improvement&lt;/li&gt;
	&lt;li&gt;add Apache license header&lt;/li&gt;
	&lt;li&gt;evaluate if this operator is UnionOperator first&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34791&amp;amp;id=34869#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34791&amp;amp;id=34869#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13690893" author="phabricator@reviews.facebook.net" created="Fri, 21 Jun 2013 23:33:20 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fix bugs related to (1) semi join and (2) multiple join and the DemuxOperator directly connects to a MuxOperator&lt;/li&gt;
	&lt;li&gt;update&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=34869&amp;amp;id=35055#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=34869&amp;amp;id=35055#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13694504" author="phabricator@reviews.facebook.net" created="Thu, 27 Jun 2013 05:31:21 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  I tested all unit tests before the commit of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4496&quot; title=&quot;JDBC2 won&amp;#39;t compile with JDK7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4496&quot;&gt;&lt;del&gt;HIVE-4496&lt;/del&gt;&lt;/a&gt;. all unit tests pass&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35055&amp;amp;id=35181#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35055&amp;amp;id=35181#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build-common.xml&lt;br/&gt;
  data/files/leftsemijoin_mr_t1.txt&lt;br/&gt;
  data/files/leftsemijoin_mr_t2.txt&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/JoinOperator.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/leftsemijoin_mr.q&lt;br/&gt;
  ql/src/test/results/clientpositive/leftsemijoin_mr.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13694506" author="phabricator@reviews.facebook.net" created="Thu, 27 Jun 2013 05:37:21 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  My last diff was for 4718...&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35181&amp;amp;id=35193#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35181&amp;amp;id=35193#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13695951" author="phabricator@reviews.facebook.net" created="Sat, 29 Jun 2013 00:05:22 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Handle partitioned tables&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35193&amp;amp;id=35223#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35193&amp;amp;id=35223#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ExprNodeConstantDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13697242" author="phabricator@reviews.facebook.net" created="Mon, 1 Jul 2013 22:02:21 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Improvement&lt;/li&gt;
	&lt;li&gt;update test cases&lt;/li&gt;
	&lt;li&gt;refactoring.&lt;/li&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-Improvement&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35223&amp;amp;id=35265#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35223&amp;amp;id=35265#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13698113" author="phabricator@reviews.facebook.net" created="Tue, 2 Jul 2013 19:12:21 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Correlation optimizer currently does not support PTF operator&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35265&amp;amp;id=35283#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35265&amp;amp;id=35283#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer12.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13698115" author="shane.pratt@actian.com" created="Tue, 2 Jul 2013 19:16:21 +0000"  >&lt;p&gt;Thank you for your message.&lt;/p&gt;

&lt;p&gt;I am out of the office on vacation for the remainder of the week.  If this is an emergency, please call me at the number below.&lt;/p&gt;

&lt;p&gt;Otherwise, I&apos;ll respond to your message when I return.&lt;/p&gt;

&lt;p&gt;Shane&lt;br/&gt;
512-590-3925&lt;/p&gt;

</comment>
                            <comment id="13702610" author="phabricator@reviews.facebook.net" created="Mon, 8 Jul 2013 23:21:46 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;update test cases&lt;/li&gt;
	&lt;li&gt;refactor code&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35283&amp;amp;id=35487#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35283&amp;amp;id=35487#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer12.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer13.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer14.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer13.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13707324" author="phabricator@reviews.facebook.net" created="Fri, 12 Jul 2013 20:15:47 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Since hive already uses a single scan for a table with multiple aliases in a MR job, we can remove unnecessary code on merging TableScanOperators&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35487&amp;amp;id=35661#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35487&amp;amp;id=35661#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer12.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer13.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer14.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer13.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13708141" author="phabricator@reviews.facebook.net" created="Sun, 14 Jul 2013 22:38:47 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-20130711&lt;/li&gt;
	&lt;li&gt;Left semi join should be handled in analyzeReduceSinkOperatorsOfJoinOperator. Also, use instanceof instead of using the operator&apos;s name to check the type of an Operator.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35661&amp;amp;id=35721#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35661&amp;amp;id=35721#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer12.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer13.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer14.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer13.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13710219" author="phabricator@reviews.facebook.net" created="Tue, 16 Jul 2013 20:56:47 +0000"  >&lt;p&gt;ashutoshc has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Minor comments, mostly around improving documentation in code.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java:334 Does this patch makes this necessary? Or, you added it just for completeness?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:114 Better to do it as List&amp;lt;Object&amp;gt; thisRow = (List&amp;lt;Object&amp;gt;) row;&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:137 Will be good to add comments for all these maps. What mappings they are tracking?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:150 Will be good to add some ascii art showing an example of such a plan.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java:710 Is this necessary?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:41 I understand this but it will be confusing for someone reading this comment for first time because before this patch RS operator is always in map side. We need to reword this so its easier to read.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:135 Can you add a comment when this boolean will be true and when it will be false.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:222 Lets throw an exception here. if (childOperatorsArray.length != 1) throw new HiveException (&quot;Expected number of children is 1. Found : &quot; + childOperatorsArray.length)&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java:180 This should not be required. You can always get all the values of enum by using valueOf() method on enum.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java:229 It will be good to add javadoc for this explaining why we should leave it as it is?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java:45 It will be good to add javadoc for this class.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-20130711&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13710227" author="shane.pratt@actian.com" created="Tue, 16 Jul 2013 20:58:46 +0000"  >&lt;p&gt;Thank you for your message.&lt;/p&gt;

&lt;p&gt;I will be traveling the next several days so there may be a delay in my response to your email.&lt;/p&gt;

&lt;p&gt;If you need to reach me now, please call the number below.  Otherwise, I will respond to you as soon as I can.&lt;/p&gt;


&lt;p&gt;Shane&lt;br/&gt;
512-590-3925&lt;/p&gt;

</comment>
                            <comment id="13710608" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 02:00:48 +0000"  >&lt;p&gt;ashutoshc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Few more comments. See which of these apply. If they doesn&apos;t apply, feel free to ignore.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:250 What does this function do?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:171 Will be good to add comment stating when table == null&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:153 It seems like lot of logic here is shared with CommonJoinTaskDispatcher. It will be good to have that refactored so that its reusable here.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:284 Seems like this method always return true. So, this is not required.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:271 Add a comment saying that tree walking is done and now you will apply transformations which you have detected.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:590 Do we really need hasBeenRemoved() check?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:597 getKeyCols().size() is not a good check. I will recommend to test explictly for operators which we are supporting right now.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:630 Do we still need this?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:647 We should do jobFlowCorrelation as another pass in transform().&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:526 It will be good to add some ascii art which shows what tree structure we are returning from this function.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:368 It will good to add javadoc for this method.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:453 Didn&apos;t understand this comment. Probably we can word it better.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:61 I dont think we need to revert to oldTag here. We can keep using newTag.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:59-60 Doesnt look like you are using these OIs. Probably we can get rid of these.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:174 It will be good to add comments for whats the intent of this for loop.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:182 Why is it called NumOriginalParents? can it be just numOfParents&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:93 There is already a forward in Demux, this should not be needed.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:75 You dont need this constructor&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java:83 Looks like this map is not used anymore, lets get rid of this.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java:79 It will be good to add comments about what this method is intending to do&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java:67 This method straight away calls another method. We can eliminate this one.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-20130711&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13710687" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 04:52:47 +0000"  >&lt;p&gt;yhuai has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Add an explanation on startGroup. Will start to address the rest of comments tomorrow.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java:334 Since we can have a operator tree with multiple JoinOperators and GroupByOperators inside, we need to propagate the startGroup to all operators in the operator tree. For queries which are not optimized by this patch, we can have at most 1 JoinOperator (at the beginning of the reduce-side) and 2 GroupByOperators (1 at the beginning of the reduce-side one and 1 hash mode one just before FileSinkOperator). This change will not affect those operators.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java:710 Please see my reply to the same change made in CommonJoinOperator&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java:180 Seems an enum does not have a method to return a list of values with the type of string.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-20130711&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13711305" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 17:18:47 +0000"  >&lt;p&gt;yhuai has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Have addressed some comments. Will address the rest of comments later.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:59-60 These OIs are not needed. I have removed them.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:61 JoinOperators relies on the tag to function correctly.  I will add comment to explain why we need revert the newTag to oldTag.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:114 Done.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:137 Done.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:150 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java:174 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:41 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:75 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:93 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:135 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:182 Yes, I have changed it to numParents = getNumParent();&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java:222 Done. Since there is another check in initializeOp, I will throw the exception at there.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java:229 Done&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-20130711&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13711556" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 20:12:46 +0000"  >&lt;p&gt;yhuai has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Another check point. Will finish soon and generate new patch&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:250 this function is not needed. I have deleted it.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:271 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:284 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:368 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:453 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:526 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:590 it is not used. I have deleted it.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:597 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:630 I have deleted it.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:647 I have deleted it. We can extend the scope of this optimizer in a follow-up jira.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java:45 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java:67 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java:79 Done&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java:83 Done&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-20130711&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13711617" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 21:00:47 +0000"  >&lt;p&gt;yhuai has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:171 table should not be null at here. I will throw an exception when we have &quot;table==null&quot;&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java:153 Since CommonJoinTaskDispatcher is in the phase of physical optimization, seems that we cannot refactor this part of code in an easy way. I suggest refactoring it in a follow-up jira.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-20130711&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13711695" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 22:02:47 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;address Ashutosh&apos;s comments&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35721&amp;amp;id=35841#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35721&amp;amp;id=35841#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  conf/hive-default.xml.template&lt;br/&gt;
  ql/if/queryplan.thrift&lt;br/&gt;
  ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer12.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer13.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer14.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer13.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby2.q.xml&lt;br/&gt;
  ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13711700" author="yhuai" created="Wed, 17 Jul 2013 22:06:17 +0000"  >&lt;p&gt;address Ashutosh&apos;s comments&lt;/p&gt;</comment>
                            <comment id="13711766" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 22:52:47 +0000"  >&lt;p&gt;ashutoshc has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  +1 Awesome work, Yin!&lt;br/&gt;
  Beautiful ascii art too : ) Finally some great comments in code. : )&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt;-3671-20130716&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13711888" author="yhuai" created="Thu, 18 Jul 2013 01:03:38 +0000"  >&lt;p&gt;try to trigger the precommit test.&lt;/p&gt;</comment>
                            <comment id="13712037" author="hiveqa" created="Thu, 18 Jul 2013 05:42:02 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12592900/HIVE-2206.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12592900/HIVE-2206.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 all tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/71/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/71/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/71/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/71/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;br/&gt;
Executing org.apache.hive.ptest.execution.CleanupPhase&lt;br/&gt;
Executing org.apache.hive.ptest.execution.PrepPhase&lt;br/&gt;
Executing org.apache.hive.ptest.execution.ExecutionPhase&lt;br/&gt;
Executing org.apache.hive.ptest.execution.ReportingPhase&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13712046" author="appodictic" created="Thu, 18 Jul 2013 06:07:10 +0000"  >&lt;p&gt;Ok this patch has been +1 multiple times. Was even +1 a year ago. Can we commit now? I would hate to have to see Yin rebase again.&lt;/p&gt;</comment>
                            <comment id="13712153" author="ashutoshc" created="Thu, 18 Jul 2013 09:19:59 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Yin!&lt;/p&gt;</comment>
                            <comment id="13712164" author="hagleitn" created="Thu, 18 Jul 2013 09:35:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;Yin Huai&lt;/a&gt; Thanks for sticking with this. This is awesome!&lt;/p&gt;</comment>
                            <comment id="13712239" author="hudson" created="Thu, 18 Jul 2013 11:39:17 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-h0.21 #2205 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2205/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2205/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&lt;br/&gt;
(Yin Huai via Ashutosh Chauhan)&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
update test results&lt;/p&gt;

&lt;p&gt;This issue proposes a new logical optimizer called Correlation Optimizer, which is used to merge correlated MapReduce jobs (MR jobs) into a single MR job. The idea is based on YSmart (&lt;a href=&quot;http://ysmart.cse.ohio-state.edu/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ysmart.cse.ohio-state.edu/&lt;/a&gt;). The paper and slides of YSmart are linked at the bottom.&lt;/p&gt;

&lt;p&gt;Since Hive translates queries in a sentence by sentence fashion, for every operation which may need to shuffle the data (e.g. join and aggregation operations), Hive will generate a MapReduce job for that operation. However, for those operations which may need to shuffle the data, they may involve correlations explained below and thus can be executed in a single MR job.&lt;/p&gt;

&lt;p&gt;	Input Correlation: Multiple MR jobs have input correlation (IC) if their input relation sets are not disjoint;&lt;br/&gt;
	Transit Correlation: Multiple MR jobs have transit correlation (TC) if they have not only input correlation, but also the same partition key;&lt;br/&gt;
	Job Flow Correlation: An MR has job &#64258;ow correlation (JFC) with one of its child nodes if it has the same partition key as that child node.&lt;/p&gt;

&lt;p&gt;The current implementation of correlation optimizer only detect correlations among MR jobs for reduce-side join operators and reduce-side aggregation operators (not map only aggregation). A query will be optimized if it satisfies following conditions.&lt;/p&gt;

&lt;p&gt;	There exists a MR job for reduce-side join operator or reduce side aggregation operator which have JFC with all of its parents MR jobs (TCs will be also exploited if JFC exists);&lt;br/&gt;
	All input tables of those correlated MR job are original input tables (not intermediate tables generated by sub-queries); and&lt;br/&gt;
	No self join is involved in those correlated MR jobs.&lt;/p&gt;

&lt;p&gt;Correlation optimizer is implemented as a logical optimizer. The main reasons are that it only needs to manipulate the query plan tree and it can leverage the existing component on generating MR jobs.&lt;/p&gt;

&lt;p&gt;Current implementation can serve as a framework for correlation related optimizations. I think that it is better than adding individual optimizers.&lt;/p&gt;

&lt;p&gt;There are several work that can be done in future to improve this optimizer. Here are three examples.&lt;/p&gt;

&lt;p&gt;	Support queries only involve TC;&lt;br/&gt;
	Support queries in which input tables of correlated MR jobs involves intermediate tables; and&lt;br/&gt;
	Optimize queries involving self join.&lt;/p&gt;

&lt;p&gt;References:&lt;br/&gt;
Paper and presentation of YSmart.&lt;br/&gt;
Paper: &lt;a href=&quot;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&lt;/a&gt;&lt;br/&gt;
Slides: &lt;a href=&quot;http://sdrv.ms/UpwJJc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://sdrv.ms/UpwJJc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test Plan: EMPTY&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA, ashutoshc&lt;/p&gt;

&lt;p&gt;Reviewed By: ashutoshc&lt;/p&gt;

&lt;p&gt;CC: brock&lt;/p&gt;

&lt;p&gt;Differential Revision: &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt; (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1504395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1504395&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/if/queryplan.thrift&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer12.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer13.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer14.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer12.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer13.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer14.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby2.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13712295" author="brocknoland" created="Thu, 18 Jul 2013 13:09:04 +0000"  >&lt;p&gt;Nice work Yin! This was one hell of an effort!&lt;/p&gt;</comment>
                            <comment id="13712371" author="yhuai" created="Thu, 18 Jul 2013 14:26:59 +0000"  >&lt;p&gt;Thank you, guys!&lt;/p&gt;

&lt;p&gt;Thanks Ashutosh and Gunther for your help! This patch has been improved a lot. I really appreciate your comments and I really enjoy our discussions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13712375" author="appodictic" created="Thu, 18 Jul 2013 14:33:51 +0000"  >&lt;p&gt;Pat yourself on the back and take a well earned rest!   &lt;/p&gt;</comment>
                            <comment id="13712452" author="yhuai" created="Thu, 18 Jul 2013 16:31:27 +0000"  >&lt;p&gt;Thanks Edward&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13712513" author="prasanth_j" created="Thu, 18 Jul 2013 17:15:53 +0000"  >&lt;p&gt;Finally (after 2 yrs) it&apos;s in! Great job &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;Yin Huai&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13712597" author="hudson" created="Thu, 18 Jul 2013 18:19:44 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hive-trunk-hadoop1-ptest #90 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/90/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/90/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&lt;br/&gt;
(Yin Huai via Ashutosh Chauhan)&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
update test results&lt;/p&gt;

&lt;p&gt;This issue proposes a new logical optimizer called Correlation Optimizer, which is used to merge correlated MapReduce jobs (MR jobs) into a single MR job. The idea is based on YSmart (&lt;a href=&quot;http://ysmart.cse.ohio-state.edu/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ysmart.cse.ohio-state.edu/&lt;/a&gt;). The paper and slides of YSmart are linked at the bottom.&lt;/p&gt;

&lt;p&gt;Since Hive translates queries in a sentence by sentence fashion, for every operation which may need to shuffle the data (e.g. join and aggregation operations), Hive will generate a MapReduce job for that operation. However, for those operations which may need to shuffle the data, they may involve correlations explained below and thus can be executed in a single MR job.&lt;/p&gt;

&lt;p&gt;	Input Correlation: Multiple MR jobs have input correlation (IC) if their input relation sets are not disjoint;&lt;br/&gt;
	Transit Correlation: Multiple MR jobs have transit correlation (TC) if they have not only input correlation, but also the same partition key;&lt;br/&gt;
	Job Flow Correlation: An MR has job &#64258;ow correlation (JFC) with one of its child nodes if it has the same partition key as that child node.&lt;/p&gt;

&lt;p&gt;The current implementation of correlation optimizer only detect correlations among MR jobs for reduce-side join operators and reduce-side aggregation operators (not map only aggregation). A query will be optimized if it satisfies following conditions.&lt;/p&gt;

&lt;p&gt;	There exists a MR job for reduce-side join operator or reduce side aggregation operator which have JFC with all of its parents MR jobs (TCs will be also exploited if JFC exists);&lt;br/&gt;
	All input tables of those correlated MR job are original input tables (not intermediate tables generated by sub-queries); and&lt;br/&gt;
	No self join is involved in those correlated MR jobs.&lt;/p&gt;

&lt;p&gt;Correlation optimizer is implemented as a logical optimizer. The main reasons are that it only needs to manipulate the query plan tree and it can leverage the existing component on generating MR jobs.&lt;/p&gt;

&lt;p&gt;Current implementation can serve as a framework for correlation related optimizations. I think that it is better than adding individual optimizers.&lt;/p&gt;

&lt;p&gt;There are several work that can be done in future to improve this optimizer. Here are three examples.&lt;/p&gt;

&lt;p&gt;	Support queries only involve TC;&lt;br/&gt;
	Support queries in which input tables of correlated MR jobs involves intermediate tables; and&lt;br/&gt;
	Optimize queries involving self join.&lt;/p&gt;

&lt;p&gt;References:&lt;br/&gt;
Paper and presentation of YSmart.&lt;br/&gt;
Paper: &lt;a href=&quot;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&lt;/a&gt;&lt;br/&gt;
Slides: &lt;a href=&quot;http://sdrv.ms/UpwJJc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://sdrv.ms/UpwJJc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test Plan: EMPTY&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA, ashutoshc&lt;/p&gt;

&lt;p&gt;Reviewed By: ashutoshc&lt;/p&gt;

&lt;p&gt;CC: brock&lt;/p&gt;

&lt;p&gt;Differential Revision: &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt; (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1504395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1504395&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/if/queryplan.thrift&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer12.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer13.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer14.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer12.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer13.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer14.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby2.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13712670" author="hudson" created="Thu, 18 Jul 2013 19:08:17 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-hadoop2-ptest #19 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/19/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/19/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&lt;br/&gt;
(Yin Huai via Ashutosh Chauhan)&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
update test results&lt;/p&gt;

&lt;p&gt;This issue proposes a new logical optimizer called Correlation Optimizer, which is used to merge correlated MapReduce jobs (MR jobs) into a single MR job. The idea is based on YSmart (&lt;a href=&quot;http://ysmart.cse.ohio-state.edu/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ysmart.cse.ohio-state.edu/&lt;/a&gt;). The paper and slides of YSmart are linked at the bottom.&lt;/p&gt;

&lt;p&gt;Since Hive translates queries in a sentence by sentence fashion, for every operation which may need to shuffle the data (e.g. join and aggregation operations), Hive will generate a MapReduce job for that operation. However, for those operations which may need to shuffle the data, they may involve correlations explained below and thus can be executed in a single MR job.&lt;/p&gt;

&lt;p&gt;	Input Correlation: Multiple MR jobs have input correlation (IC) if their input relation sets are not disjoint;&lt;br/&gt;
	Transit Correlation: Multiple MR jobs have transit correlation (TC) if they have not only input correlation, but also the same partition key;&lt;br/&gt;
	Job Flow Correlation: An MR has job &#64258;ow correlation (JFC) with one of its child nodes if it has the same partition key as that child node.&lt;/p&gt;

&lt;p&gt;The current implementation of correlation optimizer only detect correlations among MR jobs for reduce-side join operators and reduce-side aggregation operators (not map only aggregation). A query will be optimized if it satisfies following conditions.&lt;/p&gt;

&lt;p&gt;	There exists a MR job for reduce-side join operator or reduce side aggregation operator which have JFC with all of its parents MR jobs (TCs will be also exploited if JFC exists);&lt;br/&gt;
	All input tables of those correlated MR job are original input tables (not intermediate tables generated by sub-queries); and&lt;br/&gt;
	No self join is involved in those correlated MR jobs.&lt;/p&gt;

&lt;p&gt;Correlation optimizer is implemented as a logical optimizer. The main reasons are that it only needs to manipulate the query plan tree and it can leverage the existing component on generating MR jobs.&lt;/p&gt;

&lt;p&gt;Current implementation can serve as a framework for correlation related optimizations. I think that it is better than adding individual optimizers.&lt;/p&gt;

&lt;p&gt;There are several work that can be done in future to improve this optimizer. Here are three examples.&lt;/p&gt;

&lt;p&gt;	Support queries only involve TC;&lt;br/&gt;
	Support queries in which input tables of correlated MR jobs involves intermediate tables; and&lt;br/&gt;
	Optimize queries involving self join.&lt;/p&gt;

&lt;p&gt;References:&lt;br/&gt;
Paper and presentation of YSmart.&lt;br/&gt;
Paper: &lt;a href=&quot;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf&lt;/a&gt;&lt;br/&gt;
Slides: &lt;a href=&quot;http://sdrv.ms/UpwJJc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://sdrv.ms/UpwJJc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test Plan: EMPTY&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA, ashutoshc&lt;/p&gt;

&lt;p&gt;Reviewed By: ashutoshc&lt;/p&gt;

&lt;p&gt;CC: brock&lt;/p&gt;

&lt;p&gt;Differential Revision: &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt; (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1504395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1504395&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/if/queryplan.thrift&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/ql/plan/api/OperatorType.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/AbstractCorrelationProcCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationUtilities.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/IntraQueryCorrelation.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/QueryPlanTreeTransformation.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinTaskDispatcher.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/DemuxDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MuxDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/UnionDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer1.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer10.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer11.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer12.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer13.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer14.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer2.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer3.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer4.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer5.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer6.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer7.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer8.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/correlationoptimizer9.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer10.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer11.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer12.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer13.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer14.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer2.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer3.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer4.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer5.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer6.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer7.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer8.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer9.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby2.q.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/groupby3.q.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13713828" author="phabricator@reviews.facebook.net" created="Fri, 19 Jul 2013 16:46:47 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4877&quot; title=&quot;In ExecReducer, remove tag from the row which will be passed to the first Operator at the Reduce-side&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4877&quot;&gt;&lt;del&gt;HIVE-4877&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; In ExecReducer, remove tag from the row which will be passed to the first Operator at the Reduce-side&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35841&amp;amp;id=35907#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35841&amp;amp;id=35907#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4877&quot; title=&quot;In ExecReducer, remove tag from the row which will be passed to the first Operator at the Reduce-side&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4877&quot;&gt;&lt;del&gt;HIVE-4877&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  data/files/kv1kv2.cogroup.txt&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/DemuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/MuxOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java&lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13713831" author="phabricator@reviews.facebook.net" created="Fri, 19 Jul 2013 16:48:47 +0000"  >&lt;p&gt;yhuai has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Please ignore the latest diff.... it is for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4877&quot; title=&quot;In ExecReducer, remove tag from the row which will be passed to the first Operator at the Reduce-side&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4877&quot;&gt;&lt;del&gt;HIVE-4877&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4877&quot; title=&quot;In ExecReducer, remove tag from the row which will be passed to the first Operator at the Reduce-side&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4877&quot;&gt;&lt;del&gt;HIVE-4877&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13725976" author="sershe" created="Thu, 1 Aug 2013 02:28:53 +0000"  >&lt;p&gt;When I run thrift compile right now on clean trunk, I get some changes that might be related to this patch e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;--- ql/src/gen/thrift/gen-cpp/queryplan_types.cpp
+++ ql/src/gen/thrift/gen-cpp/queryplan_types.cpp
@@ -49,7 +49,9 @@ &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; _kOperatorTypeValues[] = {
   OperatorType::LATERALVIEWFORWARD,
   OperatorType::HASHTABLESINK,
   OperatorType::HASHTABLEDUMMY,
-  OperatorType::PTF
+  OperatorType::PTF,
+  OperatorType::MUX,
+  OperatorType::DEMUX
 };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;Ashutosh Chauhan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;Yin Huai&lt;/a&gt; do you guys want to update it?&lt;/p&gt;
</comment>
                            <comment id="13726019" author="yhuai" created="Thu, 1 Aug 2013 03:49:54 +0000"  >&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;. I will make the change&lt;/p&gt;</comment>
                            <comment id="13726023" author="yhuai" created="Thu, 1 Aug 2013 03:58:54 +0000"  >&lt;p&gt;i opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4972&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-4972&lt;/a&gt; to update code generated by thrift&lt;/p&gt;</comment>
                            <comment id="13751559" author="phabricator@reviews.facebook.net" created="Tue, 27 Aug 2013 18:34:54 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into trunk&lt;/li&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into trunk&lt;/li&gt;
	&lt;li&gt;Merge remote-tracking branch &apos;upstream/trunk&apos; into trunk&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5149&quot; title=&quot;ReduceSinkDeDuplication can pick the wrong partitioning columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5149&quot;&gt;&lt;del&gt;HIVE-5149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; ReduceSinkDeDuplication can pick the wrong partitioning columns&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=35907&amp;amp;id=39087#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=35907&amp;amp;id=39087#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5149&quot; title=&quot;ReduceSinkDeDuplication can pick the wrong partitioning columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5149&quot;&gt;&lt;del&gt;HIVE-5149&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/test/results/clientpositive/groupby2_map_skew.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/groupby_cube1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/groupby_rollup1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/reduce_deduplicate_extended.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13751563" author="yhuai" created="Tue, 27 Aug 2013 18:36:25 +0000"  >&lt;p&gt;the last patch was for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5149&quot; title=&quot;ReduceSinkDeDuplication can pick the wrong partitioning columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5149&quot;&gt;&lt;del&gt;HIVE-5149&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;</comment>
                            <comment id="13751568" author="phabricator@reviews.facebook.net" created="Tue, 27 Aug 2013 18:42:54 +0000"  >&lt;p&gt;yhuai updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5149&quot; title=&quot;ReduceSinkDeDuplication can pick the wrong partitioning columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5149&quot;&gt;&lt;del&gt;HIVE-5149&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=39087&amp;amp;id=39099#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=39087&amp;amp;id=39099#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  trunk&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplication.java&lt;br/&gt;
  ql/src/test/results/clientpositive/groupby2_map_skew.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/groupby_cube1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/groupby_rollup1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/reduce_deduplicate_extended.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13772336" author="phabricator@reviews.facebook.net" created="Thu, 19 Sep 2013 21:25:55 +0000"  >&lt;p&gt;yhuai has closed the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2206&quot; title=&quot;add a new optimizer for query correlation discovery and optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2206&quot;&gt;&lt;del&gt;HIVE-2206&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; add a new optimizer for query correlation discovery and optimization&quot;.&lt;/p&gt;

&lt;p&gt;  Closed by commit rHIVE1504395 (authored by hashutosh).&lt;/p&gt;

&lt;p&gt;CHANGED PRIOR TO COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097?vs=39099&amp;amp;id=40161#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097?vs=39099&amp;amp;id=40161#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D11097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/rHIVE1504395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/rHIVE1504395&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, yhuai&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13796156" author="ashutoshc" created="Tue, 15 Oct 2013 23:31:24 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                            <comment id="14060290" author="lefty@hortonworks.com" created="Mon, 14 Jul 2014 03:30:48 +0000"  >&lt;p&gt;This added &lt;b&gt;hive.optimize.correlation&lt;/b&gt; in HiveConf.java with a description in hive-default.xml.template, so the parameter needs to be documented in the wiki (Configuration Properties).&lt;/p&gt;

&lt;p&gt;Note that &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-7362&quot; title=&quot;Enabling Correlation Optimizer by default.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-7362&quot;&gt;HIVE-7362&lt;/a&gt; proposes to change the default for &lt;b&gt;hive.optimize.correlation&lt;/b&gt; to true.&lt;/p&gt;

&lt;p&gt;General documentation for the correlation optimizer is covered by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5130&quot; title=&quot;Document Correlation Optimizer in Hive wiki&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5130&quot;&gt;HIVE-5130&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14060415" author="lefty@hortonworks.com" created="Mon, 14 Jul 2014 07:53:08 +0000"  >&lt;p&gt;The correlation optimizer is documented here:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Correlation+Optimizer&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Correlation Optimizer &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14061776" author="lefty@hortonworks.com" created="Tue, 15 Jul 2014 06:57:49 +0000"  >&lt;p&gt;&lt;b&gt;hive.optimize.correlation&lt;/b&gt; is documented here:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.optimize.correlation&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Configuration Properties &amp;#8211; hive.optimize.correlation &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12614805">HIVE-3668</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12614807">HIVE-3669</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12614808">HIVE-3670</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12614810">HIVE-3671</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12648007">HIVE-4572</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12517762">HIVE-2340</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12618855">HIVE-3773</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12479272">HIVE-1772</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12606226">HIVE-3430</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12656770">HIVE-4827</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12725885">HIVE-7362</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12614802">HIVE-3667</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12494950" name="HIVE-2206.1.patch.txt" size="194754" author="yhuai" created="Sun, 18 Sep 2011 01:46:36 +0000"/>
                            <attachment id="12545223" name="HIVE-2206.10-r1384442.patch.txt" size="348695" author="yhuai" created="Fri, 14 Sep 2012 21:37:17 +0000"/>
                            <attachment id="12545294" name="HIVE-2206.11-r1385084.patch.txt" size="255792" author="yhuai" created="Sat, 15 Sep 2012 23:18:32 +0000"/>
                            <attachment id="12545586" name="HIVE-2206.12-r1386996.patch.txt" size="315836" author="yhuai" created="Tue, 18 Sep 2012 17:44:07 +0000"/>
                            <attachment id="12546320" name="HIVE-2206.13-r1389072.patch.txt" size="511866" author="yhuai" created="Mon, 24 Sep 2012 15:55:51 +0000"/>
                            <attachment id="12546709" name="HIVE-2206.14-r1389704.patch.txt" size="511241" author="yhuai" created="Wed, 26 Sep 2012 16:03:41 +0000"/>
                            <attachment id="12547394" name="HIVE-2206.15-r1392491.patch.txt" size="503879" author="yhuai" created="Tue, 2 Oct 2012 15:44:01 +0000"/>
                            <attachment id="12549995" name="HIVE-2206.16-r1399936.patch.txt" size="503943" author="yhuai" created="Fri, 19 Oct 2012 15:48:33 +0000"/>
                            <attachment id="12551963" name="HIVE-2206.17-r1404933.patch.txt" size="503220" author="yhuai" created="Sat, 3 Nov 2012 01:52:40 +0000"/>
                            <attachment id="12553207" name="HIVE-2206.18-r1407720.patch.txt" size="503248" author="yhuai" created="Mon, 12 Nov 2012 22:21:48 +0000"/>
                            <attachment id="12554227" name="HIVE-2206.19-r1410581.patch.txt" size="520674" author="yhuai" created="Mon, 19 Nov 2012 19:58:52 +0000"/>
                            <attachment id="12494992" name="HIVE-2206.2.patch.txt" size="194436" author="yhuai" created="Sun, 18 Sep 2011 23:25:57 +0000"/>
                            <attachment id="12565159" name="HIVE-2206.20-r1434012.patch.txt" size="524644" author="yhuai" created="Wed, 16 Jan 2013 19:29:13 +0000"/>
                            <attachment id="12495057" name="HIVE-2206.3.patch.txt" size="194812" author="yhuai" created="Mon, 19 Sep 2011 12:57:02 +0000"/>
                            <attachment id="12495161" name="HIVE-2206.4.patch.txt" size="194812" author="yhuai" created="Mon, 19 Sep 2011 23:08:52 +0000"/>
                            <attachment id="12504921" name="HIVE-2206.5-1.patch.txt" size="214213" author="yhuai" created="Wed, 23 Nov 2011 20:26:59 +0000"/>
                            <attachment id="12495350" name="HIVE-2206.5.patch.txt" size="260669" author="yhuai" created="Wed, 21 Sep 2011 12:36:33 +0000"/>
                            <attachment id="12506069" name="HIVE-2206.6.patch.txt" size="160077" author="yhuai" created="Sun, 4 Dec 2011 23:57:37 +0000"/>
                            <attachment id="12506144" name="HIVE-2206.7.patch.txt" size="225904" author="yhuai" created="Mon, 5 Dec 2011 19:15:05 +0000"/>
                            <attachment id="12512363" name="HIVE-2206.8-r1237253.patch.txt" size="230639" author="yhuai" created="Sun, 29 Jan 2012 17:55:16 +0000"/>
                            <attachment id="12508869" name="HIVE-2206.8.r1224646.patch.txt" size="224186" author="yhuai" created="Thu, 29 Dec 2011 18:51:42 +0000"/>
                            <attachment id="12586245" name="HIVE-2206.D11097.1.patch" size="774639" author="phabricator@reviews.facebook.net" created="Wed, 5 Jun 2013 02:27:21 +0000"/>
                            <attachment id="12589192" name="HIVE-2206.D11097.10.patch" size="1003821" author="phabricator@reviews.facebook.net" created="Fri, 21 Jun 2013 23:33:20 +0000"/>
                            <attachment id="12589836" name="HIVE-2206.D11097.11.patch" size="6783" author="phabricator@reviews.facebook.net" created="Thu, 27 Jun 2013 05:31:21 +0000"/>
                            <attachment id="12589838" name="HIVE-2206.D11097.12.patch" size="1027107" author="phabricator@reviews.facebook.net" created="Thu, 27 Jun 2013 05:37:21 +0000"/>
                            <attachment id="12590123" name="HIVE-2206.D11097.13.patch" size="1075066" author="phabricator@reviews.facebook.net" created="Sat, 29 Jun 2013 00:05:22 +0000"/>
                            <attachment id="12590312" name="HIVE-2206.D11097.14.patch" size="1140623" author="phabricator@reviews.facebook.net" created="Mon, 1 Jul 2013 22:02:21 +0000"/>
                            <attachment id="12590482" name="HIVE-2206.D11097.15.patch" size="1148515" author="phabricator@reviews.facebook.net" created="Tue, 2 Jul 2013 19:12:21 +0000"/>
                            <attachment id="12591312" name="HIVE-2206.D11097.16.patch" size="1254998" author="phabricator@reviews.facebook.net" created="Mon, 8 Jul 2013 23:21:47 +0000"/>
                            <attachment id="12592065" name="HIVE-2206.D11097.17.patch" size="1244978" author="phabricator@reviews.facebook.net" created="Fri, 12 Jul 2013 20:15:48 +0000"/>
                            <attachment id="12592218" name="HIVE-2206.D11097.18.patch" size="1259559" author="phabricator@reviews.facebook.net" created="Sun, 14 Jul 2013 22:38:47 +0000"/>
                            <attachment id="12592872" name="HIVE-2206.D11097.19.patch" size="1258906" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 22:02:48 +0000"/>
                            <attachment id="12586552" name="HIVE-2206.D11097.2.patch" size="600242" author="phabricator@reviews.facebook.net" created="Thu, 6 Jun 2013 18:58:20 +0000"/>
                            <attachment id="12593217" name="HIVE-2206.D11097.20.patch" size="47563" author="phabricator@reviews.facebook.net" created="Fri, 19 Jul 2013 16:46:47 +0000"/>
                            <attachment id="12600217" name="HIVE-2206.D11097.21.patch" size="4875" author="phabricator@reviews.facebook.net" created="Tue, 27 Aug 2013 18:34:54 +0000"/>
                            <attachment id="12600220" name="HIVE-2206.D11097.22.patch" size="4875" author="phabricator@reviews.facebook.net" created="Tue, 27 Aug 2013 18:42:54 +0000"/>
                            <attachment id="12586650" name="HIVE-2206.D11097.3.patch" size="595202" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 02:16:22 +0000"/>
                            <attachment id="12586745" name="HIVE-2206.D11097.4.patch" size="595306" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 17:00:25 +0000"/>
                            <attachment id="12586752" name="HIVE-2206.D11097.5.patch" size="595616" author="phabricator@reviews.facebook.net" created="Fri, 7 Jun 2013 17:38:21 +0000"/>
                            <attachment id="12587486" name="HIVE-2206.D11097.6.patch" size="714419" author="phabricator@reviews.facebook.net" created="Wed, 12 Jun 2013 19:15:20 +0000"/>
                            <attachment id="12587529" name="HIVE-2206.D11097.7.patch" size="742108" author="phabricator@reviews.facebook.net" created="Thu, 13 Jun 2013 00:19:20 +0000"/>
                            <attachment id="12588006" name="HIVE-2206.D11097.8.patch" size="888406" author="phabricator@reviews.facebook.net" created="Sun, 16 Jun 2013 04:33:21 +0000"/>
                            <attachment id="12588453" name="HIVE-2206.D11097.9.patch" size="945339" author="phabricator@reviews.facebook.net" created="Tue, 18 Jun 2013 21:05:20 +0000"/>
                            <attachment id="12592900" name="HIVE-2206.patch" size="1258906" author="yhuai" created="Thu, 18 Jul 2013 01:03:38 +0000"/>
                            <attachment id="12481779" name="YSmartPatchForHive.patch" size="257050" author="he yongqiang" created="Wed, 8 Jun 2011 06:41:27 +0000"/>
                            <attachment id="12508871" name="testQueries.2.q" size="5558" author="yhuai" created="Thu, 29 Dec 2011 18:58:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Jun 2011 12:45:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42226</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02isv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12647</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This optimizer exploits the intra-query correlations and merge multiple correlated MapReduce jobs into one jobs.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2207] INSERT INTO</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2207</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;New feature to allow inserting into an existing table or partition.&lt;/p&gt;

&lt;p&gt;Syntax:&lt;br/&gt;
INSERT INTO TABLE &amp;lt;table-name&amp;gt; ...;&lt;br/&gt;
INSERT INTO TABLE &amp;lt;table-name&amp;gt; PARTITION &amp;lt;partitions&amp;gt; ...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509647">HIVE-2207</key>
            <summary>INSERT INTO</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="franklinhu">Franklin Hu</assignee>
                                    <reporter username="franklinhu">Franklin Hu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jun 2011 21:34:29 +0000</created>
                <updated>Wed, 8 Jun 2011 22:04:11 +0000</updated>
                            <resolved>Wed, 8 Jun 2011 22:04:11 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13046250" author="nzhang" created="Wed, 8 Jun 2011 21:58:37 +0000"  >&lt;p&gt;Franklin, it&apos;s seems to be duplicate to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-306&quot; title=&quot;Support &amp;quot;INSERT [INTO] destination&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-306&quot;&gt;&lt;del&gt;HIVE-306&lt;/del&gt;&lt;/a&gt; (including INSERT INTO DIRECTORY as well). Can you merge these 2 if they are they are the same?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Jun 2011 21:58:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>71555</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lixr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123718</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-306&quot; title=&quot;Support &amp;quot;INSERT [INTO] destination&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-306&quot;&gt;&lt;strike&gt;HIVE-306&lt;/strike&gt;&lt;/a&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2208] create a new API in Warehouse where the root directory is specified</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2208</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;It would be useful to create tables in multiple DFS&apos;s&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509668">HIVE-2208</key>
            <summary>create a new API in Warehouse where the root directory is specified</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2011 05:49:35 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:17 +0000</updated>
                            <resolved>Thu, 9 Jun 2011 17:47:11 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13046353" author="he yongqiang" created="Thu, 9 Jun 2011 06:03:12 +0000"  >&lt;p&gt;+1, will commit after tests pass&lt;/p&gt;</comment>
                            <comment id="13046363" author="ashutoshc" created="Thu, 9 Jun 2011 07:03:45 +0000"  >&lt;p&gt;Aren&apos;t you missing db dir in there?&lt;/p&gt;</comment>
                            <comment id="13046699" author="he yongqiang" created="Thu, 9 Jun 2011 17:47:11 +0000"  >&lt;p&gt;committed. Thanks namit!&lt;/p&gt;</comment>
                            <comment id="13047042" author="hudson" created="Fri, 10 Jun 2011 07:07:39 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #771 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/771/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/771/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12481889" name="hive.2208.1.patch" size="2075" author="namit" created="Thu, 9 Jun 2011 05:52:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Jun 2011 06:03:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66865</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lixz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123719</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2209] Provide a way by which ObjectInspectorUtils.compare can be extended by the caller for comparing maps which are part of the object</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2209</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Now ObjectInspectorUtils.compare throws an exception if a map is contained (recursively) within the objects being compared. Two obvious implementations are&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a simple map comparer which assumes keys of the first map can be used to fetch values from the second&lt;/li&gt;
	&lt;li&gt;a &apos;cross-product&apos; comparer which compares every pair of key-value pairs in the two maps, and calls a match if and only if all pairs are matched&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note that it would be difficult to provide a transitive greater-than/less-than indication with maps so that is not in scope. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12509686">HIVE-2209</key>
            <summary>Provide a way by which ObjectInspectorUtils.compare can be extended by the caller for comparing maps which are part of the object</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="n_krishna_kumar">Krishna Kumar</assignee>
                                    <reporter username="n_krishna_kumar">Krishna Kumar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2011 09:10:06 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:34 +0000</updated>
                            <resolved>Thu, 21 Jul 2011 03:45:50 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Serializers/Deserializers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13047149" author="n_krishna_kumar" created="Fri, 10 Jun 2011 11:53:52 +0000"  >&lt;p&gt;Patch, with tests, added.&lt;/p&gt;</comment>
                            <comment id="13047152" author="n_krishna_kumar" created="Fri, 10 Jun 2011 11:56:09 +0000"  >&lt;p&gt;For review by He Yongqiang&lt;/p&gt;</comment>
                            <comment id="13049297" author="n_krishna_kumar" created="Tue, 14 Jun 2011 17:30:14 +0000"  >&lt;p&gt;He Yongqiang,&lt;/p&gt;

&lt;p&gt; Can you take a look at this one? Once this is in, I can upload the remainder of the patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-956&quot; title=&quot;Add support of columnar binary serde&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-956&quot;&gt;&lt;del&gt;HIVE-956&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13050920" author="n_krishna_kumar" created="Fri, 17 Jun 2011 07:53:17 +0000"  >&lt;p&gt;Added another implementation with sorting of the keys&lt;/p&gt;</comment>
                            <comment id="13051961" author="n_krishna_kumar" created="Mon, 20 Jun 2011 12:55:18 +0000"  >&lt;p&gt;Fixed a lowercase/uppercase typo in the test classes&lt;/p&gt;</comment>
                            <comment id="13067937" author="he yongqiang" created="Tue, 19 Jul 2011 20:22:18 +0000"  >&lt;p&gt;sorry, did not see this issue. can you post a review board request? &lt;br/&gt;
(in future, it is better to send a review board request and cc the reviewer. otherwise the reviewer may not notice the jira for some time)&lt;/p&gt;</comment>
                            <comment id="13068128" author="jiraposter@reviews.apache.org" created="Wed, 20 Jul 2011 02:26:57 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/879/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/879/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-20 02:25:36.169590)&lt;/p&gt;


&lt;p&gt;Review request for hive and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2209&quot; title=&quot;Provide a way by which ObjectInspectorUtils.compare can be extended by the caller for comparing maps which are part of the object&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2209&quot;&gt;&lt;del&gt;HIVE-2209&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2209&quot; title=&quot;Provide a way by which ObjectInspectorUtils.compare can be extended by the caller for comparing maps which are part of the object&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2209&quot;&gt;&lt;del&gt;HIVE-2209&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2209&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2209&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/CrossMapEqualComparer.java PRE-CREATION &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/FullMapEqualComparer.java PRE-CREATION &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/MapEqualComparer.java PRE-CREATION &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/ObjectInspectorUtils.java 2b77072 &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/SimpleMapEqualComparer.java PRE-CREATION &lt;br/&gt;
  serde/src/test/org/apache/hadoop/hive/serde2/objectinspector/TestCrossMapEqualComparer.java PRE-CREATION &lt;br/&gt;
  serde/src/test/org/apache/hadoop/hive/serde2/objectinspector/TestFullMapEqualComparer.java PRE-CREATION &lt;br/&gt;
  serde/src/test/org/apache/hadoop/hive/serde2/objectinspector/TestSimpleMapEqualComparer.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/879/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/879/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Tests added&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Krishna&lt;/p&gt;
</comment>
                            <comment id="13068540" author="he yongqiang" created="Wed, 20 Jul 2011 18:31:31 +0000"  >&lt;p&gt;+1, will commit after tests pass.&lt;/p&gt;</comment>
                            <comment id="13068786" author="he yongqiang" created="Thu, 21 Jul 2011 03:45:50 +0000"  >&lt;p&gt;Committed, thanks Krishna Kumar!&lt;/p&gt;</comment>
                            <comment id="13068838" author="hudson" created="Thu, 21 Jul 2011 06:57:20 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #838 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/838/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/838/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2209&quot; title=&quot;Provide a way by which ObjectInspectorUtils.compare can be extended by the caller for comparing maps which are part of the object&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2209&quot;&gt;&lt;del&gt;HIVE-2209&lt;/del&gt;&lt;/a&gt;:add support for map comparision in serde layer (Krishna Kumar via He Yongqiang)&lt;/p&gt;

&lt;p&gt;heyongqiang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1149027&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1149027&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/serde/src/test/org/apache/hadoop/hive/serde2/objectinspector/TestCrossMapEqualComparer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/ObjectInspectorUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/test/org/apache/hadoop/hive/serde2/objectinspector/TestSimpleMapEqualComparer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/SimpleMapEqualComparer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/test/org/apache/hadoop/hive/serde2/objectinspector/TestFullMapEqualComparer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/MapEqualComparer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/FullMapEqualComparer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/CrossMapEqualComparer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482051" name="HIVE-2209v0.patch" size="24588" author="n_krishna_kumar" created="Fri, 10 Jun 2011 11:53:52 +0000"/>
                            <attachment id="12483151" name="HIVE-2209v2.patch" size="32406" author="n_krishna_kumar" created="Mon, 20 Jun 2011 12:55:17 +0000"/>
                            <attachment id="12482903" name="HIVE2209v1.patch" size="32406" author="n_krishna_kumar" created="Fri, 17 Jun 2011 07:53:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Jul 2011 20:22:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0liy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123720</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2210] ALTER VIEW RENAME</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2210</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;ALTER TABLE RENAME cannot be used on a view; we should support ALTER VIEW RENAME.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509742">HIVE-2210</key>
            <summary>ALTER VIEW RENAME</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="charleschen">Charles Chen</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2011 17:53:03 +0000</created>
                <updated>Fri, 18 Sep 2015 18:59:37 +0000</updated>
                            <resolved>Thu, 14 Jul 2011 22:49:03 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                    <component>Views</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13061615" author="charleschen" created="Thu, 7 Jul 2011 21:44:57 +0000"  >&lt;p&gt;Adds ALTER TABLE RENAME&lt;/p&gt;</comment>
                            <comment id="13061634" author="jiraposter@reviews.apache.org" created="Thu, 7 Jul 2011 22:36:16 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1039/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-07 22:35:58.987287)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2210&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; title=&quot;ALTER VIEW RENAME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2210&quot;&gt;&lt;del&gt;HIVE-2210&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2210&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&lt;/a&gt; PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1039/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Relevant unit tests looked ok&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Charles&lt;/p&gt;
</comment>
                            <comment id="13061635" author="jiraposter@reviews.apache.org" created="Thu, 7 Jul 2011 22:36:18 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1039/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2210&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; title=&quot;ALTER VIEW RENAME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2210&quot;&gt;&lt;del&gt;HIVE-2210&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2210&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&lt;/a&gt; 1143958 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&lt;/a&gt; PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1039/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Relevant unit tests looked ok&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Charles&lt;/p&gt;
</comment>
                            <comment id="13061702" author="jiraposter@reviews.apache.org" created="Fri, 8 Jul 2011 01:00:16 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1039/#review997&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/#review997&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/a&gt;&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1039/#comment2062&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/#comment2062&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    update comment&lt;/p&gt;



&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/a&gt;&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1039/#comment2059&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/#comment2059&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Use TableType.VIRTUAL_VIEW.toString() instead of literal.&lt;/p&gt;



&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;/a&gt;&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1039/#comment2064&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/#comment2064&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    comment says DROP&lt;/p&gt;



&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&lt;/a&gt;&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1039/#comment2084&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/#comment2084&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    For completeness, can you add a SELECT statement to make sure it&apos;s still possible to query the renamed view?  It&apos;s OK if it returns no results, just that semantic analysis passes.&lt;/p&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-07-07 22:35:58, Charles Chen wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1039/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-07 22:35:58)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2210&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; title=&quot;ALTER VIEW RENAME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2210&quot;&gt;&lt;del&gt;HIVE-2210&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2210&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/a&gt; 1143958 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&lt;/a&gt; 1143958 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;/a&gt; 1143958 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&lt;/a&gt; 1143958 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&lt;/a&gt; 1143958 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&lt;/a&gt; 1143958 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&lt;/a&gt; PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&lt;/a&gt; PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&lt;/a&gt; PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&lt;/a&gt; PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&lt;/a&gt; PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&lt;/a&gt; PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1039/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Relevant unit tests looked ok&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Charles&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13061709" author="jvs" created="Fri, 8 Jul 2011 01:09:24 +0000"  >&lt;p&gt;Resubmit patch after review comments addressed.&lt;/p&gt;</comment>
                            <comment id="13062013" author="jiraposter@reviews.apache.org" created="Fri, 8 Jul 2011 15:28:16 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1039/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-08 15:27:41.458614)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Fixed changes in comments&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2210&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; title=&quot;ALTER VIEW RENAME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2210&quot;&gt;&lt;del&gt;HIVE-2210&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2210&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/a&gt; 1144352 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&lt;/a&gt; 1144352 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;/a&gt; 1144352 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&lt;/a&gt; 1144352 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&lt;/a&gt; 1144352 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&lt;/a&gt; 1144352 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&lt;/a&gt; PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1039/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1039/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Relevant unit tests looked ok&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Charles&lt;/p&gt;
</comment>
                            <comment id="13062103" author="jvs" created="Fri, 8 Jul 2011 18:37:39 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="13063324" author="hudson" created="Mon, 11 Jul 2011 13:03:29 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #820 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/820/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/820/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2210&quot; title=&quot;ALTER VIEW RENAME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2210&quot;&gt;&lt;del&gt;HIVE-2210&lt;/del&gt;&lt;/a&gt;. ALTER VIEW RENAME (Charles Chen via jvs)&lt;/p&gt;

&lt;p&gt;jvs : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1145048&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1145048&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzerFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/AlterTableDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure8.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure8.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientnegative/alter_view_failure9.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientnegative/alter_view_failure9.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/alter_view_rename.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/alter_view_rename.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13065592" author="jvs" created="Thu, 14 Jul 2011 22:49:03 +0000"  >&lt;p&gt;Committed.  Thanks Charles!  Don&apos;t forget to update the wiki.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12485659" name="HIVE-2210v0.patch" size="13379" author="charleschen" created="Thu, 7 Jul 2011 21:48:48 +0000"/>
                            <attachment id="12485751" name="HIVE-2210v1.patch" size="14279" author="charleschen" created="Fri, 8 Jul 2011 15:28:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 Jul 2011 21:44:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>68002</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0liyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123721</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2211] Fix a bug caused by HIVE-243</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2211</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Quick fix a bug caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-243&quot; title=&quot;^C breaks out of running query, but not whole CLI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-243&quot;&gt;&lt;del&gt;HIVE-243&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-234&quot; title=&quot;TableSample missing sample filter should have better error message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-234&quot;&gt;&lt;del&gt;HIVE-234&lt;/del&gt;&lt;/a&gt; removed the codes to wait for the threads to finish and use ThreadPoolExector.shutdown() to wait for the results. The usage of ThreadPoolExecutor.shutdown(), however, is wrong. The codes assume that the function blocks until all threads finish running but it actually only marks status and won&apos;t block. It caused wrong result of Utilities.getInputSummary() and caused many jobs are executed as local mode while they have huge data.&lt;/p&gt;

&lt;p&gt;Revert those changes quickly. We can have a follow-up to see how to deal with this more efficiently if you want.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509765">HIVE-2211</key>
            <summary>Fix a bug caused by HIVE-243</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sdong">Siying Dong</assignee>
                                    <reporter username="sdong">Siying Dong</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2011 21:26:59 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:05 +0000</updated>
                            <resolved>Tue, 21 Jun 2011 21:47:42 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="13046818" author="sdong" created="Thu, 9 Jun 2011 21:30:19 +0000"  >&lt;p&gt;Just a simple revert. I did a small modification: when catching InterruptedException, stop waiting pending threads and exit.&lt;/p&gt;</comment>
                            <comment id="13046840" author="nzhang" created="Thu, 9 Jun 2011 21:48:32 +0000"  >&lt;p&gt;+1. In the followup we should add a unit test for this function to compare the contentsummary returned by parallel execution and serial execution. &lt;/p&gt;</comment>
                            <comment id="13047044" author="hudson" created="Fri, 10 Jun 2011 07:07:40 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #771 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/771/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/771/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2211&quot; title=&quot;Fix a bug caused by HIVE-243&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2211&quot;&gt;&lt;del&gt;HIVE-2211&lt;/del&gt;&lt;/a&gt;. Fix a bug caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-243&quot; title=&quot;^C breaks out of running query, but not whole CLI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-243&quot;&gt;&lt;del&gt;HIVE-243&lt;/del&gt;&lt;/a&gt; (Siying Dong via Ning Zhang)&lt;/p&gt;

&lt;p&gt;nzhang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1134179&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1134179&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13052790" author="jvs" created="Tue, 21 Jun 2011 20:00:10 +0000"  >&lt;p&gt;It looks like this has already been committed?  Can we set assignee and close it?&lt;/p&gt;</comment>
                            <comment id="13052864" author="nzhang" created="Tue, 21 Jun 2011 21:47:42 +0000"  >&lt;p&gt;Committed. Thanks Siying!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12481982" name="HIVE-2211.1.patch" size="995" author="sdong" created="Thu, 9 Jun 2011 21:30:19 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12509769">HIVE-2212</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Jun 2011 21:48:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>70662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0liyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123722</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2212] unit test to compare results of getInputSummary() with single thread and multiple threads</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2212</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12509769">HIVE-2212</key>
            <summary>unit test to compare results of getInputSummary() with single thread and multiple threads</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21146&amp;avatarType=issuetype">Sub-task</type>
                            <parent id="12509765">HIVE-2211</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="sdong">Siying Dong</assignee>
                                    <reporter username="nzhang">Ning Zhang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2011 22:02:17 +0000</created>
                <updated>Thu, 9 Jun 2011 22:02:18 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0liyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123723</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2213] Optimize partial specification metastore functions</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2213</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;If a table has a large number of partitions, get_partition_names_ps() make take a long time to execute, because we get all of the partition names from the database.  This is not very memory efficient, and the operation can be pushed down to the JDO layer without getting all of the names first.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509796">HIVE-2213</key>
            <summary>Optimize partial specification metastore functions</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sohanjain">Sohan Jain</assignee>
                                    <reporter username="sohanjain">Sohan Jain</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jun 2011 06:50:57 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:55 +0000</updated>
                            <resolved>Mon, 20 Jun 2011 23:47:31 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13047041" author="jiraposter@reviews.apache.org" created="Fri, 10 Jun 2011 07:06:59 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and Paul Yang.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;If a table has a large number of partitions, get_partition_names_ps() make take a long time to execute, because we get all of the partition names from the database. This is not very memory efficient, and the operation can be pushed down to the JDO layer without getting all of the names first.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; title=&quot;Optimize partial specification metastore functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2213&quot;&gt;&lt;del&gt;HIVE-2213&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2213&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java 1134205 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1134205 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1134205 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1134205 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java 1134205 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java 1134205 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/878/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Passes previous test cases for get_partition_names_ps() in TestHiveMetaStore.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Sohan&lt;/p&gt;
</comment>
                            <comment id="13047452" author="jiraposter@reviews.apache.org" created="Fri, 10 Jun 2011 21:01:59 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/878/#review804&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#review804&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;You can do this here or in a separate JIRA, but can you update get_partitions_ps() using a similar technique?&lt;/p&gt;


&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/878/#comment1753&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#comment1753&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can you refactor with the above function since they are similar?&lt;/p&gt;



&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/878/#comment1754&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#comment1754&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Same here&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/878/#comment1755&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#comment1755&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    To be consistent with the other method, maybe call this listPartitionNamesPs?&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/878/#comment1756&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#comment1756&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Combine with above&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Paul&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-10 07:05:56, Sohan Jain wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-10 07:05:56)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Paul Yang.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;If a table has a large number of partitions, get_partition_names_ps() make take a long time to execute, because we get all of the partition names from the database. This is not very memory efficient, and the operation can be pushed down to the JDO layer without getting all of the names first.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; title=&quot;Optimize partial specification metastore functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2213&quot;&gt;&lt;del&gt;HIVE-2213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java 1134205 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1134205 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1134205 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1134205 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java 1134205 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java 1134205 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/878/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Passes previous test cases for get_partition_names_ps() in TestHiveMetaStore.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sohan&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13048781" author="jiraposter@reviews.apache.org" created="Mon, 13 Jun 2011 21:11:52 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-06-13 21:11:38.325243)&lt;/p&gt;


&lt;p&gt;Review request for hive and Paul Yang.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;-Refactored similar functions&lt;br/&gt;
-Renamed getPartitionNamesPs() to listPartitionNamesPs()&lt;br/&gt;
-Modified get_partitions_ps() and get_partitions_ps_with_auth() for a similar optimization&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;If a table has a large number of partitions, get_partition_names_ps() make take a long time to execute, because we get all of the partition names from the database. This is not very memory efficient, and the operation can be pushed down to the JDO layer without getting all of the names first.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; title=&quot;Optimize partial specification metastore functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2213&quot;&gt;&lt;del&gt;HIVE-2213&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2213&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java 1135227 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1135227 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1135227 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1135227 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java 1135227 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java 1135227 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/878/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Passes previous test cases for get_partition_names_ps() in TestHiveMetaStore.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Sohan&lt;/p&gt;
</comment>
                            <comment id="13050585" author="jiraposter@reviews.apache.org" created="Thu, 16 Jun 2011 17:37:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/878/#review853&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#review853&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/878/#comment1862&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#comment1862&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Line exceeds 100 char limit&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Paul&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-13 21:11:38, Sohan Jain wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-13 21:11:38)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Paul Yang.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;If a table has a large number of partitions, get_partition_names_ps() make take a long time to execute, because we get all of the partition names from the database. This is not very memory efficient, and the operation can be pushed down to the JDO layer without getting all of the names first.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; title=&quot;Optimize partial specification metastore functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2213&quot;&gt;&lt;del&gt;HIVE-2213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/878/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Passes previous test cases for get_partition_names_ps() in TestHiveMetaStore.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sohan&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13050586" author="pauly" created="Thu, 16 Jun 2011 17:37:49 +0000"  >&lt;p&gt;Looks good, but can you do a minor update to fix lines longer than 100 chars?&lt;/p&gt;</comment>
                            <comment id="13050802" author="sohanjain" created="Thu, 16 Jun 2011 23:30:47 +0000"  >&lt;p&gt;-Fixed line that exceeded 100 chars&lt;/p&gt;</comment>
                            <comment id="13050803" author="jiraposter@reviews.apache.org" created="Thu, 16 Jun 2011 23:31:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-06-16 23:30:02.425588)&lt;/p&gt;


&lt;p&gt;Review request for hive and Paul Yang.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;-Fixed line that exceeded 100 chars&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;If a table has a large number of partitions, get_partition_names_ps() make take a long time to execute, because we get all of the partition names from the database. This is not very memory efficient, and the operation can be pushed down to the JDO layer without getting all of the names first.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; title=&quot;Optimize partial specification metastore functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2213&quot;&gt;&lt;del&gt;HIVE-2213&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2213&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java 1135227 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1135227 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1135227 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1135227 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java 1135227 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java 1135227 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/878/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Passes previous test cases for get_partition_names_ps() in TestHiveMetaStore.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Sohan&lt;/p&gt;
</comment>
                            <comment id="13050841" author="jiraposter@reviews.apache.org" created="Fri, 17 Jun 2011 01:18:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/878/#review858&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#review858&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/878/#comment1877&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/#comment1877&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can we make this method parameterized to reduce the number of casts required? E.g.&lt;/p&gt;

&lt;p&gt;    private &amp;lt;T&amp;gt; Collection &amp;lt;T&amp;gt; getPartition...&lt;/p&gt;

&lt;p&gt;    We might have to do something like &amp;lt;String&amp;gt;getPartition... when making the call though.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Paul&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-16 23:30:02, Sohan Jain wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-16 23:30:02)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Paul Yang.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;If a table has a large number of partitions, get_partition_names_ps() make take a long time to execute, because we get all of the partition names from the database. This is not very memory efficient, and the operation can be pushed down to the JDO layer without getting all of the names first.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; title=&quot;Optimize partial specification metastore functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2213&quot;&gt;&lt;del&gt;HIVE-2213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java 1135227 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/878/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Passes previous test cases for get_partition_names_ps() in TestHiveMetaStore.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sohan&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13051330" author="jiraposter@reviews.apache.org" created="Fri, 17 Jun 2011 21:23:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-06-17 21:22:00.028428)&lt;/p&gt;


&lt;p&gt;Review request for hive and Paul Yang.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;made getPartitionPsQueryResults() return a parameterized type to avoid lots of casting&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;If a table has a large number of partitions, get_partition_names_ps() make take a long time to execute, because we get all of the partition names from the database. This is not very memory efficient, and the operation can be pushed down to the JDO layer without getting all of the names first.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; title=&quot;Optimize partial specification metastore functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2213&quot;&gt;&lt;del&gt;HIVE-2213&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2213&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/common/FileUtils.java 1136751 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1136751 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1136751 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1136751 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java 1136751 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java 1136751 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/878/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/878/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Passes previous test cases for get_partition_names_ps() in TestHiveMetaStore.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Sohan&lt;/p&gt;
</comment>
                            <comment id="13051333" author="sohanjain" created="Fri, 17 Jun 2011 21:29:42 +0000"  >&lt;p&gt;I&apos;d also like to point one more thing out.  The previous implementation of get_partitions_ps_with_auth() did not actually make use of the inputted user name or group name, nor did it set any auth privileges on the desired partitions.  &lt;/p&gt;

&lt;p&gt;This patch adds authentication privileges, which unfortunately slows down get_partitions_ps_with_auth(), since we have to iterate through all of the partitions and set privileges before returning them.  What is the desired behavior here?&lt;/p&gt;</comment>
                            <comment id="13051419" author="pauly" created="Sat, 18 Jun 2011 00:47:55 +0000"  >&lt;p&gt;If get_partitions_ps_with_auth() was not correct before, then we should fix the method to produce the correct behavior. Ideally, it should have been done in a separate JIRA, but it should be okay to include in this one.&lt;/p&gt;

&lt;p&gt;+1 looks good though, will test and commit.&lt;/p&gt;</comment>
                            <comment id="13052281" author="pauly" created="Mon, 20 Jun 2011 23:47:31 +0000"  >&lt;p&gt;Committed. Thanks Sohan!&lt;/p&gt;</comment>
                            <comment id="13054064" author="hudson" created="Thu, 23 Jun 2011 19:47:06 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #790 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/790/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/790/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482029" name="HIVE-2213.1.patch" size="11579" author="sohanjain" created="Fri, 10 Jun 2011 06:59:22 +0000"/>
                            <attachment id="12482877" name="HIVE-2213.3.patch" size="18319" author="sohanjain" created="Thu, 16 Jun 2011 23:30:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Jun 2011 07:06:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>70148</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0liz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2214] CommandNeedRetryException.java is missing ASF header</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2214</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Please add one.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509875">HIVE-2214</key>
            <summary>CommandNeedRetryException.java is missing ASF header</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jun 2011 21:00:55 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:47 +0000</updated>
                            <resolved>Thu, 3 Nov 2011 19:17:15 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13142863" author="ashutoshc" created="Thu, 3 Nov 2011 06:11:26 +0000"  >&lt;p&gt;I think this should be applied to 0.8 branch too before release because of compliance reason.&lt;/p&gt;</comment>
                            <comment id="13143451" author="jvs" created="Thu, 3 Nov 2011 19:07:21 +0000"  >&lt;p&gt;+1, will commit.&lt;/p&gt;</comment>
                            <comment id="13143462" author="jvs" created="Thu, 3 Nov 2011 19:17:16 +0000"  >&lt;p&gt;Committed to 0.8 and trunk, thanks Ashutosh!&lt;/p&gt;</comment>
                            <comment id="13143594" author="hudson" created="Thu, 3 Nov 2011 23:14:15 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1056 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1056/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1056/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2214&quot; title=&quot;CommandNeedRetryException.java is missing ASF header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2214&quot;&gt;&lt;del&gt;HIVE-2214&lt;/del&gt;&lt;/a&gt;. CommandNeedRetryException.java is missing ASF header&lt;br/&gt;
(Ashutosh Chauhan via jvs)&lt;/p&gt;

&lt;p&gt;jvs : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1197276&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1197276&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/CommandNeedRetryException.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13143660" author="hudson" created="Fri, 4 Nov 2011 00:58:02 +0000"  >&lt;p&gt;Integrated in Hive-0.8.0-SNAPSHOT-h0.21 #80 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-0.8.0-SNAPSHOT-h0.21/80/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-0.8.0-SNAPSHOT-h0.21/80/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2214&quot; title=&quot;CommandNeedRetryException.java is missing ASF header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2214&quot;&gt;&lt;del&gt;HIVE-2214&lt;/del&gt;&lt;/a&gt;. CommandNeedRetryException.java is missing ASF header&lt;br/&gt;
(Ashutosh Chauhan via jvs)&lt;/p&gt;

&lt;p&gt;jvs : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1197278&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1197278&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/branches/branch-0.8/ql/src/java/org/apache/hadoop/hive/ql/CommandNeedRetryException.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12502105" name="hive-2214.patch" size="1380" author="ashutoshc" created="Thu, 3 Nov 2011 06:11:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Nov 2011 06:11:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42224</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09zen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56177</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2215] Add api for marking / querying set of partitions for events</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2215</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12509877">HIVE-2215</key>
            <summary>Add api for marking / querying set of partitions for events</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jun 2011 21:13:26 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:47 +0000</updated>
                            <resolved>Mon, 20 Jun 2011 09:29:17 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13047459" author="ashutoshc" created="Fri, 10 Jun 2011 21:15:52 +0000"  >&lt;p&gt;Patch including generated code. Will post on RB without generated code. Incorporates feedback from John on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13047466" author="jiraposter@reviews.apache.org" created="Fri, 10 Jun 2011 21:25:59 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/883/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Follow-up for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2215&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/metastore/if/hive_metastore.thrift 1134443 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1134443 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1134443 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1134443 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1134443 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1134443 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1134443 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/MarkPartitionEvent.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/model/package.jdo 1134443 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1134443 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionSet.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1134443 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/883/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added test cases for new api.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ashutosh&lt;/p&gt;
</comment>
                            <comment id="13047467" author="ashutoshc" created="Fri, 10 Jun 2011 21:26:02 +0000"  >&lt;p&gt;This patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="13047506" author="ashutoshc" created="Fri, 10 Jun 2011 22:21:30 +0000"  >&lt;p&gt;Replying to Paul&apos;s comments since I closed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt; :&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I agree with John&apos;s suggestion for PARTITION_EVENTS. For this event table, when will rows be dropped?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This also needs to be considered. I will prefer to do it in a followup jira to keep this one manageable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, for when partitions are represented using a string, we&apos;ve followed the convention that they are called partition names. Can we use that for MPartitionSet?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yup, I can rename that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Since MPartitionSet.partVals is a string, we should make it indexed, much like partitionName for the PARTITION table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In the latest patch, I have made it indexed.&lt;/p&gt;

&lt;p&gt;If you can take a look at the latest patch, that will be great.&lt;/p&gt;</comment>
                            <comment id="13048804" author="jiraposter@reviews.apache.org" created="Mon, 13 Jun 2011 21:47:48 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/883/#review822&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#review822&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/model/package.jdo&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1782&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1782&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does indexing actually work on a LONGVARCHAR field across all DB&apos;s of interest?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-10 21:24:13, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/883/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-10 21:24:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Follow-up for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2215&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/if/hive_metastore.thrift 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/MarkPartitionEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/package.jdo 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionSet.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/883/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added test cases for new api.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13048808" author="jiraposter@reviews.apache.org" created="Mon, 13 Jun 2011 21:51:47 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-06-13 21:47:25, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/model/package.jdo, line 670&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20978#file20978line670&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20978#file20978line670&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Does indexing actually work on a LONGVARCHAR field across all DB&apos;s of interest?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, it doesn&apos;t. So, I reverted it back to VARCHAR.&lt;/p&gt;

&lt;p&gt;If the rest of the patch looks alright, I will attach a new patch with this change.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ashutosh&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/883/#review822&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#review822&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-06-10 21:24:13, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/883/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-10 21:24:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Follow-up for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2215&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/if/hive_metastore.thrift 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/MarkPartitionEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/package.jdo 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionSet.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/883/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added test cases for new api.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13048810" author="jvs" created="Mon, 13 Jun 2011 21:54:06 +0000"  >&lt;p&gt;Carl, any comments on the latest?&lt;/p&gt;</comment>
                            <comment id="13048848" author="cwsteinbach" created="Mon, 13 Jun 2011 22:48:30 +0000"  >&lt;p&gt;I&apos;m working on some comments right now. I&apos;ll have them posted in an hour.&lt;/p&gt;</comment>
                            <comment id="13048925" author="jiraposter@reviews.apache.org" created="Tue, 14 Jun 2011 01:02:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/883/#review824&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#review824&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/metastore/if/hive_metastore.thrift&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1784&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1784&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think this should be changed to &quot;PartitionEventType&quot; in order to make it clear that this applies to partitions only. If in the future we need to introduce event types for tables, indexes, etc, then we should add new enums for those event types as well.&lt;/p&gt;



&lt;p&gt;trunk/metastore/if/hive_metastore.thrift&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1785&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1785&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This should also throw UnknownDBException and UnknownTableException. The same goes for isPartitionMarkedForEvent.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1786&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1786&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Collections aren&apos;t required to satisfy an ordering property, so we have to assume the output of this logging statement is ambiguous, e.g. &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;a, b&amp;#93;&lt;/span&gt;&quot; versus &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;b, a&amp;#93;&lt;/span&gt;&quot;. We should disambiguate this by passing in the part_vals map and logging the key/value pairs instead of just the values.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1789&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1789&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing exceptions: UnknownDbException and UnknownTableException.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1787&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1787&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Checking to see if the DB and Table exist should be done in the same database transaction as the rest of the operation. If you do it here there&apos;s no guarantee that the db/table will still exist when ms.markPartitionForEvent() is called.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1791&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1791&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should we add an InvalidPartitionException and UnknownPartitionException? Seems like those are both valid exceptions in this situation.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1788&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1788&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Same issue here as before. These checks need to get pushed into ms.isPartitionMarkedForEvent().&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1798&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1798&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think the name of this method is misleading. You&apos;re marking a single partition done, not a set of partitions, right? &lt;/p&gt;

&lt;p&gt;    Also, in this context being &quot;done&quot; means that the load operation on that partition has completed, so it would be good to include &quot;load&quot; in the name of the method and event class, e.g. &quot;LoadPartitionDoneEvent&quot; and &quot;onLoadPartitionDone&quot;.&lt;/p&gt;




&lt;p&gt;trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1800&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1800&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is it possible to use org.apache.hadoop.hive.metastore.api.EventType instead of int?&lt;/p&gt;

&lt;p&gt;    Another approach is to create an MPartitionEvent baseclass, and then subclass that with MPartitionLoadDoneEvent, etc, and use eventType as the internal type discriminator for JDO.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/model/package.jdo&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1793&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1793&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You need to supply schema upgrade scripts for Derby and MySQL. Please either do that in this ticket or open a followup ticket and assign it to yourself.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/model/package.jdo&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1799&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1799&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    It looks like it&apos;s possible for this table to hold more than one &quot;MarkPartitionDone&quot; event for the same partition, but is that a legal state? If it is, how do you know when the load operation for a partition is still in progress?&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionSet.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1801&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1801&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can you subclass this with a remote and embedded version?&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/#comment1797&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#comment1797&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Any reason in particular why you switched to always running this test in local mode? If we can only test one scenario, then I think there&apos;s more value in focusing on the standalone client/server setup.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-10 21:24:13, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/883/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-10 21:24:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Follow-up for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2215&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/if/hive_metastore.thrift 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/MarkPartitionEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/package.jdo 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionSet.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1134443 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/883/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added test cases for new api.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13049405" author="jiraposter@reviews.apache.org" created="Tue, 14 Jun 2011 20:52:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/883/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-06-14 20:51:53.179968)&lt;/p&gt;


&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated patch with Carl&apos;s comments.&lt;br/&gt;
Carl, can you take a look?&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Follow-up for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2215&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/metastore/if/hive_metastore.thrift 1135779 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1135779 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1135779 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1135779 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1135779 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1135779 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1135779 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/LoadPartitionDoneEvent.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/model/package.jdo 1135779 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1135779 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartition.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionRemote.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1135779 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/883/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added test cases for new api.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ashutosh&lt;/p&gt;
</comment>
                            <comment id="13049410" author="jiraposter@reviews.apache.org" created="Tue, 14 Jun 2011 20:54:47 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/if/hive_metastore.thrift, line 46&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20969#file20969line46&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20969#file20969line46&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think this should be changed to &quot;PartitionEventType&quot; in order to make it clear that this applies to partitions only. If in the future we need to introduce event types for tables, indexes, etc, then we should add new enums for those event types as well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/if/hive_metastore.thrift, line 338&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20969#file20969line338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20969#file20969line338&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This should also throw UnknownDBException and UnknownTableException. The same goes for isPartitionMarkedForEvent.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 528&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line528&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line528&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Collections aren&apos;t required to satisfy an ordering property, so we have to assume the output of this logging statement is ambiguous, e.g. &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;a, b&amp;#93;&lt;/span&gt;&quot; versus &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;b, a&amp;#93;&lt;/span&gt;&quot;. We should disambiguate this by passing in the part_vals map and logging the key/value pairs instead of just the values.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3182&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line3182&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line3182&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Missing exceptions: UnknownDbException and UnknownTableException.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3186&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line3186&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line3186&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Checking to see if the DB and Table exist should be done in the same database transaction as the rest of the operation. If you do it here there&apos;s no guarantee that the db/table will still exist when ms.markPartitionForEvent() is called.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3188&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line3188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line3188&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should we add an InvalidPartitionException and UnknownPartitionException? Seems like those are both valid exceptions in this situation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3224&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line3224&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20970#file20970line3224&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Same issue here as before. These checks need to get pushed into ms.isPartitionMarkedForEvent().&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java, line 82&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20973#file20973line82&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20973#file20973line82&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think the name of this method is misleading. You&apos;re marking a single partition done, not a set of partitions, right? &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Also, in this context being &quot;done&quot; means that the load operation on that partition has completed, so it would be good to include &quot;load&quot; in the name of the method and event class, e.g. &quot;LoadPartitionDoneEvent&quot; and &quot;onLoadPartitionDone&quot;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java, line 34&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20977#file20977line34&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20977#file20977line34&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is it possible to use org.apache.hadoop.hive.metastore.api.EventType instead of int?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Another approach is to create an MPartitionEvent baseclass, and then subclass that with MPartitionLoadDoneEvent, etc, and use eventType as the internal type discriminator for JDO.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No.&lt;/p&gt;

&lt;p&gt;I don&apos;t see any benefit of it. Nor I cant see how will this work.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/model/package.jdo, line 668&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20978#file20978line668&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20978#file20978line668&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     You need to supply schema upgrade scripts for Derby and MySQL. Please either do that in this ticket or open a followup ticket and assign it to yourself.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will do.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/model/package.jdo, line 683&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20978#file20978line683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20978#file20978line683&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     It looks like it&apos;s possible for this table to hold more than one &quot;MarkPartitionDone&quot; event for the same partition, but is that a legal state? If it is, how do you know when the load operation for a partition is still in progress?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is not for when load operation is in progress. As suggested from name its &quot;LoadPartitionDone&quot;. So, marking partition load done is idempotent. Client can mark it multiple times. So, metastore will return true if it finds one or more such partitioned marked in the table.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionSet.java, line 36&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20980#file20980line36&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20980#file20980line36&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Can you subclass this with a remote and embedded version?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-14 01:02:20, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java, line 80&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/883/diff/1/?file=20981#file20981line80&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff/1/?file=20981#file20981line80&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Any reason in particular why you switched to always running this test in local mode? If we can only test one scenario, then I think there&apos;s more value in focusing on the standalone client/server setup.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I reverted those changes.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ashutosh&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/883/#review824&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#review824&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-06-14 20:51:53, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/883/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-14 20:51:53)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Follow-up for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2215&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/if/hive_metastore.thrift 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/LoadPartitionDoneEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/package.jdo 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartition.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionRemote.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/883/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added test cases for new api.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13049695" author="jiraposter@reviews.apache.org" created="Wed, 15 Jun 2011 09:38:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/883/#review843&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/#review843&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;Looks good to me. Thanks for making the changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-14 20:51:53, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/883/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-14 20:51:53)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Follow-up for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2215&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/if/hive_metastore.thrift 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RawStore.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/LoadPartitionDoneEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/org/apache/hadoop/hive/metastore/model/MPartitionEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/model/package.jdo 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartition.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMarkPartitionRemote.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1135779 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/883/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/883/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added test cases for new api.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13049844" author="ashutoshc" created="Wed, 15 Jun 2011 16:25:46 +0000"  >&lt;p&gt;Thanks, Carl for quick reply. Here is the full patch with the generated code. Can someone please commit this?&lt;/p&gt;</comment>
                            <comment id="13050528" author="ashutoshc" created="Thu, 16 Jun 2011 16:11:17 +0000"  >&lt;p&gt;Anyone care to commit this one?&lt;/p&gt;</comment>
                            <comment id="13050624" author="cwsteinbach" created="Thu, 16 Jun 2011 18:20:28 +0000"  >&lt;p&gt;+1. Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="13051876" author="cwsteinbach" created="Mon, 20 Jun 2011 09:29:17 +0000"  >&lt;p&gt;Committed to trunk. Thanks Ashutosh!&lt;/p&gt;</comment>
                            <comment id="13054057" author="hudson" created="Thu, 23 Jun 2011 19:47:05 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #790 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/790/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/790/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13104190" author="hudson" created="Wed, 14 Sep 2011 02:53:10 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #951 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/951/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/951/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2441&quot; title=&quot;Metastore upgrade scripts for schema change introduced in HIVE-2215&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2441&quot;&gt;&lt;del&gt;HIVE-2441&lt;/del&gt;&lt;/a&gt;. Metastore upgrade scripts for schema change introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt; (Ashutosh Chauhan via cws)&lt;/p&gt;

&lt;p&gt;cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170344&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/scripts/upgrade/derby/009-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.derby.sql&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/scripts/upgrade/mysql/009-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.mysql.sql&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/scripts/upgrade/postgres/009-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.postgres.sql&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13104235" author="hudson" created="Wed, 14 Sep 2011 04:12:48 +0000"  >&lt;p&gt;Integrated in Hive-0.8.0-SNAPSHOT-h0.21 #20 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-0.8.0-SNAPSHOT-h0.21/20/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-0.8.0-SNAPSHOT-h0.21/20/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2441&quot; title=&quot;Metastore upgrade scripts for schema change introduced in HIVE-2215&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2441&quot;&gt;&lt;del&gt;HIVE-2441&lt;/del&gt;&lt;/a&gt;. Metastore upgrade scripts for schema change introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt; (Ashutosh Chauhan via cws)&lt;/p&gt;

&lt;p&gt;cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170346&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170346&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/branches/branch-0.8/metastore/scripts/upgrade/derby/009-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.derby.sql&lt;/li&gt;
	&lt;li&gt;/hive/branches/branch-0.8/metastore/scripts/upgrade/mysql/009-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.mysql.sql&lt;/li&gt;
	&lt;li&gt;/hive/branches/branch-0.8/metastore/scripts/upgrade/postgres/009-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;.postgres.sql&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12522782">HIVE-2441</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12482684" name="hive-2215_full-1.patch" size="320436" author="ashutoshc" created="Wed, 15 Jun 2011 16:25:46 +0000"/>
                            <attachment id="12482097" name="hive_2215.patch" size="235895" author="ashutoshc" created="Fri, 10 Jun 2011 21:15:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Jun 2011 21:25:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60695</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lizb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2216] Add TestRemoteJdbcDriver and TestEmbeddedJdbcDriver</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2216</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;TestJdbcDriver currently runs in embedded mode by default, which means that the Hive regression tests don&apos;t actually cover testing the JDBC driver in remote mode. &lt;/p&gt;

&lt;p&gt;We should add TestRemoteJdbcDriver and TestEmbeddedJdbcDriver test suites that respectively cover the remote and embedded configuration scenarios.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12510234">HIVE-2216</key>
            <summary>Add TestRemoteJdbcDriver and TestEmbeddedJdbcDriver</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jun 2011 21:36:59 +0000</created>
                <updated>Mon, 13 Jun 2011 21:36:59 +0000</updated>
                                                                            <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42223</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lizj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123726</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2217] add Query text for debugging in lock data</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2217</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently, the queryId is stored in the lock data - &lt;br/&gt;
Query text would improve the debuggability&lt;/p&gt;</description>
                <environment></environment>
        <key id="12510245">HIVE-2217</key>
            <summary>add Query text for debugging in lock data</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jiangjy1982">Jiayan Jiang</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jun 2011 23:06:03 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:10 +0000</updated>
                            <resolved>Tue, 13 Sep 2011 23:02:45 +0000</resolved>
                                    <version>0.7.1</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13103161" author="he yongqiang" created="Mon, 12 Sep 2011 22:59:12 +0000"  >&lt;p&gt;+1, will commit after tests pass. &lt;/p&gt;</comment>
                            <comment id="13104062" author="he yongqiang" created="Tue, 13 Sep 2011 23:02:45 +0000"  >&lt;p&gt;Committed, thanks Jiayan!&lt;/p&gt;</comment>
                            <comment id="13104068" author="jiangjy1982" created="Tue, 13 Sep 2011 23:06:58 +0000"  >&lt;p&gt;No problem.&lt;/p&gt;</comment>
                            <comment id="13104192" author="hudson" created="Wed, 14 Sep 2011 02:53:12 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #951 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/951/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/951/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2217&quot; title=&quot;add Query text for debugging in lock data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2217&quot;&gt;&lt;del&gt;HIVE-2217&lt;/del&gt;&lt;/a&gt;: add Query text for debugging in lock data (Jiayan Jiang via He Yongqiang)&lt;/p&gt;

&lt;p&gt;heyongqiang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170260&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170260&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/Context.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/Driver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/lockmgr/HiveLockObject.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/LockTableDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/lock1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/lock2.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12493624" name="hive_diff2" size="11028" author="jiangjy1982" created="Thu, 8 Sep 2011 17:14:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 12 Sep 2011 22:59:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60697</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lizr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123727</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2218] speedup addInputPaths</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2218</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Speedup the addInputPaths for combined symlink inputformat, and added some other micro optimizations which also work for normal cases.&lt;/p&gt;

&lt;p&gt;This can help reducing the start time of one query from 5 hours to less than 20 mins.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12510257">HIVE-2218</key>
            <summary>speedup addInputPaths</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Jun 2011 02:52:09 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:24 +0000</updated>
                            <resolved>Thu, 16 Jun 2011 17:07:28 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13049423" author="he yongqiang" created="Tue, 14 Jun 2011 21:09:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/898/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13049426" author="jiraposter@reviews.apache.org" created="Tue, 14 Jun 2011 21:10:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/898/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;speedup addInputPaths&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2218&quot; title=&quot;speedup addInputPaths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2218&quot;&gt;&lt;del&gt;HIVE-2218&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2218&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 1135335 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java 1135335 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1135335 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1135335 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/898/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;yes.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yongqiang&lt;/p&gt;
</comment>
                            <comment id="13049963" author="jiraposter@reviews.apache.org" created="Wed, 15 Jun 2011 19:00:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/898/#review842&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#review842&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1826&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1826&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This change will make the order of paths in pathProcessed non-deterministic. This means mapred.input.dir will have not have the same order as before. Not sure if it is safe or not, but if you change HashSet with LinkedHashSet, the order will be preserved.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1828&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1828&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Here needs some comments why this case doesn&apos;t need to check empty paths. &lt;/p&gt;

&lt;p&gt;    In terms of efficiency, it seems to me that checking empty paths is not the most expensive part (# of RPCs is large but each listStatus() should be fast). Also we should be able to cache (needs to extend Utilities.isEmpty) the results of listStatus for each path, which are anyway needed in other operations (compute splits etc). If &lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1829&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1829&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    It seem that we are doing redundant work as FileInputFormat.setInputPaths(JobConf, CommaSeparatedString). I think it would be safer and cleaner to first get an array of paths and call: &lt;/p&gt;

&lt;p&gt;    FileInputFormat.setInputPaths(StringUtils.stringToPath(String[] paths))&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1830&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1830&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    indentation&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1833&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1833&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    why do we need it here?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1834&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1834&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ! mrwork.getPartDescToRework().isEmpty()&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1835&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1835&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The logic here is too complex and I think it&apos;s better to be refactored. Is the following what you wanted? &lt;/p&gt;

&lt;p&gt;    if (all_partitions_are_rework()) &lt;/p&gt;
{
      prepareNullCombineFilter(combine);
    }
&lt;p&gt; else &lt;/p&gt;
{
      prepareNormalCombineFilter(combine);
    }
&lt;p&gt; &lt;br/&gt;
    InputSplitShim[] iss = combine.getSplits()&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1832&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1832&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does here just need a HashSet&amp;lt;PartitionDesc&amp;gt; rather than a HashMap&amp;lt;PartitionDesc, Boolean&amp;gt;?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-14 21:09:13, Yongqiang He wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/898/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-14 21:09:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;speedup addInputPaths&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2218&quot; title=&quot;speedup addInputPaths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2218&quot;&gt;&lt;del&gt;HIVE-2218&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2218&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 1135335 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java 1135335 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1135335 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1135335 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/898/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;yes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yongqiang&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13050003" author="jiraposter@reviews.apache.org" created="Wed, 15 Jun 2011 20:24:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/898/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-06-15 20:24:15.631412)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;address Ning&apos;s comments. Did the minimum change and the performance is acceptable. We can try to remove empty path check if in future we see the latency is not good.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;speedup addInputPaths&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2218&quot; title=&quot;speedup addInputPaths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2218&quot;&gt;&lt;del&gt;HIVE-2218&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2218&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 1135335 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1135335 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/898/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;yes.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yongqiang&lt;/p&gt;
</comment>
                            <comment id="13050030" author="jiraposter@reviews.apache.org" created="Wed, 15 Jun 2011 21:06:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/898/#review846&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#review846&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1839&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1839&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    If we change accept(), we need to remove + File.separator here.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/898/#comment1837&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/#comment1837&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think it would be better to use path.getParent().toString() instead of doing string manipulation. &lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-15 20:24:15, Yongqiang He wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/898/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-15 20:24:15)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;speedup addInputPaths&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2218&quot; title=&quot;speedup addInputPaths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2218&quot;&gt;&lt;del&gt;HIVE-2218&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2218&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 1135335 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1135335 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/898/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/898/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;yes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yongqiang&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13050040" author="he yongqiang" created="Wed, 15 Jun 2011 21:18:17 +0000"  >&lt;p&gt;use path.getParent instead of writing code to get the parent of a path&lt;/p&gt;</comment>
                            <comment id="13050144" author="nzhang" created="Wed, 15 Jun 2011 23:35:44 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13050566" author="nzhang" created="Thu, 16 Jun 2011 17:07:28 +0000"  >&lt;p&gt;Committed. Thanks Yongqiang!&lt;/p&gt;</comment>
                            <comment id="13054060" author="hudson" created="Thu, 23 Jun 2011 19:47:05 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #790 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/790/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/790/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482573" name="HIVE-2218.1.patch" size="9940" author="he yongqiang" created="Tue, 14 Jun 2011 17:33:58 +0000"/>
                            <attachment id="12482715" name="HIVE-2218.2.patch" size="3480" author="he yongqiang" created="Wed, 15 Jun 2011 20:54:20 +0000"/>
                            <attachment id="12482719" name="HIVE-2218.3.patch" size="3542" author="he yongqiang" created="Wed, 15 Jun 2011 21:18:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 14 Jun 2011 21:10:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>70149</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lizz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123728</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2219] Make &quot;alter table drop partition&quot; more efficient</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2219</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The current function dropTable() that handles dropping multiple partitions is somewhat inefficient.  For each partition you want to drop, it loops through each partition in the table to see if the partition exists.  This is an &lt;em&gt;O(mn)&lt;/em&gt; operation, where &lt;em&gt;m&lt;/em&gt; is the number of partitions to drop, and &lt;em&gt;n&lt;/em&gt; is the number of partitions in the table.  The running time of this function can be improved, which is useful for tables with many partitions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12510338">HIVE-2219</key>
            <summary>Make &quot;alter table drop partition&quot; more efficient</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sohanjain">Sohan Jain</assignee>
                                    <reporter username="sohanjain">Sohan Jain</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Jun 2011 18:40:34 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:51 +0000</updated>
                            <resolved>Wed, 6 Jul 2011 17:49:41 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13049420" author="sohanjain" created="Tue, 14 Jun 2011 21:07:52 +0000"  >&lt;p&gt;Improves the time it takes to check whether a partition to delete exists in the lists of partitions.  Overall improves the complexity to &lt;em&gt;O(m + n)&lt;/em&gt;&lt;/p&gt;</comment>
                            <comment id="13050847" author="pauly" created="Fri, 17 Jun 2011 01:43:40 +0000"  >&lt;p&gt;Can you make a reviewboard instance?&lt;/p&gt;</comment>
                            <comment id="13050874" author="sohanjain" created="Fri, 17 Jun 2011 02:49:04 +0000"  >&lt;p&gt;Ah sorry, after another round of testing, I realized this doesn&apos;t work correctly at all for partial partition specs!  I will re-implement it and test again for speed / full correctness.&lt;/p&gt;</comment>
                            <comment id="13052941" author="jiraposter@reviews.apache.org" created="Tue, 21 Jun 2011 23:40:48 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/941/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/941/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and Paul Yang.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Improve the efficiency of the function that handles dropping multiple partitions by finding the partitions to drop at the JDO level instead of iterating through all given partitions and existing partitions.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2219&quot; title=&quot;Make &amp;quot;alter table drop partition&amp;quot; more efficient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2219&quot;&gt;&lt;del&gt;HIVE-2219&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2219&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2219&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java 1138144 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/941/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/941/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Still passes drop_multi_partitions.q.  Tested speed on dropping ~10k partitions in a table with ~400k partitions.  This section of code took ~10 minutes after the change, and some amount &amp;gt; 30 minutes before.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Sohan&lt;/p&gt;
</comment>
                            <comment id="13056180" author="pauly" created="Mon, 27 Jun 2011 23:05:42 +0000"  >&lt;p&gt;+1 Will test and commit.&lt;/p&gt;</comment>
                            <comment id="13060719" author="pauly" created="Wed, 6 Jul 2011 17:49:41 +0000"  >&lt;p&gt;Committed. Thanks Sohan!&lt;/p&gt;</comment>
                            <comment id="13060941" author="hudson" created="Thu, 7 Jul 2011 00:10:22 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #813 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/813/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/813/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2219&quot; title=&quot;Make &amp;quot;alter table drop partition&amp;quot; more efficient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2219&quot;&gt;&lt;del&gt;HIVE-2219&lt;/del&gt;&lt;/a&gt;. Make &quot;alter table drop partition&quot; more efficient (Sohan Jain via pauly)&lt;/p&gt;

&lt;p&gt;pauly : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1143508&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1143508&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13062117" author="sohanjain" created="Fri, 8 Jul 2011 19:08:53 +0000"  >&lt;p&gt;This patch is the correct one from ReviewBoard&lt;/p&gt;</comment>
                            <comment id="13062132" author="jvs" created="Fri, 8 Jul 2011 19:45:43 +0000"  >&lt;p&gt;Since this patch already got committed, I would recommend opening a new JIRA issue to amend it.&lt;/p&gt;</comment>
                            <comment id="13062167" author="sohanjain" created="Fri, 8 Jul 2011 20:41:49 +0000"  >&lt;p&gt;Ok, please refer to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2275&quot; title=&quot;Revert HIVE-2219 and apply correct patch to improve the efficiency of dropping multiple partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2275&quot;&gt;&lt;del&gt;HIVE-2275&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13062179" author="pauly" created="Fri, 8 Jul 2011 21:03:50 +0000"  >&lt;p&gt;I likely mixed up the RB and JIRA versions - looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2275&quot; title=&quot;Revert HIVE-2219 and apply correct patch to improve the efficiency of dropping multiple partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2275&quot;&gt;&lt;del&gt;HIVE-2275&lt;/del&gt;&lt;/a&gt; now.&lt;/p&gt;</comment>
                            <comment id="13063600" author="hudson" created="Mon, 11 Jul 2011 23:24:59 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #821 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/821/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/821/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2275&quot; title=&quot;Revert HIVE-2219 and apply correct patch to improve the efficiency of dropping multiple partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2275&quot;&gt;&lt;del&gt;HIVE-2275&lt;/del&gt;&lt;/a&gt;. Revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2219&quot; title=&quot;Make &amp;quot;alter table drop partition&amp;quot; more efficient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2219&quot;&gt;&lt;del&gt;HIVE-2219&lt;/del&gt;&lt;/a&gt; and apply correct patch to improve the efficiency of dropping multiple partitions (Sohan Jain via pauly)&lt;/p&gt;

&lt;p&gt;pauly : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1145368&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1145368&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482592" name="HIVE-2219.1.patch" size="8183" author="sohanjain" created="Tue, 14 Jun 2011 21:07:52 +0000"/>
                            <attachment id="12485773" name="HIVE-2219.2.patch" size="3787" author="sohanjain" created="Fri, 8 Jul 2011 19:08:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Jun 2011 01:43:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>68343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lj07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2220] Better error messages for MetaStore configuration problems</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2220</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We need to improve the error messages seen by users when the metastore is not configured correctly.&lt;/p&gt;

&lt;p&gt;MySQL JDBC JAR not on classpath:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
hive&amp;gt; show tables;
show tables;
FAILED: Error in metadata: javax.jdo.JDOFatalInternalException: Error creating transactional connection factory
NestedThrowables:
java.lang.reflect.InvocationTargetException
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;JDBC URL references a MySQL DB that doesn&apos;t exist:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
hive&amp;gt; show tables;
FAILED: Error in metadata: javax.jdo.JDOFatalDataStoreException: Unknown database &apos;mdb&apos;
NestedThrowables:
com.mysql.jdbc.exceptions.MySQLSyntaxErrorException: Unknown database &apos;mdb&apos;
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;datanucleus.autoCreateSchema=false and metastore schema doesn&apos;t exist:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
hive&amp;gt; show tables;
FAILED: Error in metadata: javax.jdo.JDODataStoreException: Required table missing : &quot;`DBS`&quot; in Catalog &quot;&quot; Schema &quot;&quot;. 
DataNucleus requires this table to perform its persistence operations. Either your MetaData is incorrect,
or you need to enable &quot;datanucleus.autoCreateTables&quot;
NestedThrowables:
org.datanucleus.store.rdbms.exceptions.MissingTableException: Required table missing : &quot;`DBS`&quot; in Catalog &quot;&quot; Schema &quot;&quot;.
DataNucleus requires this table to perform its persistence operations. Either your MetaData is incorrect,
or you need to enable &quot;datanucleus.autoCreateTables&quot;
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12510379">HIVE-2220</key>
            <summary>Better error messages for MetaStore configuration problems</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Jun 2011 23:01:05 +0000</created>
                <updated>Sat, 6 Dec 2014 05:23:29 +0000</updated>
                                                                            <component>Diagnosability</component>
                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42222</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08o1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48496</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>
