<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Tue Jan 22 15:16:00 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+HIVE+AND+created+%3E%3D+2010-6-9+AND+created+%3C%3D+2010-6-16+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="14" total="14"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[HIVE-1398] Support union all without an outer select *</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1398</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;In hive for union alls the query has to be wrapped in an sub query as shown below:&lt;/p&gt;

&lt;p&gt;select * from &lt;br/&gt;
(select c1 from t1&lt;br/&gt;
  union all&lt;br/&gt;
  select c2 from t2);&lt;/p&gt;

&lt;p&gt;This JIRA proposes to fix that to support&lt;/p&gt;

&lt;p&gt;select c1 from t1&lt;br/&gt;
union all&lt;br/&gt;
select c2 from t2;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466605">HIVE-1398</key>
            <summary>Support union all without an outer select *</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hagleitn">Gunther Hagleitner</assignee>
                                    <reporter username="athusoo">Ashish Thusoo</reporter>
                        <labels>
                            <label>SQL</label>
                    </labels>
                <created>Wed, 9 Jun 2010 22:12:30 +0000</created>
                <updated>Wed, 10 Dec 2014 00:09:05 +0000</updated>
                            <resolved>Tue, 2 Dec 2014 19:46:40 +0000</resolved>
                                                    <fixVersion>0.13.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14231980" author="rbains" created="Tue, 2 Dec 2014 19:34:56 +0000"  >&lt;p&gt;Looks like it is fixed in Hive 0.14&lt;/p&gt;

&lt;p&gt;hive&amp;gt; insert into table foo1 select a,b from foo1 union all select a,b from foo3;&lt;br/&gt;
Query ID = rbains_20141202142626_58807159-1762-4855-aa36-3fc3803b9ab7&lt;br/&gt;
Total jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;/p&gt;


&lt;p&gt;Status: Running (application id: application_1414029100044_2856)&lt;/p&gt;

&lt;p&gt;Map 1: &lt;del&gt;/&lt;/del&gt;	Map 3: &lt;del&gt;/&lt;/del&gt;&lt;br/&gt;
Status: Finished successfully&lt;br/&gt;
Loading data to table default.foo1&lt;br/&gt;
Table default.foo1 stats: &lt;span class=&quot;error&quot;&gt;&amp;#91;numFiles=4, numRows=0, totalSize=0, rawDataSize=0&amp;#93;&lt;/span&gt;&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 2.575 seconds&lt;br/&gt;
hive&amp;gt; insert into table foo1 select a,b from foo1 union all select x as a,y as b from foo2;&lt;br/&gt;
Query ID = rbains_20141202143333_daaf52e4-7b15-413f-a0de-9b192cee2fcd&lt;br/&gt;
Total jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;/p&gt;


&lt;p&gt;Status: Running (application id: application_1414029100044_2856)&lt;/p&gt;

&lt;p&gt;Map 1: &lt;del&gt;/&lt;/del&gt;	Map 3: &lt;del&gt;/&lt;/del&gt;&lt;br/&gt;
Status: Finished successfully&lt;br/&gt;
Loading data to table default.foo1&lt;br/&gt;
Table default.foo1 stats: &lt;span class=&quot;error&quot;&gt;&amp;#91;numFiles=6, numRows=0, totalSize=0, rawDataSize=0&amp;#93;&lt;/span&gt;&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 2.396 seconds&lt;br/&gt;
hive&amp;gt;&lt;/p&gt;


&lt;p&gt;hive&amp;gt; insert into table foo1 select a,b from foo1 union all select x as a,y as b from foo2;&lt;br/&gt;
Query ID = rbains_20141202143333_daaf52e4-7b15-413f-a0de-9b192cee2fcd&lt;br/&gt;
Total jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;/p&gt;


&lt;p&gt;Status: Running (application id: application_1414029100044_2856)&lt;/p&gt;

&lt;p&gt;Map 1: &lt;del&gt;/&lt;/del&gt;	Map 3: &lt;del&gt;/&lt;/del&gt;&lt;br/&gt;
Status: Finished successfully&lt;br/&gt;
Loading data to table default.foo1&lt;br/&gt;
Table default.foo1 stats: &lt;span class=&quot;error&quot;&gt;&amp;#91;numFiles=6, numRows=0, totalSize=0, rawDataSize=0&amp;#93;&lt;/span&gt;&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 2.396 seconds&lt;br/&gt;
hive&amp;gt;&lt;/p&gt;</comment>
                            <comment id="14232038" author="ashutoshc" created="Tue, 2 Dec 2014 19:46:41 +0000"  >&lt;p&gt;yes, via &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6189&quot; title=&quot;Support top level union all statements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6189&quot;&gt;&lt;del&gt;HIVE-6189&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12466060">HIVE-1386</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12758786">HIVE-9002</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12688505">HIVE-6189</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Dec 2014 19:34:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42514</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08nbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48376</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1399] Nested UDAFs cause Hive Internal Error (NullPointerException)</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1399</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;This query does not make &quot;real-world&quot; sense, and I&apos;m guessing it&apos;s not even supported by HQL/SQL, but I&apos;m pretty sure that it shouldn&apos;t be causing an internal error with a NullPointerException. &quot;normal&quot; just has one column called &quot;val&quot;. I&apos;m running on trunk, svn updated 5 minutes ago, ant clean package.&lt;/p&gt;

&lt;p&gt;SELECT percentile(val, percentile(val, 0.5)) FROM normal;&lt;/p&gt;

&lt;p&gt;FAILED: Hive Internal Error: java.lang.NullPointerException(null)&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.hive.ql.plan.ExprNodeGenericFuncDesc.newInstance(ExprNodeGenericFuncDesc.java:153)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory$DefaultExprProcessor.getXpathOrFuncExprNodeDesc(TypeCheckProcFactory.java:587)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory$DefaultExprProcessor.process(TypeCheckProcFactory.java:708)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultRuleDispatcher.dispatch(DefaultRuleDispatcher.java:89)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.dispatch(DefaultGraphWalker.java:88)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.walk(DefaultGraphWalker.java:128)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.startWalking(DefaultGraphWalker.java:102)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genExprNodeDesc(SemanticAnalyzer.java:6241)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genGroupByPlanMapGroupByOperator(SemanticAnalyzer.java:2301)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genGroupByPlanMapAggr1MR(SemanticAnalyzer.java:2860)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genBodyPlan(SemanticAnalyzer.java:5002)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genPlan(SemanticAnalyzer.java:5524)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:6055)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:126)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:304)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.run(Driver.java:377)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:138)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:197)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:303)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;/p&gt;



&lt;p&gt;I&apos;ve also recreated this error with a GenericUDAF I&apos;m writing, and also with the following:&lt;/p&gt;

&lt;p&gt;SELECT percentile(val, percentile()) FROM normal;   &lt;br/&gt;
SELECT avg(variance(dob_year)) FROM somedata;     // this makes no sense, but still a NullPointerException&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466678">HIVE-1399</key>
            <summary>Nested UDAFs cause Hive Internal Error (NullPointerException)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="afokken">Adam Fokken</assignee>
                                    <reporter username="mayanklahiri">Mayank Lahiri</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jun 2010 18:21:25 +0000</created>
                <updated>Fri, 11 Jan 2013 00:25:59 +0000</updated>
                            <resolved>Fri, 11 Jan 2013 00:25:50 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13119097" author="jiraposter@reviews.apache.org" created="Sun, 2 Oct 2011 22:54:34 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2146/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2146/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1399&quot; title=&quot;Nested UDAFs cause Hive Internal Error (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1399&quot;&gt;&lt;del&gt;HIVE-1399&lt;/del&gt;&lt;/a&gt; - fix for null pointer with nested UDAFs&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1399&quot; title=&quot;Nested UDAFs cause Hive Internal Error (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1399&quot;&gt;&lt;del&gt;HIVE-1399&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1399&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1399&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java 2798eaa &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java 0fd4eb9 &lt;br/&gt;
  ql/src/test/queries/clientnegative/udaf_not_supported1.q e69de29 &lt;br/&gt;
  ql/src/test/results/clientnegative/udaf_not_supported1.q.out e69de29 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2146/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2146/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Adam&lt;/p&gt;
</comment>
                            <comment id="13128455" author="ashutoshc" created="Sun, 16 Oct 2011 17:30:11 +0000"  >&lt;p&gt;Looks good to me.&lt;br/&gt;
@Adam&lt;br/&gt;
You need to mark the issue as Patch Available so that it shows up in patch queue for commit.&lt;/p&gt;
</comment>
                            <comment id="13129090" author="jiraposter@reviews.apache.org" created="Mon, 17 Oct 2011 19:05:10 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2146/#review2625&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2146/#review2625&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2146/#comment5933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2146/#comment5933&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Need a better error message here since&lt;/p&gt;

&lt;p&gt;    (a) this validation rule applies to builtin aggregate function such as SUM also (so we should just refer to &quot;aggregate functions&quot; rather than UDAF&apos;s)&lt;/p&gt;

&lt;p&gt;    (b) this error message also shows up if you try to use an aggregate function in the WHERE clause (or anywhere other than SELECT/HAVING)&lt;/p&gt;

&lt;p&gt;    So either we need to discriminate the two contexts, or else come up with a wording that covers both without causing confusion.&lt;/p&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-10-02 22:54:26, Adam Fokken wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2146/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2146/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-02 22:54:26)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1399&quot; title=&quot;Nested UDAFs cause Hive Internal Error (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1399&quot;&gt;&lt;del&gt;HIVE-1399&lt;/del&gt;&lt;/a&gt; - fix for null pointer with nested UDAFs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1399&quot; title=&quot;Nested UDAFs cause Hive Internal Error (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1399&quot;&gt;&lt;del&gt;HIVE-1399&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1399&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1399&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java 2798eaa &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java 0fd4eb9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientnegative/udaf_not_supported1.q e69de29 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientnegative/udaf_not_supported1.q.out e69de29 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2146/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2146/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Adam&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13129091" author="jvs" created="Mon, 17 Oct 2011 19:05:18 +0000"  >&lt;p&gt;Other than error message details, patch looks good.&lt;/p&gt;</comment>
                            <comment id="13184682" author="shrijeet" created="Thu, 12 Jan 2012 02:53:00 +0000"  >&lt;p&gt;Hello folks. I think there are more issues. I saw an NPE today on a query which did not have a nested UDAF. I applied the patch and it gave me &quot;not allowed error&quot; . Here is the query : &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select p_id as pid, 
       sum(1) as reqs
from table
where date = 20120110
and (p_id = 15368 or p_id = 15369 or p_id = 15370)
group by p_id, 
       sum(1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What am I missing here. This should be allowed, no?&lt;/p&gt;</comment>
                            <comment id="13184683" author="shrijeet" created="Thu, 12 Jan 2012 02:54:56 +0000"  >&lt;p&gt;My version is 0.8-r2 . Last commit : 0f94fa57d516a8c994dacc1d62c6eab9854f368e&lt;/p&gt;</comment>
                            <comment id="13402762" author="appodictic" created="Thu, 28 Jun 2012 01:29:18 +0000"  >&lt;p&gt;All. This patch looks good. Lets not let this sit over an error message. &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Aggregate functions should not be nested and can not be in a clause other than a SELECT or HAVING clause. &lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13527307" author="ashutoshc" created="Sun, 9 Dec 2012 00:37:01 +0000"  >&lt;p&gt;I agree. Ed, your error message looks appropriate to me. Can you update the patch with that? After that, please commit the patch if tests pass.&lt;/p&gt;</comment>
                            <comment id="13550491" author="brocknoland" created="Thu, 10 Jan 2013 22:08:41 +0000"  >&lt;p&gt;Hi Adam,&lt;/p&gt;

&lt;p&gt;I haven&apos;t seen an update in a while. Do you mind if I take this up?&lt;/p&gt;

&lt;p&gt;Brock&lt;/p&gt;</comment>
                            <comment id="13550517" author="ashutoshc" created="Thu, 10 Jan 2013 22:33:57 +0000"  >&lt;p&gt;Sure, please go ahead.&lt;/p&gt;</comment>
                            <comment id="13550532" author="afokken" created="Thu, 10 Jan 2013 22:48:12 +0000"  >&lt;p&gt;Yes. Please do.&lt;/p&gt;
</comment>
                            <comment id="13550546" author="brocknoland" created="Thu, 10 Jan 2013 22:59:55 +0000"  >&lt;p&gt;OK great! I&apos;ll have an updated patch shortly. Doesn&apos;t look like I have privileges to assign the jira to myself.&lt;/p&gt;</comment>
                            <comment id="13550579" author="brocknoland" created="Fri, 11 Jan 2013 00:05:06 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I think we can close this issue and link it to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2956&quot; title=&quot;[hive] Provide error message when using UDAF in the place of UDF instead of throwing NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2956&quot;&gt;&lt;del&gt;HIVE-2956&lt;/del&gt;&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2956&quot; title=&quot;[hive] Provide error message when using UDAF in the place of UDF instead of throwing NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2956&quot;&gt;&lt;del&gt;HIVE-2956&lt;/del&gt;&lt;/a&gt; has resolved this issue.&lt;/p&gt;

&lt;p&gt;For example, the below output comes from a trunk build:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; select avg(avg(key)) from src;                      
FAILED: SemanticException [Error 10128]: Line 1:11 Not yet supported place for UDAF &apos;avg&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13550599" author="ashutoshc" created="Fri, 11 Jan 2013 00:25:50 +0000"  >&lt;p&gt;Fixed via &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2956&quot; title=&quot;[hive] Provide error message when using UDAF in the place of UDF instead of throwing NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2956&quot;&gt;&lt;del&gt;HIVE-2956&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12499371" name="HIVE-1399.1.patch.txt" size="2345" author="afokken" created="Mon, 17 Oct 2011 14:02:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 2 Oct 2011 22:54:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42513</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lew7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123063</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1400] CombineHiveInputFormat does not set &quot;columns needed&quot; property</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1400</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When i was testing a job, i found it seems CombineHiveInputFormat did not pass columns needed to the underlying reader. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12466695">HIVE-1400</key>
            <summary>CombineHiveInputFormat does not set &quot;columns needed&quot; property</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jun 2010 22:42:46 +0000</created>
                <updated>Thu, 10 Jun 2010 22:42:46 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lewf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123064</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-1401] Web Interface can ony browse default</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1401</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12466704">HIVE-1401</key>
            <summary>Web Interface can ony browse default</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="appodictic">Edward Capriolo</assignee>
                                    <reporter username="appodictic">Edward Capriolo</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Jun 2010 01:23:56 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:53 +0000</updated>
                            <resolved>Sat, 31 Jul 2010 05:13:57 +0000</resolved>
                                    <version>0.5.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Web UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12877684" author="appodictic" created="Fri, 11 Jun 2010 01:30:00 +0000"  >&lt;p&gt;This patch is to support hive getting multiple catalog support.&lt;/p&gt;</comment>
                            <comment id="12879979" author="hbasereviewboard" created="Thu, 17 Jun 2010 22:28:51 +0000"  >&lt;p&gt;Message from: &quot;Carl Steinbach&quot; &amp;lt;carl@cloudera.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/205/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/205/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for Hive Developers.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Review for &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12446827/HIVE-1401-1-patch.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12446827/HIVE-1401-1-patch.txt&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1401&quot; title=&quot;Web Interface can ony browse default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1401&quot;&gt;&lt;del&gt;HIVE-1401&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HIVE-1401&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HIVE-1401&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/hwi/web/index.jsp 953471 &lt;br/&gt;
  trunk/hwi/web/session_result.jsp 953471 &lt;br/&gt;
  trunk/hwi/web/set_processor.jsp 953471 &lt;br/&gt;
  trunk/hwi/web/show_database.jsp 953471 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/205/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/205/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Carl&lt;/p&gt;

</comment>
                            <comment id="12894199" author="jvs" created="Fri, 30 Jul 2010 23:36:48 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="12894249" author="jvs" created="Sat, 31 Jul 2010 05:13:57 +0000"  >&lt;p&gt;Committed to branch and trunk.  Thanks Edward!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12446827" name="HIVE-1401-1-patch.txt" size="4570" author="appodictic" created="Fri, 11 Jun 2010 01:27:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Jun 2010 22:28:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72925</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lewn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123065</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1402] Add parallel ORDER BY to Hive</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1402</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12466807">HIVE-1402</key>
            <summary>Add parallel ORDER BY to Hive</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="navis">Navis</assignee>
                                    <reporter username="hammer">Jeff Hammerbacher</reporter>
                        <labels>
                            <label>TODOC12</label>
                            <label>optimization</label>
                    </labels>
                <created>Sat, 12 Jun 2010 06:00:50 +0000</created>
                <updated>Mon, 1 Sep 2014 07:45:53 +0000</updated>
                            <resolved>Sun, 23 Jun 2013 17:10:18 +0000</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>26</watches>
                                                                <comments>
                            <comment id="12878213" author="hammer" created="Sat, 12 Jun 2010 06:01:44 +0000"  >&lt;p&gt;From Ning Zhang:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;order by is supported in trunk with certain limititions in strict mode (has to have a limit)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From John Sichi:&lt;/p&gt;

&lt;p&gt;&amp;gt; If someone is interested in adding parallel ORDER BY to Hive (using TotalOrderPartitioner), here&apos;s a good starting point: &lt;a href=&quot;http://wiki.apache.org/hadoop/Hive/HBaseBulkLoad&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hive/HBaseBulkLoad&lt;/a&gt;&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; The goal would be to take that manual two-step sample-then-sort process and turn it into an automatic plan within Hive.  I have a better example for the sampling query which I &amp;gt; haven&apos;t published yet.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; We would also need to name the final output files in such a way that the total order could be iterated via the filenames.&lt;/p&gt;</comment>
                            <comment id="12880120" author="zjffdu" created="Fri, 18 Jun 2010 08:32:24 +0000"  >&lt;p&gt;Hi, I make a draft implementation for one special case. And it works, but since it is only for one special case, so I have some hard coding. I hope someone can give some help or instruction for the next step. &lt;br/&gt;
One big problem of parallel ORDER BY is that the output  key type of ExecMapper is HiveKey, and it has been serialized by LazyBinarySerDe, so the original column type is lost here. But when do sampling and partition, I should use the original column type.&lt;/p&gt;

&lt;p&gt;The following is my initial design.&lt;/p&gt;

&lt;p&gt;1. During parse stage, extract one SampleOperator which has two children: TableScanOperator, SelectOperator ( I am not familiar with Hive Parse Stage, and the code is not clear for me, could anyone give some help or recommend some documentation about the Hive parser ? )&lt;/p&gt;

&lt;p&gt;2. Modify the TotalOrderPartitioner.  Add a Deserializer to convert the HiveKey to its original column type. and deserialie the HiveKey in method getPartition(). &lt;/p&gt;

&lt;p&gt;Welcome any comments and help.&lt;/p&gt;
</comment>
                            <comment id="13586556" author="phabricator@reviews.facebook.net" created="Tue, 26 Feb 2013 01:00:11 +0000"  >&lt;p&gt;navis requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1402&quot; title=&quot;Add parallel ORDER BY to Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1402&quot;&gt;&lt;del&gt;HIVE-1402&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add parallel ORDER BY to Hive&quot;.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1402&quot; title=&quot;Add parallel ORDER BY to Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1402&quot;&gt;&lt;del&gt;HIVE-1402&lt;/del&gt;&lt;/a&gt; Add parallel ORDER BY to Hive&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8895&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D8895&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/HiveTotalOrderPartitioner.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/PartitionKeySampler.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingInferenceOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/CommonJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/IndexWhereResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MapJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MetadataOnlyOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalContext.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SamplingOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SkewJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/PartitionDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFPercentile.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/parallel_orderby.q&lt;br/&gt;
  ql/src/test/results/clientpositive/parallel_orderby.q.out&lt;/p&gt;

&lt;p&gt;MANAGE HERALD RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/21627/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/21627/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;/p&gt;</comment>
                            <comment id="13659200" author="appodictic" created="Thu, 16 May 2013 03:57:24 +0000"  >&lt;p&gt;Navis I clicked submit patch for you. Is this clean and ready to go? This is a feature hive has gone way to long without.&lt;/p&gt;</comment>
                            <comment id="13665012" author="navis" created="Thu, 23 May 2013 08:56:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=appodictic&quot; class=&quot;user-hover&quot; rel=&quot;appodictic&quot;&gt;Edward Capriolo&lt;/a&gt; Sadly it&apos;s not. I should do some works on this.&lt;/p&gt;</comment>
                            <comment id="13667442" author="phabricator@reviews.facebook.net" created="Mon, 27 May 2013 02:16:20 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1402&quot; title=&quot;Add parallel ORDER BY to Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1402&quot;&gt;&lt;del&gt;HIVE-1402&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add parallel ORDER BY to Hive&quot;.&lt;/p&gt;

&lt;p&gt;  Rebased to trunk &amp;amp; changed to mini-mr test&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8895&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D8895&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8895?vs=28641&amp;amp;id=33999#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D8895?vs=28641&amp;amp;id=33999#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build-common.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/HiveTotalOrderPartitioner.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/PartitionKeySampler.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingInferenceOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/IndexWhereResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MapJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MetadataOnlyOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalContext.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SamplingOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SkewJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/PartitionDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFPercentile.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/parallel_orderby.q&lt;br/&gt;
  ql/src/test/results/clientpositive/parallel_orderby.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;/p&gt;</comment>
                            <comment id="13674020" author="phabricator@reviews.facebook.net" created="Tue, 4 Jun 2013 04:16:20 +0000"  >&lt;p&gt;brock has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1402&quot; title=&quot;Add parallel ORDER BY to Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1402&quot;&gt;&lt;del&gt;HIVE-1402&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add parallel ORDER BY to Hive&quot;.&lt;/p&gt;

&lt;p&gt;  Hi&lt;/p&gt;

&lt;p&gt;  It doesn&apos;t look like this patch applies to trunk. For example, HiveTotalOrderPartitioner should be a totally new file, correct? However, in the diff it&apos;s not:&lt;/p&gt;

&lt;p&gt;  ===================================================================&lt;br/&gt;
  &amp;#8212; ql/src/java/org/apache/hadoop/hive/ql/exec/HiveTotalOrderPartitioner.java&lt;br/&gt;
  +++ ql/src/java/org/apache/hadoop/hive/ql/exec/HiveTotalOrderPartitioner.java&lt;br/&gt;
  @@ -1,4 +1,6 @@&lt;br/&gt;
   /**&lt;br/&gt;
  + * Copyright 2010 The Apache Software Foundation&lt;br/&gt;
  + *&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Licensed to the Apache Software Foundation (ASF) under one&lt;/li&gt;
	&lt;li&gt;or more contributor license agreements.  See the NOTICE file&lt;/li&gt;
	&lt;li&gt;distributed with this work for additional information&lt;br/&gt;
  @@ -18,34 +20,24 @@&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   package org.apache.hadoop.hive.ql.exec;&lt;/p&gt;

&lt;p&gt;  -import java.util.Collection;&lt;br/&gt;
  -import java.util.HashSet;&lt;br/&gt;
  -import java.util.Set;&lt;br/&gt;
  +import org.apache.hadoop.hive.ql.io.HiveKey;&lt;br/&gt;
  +import org.apache.hadoop.io.BytesWritable;&lt;br/&gt;
  +import org.apache.hadoop.mapred.JobConf;&lt;br/&gt;
  +import org.apache.hadoop.mapred.Partitioner;&lt;br/&gt;
  +import org.apache.hadoop.mapred.lib.TotalOrderPartitioner;&lt;/p&gt;

&lt;p&gt;  -public class OperatorUtils {&lt;br/&gt;
  +public class HiveTotalOrderPartitioner implements Partitioner&amp;lt;HiveKey, Object&amp;gt; {&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8895&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D8895&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13679317" author="navis" created="Mon, 10 Jun 2013 05:11:42 +0000"  >&lt;p&gt;Arcanist makes strange patch file sometimes and I don&apos;t know how to fix that. Attaching patch file.&lt;/p&gt;</comment>
                            <comment id="13679319" author="phabricator@reviews.facebook.net" created="Mon, 10 Jun 2013 05:12:20 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1402&quot; title=&quot;Add parallel ORDER BY to Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1402&quot;&gt;&lt;del&gt;HIVE-1402&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add parallel ORDER BY to Hive&quot;.&lt;/p&gt;

&lt;p&gt;  Rebased to trunk&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8895&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D8895&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8895?vs=33999&amp;amp;id=34485#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D8895?vs=33999&amp;amp;id=34485#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build-common.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/HiveTotalOrderPartitioner.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/PartitionKeySampler.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingInferenceOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/IndexWhereResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MapJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MetadataOnlyOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalContext.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SamplingOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SkewJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/PartitionDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFPercentile.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/parallel_orderby.q&lt;br/&gt;
  ql/src/test/results/clientpositive/parallel_orderby.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13688799" author="phabricator@reviews.facebook.net" created="Thu, 20 Jun 2013 02:20:21 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1402&quot; title=&quot;Add parallel ORDER BY to Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1402&quot;&gt;&lt;del&gt;HIVE-1402&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add parallel ORDER BY to Hive&quot;.&lt;/p&gt;

&lt;p&gt;  Support UDTFs&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8895&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D8895&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8895?vs=34485&amp;amp;id=34965#toc&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D8895?vs=34485&amp;amp;id=34965#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build-common.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/HiveTotalOrderPartitioner.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/PartitionKeySampler.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingCtx.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingInferenceOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/IndexWhereResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MapJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MetadataOnlyOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalContext.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SamplingOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SkewJoinResolver.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/PartitionDesc.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFPercentile.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/parallel_orderby.q&lt;br/&gt;
  ql/src/test/results/clientpositive/parallel_orderby.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13688805" author="appodictic" created="Thu, 20 Jun 2013 02:36:00 +0000"  >&lt;p&gt;Im going to start reviewing this one and run these tests tonight hopefully. &lt;/p&gt;</comment>
                            <comment id="13691188" author="appodictic" created="Sat, 22 Jun 2013 16:59:02 +0000"  >&lt;p&gt;Tests running. The patch .4 is still not clean. TotalOrderPartitioner is not right. I copied it by hand from fabricator for now. I like the idea to leave the feature off by default for now. But typically we enable this to true for full test coverage. Maybe we dothis as a follow on issue.&lt;/p&gt;</comment>
                            <comment id="13691335" author="appodictic" created="Sun, 23 Jun 2013 03:15:11 +0000"  >&lt;p&gt;Navis. Nice work all tests pass. One thing I noticed.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;        for (FileStatus status : fs.globStatus(new Path(inputPath, &quot;.sampling*&quot;))) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+          sampler.addSampleFile(status.getPath(), job);+        }&lt;/span&gt; &lt;/div&gt;&lt;/blockquote&gt;

&lt;p&gt;For hadoop hidden files by convention start with &apos;_&apos; not &apos;.&apos; . Does it make sense to say &quot;_sampling*&quot; here. Possibly put this as a constant at the top of the file.&lt;/p&gt;

&lt;p&gt;So please fix the above thing if you think it is a good idea, and regenerate the patch so it applies clean please.&lt;/p&gt;

&lt;p&gt;Then I will commit.&lt;/p&gt;</comment>
                            <comment id="13691446" author="navis" created="Sun, 23 Jun 2013 12:23:14 +0000"  >&lt;p&gt;I&apos;ve seen code in FileInputFormat in hadoop which ignores files starting with &apos;_&apos; and &apos;.&apos;  &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;private static final PathFilter hiddenFileFilter = new PathFilter(){
  public boolean accept(Path p){
    String name = p.getName(); 
    return !name.startsWith(&quot;_&quot;) &amp;amp;&amp;amp; !name.startsWith(&quot;.&quot;); 
  }
}; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If it&apos;s convention as you said, I don&apos;t bother changing it to &apos;_&apos; (I&apos;ll update it tomorrow morning). Thanks for review!&lt;/p&gt;</comment>
                            <comment id="13691476" author="appodictic" created="Sun, 23 Jun 2013 14:32:46 +0000"  >&lt;p&gt;You do not have to change &apos;.&apos; to &apos;_&apos;. I was under the impression that it was only _ but apparently it is both. &lt;/p&gt;

&lt;p&gt;Just regenerate the patch so it applies clean. If you do not have time I will do it later this afternoon.&lt;/p&gt;</comment>
                            <comment id="13691521" author="appodictic" created="Sun, 23 Jun 2013 17:10:18 +0000"  >&lt;p&gt;Committed thanks Navis and Jeff&lt;/p&gt;</comment>
                            <comment id="13691522" author="appodictic" created="Sun, 23 Jun 2013 17:11:08 +0000"  >&lt;p&gt;@Navis I had to merge whatever fabricator did to the patch. I committed what I tested. If you want to modify anything we should open up a follow on.&lt;/p&gt;</comment>
                            <comment id="13692391" author="hudson" created="Mon, 24 Jun 2013 21:13:02 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #255 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/255/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/255/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1402&quot; title=&quot;Add parallel ORDER BY to Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1402&quot;&gt;&lt;del&gt;HIVE-1402&lt;/del&gt;&lt;/a&gt; Add parallel order by to hive (Navis Ryu and Jeff Zhang via egc)&lt;/p&gt;

&lt;p&gt;Submitted by:	Navis Ryu&lt;br/&gt;
Reviewed by:	Edward Capriolo (Revision 1495847)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
ecapriolo : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1495847&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1495847&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/build-common.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/HiveTotalOrderPartitioner.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/PartitionKeySampler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/BucketingSortingInferenceOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/IndexWhereResolver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MapJoinResolver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/MetadataOnlyOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalContext.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/PhysicalOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SamplingOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/SkewJoinResolver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/PartitionDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFPercentile.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/parallel_orderby.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/parallel_orderby.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13696364" author="ashutoshc" created="Sun, 30 Jun 2013 16:33:35 +0000"  >&lt;p&gt;Newly added test parallel_orderby.q is consistently failing on trunk. &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2166/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2166/&lt;/a&gt; &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2168/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2168/&lt;/a&gt; etc. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=appodictic&quot; class=&quot;user-hover&quot; rel=&quot;appodictic&quot;&gt;Edward Capriolo&lt;/a&gt; Would you like to take a look?&lt;/p&gt;</comment>
                            <comment id="13696864" author="appodictic" created="Mon, 1 Jul 2013 15:08:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;Navis&lt;/a&gt; I am guessing that we might need something in the shim layer, because total order partitioner does not work consistently across hadoop versions?&lt;/p&gt;</comment>
                            <comment id="13697402" author="navis" created="Tue, 2 Jul 2013 01:22:50 +0000"  >&lt;p&gt;Yes, strange. I&apos;ll look into this.&lt;/p&gt;</comment>
                            <comment id="13795927" author="ashutoshc" created="Tue, 15 Oct 2013 23:29:47 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                            <comment id="14117133" author="lefty@hortonworks.com" created="Mon, 1 Sep 2014 07:44:47 +0000"  >&lt;p&gt;Doc note:  This added three configuration parameters to HiveConf.java and &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-7669&quot; title=&quot;parallel order by clause on a string column fails with IOException: Split points are out of order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-7669&quot;&gt;&lt;del&gt;HIVE-7669&lt;/del&gt;&lt;/a&gt; gives them descriptions:  &lt;b&gt;hive.optimize.sampling.orderby&lt;/b&gt;, &lt;b&gt;hive.optimize.sampling.orderby.number&lt;/b&gt;, and &lt;b&gt;hive.optimize.sampling.orderby.percent&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;They need to be documented in the wiki here:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-QueryandDDLExecution&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Configuration Properties &amp;#8211; Query and DDL Execution &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12625375">HIVE-3841</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12653840">HIVE-4765</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12655719">HIVE-4804</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12732985">HIVE-7669</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12408391">HIVE-61</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12587025" name="HIVE-1402.1.patch.txt" size="41049" author="navis" created="Mon, 10 Jun 2013 05:11:42 +0000"/>
                            <attachment id="12570902" name="HIVE-1402.D8895.1.patch" size="37739" author="phabricator@reviews.facebook.net" created="Tue, 26 Feb 2013 01:00:11 +0000"/>
                            <attachment id="12584886" name="HIVE-1402.D8895.2.patch" size="39593" author="phabricator@reviews.facebook.net" created="Mon, 27 May 2013 02:16:20 +0000"/>
                            <attachment id="12587026" name="HIVE-1402.D8895.3.patch" size="39644" author="phabricator@reviews.facebook.net" created="Mon, 10 Jun 2013 05:12:20 +0000"/>
                            <attachment id="12588748" name="HIVE-1402.D8895.4.patch" size="37976" author="phabricator@reviews.facebook.net" created="Thu, 20 Jun 2013 02:20:21 +0000"/>
                            <attachment id="12589323" name="hive-1402.patch.6.txt" size="38560" author="appodictic" created="Sun, 23 Jun 2013 16:53:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Jun 2010 08:32:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42511</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lewv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123066</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1403] Reporting progress to JT during closing files in FileSinkOperator</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1403</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;If there are too many files need to be closed in FileSinkOperator (e.g., if DynamicPartition/FileSpray is turned on), there could be many files generated by each task and they need to be closed at the FileSinkOperator.closeOp(). If the NN is overloaded each file close could take more than 1 sec. This sometimes make JT think the task is dead since it takes too long to close all the files and without any progress report. We need to report progress after a while during file closing. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12466924">HIVE-1403</key>
            <summary>Reporting progress to JT during closing files in FileSinkOperator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nzhang">Ning Zhang</assignee>
                                    <reporter username="nzhang">Ning Zhang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jun 2010 20:15:51 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:23 +0000</updated>
                            <resolved>Tue, 15 Jun 2010 15:31:01 +0000</resolved>
                                                    <fixVersion>0.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12878743" author="nzhang" created="Mon, 14 Jun 2010 21:04:12 +0000"  >&lt;p&gt;this patch report progress periodically during closing all the files. &lt;/p&gt;</comment>
                            <comment id="12878763" author="namit" created="Mon, 14 Jun 2010 21:58:28 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;looks good - will commit if the tests pass&lt;/p&gt;</comment>
                            <comment id="12879003" author="namit" created="Tue, 15 Jun 2010 15:31:00 +0000"  >&lt;p&gt;Committed. Thanks Ning&lt;/p&gt;</comment>
                            <comment id="12887577" author="sdong" created="Mon, 12 Jul 2010 22:56:12 +0000"  >&lt;p&gt;The previous patch doesn&apos;t seem to be complete.&lt;br/&gt;
This patch will cover the timeout case under multiple directories.&lt;/p&gt;</comment>
                            <comment id="12888028" author="nzhang" created="Tue, 13 Jul 2010 21:40:56 +0000"  >&lt;p&gt;Siying, the new patch looks good in general, but can you open a different JIRA and upload your patch to that?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12449302" name="HIVE-1403.1.patch" size="7038" author="sdong" created="Mon, 12 Jul 2010 22:56:12 +0000"/>
                            <attachment id="12447066" name="HIVE-1403.patch" size="3407" author="nzhang" created="Mon, 14 Jun 2010 21:04:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Jun 2010 21:58:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72924</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lex3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123067</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1404] Allow UDAFs to turn off map-side aggregation</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1404</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Some UDAFs such as COLLECT will not work with map-side aggregation (because each mapper must hold all of its contents in memory).   To use such a function at the moment, one has to remember to set hive.map.aggr.  This has two problems:&lt;/p&gt;

&lt;p&gt;1.) The user has to remember to set this flag or else bad things will happen.&lt;br/&gt;
2.) The flag applies to the entire query plan rather than just the block containing the COLLECT statement.&lt;/p&gt;

&lt;p&gt;It would be good to have a bit in the UDAF which would tell the compiler to turn off map-side aggregation for just the block containing the UDAF.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466928">HIVE-1404</key>
            <summary>Allow UDAFs to turn off map-side aggregation</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jonchang">Jonathan Chang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jun 2010 20:32:32 +0000</created>
                <updated>Mon, 14 Jun 2010 23:00:55 +0000</updated>
                                            <version>0.5.0</version>
                                                    <component>Query Processor</component>
                    <component>UDF</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42510</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lexb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-1405] hive command line option -i to run an init file before other SQL commands</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1405</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When deploying hive, it would be nice to have a .hiverc file containing statements that would be automatically run whenever hive is launched.  This way, we can automatically add JARs, create temporary functions, set flags, etc. for all users quickly. &lt;/p&gt;

&lt;p&gt;This should ideally be set up like .bashrc and the like with a global version and a user-local version.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466930">HIVE-1405</key>
            <summary>hive command line option -i to run an init file before other SQL commands</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jvs">John Sichi</assignee>
                                    <reporter username="jonchang">Jonathan Chang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jun 2010 20:38:00 +0000</created>
                <updated>Thu, 2 May 2013 02:29:32 +0000</updated>
                            <resolved>Thu, 24 Jun 2010 22:51:52 +0000</resolved>
                                    <version>0.5.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12880002" author="jvs" created="Thu, 17 Jun 2010 23:33:53 +0000"  >&lt;p&gt;I&apos;m thinking of addressing the requirement by adding a -i option to explicitly specify an initialization script.  This could be used multiple times to invoke multiple initialization scripts in the order they appear on the hive command line, e.g.&lt;/p&gt;

&lt;p&gt;hive -i /everyone/hiveinit.sql -i /home/jvs/myhiveinit.sql -f test.sql&lt;/p&gt;

&lt;p&gt;The new -i option would be compatible with -f, -e, and with interactive console (no -f/-e).  The -i scripts would always be run before the -e/-f.&lt;/p&gt;

&lt;p&gt;This allows wrapper scripts to build up the global/local .bashrc functionality in installation-specific ways; I don&apos;t think we want to dictate that within Hive itself.&lt;/p&gt;

&lt;p&gt;Would this be good enough?&lt;/p&gt;</comment>
                            <comment id="12880015" author="cwsteinbach" created="Fri, 18 Jun 2010 00:24:20 +0000"  >&lt;p&gt;An alternative approach is to add a &quot;source &amp;lt;filename&amp;gt;&quot; command to the CLIDriver, and to have it load ~/.hiverc first if it is present. A user&apos;s .hiverc can in turn source a global .hiverc.&lt;/p&gt;</comment>
                            <comment id="12880028" author="appodictic" created="Fri, 18 Jun 2010 01:14:33 +0000"  >&lt;p&gt;I like Carl&apos;s approach. The entire point of the hiverc is not to explicitly have to do invoke anything explicit to add jars.&lt;/p&gt;</comment>
                            <comment id="12880032" author="jvs" created="Fri, 18 Jun 2010 01:29:30 +0000"  >&lt;p&gt;There is already an equivalent of the source command (exclamation mark)&lt;/p&gt;

&lt;p&gt;! test.sql&lt;/p&gt;

&lt;p&gt;So that can be used to do the chaining if desired.&lt;/p&gt;</comment>
                            <comment id="12880033" author="jvs" created="Fri, 18 Jun 2010 01:30:45 +0000"  >&lt;p&gt;The new -i will be the equivalent of bash --init-file.&lt;/p&gt;</comment>
                            <comment id="12880041" author="cwsteinbach" created="Fri, 18 Jun 2010 01:52:58 +0000"  >&lt;ul&gt;
	&lt;li&gt;Can someone please add a &quot;CLI&quot; component to JIRA?&lt;/li&gt;
	&lt;li&gt;I think it would be good to add &quot;source&quot; as a synonym for &quot;!&quot;. MySQL uses &quot;source &amp;lt;file&amp;gt;&quot; and &quot;\. &amp;lt;file&amp;gt;&quot;. See &lt;a href=&quot;http://dev.mysql.com/doc/refman/5.0/en/batch-commands.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dev.mysql.com/doc/refman/5.0/en/batch-commands.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12880053" author="appodictic" created="Fri, 18 Jun 2010 02:26:45 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[edward@ec dist]$ echo show tables &amp;gt; a.sql
[edward@ec dist]$ bin/hive
[edward@ec dist]$ chmod a+x a.sql 
[edward@ec dist]$ bin/hive
Hive history file=/tmp/edward/hive_job_log_edward_201006172223_1189860304.txt
[edward@ec dist]$ pwd
/mnt/data/hive/hive/build/dist
[edward@ec dist]$ bin/hive
Hive history file=/tmp/edward/hive_job_log_edward_201006172223_310534855.txt
hive&amp;gt; ! /mnt/data/hive/hive/build/dist/a.sql;
/mnt/data/hive/hive/build/dist/a.sql: line 1: show: command not found
Command failed with exit code = 127
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;! seems to execute bash commands&lt;/p&gt;

&lt;p&gt;Dont we want to execute hive commands inside hive like add jar&lt;/p&gt;</comment>
                            <comment id="12880061" author="jvs" created="Fri, 18 Jun 2010 03:09:26 +0000"  >&lt;p&gt;Oops, you are right Edward...I only skimmed the doc; ! is for shell commands, not SQL scripts.  Sorry for the confusion.&lt;/p&gt;

&lt;p&gt;We can add source for SQL script invocation.&lt;/p&gt;</comment>
                            <comment id="12880207" author="appodictic" created="Fri, 18 Jun 2010 14:08:22 +0000"  >&lt;p&gt;I was thinking we just look for hive_rc in the users home directory and/or in hive_home/bin. If we find that file we have to read it line by line and process it just like other hive commands. We could restrict this to just set or add commands but there is no reason it could not have a full query.&lt;/p&gt;</comment>
                            <comment id="12880263" author="jvs" created="Fri, 18 Jun 2010 17:42:07 +0000"  >&lt;p&gt;For this JIRA issue, I&apos;m just going to do the -i option proposed above.  I&apos;ll create separate issues for automatically reading a .hiverc and for the source command.&lt;/p&gt;</comment>
                            <comment id="12880270" author="jvs" created="Fri, 18 Jun 2010 18:05:28 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1414&quot; title=&quot;automatically invoke .hiverc init script&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1414&quot;&gt;&lt;del&gt;HIVE-1414&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1415&quot; title=&quot;add CLI command for executing a SQL script&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1415&quot;&gt;&lt;del&gt;HIVE-1415&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12880296" author="jvs" created="Fri, 18 Jun 2010 19:34:48 +0000"  >&lt;p&gt;The -i scripts will always run in silent (-S) mode.  However, if they encounter an error, CLI will print the message and abort.&lt;/p&gt;</comment>
                            <comment id="12882180" author="namit" created="Thu, 24 Jun 2010 15:11:33 +0000"  >&lt;p&gt;Do you want to move the tables created in QTestUtil (src, srcpart etc.) in the new init file&lt;/p&gt;</comment>
                            <comment id="12882186" author="jvs" created="Thu, 24 Jun 2010 15:20:50 +0000"  >&lt;p&gt;I was thinking about that, but some of the information (e.g. path) is environment-specific.  Also, can we do anything like this in a followup JIRA so that this can go in as is?&lt;/p&gt;</comment>
                            <comment id="12882249" author="namit" created="Thu, 24 Jun 2010 17:58:58 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1433&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1433&lt;/a&gt; as a followup&lt;/p&gt;</comment>
                            <comment id="12882383" author="namit" created="Thu, 24 Jun 2010 22:51:52 +0000"  >&lt;p&gt;Committed. Thanks John&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12467823">HIVE-1433</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12467823">HIVE-1433</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12467364">HIVE-1414</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12447497" name="HIVE-1405.1.patch" size="9067" author="jvs" created="Fri, 18 Jun 2010 22:29:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Jun 2010 23:33:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lexj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123069</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1406] for query against non-native table such as HBase, choose number of mapper tasks automatically</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1406</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;For native tables, we do this automatically, but for HBase tables, we get only 2 mappers by default.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466934">HIVE-1406</key>
            <summary>for query against non-native table such as HBase, choose number of mapper tasks automatically</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jun 2010 21:43:01 +0000</created>
                <updated>Mon, 28 Mar 2011 19:34:11 +0000</updated>
                                            <version>0.6.0</version>
                                                    <component>HBase Handler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42509</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i014x3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4566</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-1407] Add hadoop-*-tools.jar to Eclipse classpath</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1407</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;A recent change to Hadoop20Shims.java added a dependency to o.a.h.tools.HadoopArchives.&lt;br/&gt;
Consequently, we need to add hadoop-*-tools.jar to the eclipse classpath.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466947">HIVE-1407</key>
            <summary>Add hadoop-*-tools.jar to Eclipse classpath</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cwsteinbach">Carl Steinbach</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jun 2010 00:40:24 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:54 +0000</updated>
                            <resolved>Tue, 15 Jun 2010 06:23:59 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Build Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12878862" author="nzhang" created="Tue, 15 Jun 2010 05:59:59 +0000"  >&lt;p&gt;+1. Will commit if it pass tests on eclipse. &lt;/p&gt;</comment>
                            <comment id="12878865" author="nzhang" created="Tue, 15 Jun 2010 06:23:59 +0000"  >&lt;p&gt;Committed. Thanks Carl!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447087" name="HIVE-1407.patch" size="962" author="cwsteinbach" created="Tue, 15 Jun 2010 00:41:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Jun 2010 05:59:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72922</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lexr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123070</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1408] add option to let hive automatically run in local mode based on tunable heuristics</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1408</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;as a followup to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-543&quot; title=&quot;provide option to run hive in local mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-543&quot;&gt;&lt;del&gt;HIVE-543&lt;/del&gt;&lt;/a&gt; - we should have a simple option (enabled by default) to let hive run in local mode if possible.&lt;/p&gt;

&lt;p&gt;two levels of options are desirable:&lt;br/&gt;
1. hive.exec.mode.local.auto=true/false // control whether local mode is automatically chosen&lt;br/&gt;
2. Options to control different heuristics, some naiive examples:&lt;br/&gt;
     hive.exec.mode.local.auto.input.size.max=1G // don&apos;t choose local mode if data &amp;gt; 1G&lt;br/&gt;
     hive.exec.mode.local.auto.script.enable=true/false // choose if local mode is enabled for queries with user scripts&lt;/p&gt;

&lt;p&gt;this can be implemented as a pre/post execution hook. It makes sense to provide this as a standard hook in the hive codebase since it&apos;s likely to improve response time for many users (especially for test queries).&lt;/p&gt;

&lt;p&gt;the initial proposal is to choose this at a query level and not at per hive-task (ie. hadoop job) level. per job-level requires more changes to compilation (to not pre-commit to hdfs or local scratch directories at compile time).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466951">HIVE-1408</key>
            <summary>add option to let hive automatically run in local mode based on tunable heuristics</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jsensarma">Joydeep Sen Sarma</assignee>
                                    <reporter username="jsensarma">Joydeep Sen Sarma</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jun 2010 02:02:14 +0000</created>
                <updated>Fri, 11 Dec 2015 01:00:44 +0000</updated>
                            <resolved>Thu, 29 Jul 2010 02:42:52 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12879412" author="jsensarma" created="Wed, 16 Jun 2010 17:38:46 +0000"  >&lt;p&gt;this is somewhat more complicated than i had bargained for:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we choose local/hdfs files at query compile time based on local mode setting. however we won&apos;t choose local mode until query compilation is complete&lt;/li&gt;
	&lt;li&gt;we choose whether to submit job via child jvm before the point at which the pre-hook is called. we (currently) have to submit job via child jvm for local mode&lt;/li&gt;
	&lt;li&gt;hooks don&apos;t have access to map-reduce plans and whether there are any script operators (for instance).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;so it&apos;s not possible to implement this via hooks. (and the changes required are somewhat invasive)&lt;/p&gt;</comment>
                            <comment id="12886293" author="jsensarma" created="Thu, 8 Jul 2010 09:26:34 +0000"  >&lt;p&gt;v1 - i will update with tests.&lt;/p&gt;

&lt;p&gt;couple of main objectives:&lt;br/&gt;
1. decide whether each mr job can be run locally&lt;br/&gt;
2. decide whether local disk can be used for intermediate data (if all jobs are going to run locally)&lt;/p&gt;

&lt;p&gt;right now - both #1 and #2 are code complete - but only #1 has been enabled in the code (#2 needs more testing)&lt;/p&gt;

&lt;p&gt;the general strategy is:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;after compilation/optimization - look at input size of each mr job.&lt;/li&gt;
	&lt;li&gt;if all the jobs are small - then we can use local disk for intermediate data (#2)&lt;/li&gt;
	&lt;li&gt;else - we use hdfs for intermediate input and before launching each job - we (re)test whether the input data set is such that we can execute locally.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;had to do substantial restructuring to make this happen:&lt;br/&gt;
a. MapRedTask is now a wrapper around ExecDriver. This allows us to have a single task implementation for running mr jobs. mapredtask decides at execute time whether it should run locally or not.&lt;br/&gt;
b. Context.java is pretty much rewritten - the path management code was somewhat buggy (in particular isMRTmpFileURI was incorrect). the code was rewritten to allow make it easy to swizzle tmp paths to be directed to local disk after plan generation&lt;br/&gt;
c. added a small cache for caching DFS file metadata (sizes). this is because we lookup file metadata many times over now (for determining local mode as well as for estimating reducer count) and this cuts the overhead of repeated DFS rpcs&lt;br/&gt;
d. most test output changes are because of altered temporary path naming convention due to (b)&lt;br/&gt;
e. bug fixes: CTAS and RCFileOutputFormat were broken for local mode execution. some cleanup (debug log statements should be wrapped in ifDebugEnabled()).&lt;/p&gt;</comment>
                            <comment id="12888438" author="jsensarma" created="Wed, 14 Jul 2010 17:03:56 +0000"  >&lt;p&gt;v2. this is ready for review.&lt;/p&gt;

&lt;p&gt;added tests:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the tests now use &apos;pfile:///&apos; namespace as the default warehouse filesystem. This is served by a proxy filesystem class that passes requests to the local file system&lt;/li&gt;
	&lt;li&gt;this comprehensively tests all the file system issues related to running in local mode (where there is now a difference between the intermediate data&apos;s file system and the warehouse&apos;s file system). there are several small bug fixes related to bugs discovered because of this test mode.&lt;/li&gt;
	&lt;li&gt;there are changes in a lot of test results as a result of the new namespace as well as because of the changes in tmp file naming. i am attaching a extra diff (.q.out.patch) that shows only the interesting changes.&lt;/li&gt;
	&lt;li&gt;some tests have been modified to run with a non-local setting for the jobtracker and with auto-local-mode turned on. this tests the new functionality.&lt;/li&gt;
	&lt;li&gt;there is one test (archive.q) that&apos;s still breaking because of the filesystem issues. waiting for a fix from pyang. but it should not stop the review.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12888867" author="jsensarma" created="Thu, 15 Jul 2010 17:44:34 +0000"  >&lt;p&gt;additional changes:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pyang&apos;s fix for archive.q&lt;/li&gt;
	&lt;li&gt;move Proxy*FileSystem.java to shims/hadoop-20. The FileSystem interface has changed from 17-20 and the class i wrote only compiles for 0.20&lt;/li&gt;
	&lt;li&gt;the change to use the pfile:/// namespace for test warehouse is now used only for hadoop-20 (because of above). it&apos;s also excluded for minimr. the namespace is now controlled by ant.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12890108" author="jsensarma" created="Tue, 20 Jul 2010 00:51:41 +0000"  >&lt;p&gt;summarizing comments from internal review:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;log why local mode was not chosen (not clear whether this should be printed all the way to the console)&lt;/li&gt;
	&lt;li&gt;turn it on by default in trunk&lt;/li&gt;
	&lt;li&gt;use mapred.child.java.opts for child jvm memory for local mode (as opposed to the current policy of passing down HADOOP_HEAPMAX). this will let the map-reduce engine run with more memory and allow us to differentiate between compiler and execution memory requirements&lt;/li&gt;
	&lt;li&gt;set auto-local reducer threshold to 1. local mode doesn&apos;t run more than one reducer.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;follow on jiras:&lt;br/&gt;
1. don&apos;t scan all partitions for determining local mode (may apply to estimateReducers as well)&lt;br/&gt;
2. use # of splits instead of # files for determining local mode.&lt;/p&gt;</comment>
                            <comment id="12892103" author="jsensarma" created="Sun, 25 Jul 2010 14:59:30 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added messages explaining why local mode was not chosen&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;added negative test for above testing that we don&apos;t choose local mode with small max size limit&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;turned on by default in hive-default.xml.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;turned off by default for tests because it might bypass minimr completely&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;set reducer threshold to 1 for choosing local mode&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;regarding child jvm memory - there&apos;s already a separate option to control this (hive.mapred.local.mem). So no work is required.&lt;/p&gt;

&lt;p&gt;patch passes all tests in 0.20. testing for 0.17&lt;/p&gt;</comment>
                            <comment id="12892163" author="jsensarma" created="Mon, 26 Jul 2010 02:20:41 +0000"  >&lt;p&gt;final patch i hope!&lt;/p&gt;

&lt;p&gt;had to go through some hoops to make the test pass on all versions. it turns out not having the pfile implementation on different implementations makes the test outputs differ (ignoring pfile: in diffs is not enough because path order in different lists change)&lt;/p&gt;

&lt;p&gt;so i have ported the ProxyFileSystem to all the shims (only 17 required significant changes).&lt;/p&gt;

&lt;p&gt;tests of 17 and 20 both pass now (running 18 and 19).&lt;/p&gt;</comment>
                            <comment id="12892202" author="jsensarma" created="Mon, 26 Jul 2010 07:21:55 +0000"  >&lt;p&gt;sigh - some more changes required in the shims to get all versions to pass. should have a final patch by morrow.&lt;/p&gt;</comment>
                            <comment id="12892347" author="jsensarma" created="Mon, 26 Jul 2010 16:27:45 +0000"  >&lt;p&gt;final round of fixes. didn&apos; realize that shim classes have to be uniquely named per hadoop version. added an exclusion to Proxy* - so that only one version of ProxyFileSystem is compiled - depending on target hadoop version. this is ok since it&apos;s only for tests.&lt;/p&gt;

&lt;p&gt;tests pass 17, 18, 20. Couple of tests in 19 are broken because of bad existing source - filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1488&quot; title=&quot;CombineHiveInputFormat for hadoop-19 is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1488&quot;&gt;&lt;del&gt;HIVE-1488&lt;/del&gt;&lt;/a&gt; for that.&lt;/p&gt;</comment>
                            <comment id="12892974" author="nzhang" created="Tue, 27 Jul 2010 22:57:14 +0000"  >&lt;p&gt;Some questions:&lt;/p&gt;

&lt;p&gt;  1) the local file system handled in shims are in a way that they are with the same file name (class name) and are compiled conditionally depending on the hadoop version during compile time. This may cause problem when deploying the same hive jar file to be used in different clusters with different version. The current shim was implemented by naming the classes differently and use ShimsLoader to get the correct class during execution time. This allows hive jar files to be deployed to different hadoop clusters. &lt;/p&gt;

&lt;p&gt;  2) data/conf/hive-site.xml fs.pfile.impl is not needed if ShimsLoader is used as described above.&lt;/p&gt;

&lt;p&gt;  3) the hive.exec.mode.local.auto default values are different in HiveConf.java and conf/hive-default.xml. It&apos;s better to be the same to avoid confusion. &lt;/p&gt;

&lt;p&gt;  4) ctas.q.out: do you know why the GlobalTableID was changed?&lt;/p&gt;

&lt;p&gt;  5) MapRedTask.java:149 The plan file name is not randomized as before. It may cause problem when the parallel execution mode is true and multiple MapRedTasks are running at the same time (e.g., parallel muti-table inserts). &lt;/p&gt;

&lt;p&gt;  6) If there are 2 MapRed tasks and MR2 depends on MR1 and MR1 is decided to be running local, it seems MR2 have to be local since the intermediate files are stored in local file system? What about in parallel execution when MR1 and MR2 running in parallel and only one of them is local? It seems the info of whether a task is &quot;local&quot; is stored in Context (and HiveConf) which is shared among parallel MR tasks?&lt;/p&gt;

&lt;p&gt;  7) ExecDriver.localizeMRTmpFileImpl changes the FileSinkDesc.dirName after the MR tasks have generated, it breaks the dynamic partition code which runs when the FileSinkOperator is generated. In particular, the DynamicPartitionCtx also stores the dirName, it has to be changed as well in localizeMRTmpFileImpl.&lt;/p&gt;

&lt;p&gt;  8) MoveTask previously move intermediate directory in HDFS to the final directory also in HDFS. In the local mode, we should change the MoveTask execution as well?&lt;/p&gt;

&lt;p&gt;  9) Driver.java:100 the two functions are made static. Should they be moved to Utilities?&lt;/p&gt;</comment>
                            <comment id="12893088" author="jsensarma" created="Wed, 28 Jul 2010 07:20:09 +0000"  >&lt;p&gt;#1 - we decide that i would try to take out ProxyFileSystem from the hive jars in the distribution. unfortunately, i am unable to do so - all the simple ways seem to break the tests. i don&apos;t see much of a downside with the current arrangement - ProxyFileSystem is test-only code - there&apos;s no reason why anyone should invoke this. so shouldn&apos;t cause any problems (even though it ships with the hive jars). the pfile:// -&amp;gt; ProxyFileSystem mapping exists only in test mode.&lt;/p&gt;

&lt;p&gt;  btw - i can&apos;t use ShimLoader - because Hadoop doesn&apos;t specify a factory class for creating file system object. it expects a file system class directly. that makes it impossible to write a portable filesystem class using the shimloader paradigm. i am beginning to appreciate factory classes more.&lt;/p&gt;

&lt;p&gt;#2 not an issue - can&apos;t use ShimLoader as per above.&lt;/p&gt;

&lt;p&gt;#3 fixed&lt;/p&gt;

&lt;p&gt;#4, #5, #6, #7, #8 - not an issue as we discussed. &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1484&quot; title=&quot;use local file system for intermediate data when automatically inferring local mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1484&quot;&gt;HIVE-1484&lt;/a&gt; has already been filed as a followup work to use local dir for intermediate data when possible&lt;/p&gt;

&lt;p&gt;#9 - fixed. moved one public func to Utility.java and eliminated the other.&lt;/p&gt;</comment>
                            <comment id="12893291" author="nzhang" created="Wed, 28 Jul 2010 18:24:02 +0000"  >&lt;p&gt;Looks good in general. One minor thing though: I tried it on real clusters and it works great except that I need to manually set mapred.local.dir even though hive.exec.mode.local.auto is already set to true. Should we treat mapred.local.dir the same as HADOOPJT so that it can be set automatically when local mode is on and reset it back in Driver and Context?&lt;/p&gt;</comment>
                            <comment id="12893314" author="jsensarma" created="Wed, 28 Jul 2010 19:06:07 +0000"  >&lt;p&gt;yeah - so the solution is that the mapred.local.dir needs to be set correctly in hive/hadoop client side xml. for our internal install - i will send a diff changing the client side to point to /tmp (instead of having server side config).&lt;/p&gt;

&lt;p&gt;there&apos;s nothing to do on the hive open source version. mapred.local.dir is a client only variable and needs to be set specific to the client side by the admin. basically our internal client side config has a bug &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12893462" author="jsensarma" created="Thu, 29 Jul 2010 01:08:28 +0000"  >&lt;p&gt;Ning - anything else u need from me? i was hoping to get it in before hive-417. otherwise i am sure would have to regenerate/reconcile a ton of stuff&lt;/p&gt;</comment>
                            <comment id="12893482" author="nzhang" created="Thu, 29 Jul 2010 02:42:52 +0000"  >&lt;p&gt;Committed. Thanks Joydeep!&lt;/p&gt;</comment>
                            <comment id="14966212" author="zxzxy1988" created="Wed, 21 Oct 2015 04:25:30 +0000"  >&lt;p&gt;Hi all, not sure if this local execution feature is also available in the current Hive version (Hive 1.0 and above)?&lt;/p&gt;</comment>
                            <comment id="14966328" author="lefty@hortonworks.com" created="Wed, 21 Oct 2015 06:45:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9575&quot; title=&quot;hive fails when hive.exec.mode.local.auto=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9575&quot;&gt;HIVE-9575&lt;/a&gt; describes a problem with it in release 0.14.0.&lt;/p&gt;

&lt;p&gt;The configuration parameters &lt;b&gt;hive.exec.mode.local.auto&lt;/b&gt; and &lt;b&gt;hive.exec.mode.local.auto.inputbytes.max&lt;/b&gt; still exist in Hive 1.0 and above (but note that the default for &lt;b&gt;hive.exec.mode.local.auto&lt;/b&gt; is false &amp;#8211; it was changed in release 0.7.0 by some other JIRA issue).&lt;/p&gt;

&lt;p&gt;The &lt;b&gt;hive.exec.mode.local.auto.tasks.max&lt;/b&gt; parameter was changed to &lt;b&gt;hive.exec.mode.local.auto.input.files.max&lt;/b&gt; in release 0.9.0 by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2651&quot; title=&quot;The variable hive.exec.mode.local.auto.tasks.max should be changed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2651&quot;&gt;&lt;del&gt;HIVE-2651&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15051945" author="sladymon" created="Fri, 11 Dec 2015 01:00:44 +0000"  >&lt;p&gt;Doc note: These configuration properties are available in the wiki here:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.exec.mode.local.auto&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Configuration Properties - hive.exec.mode.local.auto &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.exec.mode.local.auto.inputbytes.max&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Configuration Properties - hive.exec.mode.local.auto.inputbytes.max &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.exec.mode.local.auto.tasks.max&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Configuration Properties - hive.exec.mode.local.auto.tasks.max &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.exec.mode.local.auto.input.files.max&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Configuration Properties - hive.exec.mode.local.auto.input.files.max &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12472126">HIVE-1577</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12534999">HIVE-2651</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12470110">HIVE-1485</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12470109">HIVE-1484</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12448964" name="1408.1.patch" size="116479" author="jsensarma" created="Thu, 8 Jul 2010 09:26:34 +0000"/>
                            <attachment id="12449469" name="1408.2.patch" size="1546539" author="jsensarma" created="Wed, 14 Jul 2010 17:03:55 +0000"/>
                            <attachment id="12449470" name="1408.2.q.out.patch" size="115887" author="jsensarma" created="Wed, 14 Jul 2010 17:03:56 +0000"/>
                            <attachment id="12450671" name="1408.7.patch" size="1147236" author="jsensarma" created="Wed, 28 Jul 2010 07:10:36 +0000"/>
                            <attachment id="12450480" name="hive-1408.6.patch" size="1146897" author="jsensarma" created="Mon, 26 Jul 2010 16:27:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 Jul 2010 22:57:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72921</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lexz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123071</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1409] File format information is retrieved from first partition</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1409</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently, if no partitions match the partition predicate, the first partition is used to retrieve the file format. This can cause an problem if the table is set to use RCFile, but the first partition uses SequenceFile:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.RuntimeException: java.lang.NoSuchMethodException: org.apache.hadoop.hive.ql.io.RCFile$KeyBuffer.()
	at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:115)
	at org.apache.hadoop.mapred.SequenceFileRecordReader.createKey(SequenceFileRecordReader.java:65)
	at org.apache.hadoop.hive.ql.io.CombineHiveRecordReader.createKey(CombineHiveRecordReader.java:76)
	at org.apache.hadoop.hive.ql.io.CombineHiveRecordReader.createKey(CombineHiveRecordReader.java:42)
	at org.apache.hadoop.hive.shims.Hadoop20Shims$CombineFileRecordReader.createKey(Hadoop20Shims.java:212)
	at org.apache.hadoop.mapred.MapTask$TrackedRecordReader.createKey(MapTask.java:167)
	at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:45)
	at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:358)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:307)
	at org.apache.hadoop.mapred.Child.main(Child.java:159)
Caused by: java.lang.NoSuchMethodException: org.apache.hadoop.hive.ql.io.RCFile$KeyBuffer.()
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2706)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredConstructor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:1985)
	at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:109)
	... 9 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The proposed change is to use the table&apos;s metadata in such cases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466962">HIVE-1409</key>
            <summary>File format information is retrieved from first partition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauly">Paul Yang</assignee>
                                    <reporter username="pauly">Paul Yang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jun 2010 03:26:12 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:38 +0000</updated>
                            <resolved>Tue, 15 Jun 2010 22:04:53 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12878859" author="namit" created="Tue, 15 Jun 2010 05:40:27 +0000"  >&lt;p&gt;+1&lt;/p&gt;


&lt;p&gt;looks good - will commit if the tests pass&lt;/p&gt;</comment>
                            <comment id="12878992" author="namit" created="Tue, 15 Jun 2010 14:52:44 +0000"  >&lt;p&gt;After more review, please drop the table at the end of the test that you added.&lt;br/&gt;
It can lead to non-deterministic results for other tests&lt;/p&gt;</comment>
                            <comment id="12879033" author="pauly" created="Tue, 15 Jun 2010 17:18:11 +0000"  >&lt;ul&gt;
	&lt;li&gt;Drop table added&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12879041" author="namit" created="Tue, 15 Jun 2010 17:39:40 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12879137" author="namit" created="Tue, 15 Jun 2010 22:04:53 +0000"  >&lt;p&gt;Committed. Thanks Paul&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447104" name="HIVE-1409.1.patch" size="3975" author="pauly" created="Tue, 15 Jun 2010 03:29:19 +0000"/>
                            <attachment id="12447149" name="HIVE-1409.2.patch" size="4137" author="pauly" created="Tue, 15 Jun 2010 17:18:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Jun 2010 05:40:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72920</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0leyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123073</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1410] Add TCP keepalive option for the metastore server</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1410</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;In production, we have noticed that the metastore server tends to accumulate half-open TCP connections when it has been running for a long time. By half-open, I am referring to idle connections where there is an established TCP connection on the metastore server machine, but no corresponding connection on the client machine. This could be the result of network disconnects or crashed clients.&lt;/p&gt;

&lt;p&gt;This patch will add an option to turn on TCP keepalive so that these half-open connections will get cleaned up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467015">HIVE-1410</key>
            <summary>Add TCP keepalive option for the metastore server</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauly">Paul Yang</assignee>
                                    <reporter username="pauly">Paul Yang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jun 2010 17:49:35 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:27 +0000</updated>
                            <resolved>Wed, 16 Jun 2010 04:46:29 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12879048" author="pauly" created="Tue, 15 Jun 2010 18:09:57 +0000"  >&lt;p&gt;No unit test for this one, but I ran 2 metastore servers, one with and one without this patch to verify that the one with the patch did not accumulate half-open connections.&lt;/p&gt;</comment>
                            <comment id="12879114" author="nzhang" created="Tue, 15 Jun 2010 20:52:24 +0000"  >&lt;p&gt;+1. Will test and commit.&lt;/p&gt;</comment>
                            <comment id="12879243" author="nzhang" created="Wed, 16 Jun 2010 04:46:29 +0000"  >&lt;p&gt;Committed. Thanks Paul!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447155" name="HIVE-1410.1.patch" size="5395" author="pauly" created="Tue, 15 Jun 2010 18:09:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Jun 2010 20:52:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72919</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0leyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123074</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1411] DataNucleus throws NucleusException if core-3.1.1 JAR appears more than once on CLASSPATH</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1411</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;DataNucleus barfs when the core-3.1.1 JAR file appears more than once on the CLASSPATH:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2010-03-06 12:33:25,565 ERROR exec.DDLTask (SessionState.java:printError(279)) - FAILED: Error in metadata: javax.jdo.JDOFatalInter 
nalException: Unexpected exception caught. 
NestedThrowables: 
java.lang.reflect.InvocationTargetException 
org.apache.hadoop.hive.ql.metadata.HiveException: javax.jdo.JDOFatalInternalException: Unexpected exception caught. 
NestedThrowables: 
java.lang.reflect.InvocationTargetException 
at org.apache.hadoop.hive.ql.metadata.Hive.createTable(Hive.java:258) 
at org.apache.hadoop.hive.ql.exec.DDLTask.createTable(DDLTask.java:879) 
at org.apache.hadoop.hive.ql.exec.DDLTask.execute(DDLTask.java:103) 
at org.apache.hadoop.hive.ql.Driver.execute(Driver.java:379) 
at org.apache.hadoop.hive.ql.Driver.run(Driver.java:285) 
at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:123) 
at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:181) 
at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:287) 
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:597) 
at org.apache.hadoop.util.RunJar.main(RunJar.java:156) 
Caused by: javax.jdo.JDOFatalInternalException: Unexpected exception caught. 
NestedThrowables: 
java.lang.reflect.InvocationTargetException 
at javax.jdo.JDOHelper.invokeGetPersistenceManagerFactoryOnImplementation(JDOHelper.java:1186)
at javax.jdo.JDOHelper.getPersistenceManagerFactory(JDOHelper.java:803) 
at javax.jdo.JDOHelper.getPersistenceManagerFactory(JDOHelper.java:698) 
at org.apache.hadoop.hive.metastore.ObjectStore.getPMF(ObjectStore.java:164) 
at org.apache.hadoop.hive.metastore.ObjectStore.getPersistenceManager(ObjectStore.java:181)
at org.apache.hadoop.hive.metastore.ObjectStore.initialize(ObjectStore.java:125) 
at org.apache.hadoop.hive.metastore.ObjectStore.setConf(ObjectStore.java:104) 
at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:62) 
at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:117) 
at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.getMS(HiveMetaStore.java:130)
at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB(HiveMetaStore.java:146)
at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.init(HiveMetaStore.java:118) 
at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.(HiveMetaStore.java:100) 
at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.(HiveMetaStoreClient.java:74) 
at org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:783) 
at org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:794) 
at org.apache.hadoop.hive.ql.metadata.Hive.createTable(Hive.java:252) 
... 12 more 
Caused by: java.lang.reflect.InvocationTargetException 
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:597) 
at javax.jdo.JDOHelper$16.run(JDOHelper.java:1956) 
at java.security.AccessController.doPrivileged(Native Method) 
at javax.jdo.JDOHelper.invoke(JDOHelper.java:1951) 
at javax.jdo.JDOHelper.invokeGetPersistenceManagerFactoryOnImplementation(JDOHelper.java:1159)
... 28 more 
Caused by: org.datanucleus.exceptions.NucleusException: Plugin (Bundle) &lt;span class=&quot;code-quote&quot;&gt;&quot;org.eclipse.jdt.core&quot;&lt;/span&gt; is already registered. Ensure you &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; 
nt have multiple JAR versions of the same plugin in the classpath. The URL &quot;file:/Users/hadop/hadoop-0.20.1+152/build/ivy/lib/Hadoo 
p/common/core-3.1.1.jar&lt;span class=&quot;code-quote&quot;&gt;&quot; is already registered, and you are trying to register an identical plugin located at URL &quot;&lt;/span&gt;file:/Users/hado 
p/hadoop-0.20.1+152/lib/core-3.1.1.jar.&quot; 
at org.datanucleus.plugin.NonManagedPluginRegistry.registerBundle(NonManagedPluginRegistry.java:437)
at org.datanucleus.plugin.NonManagedPluginRegistry.registerBundle(NonManagedPluginRegistry.java:343)
at org.datanucleus.plugin.NonManagedPluginRegistry.registerExtensions(NonManagedPluginRegistry.java:227)
at org.datanucleus.plugin.NonManagedPluginRegistry.registerExtensionPoints(NonManagedPluginRegistry.java:159)
at org.datanucleus.plugin.PluginManager.registerExtensionPoints(PluginManager.java:82) 
at org.datanucleus.OMFContext.(OMFContext.java:164) 
at org.datanucleus.OMFContext.(OMFContext.java:145) 
at org.datanucleus.ObjectManagerFactoryImpl.initialiseOMFContext(ObjectManagerFactoryImpl.java:143)
at org.datanucleus.jdo.JDOPersistenceManagerFactory.initialiseProperties(JDOPersistenceManagerFactory.java:317)
at org.datanucleus.jdo.JDOPersistenceManagerFactory.(JDOPersistenceManagerFactory.java:261)
at org.datanucleus.jdo.JDOPersistenceManagerFactory.getPersistenceManagerFactory(JDOPersistenceManagerFactory.java:174)
... 36 more 

2010-03-06 12:33:25,575 ERROR ql.Driver (SessionState.java:printError(279)) - FAILED: Execution Error, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; code 1 from org.apach 
e.hadoop.hive.ql.exec.DDLTask 
2010-03-06 12:42:30,457 ERROR exec.DDLTask (SessionState.java:printError(279)) - FAILED: Error in metadata: javax.jdo.JDOFatalInter 
nalException: Unexpected exception caught. 
NestedThrowables: 
java.lang.reflect.InvocationTargetException 
org.apache.hadoop.hive.ql.metadata.HiveException: javax.jdo.JDOFatalInternalException: Unexpected exception caught. 
NestedThrowables:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12467046">HIVE-1411</key>
            <summary>DataNucleus throws NucleusException if core-3.1.1 JAR appears more than once on CLASSPATH</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cwsteinbach">Carl Steinbach</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jun 2010 23:56:02 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:58 +0000</updated>
                            <resolved>Fri, 30 Jul 2010 21:59:29 +0000</resolved>
                                    <version>0.4.0</version>
                    <version>0.4.1</version>
                    <version>0.5.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12879198" author="cwsteinbach" created="Wed, 16 Jun 2010 00:11:00 +0000"  >&lt;p&gt;A little background on what DataNucleus is trying to do: &lt;a href=&quot;http://www.datanucleus.org/extensions/plugins.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.datanucleus.org/extensions/plugins.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Definition of pluginRegistryBundleCheck property: &lt;a href=&quot;http://www.datanucleus.org/products/accessplatform_1_0/persistence_properties.html#general&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.datanucleus.org/products/accessplatform_1_0/persistence_properties.html#general&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12879199" author="cwsteinbach" created="Wed, 16 Jun 2010 00:14:07 +0000"  >&lt;p&gt;This patch adds the property &quot;datanucleus.plugin.pluginRegistryBundleCheck&quot; to hive-site.xml and sets the value to LOG. When not set this property defaults to EXCEPTION, which results in an exception being thrown if the CLASSPATH contains two or more JARs with the same name.&lt;/p&gt;</comment>
                            <comment id="12879218" author="pauly" created="Wed, 16 Jun 2010 01:11:25 +0000"  >&lt;p&gt;Taking a look.&lt;/p&gt;</comment>
                            <comment id="12891299" author="jvs" created="Thu, 22 Jul 2010 19:40:34 +0000"  >&lt;p&gt;Paul, are you still looking at this one?&lt;/p&gt;</comment>
                            <comment id="12891301" author="pauly" created="Thu, 22 Jul 2010 19:44:11 +0000"  >&lt;p&gt;Whoops, got side tracked by another datanucleus issue. I&apos;ll review it today.&lt;/p&gt;</comment>
                            <comment id="12891307" author="pauly" created="Thu, 22 Jul 2010 20:03:09 +0000"  >&lt;p&gt;@Carl - what is the motivation for turning off this exception? Wouldn&apos;t it be good to know if 2 jars were on the CP so that the user would know for sure which version was in use? &lt;/p&gt;</comment>
                            <comment id="12891385" author="cwsteinbach" created="Thu, 22 Jul 2010 23:02:15 +0000"  >&lt;p&gt;Here&apos;s some more background on what is happening:&lt;/p&gt;

&lt;p&gt;When DataNucleus starts up it &lt;a href=&quot;http://www.datanucleus.org/extensions/plugins.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;scans every class that it finds on the CLASSPATH&lt;/a&gt; looking for &lt;a href=&quot;http://www.ibm.com/developerworks/opensource/library/os-ecl-osgi/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;OSGi format plugins&lt;/a&gt;. Hadoop core happens to depend on Eclipse&apos;s core-3.1.1.jar (which contains OSGi format plugins), so this gets included in Hive&apos;s CLASSPATH since bin/hive delegates execution to bin/hadoop. If a user installed Hadoop from a tar ball and set HADOOP_HOME to the install directory we are all good, but if the user also ran &apos;ant&apos; in $HADOOP_HOME we&apos;re in a world of pain since this results in two copies of core-3.1.1.jar (the original copy in $HADOOP_HOME/lib and another copy in $HADOOP_HOME/build/ivy/lib/Hadoop/common/) and bin/hadoop stupidly adds both jars to the CLASSPATH.&lt;/p&gt;

&lt;p&gt;I want to highlight the following points:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Duplicate CLASSPATH entries are a fact of life with Hadoop and Hive due to the screwed up CLASSPATH construction code in bin/hadoop and bin/hive&lt;/li&gt;
	&lt;li&gt;The duplicate CLASSPATH check that DataNucleus enforces by default only applies to JARs that contain OSGi plugins, which in our case seems to only apply to the core-3.1.1 JAR.&lt;/li&gt;
	&lt;li&gt;The patch that I supplied causes this harmless condition to result in a LOG message instead of a fatal exception. I think this preferable.&lt;/li&gt;
	&lt;li&gt;This exception is easy to reproduce on 0.5.0, but the upgrade to datanucleus-2.3 in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt; seems to have made it unreproducible on trunk. I think this indicates that there is a bug in datanucleus-2.3 since it is no longer honoring the contract set by datanucleus.plugin.pluginRegistryBundleCheck (the default value is still EXCEPTION). I recommend that we commit this patch anyway lest we encounter this bug in the future after upgrading to a newer version of datanucleus that fixes this problem.&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="12891392" author="pauly" created="Thu, 22 Jul 2010 23:28:24 +0000"  >&lt;p&gt;About #4, I was able to reproduce the exception and verify the fix by creating a copy of the datanucleus core jar in hive&apos;s lib directory.&lt;/p&gt;

&lt;p&gt;Makes sense to me. Now that you mention it, I think I ran into a similar problem while using the &apos;hadoop jar&apos; command. It would unpack the jar, but include both the jar and the unpacked classes in the classpath. If the jar contained datanucleus stuff, this would throw an exception.&lt;/p&gt;

&lt;p&gt;Anyway, the fix looks good. +1&lt;/p&gt;</comment>
                            <comment id="12893020" author="jvs" created="Wed, 28 Jul 2010 01:08:13 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="12894120" author="jvs" created="Fri, 30 Jul 2010 19:29:41 +0000"  >&lt;p&gt;Carl, when you supply patches, please make sure they can be applied with patch -p0.  This one needed patch -p1.&lt;/p&gt;</comment>
                            <comment id="12894171" author="jvs" created="Fri, 30 Jul 2010 21:59:29 +0000"  >&lt;p&gt;Committed to branch and trunk.  Thanks Carl!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447187" name="HIVE-1411.patch.txt" size="1416" author="cwsteinbach" created="Wed, 16 Jun 2010 00:09:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Jun 2010 01:11:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72918</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d3yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74417</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
