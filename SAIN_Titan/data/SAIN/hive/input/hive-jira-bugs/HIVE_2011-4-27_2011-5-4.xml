<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Tue Jan 22 15:18:05 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+HIVE+AND+created+%3E%3D+2011-4-27+AND+created+%3C%3D+2011-5-4+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="14" total="14"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[HIVE-2135] Refactor HiveMetaStore.java</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2135</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;HiveMetaStore.java is more then 3000 LOC which contains wide variety of code. It will be good to refactor it so that its easier to maintain.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505275">HIVE-2135</key>
            <summary>Refactor HiveMetaStore.java</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Apr 2011 06:53:43 +0000</created>
                <updated>Fri, 24 Feb 2012 21:14:26 +0000</updated>
                            <resolved>Fri, 24 Feb 2012 21:14:26 +0000</resolved>
                                                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13025640" author="ashutoshc" created="Wed, 27 Apr 2011 06:58:09 +0000"  >&lt;p&gt;Major part of this refactoring is done using Eclipse.&lt;/p&gt;</comment>
                            <comment id="13025936" author="jiraposter@reviews.apache.org" created="Wed, 27 Apr 2011 18:25:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/669/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/669/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-04-27 18:24:42.458082)&lt;/p&gt;


&lt;p&gt;Review request for hive, Carl Steinbach, John Sichi, and Paul Yang.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Mistyped jira number.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2135&quot; title=&quot;Refactor HiveMetaStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2135&quot;&gt;&lt;del&gt;HIVE-2135&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2135&quot; title=&quot;Refactor HiveMetaStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2135&quot;&gt;&lt;del&gt;HIVE-2135&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2135&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2135&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1096976 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreCommand.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java 1096976 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/URLConnectionUpdater.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/669/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/669/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Since this is a refactoring patch, no new tests are required. Ran all the tests in metastore. All of them passed.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ashutosh&lt;/p&gt;
</comment>
                            <comment id="13027144" author="cwsteinbach" created="Fri, 29 Apr 2011 19:05:36 +0000"  >&lt;p&gt;Changes look good to me. Nice to see some cleanup work!&lt;/p&gt;

&lt;p&gt;@John and Paul: Can one of you take a look at this and make sure it doesn&apos;t break anything on the FB side?&lt;/p&gt;</comment>
                            <comment id="13027177" author="jiraposter@reviews.apache.org" created="Fri, 29 Apr 2011 20:49:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/669/#review622&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/669/#review622&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreCommand.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/669/#comment1265&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/669/#comment1265&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The example in this Javadoc needs to be updated to match the new invocation pattern.  (Also, the original Javadoc was missing &amp;lt;pre&amp;gt; and &amp;lt;code&amp;gt; tags; can you add those in here so that the HTML will get generated correctly?)&lt;/p&gt;

&lt;p&gt;    But first...is the new invocation pattern actually better?  It seems like the invocation has gotten a little more verbose since each call to executeWithRetry now has to pass in two arguments.  Wouldn&apos;t it be better to leave the executeWithRetry method in the HiveMetaStore class so that it can do any common stuff like setting these as attributes on the command object?&lt;/p&gt;

&lt;p&gt;    Likewise, I&apos;m not clear on how moving the thread-local access to the command object is an improvement.  Seems to me it should stay in HiveMetaStore; again, you can pass the right object in from executeWithRetry.&lt;/p&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-27 18:24:42, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/669/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/669/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-27 18:24:42)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Carl Steinbach, John Sichi, and Paul Yang.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2135&quot; title=&quot;Refactor HiveMetaStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2135&quot;&gt;&lt;del&gt;HIVE-2135&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2135&quot; title=&quot;Refactor HiveMetaStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2135&quot;&gt;&lt;del&gt;HIVE-2135&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2135&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2135&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1096976 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreCommand.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java 1096976 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/URLConnectionUpdater.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/669/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/669/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Since this is a refactoring patch, no new tests are required. Ran all the tests in metastore. All of them passed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13027558" author="ashutoshc" created="Mon, 2 May 2011 06:01:52 +0000"  >&lt;p&gt;Objectstore, Metastore, Command, execution, retrials are distinct concepts which I think are too entwined in current implementation. It would be good to disentangle them from each other to make code more modular. I think its better to have a separate Command interface which different types of Command will implement. execute() should really be a part of Rawstore interface since different Objectstore can have different strategies for executing a command and may have different ways of doing retrials. Metastore should prepare a Command and call execute() on Rawstore to execute it. I am attaching an illustrative patch which sketches these ideas for create database command. Let me know if it makes sense.&lt;/p&gt;</comment>
                            <comment id="13215916" author="ashutoshc" created="Fri, 24 Feb 2012 21:14:26 +0000"  >&lt;p&gt;This got taken care of in a better fashion in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2716&quot; title=&quot;Move retry logic in HiveMetaStore to a separe class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2716&quot;&gt;&lt;del&gt;HIVE-2716&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477931" name="hive_2135.patch" size="14201" author="ashutoshc" created="Mon, 2 May 2011 06:01:52 +0000"/>
                            <attachment id="12477474" name="refactor.patch" size="55812" author="ashutoshc" created="Wed, 27 Apr 2011 06:58:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Apr 2011 18:25:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42256</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0likv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123660</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2136] Add get_version() call to Thrift API</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2136</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Clients need to be able to determine the version of the HiveServer and HiveMetastore.&lt;/p&gt;

&lt;p&gt;Open questions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Should there be separate methods for determining the HiveServer and HiveMetaStore versions?&lt;/li&gt;
	&lt;li&gt;Should the return value be a string, or should we have separate integer valued methods that return the major/minor/patch versions separately (the latter would be easier for clients written in C).&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12505363">HIVE-2136</key>
            <summary>Add get_version() call to Thrift API</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Apr 2011 23:17:22 +0000</created>
                <updated>Thu, 28 Apr 2011 06:50:59 +0000</updated>
                                                                            <component>Thrift API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13026150" author="cwsteinbach" created="Thu, 28 Apr 2011 06:50:59 +0000"  >&lt;p&gt;We may also want to consider wrapping this in some kind of generic mechanism similar to ODBC&apos;s SQLGetInfo call.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42255</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08ng7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48398</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2137] JDBC driver doesn&apos;t encode string properly.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2137</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;JDBC driver for HiveServer1 decodes string by client side default encoding, which depends on operating system unless we don&apos;t specify another encoding. &lt;br/&gt;
It ignore server side encoding. &lt;/p&gt;

&lt;p&gt;For example, &lt;br/&gt;
when server side operating system and encoding are Linux (utf-8) and client side operating system and encoding are Windows (shift-jis : it&apos;s japanese charset, makes character corruption happens in the client.&lt;/p&gt;

&lt;p&gt;In current implementation of Hive, UTF-8 appears to be expected in server side so client side should encode/decode string as UTF-8.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505841">HIVE-2137</key>
            <summary>JDBC driver doesn&apos;t encode string properly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jin">Jin Adachi</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Sat, 30 Apr 2011 11:30:33 +0000</created>
                <updated>Wed, 12 Nov 2014 23:55:23 +0000</updated>
                            <resolved>Wed, 12 Nov 2014 23:55:23 +0000</resolved>
                                    <version>0.9.0</version>
                                                    <component>JDBC</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13027321" author="jin" created="Sat, 30 Apr 2011 11:34:07 +0000"  >&lt;p&gt;This patch can set character encoding in the connection string.&lt;/p&gt;

&lt;p&gt;For example,&lt;br/&gt;
jdbc:hive://10.68.160.236:10000/default&lt;br/&gt;
-&amp;gt;&lt;br/&gt;
jdbc:hive://10.68.160.236:10000/default?characterEncoding=UTF-8&lt;/p&gt;

&lt;p&gt;If you set &quot;characterEncoding&quot;, string is decoded by character code which was set.&lt;br/&gt;
If not set, it&apos;s the same as before.&lt;/p&gt;</comment>
                            <comment id="13134713" author="ashutoshc" created="Tue, 25 Oct 2011 03:13:15 +0000"  >&lt;p&gt;@Jin,&lt;br/&gt;
&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/HowToContribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/HowToContribute&lt;/a&gt; has guidelines on how to contribute. Essentially you need to generate a one svn friendly patch instead each for different files.&lt;/p&gt;</comment>
                            <comment id="13139531" author="jin" created="Sun, 30 Oct 2011 03:54:19 +0000"  >&lt;p&gt;Sorry for my patches were not conformed to guidance.&lt;br/&gt;
I re-maked a patch.&lt;br/&gt;
This new patch supports fixed charset &quot;UTF-8&quot;.&lt;/p&gt;</comment>
                            <comment id="13443045" author="jokang" created="Tue, 28 Aug 2012 09:27:29 +0000"  >&lt;p&gt;I have ran into the same trouble. Thank you for your patches.&lt;br/&gt;
But, I think I had found some way easier to solve the problem by setting your encoding of .class files when compiling the source files. &lt;br/&gt;
here is the command:&lt;br/&gt;
javac -encoding UTF-8 XX.java&lt;br/&gt;
or you can set it in eclipse.&lt;/p&gt;</comment>
                            <comment id="13633856" author="kristof.vanbecelaere" created="Wed, 17 Apr 2013 07:24:09 +0000"  >&lt;p&gt;Can some committer comment on this issue please? Will this issue be resolved and/or will a patch be applied? Which version could contain a fix for this?&lt;/p&gt;</comment>
                            <comment id="13721104" author="hiveqa" created="Fri, 26 Jul 2013 19:20:55 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12501499/HIVE-2137.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12501499/HIVE-2137.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 2653 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/194/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/194/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/194/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/194/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.CleanupPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13722255" author="sarutak" created="Mon, 29 Jul 2013 08:17:07 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I&apos;ve re-fine the patch uploaded before. I&apos;ve added  a test code and test data.&lt;/p&gt;</comment>
                            <comment id="13722303" author="hiveqa" created="Mon, 29 Jul 2013 09:55:43 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12594645/HIVE-2137.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12594645/HIVE-2137.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 2736 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hcatalog.pig.TestE2EScenarios.testReadOrcAndRCFromPig
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/220/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/220/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/220/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/220/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13722789" author="sarutak" created="Mon, 29 Jul 2013 18:30:43 +0000"  >&lt;p&gt;I wonder if my change really affects TestE2EScenarios.testReadOrcAndRCFromPig.&lt;br/&gt;
I&apos;ve just only added test code and test data for HiveQueryResultSet after the build successfully finished.&lt;/p&gt;</comment>
                            <comment id="13724278" author="sarutak" created="Tue, 30 Jul 2013 19:11:50 +0000"  >&lt;p&gt;I forgot to drop the table I added in tearDown.&lt;br/&gt;
Thank you for your advice, tamtam180!&lt;/p&gt;</comment>
                            <comment id="13724484" author="hiveqa" created="Tue, 30 Jul 2013 21:57:44 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12595024/HIVE-2137.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12595024/HIVE-2137.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 2749 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/245/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/245/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/245/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/245/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13787862" author="thejas" created="Mon, 7 Oct 2013 02:24:37 +0000"  >&lt;p&gt;Preparing for 0.12 release. Removing fix version of 0.12 for those that are not in 0.12 branch.&lt;/p&gt;</comment>
                            <comment id="13994152" author="hiveqa" created="Sat, 10 May 2014 05:36:23 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 no tests executed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12595024/HIVE-2137.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12595024/HIVE-2137.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/160/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/160/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/160/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/160/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command &apos;bash /data/hive-ptest/working/scratch/source-prep.sh&apos; failed with exit status 1 and output &apos;+ [[ -n &apos;&apos; ]]
+ export &apos;ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m &apos;
+ ANT_OPTS=&apos;-Xmx1g -XX:MaxPermSize=256m &apos;
+ export &apos;M2_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ M2_OPTS=&apos;-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ cd /data/hive-ptest/working/
+ tee /data/hive-ptest/logs/PreCommit-HIVE-Build-160/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ svn = \s\v\n ]]
+ [[ -n &apos;&apos; ]]
+ [[ -d apache-svn-trunk-source ]]
+ [[ ! -d apache-svn-trunk-source/.svn ]]
+ [[ ! -d apache-svn-trunk-source ]]
+ cd apache-svn-trunk-source
+ svn revert -R .
++ awk &apos;{print $2}&apos;
++ egrep -v &apos;^X|^Performing status on external&apos;
++ svn status --no-ignore
+ rm -rf
+ svn update

Fetching external item into &apos;hcatalog/src/test/e2e/harness&apos;
External at revision 1593663.

At revision 1593663.
+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hive-ptest/working/scratch/build.patch
+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]
+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh
+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch
The patch does not appear to apply with p0, p1, or p2
+ exit 1
&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12595024&lt;/p&gt;</comment>
                            <comment id="14208936" author="ashutoshc" created="Wed, 12 Nov 2014 23:55:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6977&quot; title=&quot;Delete Hiveserver1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6977&quot;&gt;&lt;del&gt;HIVE-6977&lt;/del&gt;&lt;/a&gt; removed HS1 and driver&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12595024" name="HIVE-2137.patch" size="5211" author="sarutak" created="Tue, 30 Jul 2013 19:11:50 +0000"/>
                            <attachment id="12594645" name="HIVE-2137.patch" size="4815" author="sarutak" created="Mon, 29 Jul 2013 08:17:07 +0000"/>
                            <attachment id="12501499" name="HIVE-2137.patch" size="807" author="jin" created="Sun, 30 Oct 2011 06:47:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Oct 2011 03:13:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lil3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123661</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2138] Exception when no splits returned from index</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2138</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Running a query that uses indexing but doesn&apos;t return any results give an exception.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; java.lang.IllegalArgumentException: Can not create a Path from an empty string
at org.apache.hadoop.fs.Path.checkPathArg(Path.java:82)
at org.apache.hadoop.fs.Path.&amp;lt;init&amp;gt;(Path.java:90)
at org.apache.hadoop.util.StringUtils.stringToPath(StringUtils.java:224)
at org.apache.hadoop.mapred.FileInputFormat.setInputPaths(FileInputFormat.java:282)
at org.apache.hadoop.hive.ql.index.HiveIndexedInputFormat.getSplits(HiveIndexedInputFormat.java:123) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This could potentially be fixed by creating a new empty file to use for the splits.&lt;/p&gt;

&lt;p&gt;Once this is fixed, the index_auto_test_if_used.q can be used.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505858">HIVE-2138</key>
            <summary>Exception when no splits returned from index</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="salbiz">Syed S. Albiz</assignee>
                                    <reporter username="rmelick">Russell Melick</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 May 2011 00:19:23 +0000</created>
                <updated>Fri, 16 Dec 2011 23:57:02 +0000</updated>
                            <resolved>Mon, 8 Aug 2011 19:07:51 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Indexing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13027409" author="rmelick" created="Sun, 1 May 2011 00:23:45 +0000"  >&lt;p&gt;Attached test file (index_auto_test_if_used) that should test whether indexes are used.&lt;/p&gt;</comment>
                            <comment id="13073985" author="jvs" created="Mon, 1 Aug 2011 23:06:39 +0000"  >&lt;p&gt;Syed, if you get time to look into this one, it&apos;s a good one to fix for getting automatic index usage production-ready.&lt;/p&gt;</comment>
                            <comment id="13076006" author="salbiz" created="Tue, 2 Aug 2011 02:33:01 +0000"  >&lt;p&gt;fix + testcase&lt;/p&gt;</comment>
                            <comment id="13076007" author="jiraposter@reviews.apache.org" created="Tue, 2 Aug 2011 02:36:27 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1255/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive, John Sichi and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;return an empty array of input splits when we get back no results from the hiveIndexResult&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; title=&quot;Exception when no splits returned from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2138&quot;&gt;&lt;del&gt;HIVE-2138&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2138&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_test_if_used.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_test_if_used.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1255/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added index_auto_test_if_used.q to the test suite&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13078325" author="jvs" created="Tue, 2 Aug 2011 18:08:06 +0000"  >&lt;p&gt;A few comments added in Review Board.&lt;/p&gt;</comment>
                            <comment id="13078326" author="jiraposter@reviews.apache.org" created="Tue, 2 Aug 2011 18:08:27 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1255/#review1265&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/#review1265&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1255/#comment2898&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/#comment2898&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We&apos;re not actually generating a dummy file now...&lt;/p&gt;



&lt;p&gt;ql/src/test/queries/clientpositive/index_auto_test_if_used.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1255/#comment2900&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/#comment2900&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Could you add a note that this test relies on the fact that we currently attempt to use indexes even when they are out of date, and that once we fix that by detecting stale indexes, we&apos;ll need another way to verify that the index actually had an effect?&lt;/p&gt;




&lt;p&gt;ql/src/test/queries/clientpositive/index_auto_test_if_used.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1255/#comment2899&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/#comment2899&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Reissue query to demonstrate that results are returned after index lookup is disabled.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-08-02 02:35:11, Syed Albiz wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1255/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-02 02:35:11)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, John Sichi and Yongqiang He.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;return an empty array of input splits when we get back no results from the hiveIndexResult&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; title=&quot;Exception when no splits returned from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2138&quot;&gt;&lt;del&gt;HIVE-2138&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2138&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/index_auto_test_if_used.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/index_auto_test_if_used.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1255/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;added index_auto_test_if_used.q to the test suite&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Syed&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13078357" author="jiraposter@reviews.apache.org" created="Tue, 2 Aug 2011 18:48:27 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1255/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-02 18:48:23.995744)&lt;/p&gt;


&lt;p&gt;Review request for hive, John Sichi and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;addressed comments&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;return an empty array of input splits when we get back no results from the hiveIndexResult&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; title=&quot;Exception when no splits returned from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2138&quot;&gt;&lt;del&gt;HIVE-2138&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2138&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_test_if_used.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_test_if_used.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1255/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added index_auto_test_if_used.q to the test suite&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13078358" author="jvs" created="Tue, 2 Aug 2011 18:53:30 +0000"  >&lt;p&gt;+1, will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="13078515" author="salbiz" created="Tue, 2 Aug 2011 23:43:39 +0000"  >&lt;p&gt;replace testcase with a robust testcase to check for empty splits&lt;/p&gt;</comment>
                            <comment id="13078516" author="jiraposter@reviews.apache.org" created="Tue, 2 Aug 2011 23:44:27 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1255/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-02 23:44:30.658334)&lt;/p&gt;


&lt;p&gt;Review request for hive, John Sichi and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;replace test case with something more robust&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;return an empty array of input splits when we get back no results from the hiveIndexResult&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; title=&quot;Exception when no splits returned from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2138&quot;&gt;&lt;del&gt;HIVE-2138&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2138&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_empty.q PRE-CREATION &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_test_if_used.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_empty.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1255/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added index_auto_test_if_used.q to the test suite&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13079592" author="jvs" created="Thu, 4 Aug 2011 21:04:06 +0000"  >&lt;p&gt;index_auto_test_if_used.q should not be in this patch.&lt;/p&gt;</comment>
                            <comment id="13079622" author="salbiz" created="Thu, 4 Aug 2011 21:46:52 +0000"  >&lt;p&gt;removed old testcase&lt;/p&gt;</comment>
                            <comment id="13079630" author="jiraposter@reviews.apache.org" created="Thu, 4 Aug 2011 21:57:28 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1255/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-04 21:56:31.633797)&lt;/p&gt;


&lt;p&gt;Review request for hive, John Sichi and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;removed stale testcase&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;return an empty array of input splits when we get back no results from the hiveIndexResult&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; title=&quot;Exception when no splits returned from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2138&quot;&gt;&lt;del&gt;HIVE-2138&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2138&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_empty.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_empty.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1255/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added index_auto_test_if_used.q to the test suite&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13079792" author="jvs" created="Fri, 5 Aug 2011 04:46:13 +0000"  >&lt;p&gt;index_auto_empty needs its log updated:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt; PREHOOK: type: ALTERINDEX_REBUILD&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;gt; PREHOOK: type: QUERY&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 23c23&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt; POSTHOOK: type: ALTERINDEX_REBUILD&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;#8212;&lt;/p&gt;</comment>
                            <comment id="13080157" author="salbiz" created="Fri, 5 Aug 2011 19:04:28 +0000"  >&lt;p&gt;regenerated patch with updated testcase output&lt;/p&gt;</comment>
                            <comment id="13080158" author="jiraposter@reviews.apache.org" created="Fri, 5 Aug 2011 19:05:27 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1255/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-05 19:05:05.682867)&lt;/p&gt;


&lt;p&gt;Review request for hive, John Sichi and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;updated testcases with new output&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;return an empty array of input splits when we get back no results from the hiveIndexResult&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; title=&quot;Exception when no splits returned from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2138&quot;&gt;&lt;del&gt;HIVE-2138&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2138&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_empty.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_empty.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1255/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1255/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added index_auto_test_if_used.q to the test suite&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13080187" author="jvs" created="Fri, 5 Aug 2011 20:11:38 +0000"  >&lt;p&gt;Giving it another go now.&lt;/p&gt;</comment>
                            <comment id="13081132" author="jvs" created="Mon, 8 Aug 2011 19:07:51 +0000"  >&lt;p&gt;Committed.  Thanks Syed!&lt;/p&gt;</comment>
                            <comment id="13081328" author="hudson" created="Tue, 9 Aug 2011 00:20:10 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #881 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/881/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/881/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2138&quot; title=&quot;Exception when no splits returned from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2138&quot;&gt;&lt;del&gt;HIVE-2138&lt;/del&gt;&lt;/a&gt;. Exception when no splits returned from index.&lt;br/&gt;
(Syed Albiz via jvs)&lt;/p&gt;

&lt;p&gt;jvs : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1155059&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1155059&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/index_auto_empty.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/index_auto_empty.q&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12474222">HIVE-1644</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12488851" name="HIVE-2138.1.patch" size="14456" author="salbiz" created="Tue, 2 Aug 2011 02:33:01 +0000"/>
                            <attachment id="12489097" name="HIVE-2138.2.patch" size="19057" author="salbiz" created="Tue, 2 Aug 2011 18:47:50 +0000"/>
                            <attachment id="12489136" name="HIVE-2138.3.patch" size="9826" author="salbiz" created="Tue, 2 Aug 2011 23:43:39 +0000"/>
                            <attachment id="12489410" name="HIVE-2138.4.patch" size="8340" author="salbiz" created="Thu, 4 Aug 2011 21:46:52 +0000"/>
                            <attachment id="12489517" name="HIVE-2138.5.patch" size="8364" author="salbiz" created="Fri, 5 Aug 2011 19:04:28 +0000"/>
                            <attachment id="12477887" name="index_auto_test_if_used.q" size="922" author="rmelick" created="Sun, 1 May 2011 00:23:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Aug 2011 23:06:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>43517</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i010bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3819</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2139] Enables HiveServer to accept -hiveconf option</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2139</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently, I&apos;m trying to test HiveHBaseIntegration on HiveServer. But it doesn&apos;t seem to accept -hiveconf command.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive --service hiveserver -hiveconf hbase.zookeeper.quorum=hdp0,hdp1,hdp2
Starting Hive Thrift Server
java.lang.NumberFormatException: For input string: &lt;span class=&quot;code-quote&quot;&gt;&quot;-hiveconf&quot;&lt;/span&gt;
        at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.java:449)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.java:499)
        at org.apache.hadoop.hive.service.HiveServer.main(HiveServer.java:382)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.util.RunJar.main(RunJar.java:186)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Therefore, you need to throw the query like &quot;set hbase.zookeeper.quorum=hdp0,hdp1,hdp2&quot; everytime. It&apos;s not convenient for separating the configuration between server-side and client-side.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux + CDH3u0 (Hive 0.7.0+27.1-2~lucid-cdh3)&lt;/p&gt;</environment>
        <key id="12505872">HIVE-2139</key>
            <summary>Enables HiveServer to accept -hiveconf option</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="phunt">Patrick Hunt</assignee>
                                    <reporter username="kzk">Kazuki Ohta</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 May 2011 09:43:59 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:34 +0000</updated>
                            <resolved>Thu, 21 Jul 2011 18:50:58 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>CLI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13054693" author="phunt" created="Fri, 24 Jun 2011 21:43:23 +0000"  >&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;

&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;

&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;

&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;

&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;

&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;

&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;

&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;


&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;


&lt;p&gt;If these changes go through I&apos;ll update the wiki docs (which afaik are the only docs that need to be updated).&lt;/p&gt;</comment>
                            <comment id="13054710" author="jiraposter@reviews.apache.org" created="Fri, 24 Jun 2011 22:13:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/958/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;

&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;

&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;

&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;

&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;

&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;

&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;

&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2139&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  bin/ext/hiveserver.sh b5edce4 &lt;br/&gt;
  bin/ext/metastore.sh db15f6e &lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/common/cli/HiveCli.java PRE-CREATION &lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java bc58bd5 &lt;br/&gt;
  service/src/java/org/apache/hadoop/hive/service/HiveServer.java ea04be9 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/958/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Patrick&lt;/p&gt;
</comment>
                            <comment id="13055748" author="jiraposter@reviews.apache.org" created="Mon, 27 Jun 2011 20:51:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/958/#review919&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#review919&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I ran into some problems compiling this patch. Please verify that it builds using the ant command &apos;ant clean package&apos;.&lt;/p&gt;


&lt;p&gt;bin/ext/hiveserver.sh&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment1973&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment1973&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does this mean that $HIVE_PORT takes precedence over another port specified using the -p switch? If so then I think the reverse makes more sense.&lt;/p&gt;

&lt;p&gt;    Also, in order to make the precedence explicit, I think it would be good to move this logic to the HiveCli class, e.g. explicitly call System.getenv(&quot;HIVE_PORT&quot;) from HiveCli.&lt;/p&gt;



&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/cli/HiveCli.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment1975&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment1975&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The HiveMetaStore and HiveServer imports are unnecessary.&lt;/p&gt;



&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/cli/HiveCli.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment1974&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment1974&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The name of this class is likely to generate confusion. Maybe change it to CommonCliOpts, or something else?&lt;/p&gt;



&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment1976&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment1976&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We should try to avoid making the metastore dependent on ql. There&apos;s already an open ticket (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-850&quot; title=&quot;moving SessionState from ql to common&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-850&quot;&gt;HIVE-850&lt;/a&gt;) that covers the task of moving SessionState to common. Looks like now may be a good time to do this.&lt;/p&gt;



&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment1977&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment1977&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    cli.processHiveConf() copies all of the -hiveconf properties into the list of SystemProperties, which I agree we want to do before initializing the logging system, but subsequently we need to make sure that these same key/val properties are are also registered as HiveConf values so that they have the opportunity to override values specified in hive-default.xml and hive-site.xml. A similar trick is done for the CLI via the OptionsProcessor process_stage1() and process_stage2() methods.&lt;/p&gt;



&lt;p&gt;service/src/java/org/apache/hadoop/hive/service/HiveServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment1978&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment1978&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    hive.metastore.server.&lt;span class=&quot;error&quot;&gt;&amp;#91;min|max&amp;#93;&lt;/span&gt;.threads already exists. We should add similar properties for controlling the min/max number of threads for HiveServer.&lt;/p&gt;



&lt;p&gt;service/src/java/org/apache/hadoop/hive/service/HiveServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment1979&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment1979&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Need to read the -hiveconf properties into the SessionState&apos;s HiveConf.&lt;/p&gt;



&lt;p&gt;service/src/java/org/apache/hadoop/hive/service/HiveServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment1980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment1980&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We should also set options.maxWorkerThreads. Looks like the default value for Thrift is Integer.MAX_VALUE.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-06-24 22:12:48, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/958/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-24 22:12:48)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2139&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/hiveserver.sh b5edce4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/metastore.sh db15f6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/cli/HiveCli.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java bc58bd5 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;service/src/java/org/apache/hadoop/hive/service/HiveServer.java ea04be9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/958/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13066312" author="jiraposter@reviews.apache.org" created="Fri, 15 Jul 2011 23:50:00 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; I ran into some problems compiling this patch. Please verify that it builds using the ant command &apos;ant clean package&apos;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I see. I added a dependency on commons-cli in hive common but didn&apos;t specify it explicitly. I&apos;ve updated ivy dependencies for this.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; common/src/java/org/apache/hadoop/hive/common/cli/HiveCli.java, line 42&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21667#file21667line42&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21667#file21667line42&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     The name of this class is likely to generate confusion. Maybe change it to CommonCliOpts, or something else?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;done&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; common/src/java/org/apache/hadoop/hive/common/cli/HiveCli.java, line 29&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21667#file21667line29&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21667#file21667line29&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     The HiveMetaStore and HiveServer imports are unnecessary.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;weird, &quot;organize imports&quot; adds this each time I run it, I removed it manually and it&apos;s fine.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 91&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21668#file21668line91&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21668#file21668line91&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We should try to avoid making the metastore dependent on ql. There&apos;s already an open ticket (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-850&quot; title=&quot;moving SessionState from ql to common&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-850&quot;&gt;HIVE-850&lt;/a&gt;) that covers the task of moving SessionState to common. Looks like now may be a good time to do this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve refactored the log initialization code in order to allow reuse (moved into common). Took a look at doing more like 850, but it looks like that&apos;s going to be a much class to tease apart.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; bin/ext/hiveserver.sh, line 31&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21665#file21665line31&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21665#file21665line31&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Does this mean that $HIVE_PORT takes precedence over another port specified using the -p switch? If so then I think the reverse makes more sense.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Also, in order to make the precedence explicit, I think it would be good to move this logic to the HiveCli class, e.g. explicitly call System.getenv(&quot;HIVE_PORT&quot;) from HiveCli.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;excellent idea, I didn&apos;t think to move the check into the code. done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3347&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21668#file21668line3347&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21668#file21668line3347&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     cli.processHiveConf() copies all of the -hiveconf properties into the list of SystemProperties, which I agree we want to do before initializing the logging system, but subsequently we need to make sure that these same key/val properties are are also registered as HiveConf values so that they have the opportunity to override values specified in hive-default.xml and hive-site.xml. A similar trick is done for the CLI via the OptionsProcessor process_stage1() and process_stage2() methods.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve refactored a bit to allow this. It&apos;s tricky given that you need access to HiveConf, which is buried in a couple places. I like the way it&apos;s come out in general, however we can&apos;t push it into common (the shared cli code) given it would add a dependency on hiveconf.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; service/src/java/org/apache/hadoop/hive/service/HiveServer.java, line 76&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21669#file21669line76&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21669#file21669line76&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     hive.metastore.server.&lt;span class=&quot;error&quot;&gt;&amp;#91;min|max&amp;#93;&lt;/span&gt;.threads already exists. We should add similar properties for controlling the min/max number of threads for HiveServer.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Happy to do it - but would you mind adding a jira assigned to me? Would like to limit the scope creep on this one.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; service/src/java/org/apache/hadoop/hive/service/HiveServer.java, line 612&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21669#file21669line612&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21669#file21669line612&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Need to read the -hiveconf properties into the SessionState&apos;s HiveConf.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;is this a bug in the existing code? &amp;#8211; in HiveServerHandler constructor, both the call to super and the constructor itself seem to be creating &quot;new HiveConf&quot; object. See how I&apos;ve addressed this in the updated patch.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; service/src/java/org/apache/hadoop/hive/service/HiveServer.java, line 616&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21669#file21669line616&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21669#file21669line616&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We should also set options.maxWorkerThreads. Looks like the default value for Thrift is Integer.MAX_VALUE.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;added&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/958/#review919&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#review919&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-06-24 22:12:48, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/958/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-06-24 22:12:48)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2139&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/hiveserver.sh b5edce4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/metastore.sh db15f6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/cli/HiveCli.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java bc58bd5 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;service/src/java/org/apache/hadoop/hive/service/HiveServer.java ea04be9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/958/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13066314" author="jiraposter@reviews.apache.org" created="Fri, 15 Jul 2011 23:52:00 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/958/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-15 23:51:55.625387)&lt;/p&gt;


&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated based on Carl&apos;s feedback.&lt;/p&gt;

&lt;p&gt;All unit tests passed except for &quot;org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_script_broken_pipe1&quot; which I don&apos;t think is me.&lt;/p&gt;

&lt;p&gt;I also exercised on the command line and it all seemed to work.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;

&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;

&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;

&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;

&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;

&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;

&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;

&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2139&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java 728958d &lt;br/&gt;
  service/src/java/org/apache/hadoop/hive/service/HiveServer.java ea04be9 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 090ecfc &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java 61393c8 &lt;br/&gt;
  bin/ext/hiveserver.sh b5edce4 &lt;br/&gt;
  bin/ext/metastore.sh db15f6e &lt;br/&gt;
  cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java bd9f6b1 &lt;br/&gt;
  common/build.xml 0969e16 &lt;br/&gt;
  common/ivy.xml bee3bf0 &lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/common/LogUtils.java PRE-CREATION &lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/common/cli/CommonCliOptions.java PRE-CREATION &lt;br/&gt;
  hwi/src/java/org/apache/hadoop/hive/hwi/HWISessionItem.java 1bf8c97 &lt;br/&gt;
  metastore/ivy.xml 83218fc &lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java e540c63 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/958/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Patrick&lt;/p&gt;
</comment>
                            <comment id="13066319" author="jiraposter@reviews.apache.org" created="Sat, 16 Jul 2011 00:02:00 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-06-27 20:51:48, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 91&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/1/?file=21668#file21668line91&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/1/?file=21668#file21668line91&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We should try to avoid making the metastore dependent on ql. There&apos;s already an open ticket (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-850&quot; title=&quot;moving SessionState from ql to common&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-850&quot;&gt;HIVE-850&lt;/a&gt;) that covers the task of moving SessionState to common. Looks like now may be a good time to do this.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;ve refactored the log initialization code in order to allow reuse (moved into common). Took a look at doing more like 850, but it looks like that&apos;s going to be a much class to tease apart.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;notice as part of this refactoring the log4j initialization method now throws an exception rather than silently ignoring the missing log4j.properties. When I built this (ant package) and run either the hiveserver or metastore it now complains about no log4j.properties found on the classpath (please give it a try). I added a log4j.properties to the conf dir and it was fine. It seems that the exec jar includes a log4j.properties, should other jars also? or it&apos;s just up to the user to address this?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/958/#review919&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#review919&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-07-15 23:51:55, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/958/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-15 23:51:55)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2139&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java 728958d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;service/src/java/org/apache/hadoop/hive/service/HiveServer.java ea04be9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 090ecfc &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java 61393c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/hiveserver.sh b5edce4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/metastore.sh db15f6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java bd9f6b1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/build.xml 0969e16 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/ivy.xml bee3bf0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/LogUtils.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/cli/CommonCliOptions.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hwi/src/java/org/apache/hadoop/hive/hwi/HWISessionItem.java 1bf8c97 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/ivy.xml 83218fc &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java e540c63 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/958/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13066320" author="phunt" created="Sat, 16 Jul 2011 00:07:03 +0000"  >&lt;p&gt;Updated based on Carl&apos;s feedback.&lt;/p&gt;</comment>
                            <comment id="13067411" author="jiraposter@reviews.apache.org" created="Tue, 19 Jul 2011 00:08:58 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/958/#review1106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#review1106&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;common/build.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment2245&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment2245&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This target overrides the definition of &apos;compile&apos; in build-common.xml, but neglects to include this action which copies over hive-log4j.properties:&lt;/p&gt;

&lt;p&gt;        &amp;lt;copy todir=&quot;${build.classes}&quot; failonerror=&quot;false&quot;&amp;gt;&lt;br/&gt;
          &amp;lt;fileset dir=&quot;${src.dir}/conf&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;/copy&amp;gt;&lt;/p&gt;

&lt;p&gt;    If this is added in I think the missing hive-log4j.properties issue will be resolved.&lt;/p&gt;



&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/#comment2244&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#comment2244&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This should be $METASTORE_PORT instead of HIVE_PORT (see metastore.sh).&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-07-15 23:51:55, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/958/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-15 23:51:55)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2139&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java 728958d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;service/src/java/org/apache/hadoop/hive/service/HiveServer.java ea04be9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 090ecfc &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java 61393c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/hiveserver.sh b5edce4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/metastore.sh db15f6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java bd9f6b1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/build.xml 0969e16 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/ivy.xml bee3bf0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/LogUtils.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/cli/CommonCliOptions.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hwi/src/java/org/apache/hadoop/hive/hwi/HWISessionItem.java 1bf8c97 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/ivy.xml 83218fc &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java e540c63 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/958/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13067933" author="jiraposter@reviews.apache.org" created="Tue, 19 Jul 2011 20:14:57 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-07-19 00:08:19, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3382&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/2/?file=26007#file26007line3382&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/2/?file=26007#file26007line3382&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This should be $METASTORE_PORT instead of HIVE_PORT (see metastore.sh).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I missed that, thanks.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-19 00:08:19, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; common/build.xml, line 30&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/958/diff/2/?file=26001#file26001line30&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff/2/?file=26001#file26001line30&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This target overrides the definition of &apos;compile&apos; in build-common.xml, but neglects to include this action which copies over hive-log4j.properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;         &amp;lt;copy todir=&quot;${build.classes}&quot; failonerror=&quot;false&quot;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;           &amp;lt;fileset dir=&quot;${src.dir}/conf&quot;/&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;         &amp;lt;/copy&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     If this is added in I think the missing hive-log4j.properties issue will be resolved.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok &amp;#8211; FYI I originally copied this section from cli/build.xml, not build-common.xml. (it&apos;s the same except for this missing copy)&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/958/#review1106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/#review1106&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-07-15 23:51:55, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/958/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-15 23:51:55)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2139&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java 728958d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;service/src/java/org/apache/hadoop/hive/service/HiveServer.java ea04be9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 090ecfc &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java 61393c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/hiveserver.sh b5edce4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;bin/ext/metastore.sh db15f6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java bd9f6b1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/build.xml 0969e16 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/ivy.xml bee3bf0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/LogUtils.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/common/cli/CommonCliOptions.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hwi/src/java/org/apache/hadoop/hive/hwi/HWISessionItem.java 1bf8c97 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/ivy.xml 83218fc &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java e540c63 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/958/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13067934" author="jiraposter@reviews.apache.org" created="Tue, 19 Jul 2011 20:16:58 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/958/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-19 20:15:07.278811)&lt;/p&gt;


&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated with Carl&apos;s comments.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch updates HiveServer and HiveMetastore to add proper cli handling - similar to that used in CliDriver (ie GnuParser).&lt;/p&gt;

&lt;p&gt;There&apos;s a common HiveCli class that&apos;s used by both main classes.&lt;/p&gt;

&lt;p&gt;I&apos;ve attempted to make the cli&apos;s backward compatible with the prior command line processing. Notice I&apos;ve &quot;deprecated&quot; (via warnings, but the code still runs) if the old style CLI usage is used.&lt;/p&gt;

&lt;p&gt;commands such as the following now work as expected:&lt;/p&gt;

&lt;p&gt;bin/hive --service hiveserver -t 200 -p 12000 --hiveconf hive.root.logger=DEBUG,console&lt;/p&gt;

&lt;p&gt;as does the following which generates usage information:&lt;/p&gt;

&lt;p&gt;bin/hive --service hiveserver -h&lt;/p&gt;

&lt;p&gt;Note: HiveMetastore as not initializing log4j, I updated the code to do similar to HiveServer (otw the hiveconf hive.root.logger option above didn&apos;t work).&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2139&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  common/build.xml 0969e16 &lt;br/&gt;
  common/ivy.xml bee3bf0 &lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/common/LogUtils.java PRE-CREATION &lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/common/cli/CommonCliOptions.java PRE-CREATION &lt;br/&gt;
  hwi/src/java/org/apache/hadoop/hive/hwi/HWISessionItem.java 1bf8c97 &lt;br/&gt;
  metastore/ivy.xml 83218fc &lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java e540c63 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 090ecfc &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java 61393c8 &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java 728958d &lt;br/&gt;
  service/src/java/org/apache/hadoop/hive/service/HiveServer.java ea04be9 &lt;br/&gt;
  cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java bd9f6b1 &lt;br/&gt;
  bin/ext/hiveserver.sh b5edce4 &lt;br/&gt;
  bin/ext/metastore.sh db15f6e &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/958/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/958/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I couldn&apos;t find any tests for these changes, so I verfied the changes manually.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Patrick&lt;/p&gt;
</comment>
                            <comment id="13067968" author="phunt" created="Tue, 19 Jul 2011 21:07:51 +0000"  >&lt;p&gt;Updated with Carl&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="13068173" author="cwsteinbach" created="Wed, 20 Jul 2011 06:38:37 +0000"  >&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13069128" author="cwsteinbach" created="Thu, 21 Jul 2011 18:50:58 +0000"  >&lt;p&gt;Committed to trunk. Thanks Patrick!&lt;/p&gt;</comment>
                            <comment id="13069163" author="hudson" created="Thu, 21 Jul 2011 19:53:36 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #841 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/841/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/841/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2139&quot; title=&quot;Enables HiveServer to accept -hiveconf option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2139&quot;&gt;&lt;del&gt;HIVE-2139&lt;/del&gt;&lt;/a&gt;. Enable HiveServer to accept -hiveconf option (Patrick Hunt via cws)&lt;/p&gt;

&lt;p&gt;cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1149311&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1149311&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/common/LogUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hwi/src/java/org/apache/hadoop/hive/hwi/HWISessionItem.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/service/src/java/org/apache/hadoop/hive/service/HiveServer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/common/cli/CommonCliOptions.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/ivy.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/bin/ext/metastore.sh&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/common/ivy.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/common/build.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/common/cli&lt;/li&gt;
	&lt;li&gt;/hive/trunk/bin/ext/hiveserver.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13069184" author="phunt" created="Thu, 21 Jul 2011 20:19:37 +0000"  >&lt;p&gt;Should I update the docs for this? Where? If so any guidelines for doing so? (version differences for example)&lt;/p&gt;</comment>
                            <comment id="13069245" author="cwsteinbach" created="Thu, 21 Jul 2011 22:17:35 +0000"  >&lt;p&gt;I think doc updates should go here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/HiveServer&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/HiveServer&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13069251" author="phunt" created="Thu, 21 Jul 2011 22:28:00 +0000"  >&lt;p&gt;Ok, I&apos;ll update that. Do you all have some common way to handle documenting the fact that pre-0.8.0 it&apos;s one way, post 0.8.0 it&apos;s another? Is there an example you can point me to?&lt;/p&gt;</comment>
                            <comment id="13069328" author="cwsteinbach" created="Fri, 22 Jul 2011 01:00:05 +0000"  >&lt;p&gt;@Patrick: Good idea. I created a page on the wiki for notes like this: &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/HiveChangeLog&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/HiveChangeLog&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please add a blurb there and be sure to include a link back to this ticket. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12487063" name="HIVE-2139.patch" size="32498" author="phunt" created="Tue, 19 Jul 2011 21:07:51 +0000"/>
                            <attachment id="12486700" name="HIVE-2139.patch" size="32368" author="phunt" created="Sat, 16 Jul 2011 00:07:03 +0000"/>
                            <attachment id="12483772" name="HIVE-2139.patch" size="15366" author="phunt" created="Fri, 24 Jun 2011 21:43:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Jun 2011 21:43:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>67208</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lilb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2140] Return correct Major / Minor version numbers for Hive Driver</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2140</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12505893">HIVE-2140</key>
            <summary>Return correct Major / Minor version numbers for Hive Driver</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21146&amp;avatarType=issuetype">Sub-task</type>
                            <parent id="12428762">HIVE-576</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cboyden">Curtis Boyden</assignee>
                                    <reporter username="cboyden">Curtis Boyden</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 May 2011 01:58:59 +0000</created>
                <updated>Wed, 27 Jul 2011 04:20:25 +0000</updated>
                            <resolved>Wed, 15 Jun 2011 02:09:49 +0000</resolved>
                                    <version>0.6.0</version>
                    <version>0.7.0</version>
                                    <fixVersion>0.7.1</fixVersion>
                    <fixVersion>0.8.0</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13027528" author="cboyden" created="Mon, 2 May 2011 02:02:49 +0000"  >&lt;p&gt;Attaching patches to return the JDBC Driver version number from the manifest file for both the Driver class and the DatabaseMetadata class.&lt;/p&gt;</comment>
                            <comment id="13049572" author="cwsteinbach" created="Wed, 15 Jun 2011 02:09:49 +0000"  >&lt;p&gt;Committed to trunk and branch-0.7. Thanks Curtis!&lt;/p&gt;</comment>
                            <comment id="13054062" author="hudson" created="Thu, 23 Jun 2011 19:47:05 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #790 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/790/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/790/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477921" name="hive-0.6-driver-version.patch" size="7355" author="cboyden" created="Mon, 2 May 2011 02:03:41 +0000"/>
                            <attachment id="12477922" name="hive-0.7-driver-version.patch" size="7123" author="cboyden" created="Mon, 2 May 2011 02:03:41 +0000"/>
                            <attachment id="12477923" name="hive-trunk-driver-version.patch" size="7121" author="cboyden" created="Mon, 2 May 2011 02:03:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 Jun 2011 02:09:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lilj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123663</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2141] Eclipse integration does not work when Hive is build against Secure Hadoop</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2141</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12505965">HIVE-2141</key>
            <summary>Eclipse integration does not work when Hive is build against Secure Hadoop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 May 2011 18:24:08 +0000</created>
                <updated>Sat, 6 Dec 2014 05:23:29 +0000</updated>
                                            <version>0.7.0</version>
                                                    <component>Build Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13027773" author="ashutoshc" created="Mon, 2 May 2011 19:01:16 +0000"  >&lt;p&gt;Also, .classpath needs to be updated for recently introduced dependency of javaewah lib&lt;/p&gt;</comment>
                            <comment id="13027775" author="jvs" created="Mon, 2 May 2011 19:06:46 +0000"  >&lt;p&gt;javaewah dependency is about to get fixed (rolled into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1644&quot; title=&quot;use filter pushdown for automatically accessing indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1644&quot;&gt;&lt;del&gt;HIVE-1644&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 2 May 2011 19:01:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42253</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d2gn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74175</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2142] Jobs do not get killed even when they created too many files.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2142</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12505984">HIVE-2142</key>
            <summary>Jobs do not get killed even when they created too many files.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 May 2011 21:56:23 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:21 +0000</updated>
                            <resolved>Tue, 3 May 2011 05:11:05 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13027927" author="nzhang" created="Mon, 2 May 2011 23:45:45 +0000"  >&lt;p&gt;Please correct the error message syntax as follows (since it is a user-facing message): &lt;/p&gt;

&lt;p&gt;&quot;total number of created files now is &quot; + numFiles + &quot;, exceeds &quot;).append(upperLimit);&lt;/p&gt;

&lt;p&gt;should be changed to:&lt;/p&gt;

&lt;p&gt;&quot;total number of created files now is &quot; + numFiles + &quot;, which exceeds &quot;).append(upperLimit);&lt;/p&gt;

&lt;p&gt;Otherwise it looks fine. &lt;/p&gt;</comment>
                            <comment id="13027933" author="he yongqiang" created="Mon, 2 May 2011 23:56:16 +0000"  >&lt;p&gt;opened follow up jira &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2143&quot; title=&quot;add negative minirCliDriver in test (put dyn_part3.q in it)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2143&quot;&gt;HIVE-2143&lt;/a&gt; for testing.&lt;/p&gt;</comment>
                            <comment id="13027953" author="nzhang" created="Tue, 3 May 2011 00:28:22 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13028020" author="nzhang" created="Tue, 3 May 2011 05:11:05 +0000"  >&lt;p&gt;Committed. Thanks Yongqiang!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477998" name="HIVE-2142.1.patch" size="1127" author="he yongqiang" created="Mon, 2 May 2011 22:49:46 +0000"/>
                            <attachment id="12478003" name="HIVE-2142.2.patch" size="1133" author="he yongqiang" created="Mon, 2 May 2011 23:55:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 2 May 2011 23:45:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lilr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123664</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2143] add negative minirCliDriver in test (put dyn_part3.q in it)</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2143</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12505992">HIVE-2143</key>
            <summary>add negative minirCliDriver in test (put dyn_part3.q in it)</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 May 2011 23:52:52 +0000</created>
                <updated>Mon, 2 May 2011 23:52:52 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08o9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2144] reduce workload generated by JDBCStatsPublisher</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2144</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;In JDBCStatsPublisher, we first try a SELECT query to see if the specific ID was inserted by another task (mostly likely a speculative or previously failed task). Depending on if the ID is there, an INSERT or UPDATE query was issues. So there are basically 2x of queries per row inserted into the intermediate stats table. This workload could be reduced to 1/2 if we insert it anyway (it is very rare that IDs are duplicated) and use a different SQL query in the aggregation phase to dedup the ID (e.g., using group-by and max()). The benefits are that even though the aggregation query is more expensive, it is only run once per query. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12505995">HIVE-2144</key>
            <summary>reduce workload generated by JDBCStatsPublisher</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tnykiel">Tomasz Nykiel</assignee>
                                    <reporter username="nzhang">Ning Zhang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2011 00:17:26 +0000</created>
                <updated>Fri, 16 Dec 2011 23:55:57 +0000</updated>
                            <resolved>Tue, 24 May 2011 19:18:54 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13035493" author="tnykiel" created="Wed, 18 May 2011 17:10:46 +0000"  >&lt;p&gt;Currently the schema of the stat table is the following:&lt;/p&gt;

&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255), ROW_COUNT BIGINT ) and does not have any integrity constraints declared.&lt;/p&gt;

&lt;p&gt;We can amend it to:&lt;/p&gt;

&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255) UNIQUE , ROW_COUNT BIGINT ).&lt;/p&gt;

&lt;p&gt;Then instead of executing two queries per row inserted, we can execute one INSERT query, as we do currently.&lt;br/&gt;
In the case when the integrity constraint is violated, via the unique index, which can be caught by an exception, we perform a single UPDATE query.&lt;br/&gt;
The UPDATE query needs to check the condition, if the currently inserted stats are &quot;newer&quot; then the ones already in the table:&lt;/p&gt;

&lt;p&gt;UPDATE PARTITION_STAT_TBL SET ROW_COUNT = new_value&lt;br/&gt;
    WHERE ID = &quot;rowID&quot; AND&lt;br/&gt;
(0)    new_value &amp;gt;&lt;br/&gt;
(1)                (SELECT TEMP.ROW_COUNT FROM&lt;br/&gt;
(2)                    (SELECT ROW_COUNT FROM PARTITION_STAT_TBL WHERE ID = &quot;rowID&quot;) TEMP )&lt;/p&gt;

&lt;p&gt;--(0) is a condition that checks if the newly inserted value is greater that the one we already have.&lt;br/&gt;
--(1) and (2) is a work-around for MySQL, which does not allow to refer to the table that occurs in the update statement. Here, we basically materialize the value that we need for comparison.&lt;br/&gt;
--(1) should theoretically have (LIMIT 1) to choose exactly one tuple, however Derby does not support it, and by the unique constraint, and the fact that the insert failed, there exists exactly one tuple matching the ID predicate.&lt;/p&gt;

&lt;p&gt;To summarize, for non existing rows, only one insert query will be executed, instead of two.&lt;br/&gt;
For existing rows, which seems to occur very infrequently, two queries instead of three will be executed.&lt;/p&gt;</comment>
                            <comment id="13035612" author="nzhang" created="Wed, 18 May 2011 19:37:24 +0000"  >&lt;p&gt;Great! I like the idea. &lt;/p&gt;

&lt;p&gt;One comment about the primary key constraint: I&apos;m not sure if UNIQUE is the standard way to specify primary key constraint. There are people using Oralce/MS SQL sever/Postgres as metastore, we should use a standard way. I think &apos;id varchar(255) PRIMARY KEY&apos; is more widely supported. Can you double check with mysql and derby?&lt;/p&gt;</comment>
                            <comment id="13035634" author="tnykiel" created="Wed, 18 May 2011 20:12:31 +0000"  >&lt;p&gt;Yes, I agree. There are some subtle differences between UNIQUE and PK in Derby and MySQL (e.g., in MySQL the unique index allows null values, and in Derby it does not. So in general, PK constraint will be more suitable.&lt;/p&gt;

&lt;p&gt;CREATE TABLE PARTITION_STAT_TBL ( IDE VARCHAR(255) PRIMARY KEY, ROW_COUNT BIGINT ) works for both Derby and MySql.&lt;br/&gt;
After a quick check it seems that it&apos;s supported by Oracle/MSSQL as well.&lt;/p&gt;
</comment>
                            <comment id="13036566" author="jiraposter@reviews.apache.org" created="Thu, 19 May 2011 23:15:48 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/765/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Currently, the JDBCStatsPublisher executes two queries per inserted row of statistics, first query to check if the ID was inserted by another task, and second query to insert a new or update the existing row.&lt;br/&gt;
The latter occurs very rarely, since duplicates most likely originate from speculative failed tasks.&lt;/p&gt;

&lt;p&gt;Currently the schema of the stat table is the following:&lt;/p&gt;

&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255), ROW_COUNT BIGINT ) and does not have any integrity constraints declared.&lt;/p&gt;

&lt;p&gt;We amend it to:&lt;/p&gt;

&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255) PRIMARY KEY , ROW_COUNT BIGINT ).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt; improves on performance by greedily performing the insertion statement.&lt;br/&gt;
Then instead of executing two queries per row inserted, we can execute one INSERT query.&lt;br/&gt;
In the case primary key constraint violation, we perform a single UPDATE query.&lt;br/&gt;
The UPDATE query needs to check the condition, if the currently inserted stats are &quot;newer&quot; then the ones already in the table.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2144&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java 1125140 &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/765/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestStatsPublisher JUnit test:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;basic behaviour&lt;/li&gt;
	&lt;li&gt;multiple updates&lt;/li&gt;
	&lt;li&gt;cleanup of the statistics table after aggregation&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Standalone testing on the cluster.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;insert/analyze queries over non-partitioned/partitioned tables&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;NOTE. For the correct behaviour, the primary_key index needs to be created, or the PARTITION_STAT_TABLE table dropped - which triggers creation of the table with the constraint declared.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Tomasz&lt;/p&gt;
</comment>
                            <comment id="13036707" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 07:26:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/765/#review696&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#review696&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1395&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Here we need to catch SQLRecoverableException and retry.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1396&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1396&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    If these parameters present in conf/hive-default.xml, you don&apos;t need to set them again here since new JobConf() should read from hive-default.xml.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1397&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1397&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    the usual use case for aggregateStats() is that the key should be the prefix (e.g., file_000) of the string inserted by publishStats, so that all keys that match the prefix will be aggregated.&lt;/p&gt;

&lt;p&gt;    Can you add one more test for aggregateStats(&apos;file_000&apos;)?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1398&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1398&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    won&apos;t this also change the stats at the 2nd publishStat()?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1399&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1399&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    also add another aggStats for prefix.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-05-19 23:14:26, Tomasz Nykiel wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/765/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-19 23:14:26)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the JDBCStatsPublisher executes two queries per inserted row of statistics, first query to check if the ID was inserted by another task, and second query to insert a new or update the existing row.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The latter occurs very rarely, since duplicates most likely originate from speculative failed tasks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently the schema of the stat table is the following:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255), ROW_COUNT BIGINT ) and does not have any integrity constraints declared.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We amend it to:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255) PRIMARY KEY , ROW_COUNT BIGINT ).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt; improves on performance by greedily performing the insertion statement.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Then instead of executing two queries per row inserted, we can execute one INSERT query.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In the case primary key constraint violation, we perform a single UPDATE query.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The UPDATE query needs to check the condition, if the currently inserted stats are &quot;newer&quot; then the ones already in the table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2144&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java 1125140 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/765/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestStatsPublisher JUnit test:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- basic behaviour&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- multiple updates&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- cleanup of the statistics table after aggregation&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Standalone testing on the cluster.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- insert/analyze queries over non-partitioned/partitioned tables&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;NOTE. For the correct behaviour, the primary_key index needs to be created, or the PARTITION_STAT_TABLE table dropped - which triggers creation of the table with the constraint declared.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Tomasz&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13036932" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 16:59:52 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/765/#review702&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#review702&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1402&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1402&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Yes. That&apos;s correct.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1403&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1403&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ok.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1404&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1404&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I will amend the test cases to aggregate over prefixes. I will also add one simple test case to aggregate over exact match.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1405&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1405&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The original value inserted in line 120 is 200. Neither 100, nor 150 should change the values. &lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1406&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1406&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    As disscussed before, I will improve the test cases to aggregate over prefixes.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Tomasz&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-05-19 23:14:26, Tomasz Nykiel wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/765/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-19 23:14:26)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the JDBCStatsPublisher executes two queries per inserted row of statistics, first query to check if the ID was inserted by another task, and second query to insert a new or update the existing row.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The latter occurs very rarely, since duplicates most likely originate from speculative failed tasks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently the schema of the stat table is the following:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255), ROW_COUNT BIGINT ) and does not have any integrity constraints declared.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We amend it to:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255) PRIMARY KEY , ROW_COUNT BIGINT ).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt; improves on performance by greedily performing the insertion statement.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Then instead of executing two queries per row inserted, we can execute one INSERT query.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In the case primary key constraint violation, we perform a single UPDATE query.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The UPDATE query needs to check the condition, if the currently inserted stats are &quot;newer&quot; then the ones already in the table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2144&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java 1125140 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/765/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestStatsPublisher JUnit test:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- basic behaviour&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- multiple updates&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- cleanup of the statistics table after aggregation&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Standalone testing on the cluster.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- insert/analyze queries over non-partitioned/partitioned tables&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;NOTE. For the correct behaviour, the primary_key index needs to be created, or the PARTITION_STAT_TABLE table dropped - which triggers creation of the table with the constraint declared.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Tomasz&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13037221" author="jiraposter@reviews.apache.org" created="Sat, 21 May 2011 01:49:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/765/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-05-21 01:49:07.819494)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;-Amended the test cases to accommodate prefix aggregation&lt;br/&gt;
-Fixed unnecessary conf settings&lt;br/&gt;
-Fixed exception handling in JDBCStatsPublisher.publishStats -&amp;gt; SQLRecoverableException is handled when executing the update statement.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Currently, the JDBCStatsPublisher executes two queries per inserted row of statistics, first query to check if the ID was inserted by another task, and second query to insert a new or update the existing row.&lt;br/&gt;
The latter occurs very rarely, since duplicates most likely originate from speculative failed tasks.&lt;/p&gt;

&lt;p&gt;Currently the schema of the stat table is the following:&lt;/p&gt;

&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255), ROW_COUNT BIGINT ) and does not have any integrity constraints declared.&lt;/p&gt;

&lt;p&gt;We amend it to:&lt;/p&gt;

&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255) PRIMARY KEY , ROW_COUNT BIGINT ).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt; improves on performance by greedily performing the insertion statement.&lt;br/&gt;
Then instead of executing two queries per row inserted, we can execute one INSERT query.&lt;br/&gt;
In the case primary key constraint violation, we perform a single UPDATE query.&lt;br/&gt;
The UPDATE query needs to check the condition, if the currently inserted stats are &quot;newer&quot; then the ones already in the table.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2144&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java 1125468 &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/765/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestStatsPublisher JUnit test:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;basic behaviour&lt;/li&gt;
	&lt;li&gt;multiple updates&lt;/li&gt;
	&lt;li&gt;cleanup of the statistics table after aggregation&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Standalone testing on the cluster.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;insert/analyze queries over non-partitioned/partitioned tables&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;NOTE. For the correct behaviour, the primary_key index needs to be created, or the PARTITION_STAT_TABLE table dropped - which triggers creation of the table with the constraint declared.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Tomasz&lt;/p&gt;
</comment>
                            <comment id="13037222" author="tnykiel" created="Sat, 21 May 2011 01:52:45 +0000"  >&lt;p&gt;Fixed after revision 1.&lt;/p&gt;</comment>
                            <comment id="13038236" author="jiraposter@reviews.apache.org" created="Mon, 23 May 2011 21:17:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/765/#review709&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#review709&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1417&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1417&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    can you add a comment on what situation this exception will be thrown? Just for the sake of reader that didn&apos;t notice there is a primary key constraint in the DDL. &lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/765/#comment1418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/#comment1418&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    remove this?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-05-21 01:49:07, Tomasz Nykiel wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/765/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-21 01:49:07)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the JDBCStatsPublisher executes two queries per inserted row of statistics, first query to check if the ID was inserted by another task, and second query to insert a new or update the existing row.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The latter occurs very rarely, since duplicates most likely originate from speculative failed tasks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently the schema of the stat table is the following:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255), ROW_COUNT BIGINT ) and does not have any integrity constraints declared.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We amend it to:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;PARTITION_STAT_TABLE ( ID VARCHAR(255) PRIMARY KEY , ROW_COUNT BIGINT ).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt; improves on performance by greedily performing the insertion statement.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Then instead of executing two queries per row inserted, we can execute one INSERT query.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In the case primary key constraint violation, we perform a single UPDATE query.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The UPDATE query needs to check the condition, if the currently inserted stats are &quot;newer&quot; then the ones already in the table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2144&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java 1125468 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/765/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/765/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestStatsPublisher JUnit test:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- basic behaviour&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- multiple updates&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- cleanup of the statistics table after aggregation&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Standalone testing on the cluster.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- insert/analyze queries over non-partitioned/partitioned tables&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;NOTE. For the correct behaviour, the primary_key index needs to be created, or the PARTITION_STAT_TABLE table dropped - which triggers creation of the table with the constraint declared.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Tomasz&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13038348" author="nzhang" created="Tue, 24 May 2011 01:23:32 +0000"  >&lt;p&gt;+1. Will commit if tests pass. &lt;/p&gt;</comment>
                            <comment id="13038419" author="nzhang" created="Tue, 24 May 2011 07:02:06 +0000"  >&lt;p&gt;Tom, TestMetaStoreAuthorization failed with 1 Error. Can you take a look?&lt;/p&gt;</comment>
                            <comment id="13038735" author="nzhang" created="Tue, 24 May 2011 19:16:22 +0000"  >&lt;p&gt;Actually the failure was due to port confliction on my test machine. Tested on another box and it passed. &lt;/p&gt;</comment>
                            <comment id="13038737" author="nzhang" created="Tue, 24 May 2011 19:18:54 +0000"  >&lt;p&gt;Committed. Thanks Tom!&lt;/p&gt;

&lt;p&gt;Congrats on your 1st commit!&lt;/p&gt;</comment>
                            <comment id="13038757" author="tnykiel" created="Tue, 24 May 2011 20:02:45 +0000"  >&lt;p&gt;Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13038932" author="hudson" created="Wed, 25 May 2011 02:14:34 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #748 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hive-trunk-h0.21/748/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/Hive-trunk-h0.21/748/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2144&quot; title=&quot;reduce workload generated by JDBCStatsPublisher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2144&quot;&gt;&lt;del&gt;HIVE-2144&lt;/del&gt;&lt;/a&gt;. reduce workload generated by JDBCStatsPublisher (Tomasz Nykiel via Ning Zhang)&lt;/p&gt;

&lt;p&gt;nzhang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1127229&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1127229&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisher.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/stats/jdbc/JDBCStatsPublisher.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13039417" author="tnykiel" created="Wed, 25 May 2011 23:24:03 +0000"  >&lt;p&gt;IMPORTANT NOTE!&lt;/p&gt;

&lt;p&gt;Before deployment, the primary key constraint needs to be added manually on the ID column of PARTITION_STAT_TBL, if the table already exists.&lt;br/&gt;
Otherwise, the statistics might be duplicated for some entries, and the aggregated statistics will be silently incorrect.&lt;/p&gt;

&lt;p&gt;If the table does not exist, it will be created in the proper format.&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12479977" name="HIVE-2144.1.patch" size="21099" author="tnykiel" created="Sat, 21 May 2011 01:52:45 +0000"/>
                            <attachment id="12480170" name="HIVE-2144.2.patch" size="21090" author="tnykiel" created="Mon, 23 May 2011 22:08:13 +0000"/>
                            <attachment id="12479851" name="HIVE-2144.patch" size="15813" author="tnykiel" created="Thu, 19 May 2011 22:11:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 18 May 2011 17:10:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72551</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lilz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123665</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2145] NPE during parsing order-by expression</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2145</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The following query throws NPE, where it should have throw parsing exception. &lt;/p&gt;

&lt;p&gt;hive&amp;gt; select key, count(1) cnt from src group by key order by count(1) limit 10;&lt;br/&gt;
select key, count(1) cnt from src group by key order by count(1) limit 10;&lt;br/&gt;
FAILED: Hive Internal Error: java.lang.NullPointerException(null)&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.hive.ql.plan.ExprNodeGenericFuncDesc.newInstance(ExprNodeGenericFuncDesc.java:153)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory$DefaultExprProcessor.getXpathOrFuncExprNodeDesc(TypeCheckProcFactory.java:640)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory$DefaultExprProcessor.process(TypeCheckProcFactory.java:761)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultRuleDispatcher.dispatch(DefaultRuleDispatcher.java:89)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.dispatch(DefaultGraphWalker.java:88)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.walk(DefaultGraphWalker.java:125)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.startWalking(DefaultGraphWalker.java:102)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory.genExprNode(TypeCheckProcFactory.java:156)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genExprNodeDesc(SemanticAnalyzer.java:6830)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genExprNodeDesc(SemanticAnalyzer.java:6788)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genReduceSinkPlan(SemanticAnalyzer.java:4303)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genBodyPlan(SemanticAnalyzer.java:5461)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genPlan(SemanticAnalyzer.java:6022)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:6607)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:238)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:340)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.run(Driver.java:790)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:209)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:286)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:514)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;/p&gt;


&lt;p&gt;We should still allow functions in the order by clause (as in MySQL) but fix the NPE.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506000">HIVE-2145</key>
            <summary>NPE during parsing order-by expression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chinnalalam">Chinna Rao Lalam</assignee>
                                    <reporter username="nzhang">Ning Zhang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2011 00:52:32 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:57 +0000</updated>
                            <resolved>Wed, 14 Sep 2011 15:07:00 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13102832" author="jiraposter@reviews.apache.org" created="Mon, 12 Sep 2011 17:36:10 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1802/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1802/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and Ning Zhang.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;While compiling the query if order by contains function throwing an exception..&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2145&quot; title=&quot;NPE during parsing order-by expression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2145&quot;&gt;&lt;del&gt;HIVE-2145&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2145&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2145&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java 1167000 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1167000 &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/orderby_function.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/orderby_function.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1802/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1802/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added unit test case and ran all existing test cases&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;chinna&lt;/p&gt;
</comment>
                            <comment id="13104274" author="nzhang" created="Wed, 14 Sep 2011 05:53:18 +0000"  >&lt;p&gt;+1. Will commit if tests pass. &lt;/p&gt;</comment>
                            <comment id="13104551" author="nzhang" created="Wed, 14 Sep 2011 15:07:00 +0000"  >&lt;p&gt;Committed. Thanks Chinna!&lt;/p&gt;</comment>
                            <comment id="13105006" author="hudson" created="Wed, 14 Sep 2011 23:44:26 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #954 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/954/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/954/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2145&quot; title=&quot;NPE during parsing order-by expression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2145&quot;&gt;&lt;del&gt;HIVE-2145&lt;/del&gt;&lt;/a&gt;. NPE during parsing order-by expression (Chinna Rao Lalam via Ning Zhang)&lt;/p&gt;

&lt;p&gt;nzhang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170672&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170672&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientnegative/orderby_function.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientnegative/orderby_function.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13114166" author="aoxiang" created="Sun, 25 Sep 2011 07:05:33 +0000"  >&lt;p&gt;the error message is not very well, for example &lt;br/&gt;
select key, count(1) cnt from src group by key sort by count(1) limit 10;  will throw the following error message:&lt;/p&gt;

&lt;p&gt;FAILED: Error in semantic analysis: functions are not supported in order by&lt;/p&gt;</comment>
                            <comment id="13114722" author="chinnalalam" created="Mon, 26 Sep 2011 15:31:22 +0000"  >&lt;p&gt;Instead hard code the clause in message need to construct the message from the ASTNode.&lt;/p&gt;</comment>
                            <comment id="13135316" author="hudson" created="Tue, 25 Oct 2011 18:28:11 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1032 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1032/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1032/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2512&quot; title=&quot;After HIVE-2145, Hive disallow any use of function in cluster-by clause&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2512&quot;&gt;&lt;del&gt;HIVE-2512&lt;/del&gt;&lt;/a&gt;. After &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2145&quot; title=&quot;NPE during parsing order-by expression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2145&quot;&gt;&lt;del&gt;HIVE-2145&lt;/del&gt;&lt;/a&gt;, Hive disallow any use of function in cluster-by clause (Chinna Rao Lalam via Ning Zhang)&lt;/p&gt;

&lt;p&gt;nzhang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1188473&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1188473&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientnegative/orderby_function.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientnegative/orderby_function.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12524646">HIVE-2469</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12494069" name="HIVE-2145.patch" size="2073" author="chinnalalam" created="Mon, 12 Sep 2011 17:23:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 12 Sep 2011 17:36:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3265</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lim7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123666</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2146] Block Sampling should adjust number of reducers accordingly to make it useful</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2146</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Now number of reducers of block sampling is not modified, so that queries like:&lt;br/&gt;
select c from tab tablesample(1 percent) group by c;&lt;br/&gt;
can generate huge number of reducers although the input is sampled to be small.&lt;br/&gt;
We need to shrink number of reducers to make block sampling more useful.&lt;br/&gt;
Since now number of reducers are determined before get splits, the way to do it probably is not clean enough, but we can do a good guess.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506004">HIVE-2146</key>
            <summary>Block Sampling should adjust number of reducers accordingly to make it useful</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sdong">Siying Dong</assignee>
                                    <reporter username="sdong">Siying Dong</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2011 01:26:41 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:05 +0000</updated>
                            <resolved>Wed, 4 May 2011 19:07:58 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13028532" author="nzhang" created="Wed, 4 May 2011 00:45:05 +0000"  >&lt;p&gt;Siying can you create a review request? &lt;/p&gt;

&lt;p&gt;I&apos;ve a couple of comments as well: &lt;br/&gt;
 1) comment in line 387 is not complete&lt;br/&gt;
 2) comments in line 388-389: can you give an example in which case all input alias are sampled by syntax but it actually cannot be sampled?&lt;br/&gt;
 3) line 391: if we want to mimic the old estimation algorithm it seems we shouldn&apos;t + bytesPerReducer here? It is added in line 399 right?  &lt;/p&gt;</comment>
                            <comment id="13028556" author="sdong" created="Wed, 4 May 2011 01:57:01 +0000"  >&lt;p&gt;for 2) the possibility that it can&apos;t be sampled is more likely to be the case that CombineHiveInputformat.getSplits() finally calls super.getSplits() for some reasons. In those cases, the data are not sampled at all. &lt;br/&gt;
Another possible is that, for example, two alias of the MapReduce job include the same directory. We can&apos;t sample it then.&lt;/p&gt;

&lt;p&gt;For 1) and 3), I think about it more. I&apos;ll remove the extra bytesPerReducer added. The worst case is that we run one less reducer. Shouldn&apos;t be so bad.&lt;/p&gt;</comment>
                            <comment id="13028563" author="sdong" created="Wed, 4 May 2011 02:15:50 +0000"  >&lt;p&gt;review board:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/685/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/685/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13028564" author="jiraposter@reviews.apache.org" created="Wed, 4 May 2011 02:16:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/685/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/685/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Now number of reducers of block sampling is not modified, so that queries like:&lt;br/&gt;
select c from tab tablesample(1 percent) group by c;&lt;br/&gt;
can generate huge number of reducers although the input is sampled to be small.&lt;br/&gt;
We need to shrink number of reducers to make block sampling more useful.&lt;br/&gt;
Since now number of reducers are determined before get splits, the way to do it probably is not clean enough, but we can do a good guess.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2146&quot; title=&quot;Block Sampling should adjust number of reducers accordingly to make it useful&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2146&quot;&gt;&lt;del&gt;HIVE-2146&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2146&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2146&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapRedTask.java 1098885 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/685/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/685/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Siying&lt;/p&gt;
</comment>
                            <comment id="13028624" author="nzhang" created="Wed, 4 May 2011 06:11:00 +0000"  >&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13028899" author="nzhang" created="Wed, 4 May 2011 19:07:58 +0000"  >&lt;p&gt;Committed. Thanks Siying!&lt;/p&gt;</comment>
                            <comment id="13029816" author="hudson" created="Fri, 6 May 2011 07:59:29 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.20 #712 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hive-trunk-h0.20/712/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/Hive-trunk-h0.20/712/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12478013" name="HIVE-2146.1.patch" size="1866" author="sdong" created="Tue, 3 May 2011 01:31:26 +0000"/>
                            <attachment id="12478119" name="HIVE-2146.2.patch" size="1904" author="sdong" created="Wed, 4 May 2011 02:07:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 May 2011 00:45:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72550</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0limf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123667</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2147] Add api to send / receive message to metastore</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2147</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;This is follow-up work on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2038&quot; title=&quot;Metastore listener&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2038&quot;&gt;&lt;del&gt;HIVE-2038&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506080">HIVE-2147</key>
            <summary>Add api to send / receive message to metastore</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2011 17:43:44 +0000</created>
                <updated>Fri, 16 Dec 2011 23:55:55 +0000</updated>
                            <resolved>Fri, 10 Jun 2011 21:26:59 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13028341" author="ashutoshc" created="Tue, 3 May 2011 17:46:26 +0000"  >&lt;p&gt;This is a git diff on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2038&quot; title=&quot;Metastore listener&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2038&quot;&gt;&lt;del&gt;HIVE-2038&lt;/del&gt;&lt;/a&gt;. As discussed in April contributor meeting, the best way to do this is by using recently introduced hiveobjectRef. This patch doesnt contain thrift generated code to make it easier to review.&lt;/p&gt;</comment>
                            <comment id="13031476" author="cwsteinbach" created="Tue, 10 May 2011 23:40:47 +0000"  >&lt;p&gt;@Ashutosh: can you please post a reviewboard request? Thanks.&lt;/p&gt;</comment>
                            <comment id="13031774" author="ashutoshc" created="Wed, 11 May 2011 15:15:54 +0000"  >&lt;p&gt;Looks like RB is down. Trying to create review request since yesterday. No luck.&lt;/p&gt;</comment>
                            <comment id="13032573" author="ashutoshc" created="Thu, 12 May 2011 18:43:47 +0000"  >&lt;p&gt;@Carl, Looks like RB is not coming back up. I am not sure if I am the only one not able to create new review request. Don&apos;t know with whom to followup for it? In the meantime, Carl if you have comments can you please post them here.&lt;/p&gt;</comment>
                            <comment id="13032624" author="jiraposter@reviews.apache.org" created="Thu, 12 May 2011 19:55:48 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/737/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/737/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Posted for Ashutosh: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12478073/api-without-thrift.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12478073/api-without-thrift.patch&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2147&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  metastore/if/hive_metastore.thrift 6be3f93 &lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1247887 &lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 5562ffc &lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 2ce02bb &lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 75e01ec &lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/events/MessageEvent.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/737/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/737/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Carl&lt;/p&gt;
</comment>
                            <comment id="13032628" author="jiraposter@reviews.apache.org" created="Thu, 12 May 2011 19:57:48 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/737/#review666&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/737/#review666&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/events/MessageEvent.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/737/#comment1328&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/737/#comment1328&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing ASF license.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-05-12 19:56:03, Carl Steinbach wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/737/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/737/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-12 19:56:03)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Posted for Ashutosh: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12478073/api-without-thrift.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12478073/api-without-thrift.patch&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2147&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/if/hive_metastore.thrift 6be3f93 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1247887 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 5562ffc &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 2ce02bb &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 75e01ec &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;metastore/src/java/org/apache/hadoop/hive/metastore/events/MessageEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/737/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/737/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Carl&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13032677" author="jiraposter@reviews.apache.org" created="Thu, 12 May 2011 21:03:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/738/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated patch to include missing ASF license and generated thrift code.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2147&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/metastore/if/hive_metastore.thrift 1102450 &lt;br/&gt;
  trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore.h 1102450 &lt;br/&gt;
  trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore.cpp 1102450 &lt;br/&gt;
  trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore_server.skeleton.cpp 1102450 &lt;br/&gt;
  trunk/metastore/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/metastore/api/ThriftHiveMetastore.java 1102450 &lt;br/&gt;
  trunk/metastore/src/gen/thrift/gen-php/hive_metastore/ThriftHiveMetastore.php 1102450 &lt;br/&gt;
  trunk/metastore/src/gen/thrift/gen-py/hive_metastore/ThriftHiveMetastore-remote 1102450 &lt;br/&gt;
  trunk/metastore/src/gen/thrift/gen-py/hive_metastore/ThriftHiveMetastore.py 1102450 &lt;br/&gt;
  trunk/metastore/src/gen/thrift/gen-rb/thrift_hive_metastore.rb 1102450 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1102450 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1102450 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1102450 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1102450 &lt;br/&gt;
  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/MessageEvent.java PRE-CREATION &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1102450 &lt;br/&gt;
  trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1102450 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/738/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated TestMetaStoreEventListener to test new api.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ashutosh&lt;/p&gt;
</comment>
                            <comment id="13036282" author="ashutoshc" created="Thu, 19 May 2011 16:28:59 +0000"  >&lt;p&gt;Can someone take a look at this one? &lt;/p&gt;</comment>
                            <comment id="13038890" author="cwsteinbach" created="Wed, 25 May 2011 00:08:11 +0000"  >&lt;p&gt;@Ashutosh: can you please attach the most recent version of the patch? Thanks.&lt;/p&gt;</comment>
                            <comment id="13038893" author="ashutoshc" created="Wed, 25 May 2011 00:23:42 +0000"  >&lt;p&gt;Patch on Reviewboard is latest and applies fine. &lt;a href=&quot;https://reviews.apache.org/r/738/diff/#index_header&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/#index_header&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13038907" author="cwsteinbach" created="Wed, 25 May 2011 01:17:09 +0000"  >&lt;p&gt;Right, but I think it&apos;s policy to also attach the patch to the JIRA ticket (we reference the JIRA ID in the commit message, not the reviewboard request ID). Thanks.&lt;/p&gt;</comment>
                            <comment id="13038912" author="ashutoshc" created="Wed, 25 May 2011 01:25:07 +0000"  >&lt;p&gt;I was thinking that if you have some comments and if i need to update the patch then I will generate new patch and attach here. So, was waiting for +1. If you have already reviewed the one on RB then I can attach that here.&lt;/p&gt;</comment>
                            <comment id="13038945" author="cwsteinbach" created="Wed, 25 May 2011 03:43:48 +0000"  >&lt;p&gt;@Ashutosh: I left some comments on RB. Thanks.&lt;/p&gt;</comment>
                            <comment id="13038946" author="jiraposter@reviews.apache.org" created="Wed, 25 May 2011 03:44:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/738/#review713&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#review713&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/metastore/if/hive_metastore.thrift&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/#comment1428&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#comment1428&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Having separate calls for sending request and response messages looks unnecessary. A sendMessage() function with separate request and response message types should work just as well, and will help to avoid confusion &amp;#8211; otherwise I think people will assume that receiveMessage is a polling call.&lt;/p&gt;

&lt;p&gt;    This is starting to look like a general purpose messaging/rpc framework. Is that the intent?&lt;/p&gt;




&lt;p&gt;trunk/metastore/if/hive_metastore.thrift&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/#comment1429&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#comment1429&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Identifying the message type using an integer seems brittle. This won&apos;t work if you have more than one application that is firing events at the metastore. &lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/#comment1430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#comment1430&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    So the event model is that each event may be handled by at most one event handler?&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/#comment1431&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#comment1431&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please add some DEBUG or TRACE level logging here that indicates which handler consumed a particular event, or if an event was unserviceable.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/#comment1432&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#comment1432&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Semantically this function looks more like &quot;sendRequest&quot; than &quot;receiveMessage&quot; (and &quot;sendMessage&quot; looks more like &quot;fireEvent&quot;). &lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/#comment1433&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#comment1433&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Checkstyle: you need a space between control flow tokens and open parens.&lt;/p&gt;




&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/#comment1434&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#comment1434&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Nice to have: javadoc.&lt;/p&gt;



&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/#comment1435&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#comment1435&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    canProcessSendMessage() looks like a redundant call. Is there any reason that this can&apos;t be be rolled into processSendMessage()?&lt;/p&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-05-12 21:03:29, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/738/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-12 21:03:29)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated patch to include missing ASF license and generated thrift code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2147&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/if/hive_metastore.thrift 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore.h 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore.cpp 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore_server.skeleton.cpp 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/metastore/api/ThriftHiveMetastore.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-php/hive_metastore/ThriftHiveMetastore.php 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-py/hive_metastore/ThriftHiveMetastore-remote 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-py/hive_metastore/ThriftHiveMetastore.py 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-rb/thrift_hive_metastore.rb 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/MessageEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/738/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated TestMetaStoreEventListener to test new api.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13039249" author="jiraposter@reviews.apache.org" created="Wed, 25 May 2011 18:02:47 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/if/hive_metastore.thrift, line 347&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18685#file18685line347&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18685#file18685line347&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Having separate calls for sending request and response messages looks unnecessary. A sendMessage() function with separate request and response message types should work just as well, and will help to avoid confusion &amp;#8211; otherwise I think people will assume that receiveMessage is a polling call.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is starting to look like a general purpose messaging/rpc framework. Is that the intent?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;&amp;gt; A sendMessage() function with separate request and response message types should work just as well.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That is correct. But semantically they are different. In sendMessage() user is just notifying Metastore of an event and is not bothered of return value. recvMessage() user is asking for a response for his message. This distinction is further enforced by return types. We could just have one api sendMessage() for both as you suggested, but having distinct apis for sending and receiving makes it easier for client to understand the semantics.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&amp;gt; This is starting to look like a general purpose messaging/rpc framework. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Well general purpose rpc framework would be much more sophisticated. I am not aiming for that. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/if/hive_metastore.thrift, line 348&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18685#file18685line348&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18685#file18685line348&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Identifying the message type using an integer seems brittle. This won&apos;t work if you have more than one application that is firing events at the metastore.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There are two other alternatives that I thought of before settling on this one.&lt;br/&gt;
1) Add specific apis for different message types. This would have made doing this generic api redundant but then this will result in application specific apis in the metastore. E.g., in HCatalog we want to send a message for &quot;set of partitions&quot; telling Metastore to mark them as done. What does finalizePartition() mean in metastore api when Metastore itself is not aware of this concept as this is application specific. This would be confusing.&lt;br/&gt;
2) Use enums instead of integer. This will result in similar problem as above though on a lower scale. Enums give compile time safety so we have to define them in Metastore code. Defining application specific enums doesnt look like a good idea because of similar reasons. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3126&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3126&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     So the event model is that each event may be handled by at most one event handler?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3134&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3134&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3134&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Please add some DEBUG or TRACE level logging here that indicates which handler consumed a particular event, or if an event was unserviceable.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will add logging.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3149&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3149&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3149&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Semantically this function looks more like &quot;sendRequest&quot; than &quot;receiveMessage&quot; (and &quot;sendMessage&quot; looks more like &quot;fireEvent&quot;).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Same as my very first comment.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3151&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3151&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3151&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Checkstyle: you need a space between control flow tokens and open parens.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;will roll this in.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java, line 640&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18696#file18696line640&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18696#file18696line640&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Nice to have: javadoc.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will add.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java, line 86&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18697#file18697line86&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18697#file18697line86&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     canProcessSendMessage() looks like a redundant call. Is there any reason that this can&apos;t be be rolled into processSendMessage()?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Event model is every event is handled by atmost one handler. If we roll this in processSendMsg() then we have to make this method return boolean which will tell whether this event got serviced by this handler or not. Then how will it communicate back the actual return value. In case of sendMsg() this is fine, but recvMsg() returns a valid value which is then need to be returned to a client. So, we first ask handler if it can handle the message and then expect a valid return value in processRecvMsg() call.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ashutosh&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/738/#review713&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#review713&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-05-12 21:03:29, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/738/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-12 21:03:29)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated patch to include missing ASF license and generated thrift code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2147&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/if/hive_metastore.thrift 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore.h 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore.cpp 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore_server.skeleton.cpp 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/metastore/api/ThriftHiveMetastore.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-php/hive_metastore/ThriftHiveMetastore.php 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-py/hive_metastore/ThriftHiveMetastore-remote 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-py/hive_metastore/ThriftHiveMetastore.py 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-rb/thrift_hive_metastore.rb 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/MessageEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/738/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated TestMetaStoreEventListener to test new api.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13040006" author="jiraposter@reviews.apache.org" created="Fri, 27 May 2011 00:21:47 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/if/hive_metastore.thrift, line 348&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18685#file18685line348&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18685#file18685line348&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Identifying the message type using an integer seems brittle. This won&apos;t work if you have more than one application that is firing events at the metastore.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh Chauhan wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There are two other alternatives that I thought of before settling on this one.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1) Add specific apis for different message types. This would have made doing this generic api redundant but then this will result in application specific apis in the metastore. E.g., in HCatalog we want to send a message for &quot;set of partitions&quot; telling Metastore to mark them as done. What does finalizePartition() mean in metastore api when Metastore itself is not aware of this concept as this is application specific. This would be confusing.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2) Use enums instead of integer. This will result in similar problem as above though on a lower scale. Enums give compile time safety so we have to define them in Metastore code. Defining application specific enums doesnt look like a good idea because of similar reasons.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Another approach would be to serialize the events, and then wrap the serialized event object in a Thrift struct that also contains a field with the fully qualified class name of the event. When the server receives the event struct it would pass the class name to each of the listeners, which then have the option of deserializing the event if they are capable of handling it.&lt;/p&gt;

&lt;p&gt;Using qualified event class names would help to eliminate the burden of coordinating the event id namespace, and it would also make it much easier to emit meaningful logging information on the server side.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java, line 3126&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18694#file18694line3126&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     So the event model is that each event may be handled by at most one event handler?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh Chauhan wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why not give each listener the opportunity to handle every event? It seems like a pretty conventional use case that you would want to have more than one listener operate on some events. This also seems like a more conventional policy for a pluggable listener framework.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/if/hive_metastore.thrift, line 347&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18685#file18685line347&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18685#file18685line347&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Having separate calls for sending request and response messages looks unnecessary. A sendMessage() function with separate request and response message types should work just as well, and will help to avoid confusion &amp;#8211; otherwise I think people will assume that receiveMessage is a polling call.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is starting to look like a general purpose messaging/rpc framework. Is that the intent?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh Chauhan wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&amp;gt; A sendMessage() function with separate request and response message types should work just as well.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;That is correct. But semantically they are different. In sendMessage() user is just notifying Metastore of an event and is not bothered of return value. recvMessage() user is asking for a response for his message. This distinction is further enforced by return types. We could just have one api sendMessage() for both as you suggested, but having distinct apis for sending and receiving makes it easier for client to understand the semantics.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&amp;gt; This is starting to look like a general purpose messaging/rpc framework. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Well general purpose rpc framework would be much more sophisticated. I am not aiming for that.&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;&amp;gt; Well general purpose rpc framework would be much more sophisticated. I am not aiming for that. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, I shouldn&apos;t have said &quot;general purpose&quot;, but it does sound like adding an extensible RPC mechanism is one of the goals of this patch. This seems like a significant departure from the goal of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2038&quot; title=&quot;Metastore listener&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2038&quot;&gt;&lt;del&gt;HIVE-2038&lt;/del&gt;&lt;/a&gt;, which I think was more narrowly focused on adding an event framework, or at least that&apos;s what I remember discussing at the contrib meeting. RPCs are quite different from events, and if if we add this feature it shouldn&apos;t be conflated with events. I think the RPC modifications should be proposed in a separate ticket, and we should keep the focus in this ticket on adding an event framework.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-25 03:43:30, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java, line 86&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/738/diff/1/?file=18697#file18697line86&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff/1/?file=18697#file18697line86&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     canProcessSendMessage() looks like a redundant call. Is there any reason that this can&apos;t be be rolled into processSendMessage()?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh Chauhan wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Event model is every event is handled by atmost one handler. If we roll this in processSendMsg() then we have to make this method return boolean which will tell whether this event got serviced by this handler or not. Then how will it communicate back the actual return value. In case of sendMsg() this is fine, but recvMsg() returns a valid value which is then need to be returned to a client. So, we first ask handler if it can handle the message and then expect a valid return value in processRecvMsg() call.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I wasn&apos;t sure before if these changes were supposed to enable RPCs. Now that that&apos;s clear, I don&apos;t think this code belongs in MetaStoreEventListener. It belongs in MetaStoreGenericRPCHandler, or something like that. Can you please remove the RPC code, and change the names of the event code (e.g. one way communication from client to server) to make it clear that these are events, and not something more generic like RPCs?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/738/#review713&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/#review713&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-05-12 21:03:29, Ashutosh Chauhan wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/738/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-12 21:03:29)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated patch to include missing ASF license and generated thrift code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; title=&quot;Add api to send / receive message to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2147&quot;&gt;&lt;del&gt;HIVE-2147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2147&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/if/hive_metastore.thrift 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore.h 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore.cpp 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-cpp/ThriftHiveMetastore_server.skeleton.cpp 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/metastore/api/ThriftHiveMetastore.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-php/hive_metastore/ThriftHiveMetastore.php 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-py/hive_metastore/ThriftHiveMetastore-remote 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-py/hive_metastore/ThriftHiveMetastore.py 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/gen/thrift/gen-rb/thrift_hive_metastore.rb 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreEventListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/java/org/apache/hadoop/hive/metastore/events/MessageEvent.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/DummyListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestMetaStoreEventListener.java 1102450 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/738/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/738/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated TestMetaStoreEventListener to test new api.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ashutosh&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13040414" author="ashutoshc" created="Fri, 27 May 2011 20:19:18 +0000"  >&lt;p&gt;Carl,&lt;/p&gt;

&lt;p&gt;Whats the difference between &apos;event framework&apos; and &apos;rpc framework&apos;? From your comments, it seems, you are defining them as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Event Framework = sendMsg()
RPC Framework   = sendMsg() + recvMsg()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If this is correct, then are you suggesting to remove recvMsg() api from this patch and propose it in another jira ?&lt;/p&gt;</comment>
                            <comment id="13041008" author="cwsteinbach" created="Mon, 30 May 2011 05:52:40 +0000"  >&lt;p&gt;Yes, that&apos;s pretty much my definition of events vs. RPCs. How do you define it?&lt;/p&gt;

&lt;p&gt;One advantage of this definition is that it&apos;s explicit that event generators don&apos;t have to block waiting for a response from a listener. Another advantage is that it&apos;s compatible with the model where multiple listeners can handle each event since there&apos;s no need to bundle a response from each of them (which also helps to cut down on latency).&lt;/p&gt;</comment>
                            <comment id="13046219" author="ashutoshc" created="Wed, 8 Jun 2011 21:05:52 +0000"  >&lt;p&gt;Patch which adds specific apis instead of generic ones.&lt;/p&gt;</comment>
                            <comment id="13046731" author="jvs" created="Thu, 9 Jun 2011 18:37:04 +0000"  >&lt;p&gt;I think we should close out this JIRA and create a new one specific to the latest approach.&lt;/p&gt;

&lt;p&gt;Regarding the JDO change, instead of calling the table DONE_PARTITION_SET, I&apos;d recommend naming it PARTITION_EVENTS, and add an EVENT_TYPE field containing values such as &apos;LOAD_DONE&apos;.  This would allow for later adding new events such as &apos;LOAD_BEGIN&apos;.  Then parameterize the API&apos;s accordingly.  Also, use EVENT_TIME instead of CREATE_TIME.&lt;/p&gt;

&lt;p&gt;It seems like we&apos;re going to end up with sequential scans against this table?  Or is it going to be possible to index the searches on PARTITION_VALS?&lt;/p&gt;</comment>
                            <comment id="13047468" author="pauly" created="Fri, 10 Jun 2011 21:26:39 +0000"  >&lt;p&gt;I agree with John&apos;s suggestion for PARTITION_EVENTS. For this event table, when will rows be dropped? Also, for when partitions are represented using a string, we&apos;ve followed the convention that they are called partition names. Can we use that for MPartitionSet?&lt;/p&gt;

&lt;p&gt;Since MPartitionSet.partVals is a string, we should make it indexed, much like partitionName for the PARTITION table.&lt;/p&gt;</comment>
                            <comment id="13047469" author="ashutoshc" created="Fri, 10 Jun 2011 21:26:59 +0000"  >&lt;p&gt;As suggested, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt; has been opened for this.&lt;/p&gt;</comment>
                            <comment id="13047509" author="ashutoshc" created="Fri, 10 Jun 2011 22:22:33 +0000"  >&lt;p&gt;Paul,&lt;/p&gt;

&lt;p&gt;I replied on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2215&quot; title=&quot;Add api for marking / querying set of partitions for events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2215&quot;&gt;&lt;del&gt;HIVE-2215&lt;/del&gt;&lt;/a&gt;. Lets continue the discussion there since this I marked as closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12500931">HIVE-2038</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12478073" name="api-without-thrift.patch" size="7543" author="ashutoshc" created="Tue, 3 May 2011 17:46:26 +0000"/>
                            <attachment id="12481866" name="hive_2147-2.patch" size="15713" author="ashutoshc" created="Wed, 8 Jun 2011 21:05:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 May 2011 23:40:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63970</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 33 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0limn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123668</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2148] Add interface classification in Hive.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2148</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Add mechanism for marking stability and intended audiences in Hive.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506105">HIVE-2148</key>
            <summary>Add interface classification in Hive.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2011 21:56:59 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:25 +0000</updated>
                            <resolved>Wed, 11 May 2011 06:38:38 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13028460" author="ashutoshc" created="Tue, 3 May 2011 21:57:54 +0000"  >&lt;p&gt;&lt;br/&gt;
I want to reuse few classes and methods that are currently private in Hive. Few Apache projects (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-5073&quot; title=&quot;Hadoop 1.0 Interface Classification - scope (visibility - public/private) and stability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-5073&quot;&gt;&lt;del&gt;HADOOP-5073&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1311&quot; title=&quot;Pig interfaces should be clearly classified in terms of scope and stability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1311&quot;&gt;&lt;del&gt;PIG-1311&lt;/del&gt;&lt;/a&gt;) have handled this problem of opening up few interfaces for particular projects through annotations. Same solution could be reused for Hive to open up few classes for HCatalog. Patch for adding these annotations and couple of illustrations on how to use them.&lt;/p&gt;</comment>
                            <comment id="13031402" author="cwsteinbach" created="Tue, 10 May 2011 21:51:50 +0000"  >&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="13031403" author="ashutoshc" created="Tue, 10 May 2011 21:55:14 +0000"  >&lt;p&gt;Thanks, Carl for the review. I will upload the final patch soon.&lt;/p&gt;</comment>
                            <comment id="13031475" author="cwsteinbach" created="Tue, 10 May 2011 23:39:07 +0000"  >&lt;p&gt;Committed to trunk. Thanks Ashutosh!&lt;/p&gt;</comment>
                            <comment id="13031549" author="ashutoshc" created="Wed, 11 May 2011 05:38:41 +0000"  >&lt;p&gt;Sorry Carl, the patch was incomplete. There is one more method run() of Command whose visibility I wanted to change. Incremental patch attached.&lt;/p&gt;</comment>
                            <comment id="13031565" author="cwsteinbach" created="Wed, 11 May 2011 06:38:22 +0000"  >&lt;p&gt;@Ashutosh: Sorry I missed your last comment before committing. Can you please open a separate ticket and post the followup there so I have a unique JIRA ID to commit against? Thanks.&lt;/p&gt;</comment>
                            <comment id="13032613" author="hudson" created="Thu, 12 May 2011 19:40:22 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.20 #726 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hive-trunk-h0.20/726/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/Hive-trunk-h0.20/726/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12507040">HIVE-2161</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12478098" name="classification.patch" size="7098" author="ashutoshc" created="Tue, 3 May 2011 21:57:54 +0000"/>
                            <attachment id="12478765" name="hive_2148.patch" size="20150" author="ashutoshc" created="Wed, 11 May 2011 05:38:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 May 2011 21:51:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63967</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 37 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0limv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
