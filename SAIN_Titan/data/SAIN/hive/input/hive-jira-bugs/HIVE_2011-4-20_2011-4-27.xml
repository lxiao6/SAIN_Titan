<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Tue Jan 22 15:18:02 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+HIVE+AND+created+%3E%3D+2011-4-20+AND+created+%3C%3D+2011-4-27+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="14" total="14"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[HIVE-2121] Input Sampling By Splits</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2121</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;br/&gt;
1. test their queries against a smaller data set&lt;br/&gt;
2. understand more about how the data look like without scanning the whole table.&lt;br/&gt;
A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504737">HIVE-2121</key>
            <summary>Input Sampling By Splits</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sdong">Siying Dong</assignee>
                                    <reporter username="sdong">Siying Dong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Apr 2011 00:26:52 +0000</created>
                <updated>Fri, 15 Jun 2012 19:17:40 +0000</updated>
                            <resolved>Fri, 29 Apr 2011 22:51:51 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13021878" author="sdong" created="Wed, 20 Apr 2011 00:44:35 +0000"  >&lt;p&gt;still need to modify some test results.&lt;/p&gt;</comment>
                            <comment id="13022262" author="nzhang" created="Wed, 20 Apr 2011 18:00:06 +0000"  >&lt;p&gt;Siying, can you create a review request on the review board?&lt;/p&gt;</comment>
                            <comment id="13022271" author="sdong" created="Wed, 20 Apr 2011 18:23:28 +0000"  >&lt;p&gt;changed test outputs. test outputs of sample tests changed as I chanced token name for sampling using buckets from TOK_TABLESAMPLE to TOK_TABLEBUCKETSAMPLE (as I am adding a TOK_TABLESPLITSAMPLE). Other than that, there should be no change.&lt;/p&gt;

&lt;p&gt;This patch has a limit: even if we only sample one split out, execution is not switched to local mode if possible, as getSplits() is called in job submit part, which already passed the step to choose local mode.&lt;/p&gt;</comment>
                            <comment id="13022277" author="jiraposter@reviews.apache.org" created="Wed, 20 Apr 2011 18:29:06 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;br/&gt;
1. test their queries against a smaller data set&lt;br/&gt;
2. understand more about how the data look like without scanning the whole table.&lt;br/&gt;
A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;

&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1095244 &lt;br/&gt;
  trunk/conf/hive-default.xml 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1095244 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1095244 &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/split_sample_disabled.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/split_sample_disabled.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket1.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket2.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket3.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample1.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample10.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample2.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample3.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample4.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample5.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample6.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample7.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample8.q.out 1095244 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample9.q.out 1095244 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Siying&lt;/p&gt;
</comment>
                            <comment id="13022285" author="nzhang" created="Wed, 20 Apr 2011 18:46:46 +0000"  >&lt;p&gt;I will take a look.&lt;/p&gt;</comment>
                            <comment id="13025107" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 07:24:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/#review558&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#review558&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1178&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1178&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The naming of this parameter is a little bit confusing: the parameter key is called &quot;randomnumber&quot; but the value of it is a fixed number.  Do you mean this number is actually the seed to generate samples?&lt;/p&gt;



&lt;p&gt;trunk/conf/hive-default.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1179&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1179&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    same as above.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1195&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1195&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    better add a comment for this function explain what the rationale behind sampling splits.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1192&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1192&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    we should declare retLists as interface (List) rather than implementation (ArrayList)&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1193&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1193&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    same here, should declare it as Map rather than HashMap.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1194&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1194&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    can you add comments here? &lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1182&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1182&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    can you add a comment on what this Map is used for and what are the key and value of the Map?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1184&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1184&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think we don&apos;t need to introduce this parameter at all. For one it is a new feature rather than a different code path for an old feature. We don&apos;t need the &quot;fallback&quot; protection by a new parameter. Secondly, throwing a SemanticException here can only make the user asking how to solve this problem, which is to set the parameter to true. So it seems that it doesn&apos;t make sense to set the parameter to false in any cases. So why not remove the this parameter to make it cleaner. &lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1189&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    you may want to check the percentage number (if it is a valid double and within the range &lt;span class=&quot;error&quot;&gt;&amp;#91;0,100&amp;#93;&lt;/span&gt;) and throw SemanticException if it is invalid before creating a SplitSample object.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1190&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1190&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    why limit cannot be combined with block sampling?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1191&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1191&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This comment doesn&apos;t belong to this class.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-20 18:28:29, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-20 18:28:29)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. test their queries against a smaller data set&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. understand more about how the data look like without scanning the whole table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_disabled.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_disabled.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket1.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket2.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket3.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample1.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample10.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample2.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample3.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample4.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample5.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample6.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample7.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample8.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample9.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025426" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 20:52:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/#review561&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#review561&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1196&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1196&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I feel like it is a little hard to explain what this sample guarantees. It basically only guarantees that we fetch at least the sampled percentage of source data. Not exact number, nor guarantee for #rows. I think an option to disable it is a way to avoid confusion in some ways. How do you think?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1197&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1197&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    limit can be combined with block sampling. Just this optimization for limit doesn&apos;t make sense when users already sample the input data and we won&apos;t get much benefit.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Siying&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-20 18:28:29, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-20 18:28:29)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. test their queries against a smaller data set&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. understand more about how the data look like without scanning the whole table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_disabled.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_disabled.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket1.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket2.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket3.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample1.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample10.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample2.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample3.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample4.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample5.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample6.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample7.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample8.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample9.q.out 1095244 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025436" author="sdong" created="Tue, 26 Apr 2011 21:16:12 +0000"  >&lt;p&gt;addressing most of Ning&apos;s comments, except the two places I commented on review board.&lt;/p&gt;</comment>
                            <comment id="13025438" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 21:20:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-04-26 21:19:18.557345)&lt;/p&gt;


&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Addressing most of Ning&apos;s comments.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;br/&gt;
1. test their queries against a smaller data set&lt;br/&gt;
2. understand more about how the data look like without scanning the whole table.&lt;br/&gt;
A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;

&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096852 &lt;br/&gt;
  trunk/conf/hive-default.xml 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1096852 &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/split_sample_disabled.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/split_sample_out_of_range.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/split_sample_disabled.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/split_sample_out_of_range.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket1.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket2.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket3.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample1.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample10.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample2.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample3.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample4.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample5.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample6.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample7.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample8.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample9.q.out 1096852 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Siying&lt;/p&gt;
</comment>
                            <comment id="13025465" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 22:00:03 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-04-26 20:50:30, Siying Dong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java, line 498&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line498&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I feel like it is a little hard to explain what this sample guarantees. It basically only guarantees that we fetch at least the sampled percentage of source data. Not exact number, nor guarantee for #rows. I think an option to disable it is a way to avoid confusion in some ways. How do you think?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think if we specify clearly the semantics of block-level sample in the wiki/documentation, there shouldn&apos;t be much confusion. In fact I think it is much easier to explain than the bucket-based sampling. In addition if the user has confusions about the semantics, throwing an SemanticException won&apos;t help them understand.  I think the only use case for this parameter is to act as a gatekeeper to this feature if we found a bug in it and want to disable the feature quickly. That should be able to be achieved by switching branches quickly. If we have a gatekeeper parameter for each feature, the conf will grow unnecessarily large quickly. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-04-26 20:50:30, Siying Dong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java, line 6392&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line6392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line6392&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     limit can be combined with block sampling. Just this optimization for limit doesn&apos;t make sense when users already sample the input data and we won&apos;t get much benefit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think combining these two still makes sense: 1) as you mentioned block sampling is not limiting on the # of rows, but limit is. Combining these two allows the users to get approximately N rows quickly. 2) this restriction makes an exception in terms of the query language composition. From the language syntax, it is allowed and makes senses to combine block-sampling and limit, but the user will get a SemanticException if they do. I think SemanticException should be thrown only when there is a legitimate semantic error (e.g., the percentage number is negative). If you feel that it is not a major use case and would rather do it in a follow-up JIRA, we should document it in TODO and file a JIRA for it. &lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/#review561&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#review561&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-04-26 21:19:18, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-26 21:19:18)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. test their queries against a smaller data set&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. understand more about how the data look like without scanning the whole table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_disabled.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_out_of_range.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_disabled.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_out_of_range.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample10.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample4.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample5.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample6.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample7.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample8.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample9.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025468" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 22:10:03 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-04-26 20:50:30, Siying Dong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java, line 498&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line498&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I feel like it is a little hard to explain what this sample guarantees. It basically only guarantees that we fetch at least the sampled percentage of source data. Not exact number, nor guarantee for #rows. I think an option to disable it is a way to avoid confusion in some ways. How do you think?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ning Zhang wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I think if we specify clearly the semantics of block-level sample in the wiki/documentation, there shouldn&apos;t be much confusion. In fact I think it is much easier to explain than the bucket-based sampling. In addition if the user has confusions about the semantics, throwing an SemanticException won&apos;t help them understand.  I think the only use case for this parameter is to act as a gatekeeper to this feature if we found a bug in it and want to disable the feature quickly. That should be able to be achieved by switching branches quickly. If we have a gatekeeper parameter for each feature, the conf will grow unnecessarily large quickly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK. I&apos;ll remove this switch. We need to document and communicate very well to users. People will easily misunderstand this.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-04-26 20:50:30, Siying Dong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java, line 6392&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line6392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line6392&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     limit can be combined with block sampling. Just this optimization for limit doesn&apos;t make sense when users already sample the input data and we won&apos;t get much benefit.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ning Zhang wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I think combining these two still makes sense: 1) as you mentioned block sampling is not limiting on the # of rows, but limit is. Combining these two allows the users to get approximately N rows quickly. 2) this restriction makes an exception in terms of the query language composition. From the language syntax, it is allowed and makes senses to combine block-sampling and limit, but the user will get a SemanticException if they do. I think SemanticException should be thrown only when there is a legitimate semantic error (e.g., the percentage number is negative). If you feel that it is not a major use case and would rather do it in a follow-up JIRA, we should document it in TODO and file a JIRA for it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it is the misunderstanding here. Limit works with split sampling well. No exception will be thrown in any of those two combination and the result will be what we expected.&lt;br/&gt;
This condition only disabled the optimization that runs against a smaller data set for some limit queries. With split sampling, user already specific what a percentage to sample, there is no need to further run the query against a small subset of the inputs. From test case split_sample.q, you can already see how they work together well.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Siying&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/#review561&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#review561&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-04-26 21:19:18, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-26 21:19:18)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. test their queries against a smaller data set&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. understand more about how the data look like without scanning the whole table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_disabled.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_out_of_range.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_disabled.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_out_of_range.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample10.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample4.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample5.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample6.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample7.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample8.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample9.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025476" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 22:16:03 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-04-26 20:50:30, Siying Dong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java, line 498&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line498&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I feel like it is a little hard to explain what this sample guarantees. It basically only guarantees that we fetch at least the sampled percentage of source data. Not exact number, nor guarantee for #rows. I think an option to disable it is a way to avoid confusion in some ways. How do you think?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ning Zhang wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I think if we specify clearly the semantics of block-level sample in the wiki/documentation, there shouldn&apos;t be much confusion. In fact I think it is much easier to explain than the bucket-based sampling. In addition if the user has confusions about the semantics, throwing an SemanticException won&apos;t help them understand.  I think the only use case for this parameter is to act as a gatekeeper to this feature if we found a bug in it and want to disable the feature quickly. That should be able to be achieved by switching branches quickly. If we have a gatekeeper parameter for each feature, the conf will grow unnecessarily large quickly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying Dong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;OK. I&apos;ll remove this switch. We need to document and communicate very well to users. People will easily misunderstand this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds good. Yes, we should clearly document it in the wiki by what it does and does not. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-04-26 20:50:30, Siying Dong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java, line 6392&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line6392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff/1/?file=16093#file16093line6392&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     limit can be combined with block sampling. Just this optimization for limit doesn&apos;t make sense when users already sample the input data and we won&apos;t get much benefit.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ning Zhang wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I think combining these two still makes sense: 1) as you mentioned block sampling is not limiting on the # of rows, but limit is. Combining these two allows the users to get approximately N rows quickly. 2) this restriction makes an exception in terms of the query language composition. From the language syntax, it is allowed and makes senses to combine block-sampling and limit, but the user will get a SemanticException if they do. I think SemanticException should be thrown only when there is a legitimate semantic error (e.g., the percentage number is negative). If you feel that it is not a major use case and would rather do it in a follow-up JIRA, we should document it in TODO and file a JIRA for it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying Dong wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I think it is the misunderstanding here. Limit works with split sampling well. No exception will be thrown in any of those two combination and the result will be what we expected.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This condition only disabled the optimization that runs against a smaller data set for some limit queries. With split sampling, user already specific what a percentage to sample, there is no need to further run the query against a small subset of the inputs. From test case split_sample.q, you can already see how they work together well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;oh I see. Thanks for the clarification!&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/#review561&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#review561&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-04-26 21:19:18, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-26 21:19:18)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. test their queries against a smaller data set&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. understand more about how the data look like without scanning the whole table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_disabled.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_out_of_range.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_disabled.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_out_of_range.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample10.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample4.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample5.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample6.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample7.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample8.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample9.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025498" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 22:52:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/#review567&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#review567&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1205&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1205&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This function could be quite expensive inside the loops. You may want to test a case where there are large # of partitions and each partition contains a large # of small files. &lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-26 21:19:18, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-26 21:19:18)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. test their queries against a smaller data set&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. understand more about how the data look like without scanning the whole table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_disabled.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_out_of_range.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_disabled.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_out_of_range.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample10.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample4.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample5.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample6.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample7.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample8.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample9.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025508" author="sdong" created="Tue, 26 Apr 2011 23:18:55 +0000"  >&lt;p&gt;remove the switch&lt;/p&gt;</comment>
                            <comment id="13025519" author="sdong" created="Tue, 26 Apr 2011 23:47:32 +0000"  >&lt;p&gt;remove the switch. &lt;br/&gt;
I ran it against about 800 partitions input and didn&apos;t see obvious client time increase.&lt;/p&gt;</comment>
                            <comment id="13025611" author="namit" created="Wed, 27 Apr 2011 05:19:55 +0000"  >&lt;p&gt;Add the new configuration variables in the name of the jira&lt;/p&gt;</comment>
                            <comment id="13025614" author="namit" created="Wed, 27 Apr 2011 05:29:29 +0000"  >&lt;p&gt;A few other comments:&lt;/p&gt;

&lt;p&gt;1. The behavior should be reflected in explain plan extended.&lt;br/&gt;
   Yongqiang recently added a similar plan change in pathtoAlias etc.&lt;br/&gt;
   in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2126&quot; title=&quot;Hive&amp;#39;s symlink text input format should be able to work with ComineHiveInputFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2126&quot;&gt;&lt;del&gt;HIVE-2126&lt;/del&gt;&lt;/a&gt;. Take a look as an example.&lt;br/&gt;
2. It would increase the utility if I can add a new session variable&lt;br/&gt;
   where I specify the split percentage - this will be applicable to &lt;br/&gt;
   all tables (this can also be done in a follow-up)&lt;/p&gt;</comment>
                            <comment id="13025919" author="namit" created="Wed, 27 Apr 2011 17:51:49 +0000"  >&lt;p&gt;A few other comments:&lt;/p&gt;

&lt;p&gt;   The percentage of data read is currently a function &lt;br/&gt;
   of the split size - we should mark the last split &lt;br/&gt;
   specially, and only read the required data at runtime.&lt;br/&gt;
   I mean, if we have only 1 split, and we need to sample&lt;br/&gt;
   10% of the data, there should be a way to do so. Currently,&lt;br/&gt;
   it seems impossible.&lt;/p&gt;</comment>
                            <comment id="13026202" author="sdong" created="Thu, 28 Apr 2011 08:28:55 +0000"  >&lt;p&gt;Two changes made according to Namit&apos;s comments:&lt;br/&gt;
1. explain will print out some about the sampling. (It might not be the best way to print but it follows the framework)&lt;br/&gt;
2. the granularity of sampling is down from split-level to HDFS block level.&lt;/p&gt;</comment>
                            <comment id="13026204" author="jiraposter@reviews.apache.org" created="Thu, 28 Apr 2011 08:32:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-04-28 08:32:17.534107)&lt;/p&gt;


&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Two changes made according to Namit&apos;s comments:&lt;br/&gt;
1. explain will print out some about the sampling. (It might not be the best way to print but it follows the framework)&lt;br/&gt;
2. the granularity of sampling is down from split-level to HDFS block level.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;br/&gt;
1. test their queries against a smaller data set&lt;br/&gt;
2. understand more about how the data look like without scanning the whole table.&lt;br/&gt;
A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;

&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096852 &lt;br/&gt;
  trunk/conf/hive-default.xml 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096852 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1096852 &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/split_sample_out_of_range.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/split_sample_out_of_range.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket1.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket2.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucket3.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample1.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample10.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample2.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample3.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample4.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample5.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample6.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample7.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample8.q.out 1096852 &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/sample9.q.out 1096852 &lt;br/&gt;
  trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java 1096852 &lt;br/&gt;
  trunk/shims/src/0.20S/java/org/apache/hadoop/hive/shims/Hadoop20SShims.java 1096852 &lt;br/&gt;
  trunk/shims/src/common/java/org/apache/hadoop/hive/shims/HadoopShims.java 1096852 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Siying&lt;/p&gt;
</comment>
                            <comment id="13026654" author="sdong" created="Thu, 28 Apr 2011 19:41:11 +0000"  >&lt;p&gt;forgot a file.&lt;/p&gt;</comment>
                            <comment id="13026719" author="namit" created="Thu, 28 Apr 2011 21:57:22 +0000"  >&lt;p&gt;minor comments in review-board.&lt;/p&gt;
</comment>
                            <comment id="13026721" author="jiraposter@reviews.apache.org" created="Thu, 28 Apr 2011 21:58:04 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/633/#review605&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#review605&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/633/#comment1249&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/#comment1249&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    talked to siying offline -&lt;/p&gt;

&lt;p&gt;    the check:&lt;/p&gt;

&lt;p&gt;    if (split instanceof Hadoop20Shims.InputSplitShim)&lt;/p&gt;


&lt;p&gt;    is not needed - this can be replaced by an assert.&lt;/p&gt;

&lt;p&gt;    Same in Hadoop20SShims.&lt;/p&gt;


&lt;p&gt;    Otherwise looks good&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;namit&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-28 08:32:17, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-28 08:32:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Ning Zhang and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We need a better input sampling to serve at least two purposes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. test their queries against a smaller data set&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. understand more about how the data look like without scanning the whole table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A simple function that gives a subset splits will help in those cases. It doesn&apos;t have to be strict sampling.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This diff allows a syntax of .. table TABLESAMPLE(n PERCENT), which samples input splits with size at least n% of the original inputs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; title=&quot;Input Sampling By Splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2121&quot;&gt;&lt;del&gt;HIVE-2121&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2121&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/CombineHiveInputFormat.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SplitSample.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_out_of_range.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/split_sample_wrong_format.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/split_sample.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_out_of_range.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/split_sample_wrong_format.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucket3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/bucketmapjoin1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample1.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample10.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample2.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample3.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample4.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample5.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample6.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample7.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample8.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/sample9.q.out 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/shims/src/0.20S/java/org/apache/hadoop/hive/shims/Hadoop20SShims.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/shims/src/common/java/org/apache/hadoop/hive/shims/HadoopShims.java 1096852 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TestCliDriver TestNegativeCliDriver, manual tests on real clusters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13026734" author="sdong" created="Thu, 28 Apr 2011 22:17:05 +0000"  >&lt;p&gt;move instanceof InputSplitShim to assert.&lt;/p&gt;</comment>
                            <comment id="13026779" author="namit" created="Thu, 28 Apr 2011 23:46:00 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13026846" author="namit" created="Fri, 29 Apr 2011 05:11:41 +0000"  >&lt;p&gt;Some tests are failing:&lt;/p&gt;

&lt;p&gt;split_sample.q&lt;/p&gt;


&lt;p&gt;Some tests in TestMinimrCliDriver (log updates)&lt;/p&gt;

&lt;p&gt;almost all test in TestParse (log updates)&lt;/p&gt;


</comment>
                            <comment id="13026921" author="sdong" created="Fri, 29 Apr 2011 09:42:52 +0000"  >&lt;p&gt;fix tests or test outputs.&lt;/p&gt;</comment>
                            <comment id="13027125" author="namit" created="Fri, 29 Apr 2011 18:36:18 +0000"  >&lt;p&gt;running tests&lt;/p&gt;</comment>
                            <comment id="13027227" author="namit" created="Fri, 29 Apr 2011 22:51:51 +0000"  >&lt;p&gt;Committed. Thanks Siying&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12476808" name="HIVE-2121.1.patch" size="37854" author="sdong" created="Wed, 20 Apr 2011 00:34:13 +0000"/>
                            <attachment id="12476925" name="HIVE-2121.2.patch" size="212692" author="sdong" created="Wed, 20 Apr 2011 18:19:37 +0000"/>
                            <attachment id="12477439" name="HIVE-2121.3.patch" size="215441" author="sdong" created="Tue, 26 Apr 2011 21:16:12 +0000"/>
                            <attachment id="12477460" name="HIVE-2121.4.patch" size="213850" author="sdong" created="Tue, 26 Apr 2011 23:47:32 +0000"/>
                            <attachment id="12477629" name="HIVE-2121.5.patch" size="223095" author="sdong" created="Thu, 28 Apr 2011 08:28:55 +0000"/>
                            <attachment id="12477684" name="HIVE-2121.6.patch" size="272471" author="sdong" created="Thu, 28 Apr 2011 19:41:11 +0000"/>
                            <attachment id="12477704" name="HIVE-2121.7.patch" size="272485" author="sdong" created="Thu, 28 Apr 2011 22:17:05 +0000"/>
                            <attachment id="12477742" name="HIVE-2121.8.patch" size="772556" author="sdong" created="Fri, 29 Apr 2011 09:42:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Apr 2011 18:00:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66834</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0liiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123651</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This patch adds support for the &amp;#39;TABLESAMPLE(x PERCENT)&amp;#39; clause.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2122] Remove usage of deprecated methods from org.apache.hadoop.io package</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2122</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Serde code uses some deprecated methods from org.apache.hadoop.io. package. We should remove them.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504877">HIVE-2122</key>
            <summary>Remove usage of deprecated methods from org.apache.hadoop.io package</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amareshwari">Amareshwari Sriramadasu</assignee>
                                    <reporter username="amareshwari">Amareshwari Sriramadasu</reporter>
                        <labels>
                            <label>cleanup</label>
                    </labels>
                <created>Thu, 21 Apr 2011 10:36:22 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:09 +0000</updated>
                            <resolved>Tue, 2 Aug 2011 04:26:16 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13063730" author="amareshwari" created="Tue, 12 Jul 2011 05:41:24 +0000"  >&lt;p&gt;Patch with required changes&lt;/p&gt;</comment>
                            <comment id="13073496" author="jiraposter@reviews.apache.org" created="Mon, 1 Aug 2011 11:13:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1234/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1234/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Remove usage of deprecated methods from org.apache.hadoop.io package&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2122&quot; title=&quot;Remove usage of deprecated methods from org.apache.hadoop.io package&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2122&quot;&gt;&lt;del&gt;HIVE-2122&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2122&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2122&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/contrib/src/java/org/apache/hadoop/hive/contrib/fileformat/base64/Base64TextOutputFormat.java 1145030 &lt;br/&gt;
  trunk/contrib/src/java/org/apache/hadoop/hive/contrib/serde2/TypedBytesSerDe.java 1145030 &lt;br/&gt;
  trunk/contrib/src/java/org/apache/hadoop/hive/contrib/serde2/s3/S3LogDeserializer.java 1145030 &lt;br/&gt;
  trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesRecordWriter.java 1145030 &lt;br/&gt;
  trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesWritable.java 1145030 &lt;br/&gt;
  trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesWritableOutput.java 1145030 &lt;br/&gt;
  trunk/serde/src/java/org/apache/hadoop/hive/serde2/ByteStreamTypedSerDe.java 1145030 &lt;br/&gt;
  trunk/serde/src/java/org/apache/hadoop/hive/serde2/MetadataTypedColumnsetSerDe.java 1145030 &lt;br/&gt;
  trunk/serde/src/java/org/apache/hadoop/hive/serde2/binarysortable/BinarySortableSerDe.java 1145030 &lt;br/&gt;
  trunk/serde/src/java/org/apache/hadoop/hive/serde2/dynamic_type/DynamicSerDe.java 1145030 &lt;br/&gt;
  trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazy/LazySimpleSerDe.java 1145030 &lt;br/&gt;
  trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazybinary/LazyBinarySerDe.java 1145030 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1234/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1234/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Amareshwari&lt;/p&gt;
</comment>
                            <comment id="13073602" author="jiraposter@reviews.apache.org" created="Mon, 1 Aug 2011 16:40:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1234/#review1249&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1234/#review1249&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-08-01 11:11:36, Amareshwari Sriramadasu wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1234/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1234/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-01 11:11:36)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Remove usage of deprecated methods from org.apache.hadoop.io package&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2122&quot; title=&quot;Remove usage of deprecated methods from org.apache.hadoop.io package&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2122&quot;&gt;&lt;del&gt;HIVE-2122&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2122&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2122&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/contrib/src/java/org/apache/hadoop/hive/contrib/fileformat/base64/Base64TextOutputFormat.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/contrib/src/java/org/apache/hadoop/hive/contrib/serde2/TypedBytesSerDe.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/contrib/src/java/org/apache/hadoop/hive/contrib/serde2/s3/S3LogDeserializer.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesRecordWriter.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesWritable.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesWritableOutput.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/serde/src/java/org/apache/hadoop/hive/serde2/ByteStreamTypedSerDe.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/serde/src/java/org/apache/hadoop/hive/serde2/MetadataTypedColumnsetSerDe.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/serde/src/java/org/apache/hadoop/hive/serde2/binarysortable/BinarySortableSerDe.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/serde/src/java/org/apache/hadoop/hive/serde2/dynamic_type/DynamicSerDe.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazy/LazySimpleSerDe.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazybinary/LazyBinarySerDe.java 1145030 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1234/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1234/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Amareshwari&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13076028" author="cwsteinbach" created="Tue, 2 Aug 2011 04:26:16 +0000"  >&lt;p&gt;Committed to trunk. Thanks Amareshwari!&lt;/p&gt;</comment>
                            <comment id="13076036" author="hudson" created="Tue, 2 Aug 2011 05:09:29 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #865 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/865/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/865/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2122&quot; title=&quot;Remove usage of deprecated methods from org.apache.hadoop.io package&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2122&quot;&gt;&lt;del&gt;HIVE-2122&lt;/del&gt;&lt;/a&gt;. Remove usage of deprecated methods from org.apache.hadoop.io package (Amareshwari Sriramadasu via cws)&lt;/p&gt;

&lt;p&gt;cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152980&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazybinary/LazyBinarySerDe.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/binarysortable/BinarySortableSerDe.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazy/LazySimpleSerDe.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/ByteStreamTypedSerDe.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/dynamic_type/DynamicSerDe.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/contrib/src/java/org/apache/hadoop/hive/contrib/fileformat/base64/Base64TextOutputFormat.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesRecordWriter.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/contrib/src/java/org/apache/hadoop/hive/contrib/serde2/s3/S3LogDeserializer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/MetadataTypedColumnsetSerDe.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesWritableOutput.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/contrib/src/java/org/apache/hadoop/hive/contrib/util/typedbytes/TypedBytesWritable.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/contrib/src/java/org/apache/hadoop/hive/contrib/serde2/TypedBytesSerDe.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12486147" name="patch-2122.txt" size="14335" author="amareshwari" created="Tue, 12 Jul 2011 05:41:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Aug 2011 11:13:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>43518</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lij3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123652</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2123] CommandNeedRetryException needs release locks</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2123</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;now when CommandNeedRetryException is thrown, locks are not released. Not sure whether it will cause problem, since the same locks will be acquired when retrying it. It is anyway something we need to fix. Also we can do some little code cleaning up to make future mistakes less likely.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504934">HIVE-2123</key>
            <summary>CommandNeedRetryException needs release locks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="sdong">Siying Dong</assignee>
                                    <reporter username="sdong">Siying Dong</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Apr 2011 23:36:54 +0000</created>
                <updated>Fri, 19 Aug 2011 20:33:55 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13023044" author="he yongqiang" created="Fri, 22 Apr 2011 00:07:41 +0000"  >&lt;p&gt;i will take a look.&lt;/p&gt;</comment>
                            <comment id="13023045" author="he yongqiang" created="Fri, 22 Apr 2011 00:08:45 +0000"  >&lt;p&gt;can you create a review board for this one?&lt;/p&gt;</comment>
                            <comment id="13023049" author="jiraposter@reviews.apache.org" created="Fri, 22 Apr 2011 00:13:06 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/646/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive, Yongqiang He and namit jain.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;now when CommandNeedRetryException is thrown, locks are not released. Not sure whether it will cause problem, since the same locks will be acquired when retrying it. It is anyway something we need to fix. Also we can do some little code cleaning up to make future mistakes less likely.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; title=&quot;CommandNeedRetryException needs release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2123&quot;&gt;HIVE-2123&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2123&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java 1095838 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/Driver.java 1095838 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/646/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Siying&lt;/p&gt;
</comment>
                            <comment id="13023054" author="he yongqiang" created="Fri, 22 Apr 2011 00:24:57 +0000"  >&lt;p&gt;+1, running tests&lt;/p&gt;</comment>
                            <comment id="13023056" author="jiraposter@reviews.apache.org" created="Fri, 22 Apr 2011 00:31:06 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/646/#review527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/#review527&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/646/#comment1091&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/#comment1091&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    There&apos;s a try/catch block here, so why not do this the Java way and throw an exception instead of returning a status code?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/Driver.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/646/#comment1092&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/#comment1092&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can you replace this with a DriverException class?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/Driver.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/646/#comment1093&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/#comment1093&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    spacing&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-22 00:11:43, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/646/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-22 00:11:43)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Yongqiang He and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;now when CommandNeedRetryException is thrown, locks are not released. Not sure whether it will cause problem, since the same locks will be acquired when retrying it. It is anyway something we need to fix. Also we can do some little code cleaning up to make future mistakes less likely.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; title=&quot;CommandNeedRetryException needs release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2123&quot;&gt;HIVE-2123&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2123&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java 1095838 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/Driver.java 1095838 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/646/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13023057" author="cwsteinbach" created="Fri, 22 Apr 2011 00:31:51 +0000"  >&lt;p&gt;@Yongqiang: Please give Siying a chance to respond to my comments before committing.&lt;/p&gt;</comment>
                            <comment id="13023102" author="jiraposter@reviews.apache.org" created="Fri, 22 Apr 2011 04:01:05 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/646/#review529&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/#review529&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/646/#comment1097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/#comment1097&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I tried to make some minimum change, but it looks much more difficult than I thought. The whole structure is built based on return codes, instead of exceptions. What I can do is that I can make Driver.run() not to throw any exception. In that case, we don&apos;t get two approaches twisted.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Siying&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-22 00:11:43, Siying Dong wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/646/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-22 00:11:43)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive, Yongqiang He and namit jain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;now when CommandNeedRetryException is thrown, locks are not released. Not sure whether it will cause problem, since the same locks will be acquired when retrying it. It is anyway something we need to fix. Also we can do some little code cleaning up to make future mistakes less likely.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; title=&quot;CommandNeedRetryException needs release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2123&quot;&gt;HIVE-2123&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2123&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java 1095838 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/Driver.java 1095838 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/646/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Siying&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13023104" author="sdong" created="Fri, 22 Apr 2011 04:10:55 +0000"  >&lt;p&gt;I changed Driver.execute() not to throw any exception. CommandNeedRetryException is translated to another return status code in this level.&lt;/p&gt;</comment>
                            <comment id="13023106" author="jiraposter@reviews.apache.org" created="Fri, 22 Apr 2011 04:23:05 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/646/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-04-22 04:22:16.136899)&lt;/p&gt;


&lt;p&gt;Review request for hive, Yongqiang He and namit jain.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;execute() not to throw any exception.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;now when CommandNeedRetryException is thrown, locks are not released. Not sure whether it will cause problem, since the same locks will be acquired when retrying it. It is anyway something we need to fix. Also we can do some little code cleaning up to make future mistakes less likely.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; title=&quot;CommandNeedRetryException needs release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2123&quot;&gt;HIVE-2123&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2123&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java 1095838 &lt;br/&gt;
  trunk/hwi/src/java/org/apache/hadoop/hive/hwi/HWISessionItem.java 1095838 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/Driver.java 1095838 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/CommandProcessor.java 1095838 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/646/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/646/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Siying&lt;/p&gt;
</comment>
                            <comment id="13023474" author="sdong" created="Sat, 23 Apr 2011 00:50:14 +0000"  >&lt;p&gt;@Carl?&lt;/p&gt;</comment>
                            <comment id="13023489" author="cwsteinbach" created="Sat, 23 Apr 2011 02:33:53 +0000"  >&lt;p&gt;@Siying: Thanks for making the change.&lt;/p&gt;

&lt;p&gt;+1 on this patch, but I&apos;m -1 on the overall approach of using status return codes instead of exceptions. Hopefully we can replace the status codes with exceptions during some future cleanup effort.&lt;/p&gt;</comment>
                            <comment id="13027229" author="he yongqiang" created="Fri, 29 Apr 2011 23:05:51 +0000"  >&lt;p&gt;looks good to me. will commit after tests pass.&lt;/p&gt;</comment>
                            <comment id="13028008" author="he yongqiang" created="Tue, 3 May 2011 03:35:11 +0000"  >&lt;p&gt;Siying, can you rebase the patch. I got some small conflict when trying to commit.&lt;/p&gt;</comment>
                            <comment id="13028010" author="sdong" created="Tue, 3 May 2011 03:45:11 +0000"  >&lt;p&gt;rebase&lt;/p&gt;</comment>
                            <comment id="13029007" author="he yongqiang" created="Wed, 4 May 2011 22:10:04 +0000"  >&lt;p&gt;Siying, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; title=&quot;CommandNeedRetryException needs release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2123&quot;&gt;HIVE-2123&lt;/a&gt;.3.patch can not pass compilation. And &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2123&quot; title=&quot;CommandNeedRetryException needs release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2123&quot;&gt;HIVE-2123&lt;/a&gt;.4.patch does not have apache license granted. &lt;/p&gt;</comment>
                            <comment id="13029012" author="sdong" created="Wed, 4 May 2011 22:20:03 +0000"  >&lt;p&gt;License granted. &lt;/p&gt;
</comment>
                            <comment id="13071327" author="jvs" created="Tue, 26 Jul 2011 20:11:26 +0000"  >&lt;p&gt;This one has been sitting in Patch Available queue for a while...anything holding it up?&lt;/p&gt;</comment>
                            <comment id="13087951" author="cwsteinbach" created="Fri, 19 Aug 2011 20:33:55 +0000"  >&lt;p&gt;@Siying: Can you please rebase the patch?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477056" name="HIVE-2123.1.patch" size="6131" author="sdong" created="Thu, 21 Apr 2011 23:44:01 +0000"/>
                            <attachment id="12477078" name="HIVE-2123.2.patch" size="8176" author="sdong" created="Fri, 22 Apr 2011 04:17:55 +0000"/>
                            <attachment id="12478027" name="HIVE-2123.3.patch" size="8176" author="sdong" created="Tue, 3 May 2011 03:45:11 +0000"/>
                            <attachment id="12478222" name="HIVE-2123.4.patch" size="8834" author="sdong" created="Wed, 4 May 2011 22:17:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 22 Apr 2011 00:07:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42261</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lijb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123653</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2124] Specified functions in the partitioning predicates should not generate a M/R job.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2124</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;For certain situations specifying which functions should be evaluated once would help to make syntax simpler to avoid launching M/R jobs.&lt;/p&gt;


&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;&amp;#35; myhql.time=`date &quot;+%s&quot;` -&amp;gt; constant&lt;br/&gt;
&amp;#35; counting rows from the last 30 days generates a M/R job using all the partitions&lt;br/&gt;
$ hive -hiveconf myhql.time=`date &quot;+%s&quot;` -e &quot;SELECT COUNT&amp;#40;&amp;#42;&amp;#41; FROM mybigtable WHERE mypartition &amp;gt;= from_unixtime(\${hiveconf:myhql.time}-2592000,&apos;yyyy-MM-dd&apos;);&lt;/p&gt;


&lt;p&gt;Suggested feature:&lt;/p&gt;


&lt;p&gt;&amp;#35; will scan only the right partitions&lt;br/&gt;
$ hive -hiveconf hive.partition.evaluateonce=unix_timestamp -e &quot;SELECT COUNT&amp;#40;&amp;#42;&amp;#41; FROM mybigtable WHERE mypartition &amp;gt;= from_unixtime(unix_timestamp()-2592000,&apos;yyyy-MM-dd&apos;);&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12504946">HIVE-2124</key>
            <summary>Specified functions in the partitioning predicates should not generate a M/R job.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="esteban">Esteban Gutierrez</reporter>
                        <labels>
                            <label>features</label>
                            <label>new</label>
                    </labels>
                <created>Fri, 22 Apr 2011 03:49:21 +0000</created>
                <updated>Fri, 19 Aug 2011 00:46:16 +0000</updated>
                                            <version>0.5.0</version>
                    <version>0.6.0</version>
                    <version>0.7.0</version>
                                                    <component>Query Processor</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>5</watches>
                                                                    <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12498497">HIVE-1986</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12465154">HIVE-1360</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42260</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08own:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48634</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2125] alter table concatenate fails and deletes data</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2125</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;the number of reducers is not set by this command (unlike other hive queries). since mapred.reduce.tasks=-1 (to let hive infer this automatically) - jobtracker fails the job (number of reducers cannot be negative)&lt;/p&gt;

&lt;p&gt;hive&amp;gt; alter table ad_imps_2 partition(ds=&apos;2009-06-16&apos;) concatenate;&lt;br/&gt;
alter table ad_imps_2 partition(ds=&apos;2009-06-16&apos;) concatenate;&lt;br/&gt;
Starting Job = job_201103101203_453180, Tracking URL = &lt;a href=&quot;http://curium.data.facebook.com:50030/jobdetails.jsp?jobid=job_201103101203_453180&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://curium.data.facebook.com:50030/jobdetails.jsp?jobid=job_201103101203_453180&lt;/a&gt;&lt;br/&gt;
Kill Command = /mnt/vol/hive/sites/curium/hadoop/bin/../bin/hadoop job  -Dmapred.job.tracker=curium.data.facebook.com:50029 -kill job_201103101203_453180&lt;br/&gt;
Hadoop job information for null: number of mappers: 0; number of reducers: 0&lt;br/&gt;
2011-04-22 10:21:24,046 null map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201103101203_453180 with errors&lt;br/&gt;
Moved to trash: /user/facebook/warehouse/ad_imps_2/_backup.ds=2009-06-16&lt;br/&gt;
after the job fails - the partition is deleted&lt;/p&gt;

&lt;p&gt;thankfully it&apos;s still in trash&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504992">HIVE-2125</key>
            <summary>alter table concatenate fails and deletes data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="jsensarma">Joydeep Sen Sarma</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Apr 2011 17:36:06 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:09 +0000</updated>
                            <resolved>Thu, 28 Apr 2011 17:53:24 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13024993" author="he yongqiang" created="Mon, 25 Apr 2011 22:47:08 +0000"  >&lt;p&gt;It is because the number of reducers is set to -1.&lt;br/&gt;
In this patch, it is set to zero. &lt;br/&gt;
Also added a move task as the child task of the merge task. added a conf to control whether to check index or not, and add the job name for the merge job.&lt;/p&gt;</comment>
                            <comment id="13024994" author="jiraposter@reviews.apache.org" created="Mon, 25 Apr 2011 22:48:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/665/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;alter table concatenate fails and deletes data&lt;/p&gt;

&lt;p&gt;It is because the number of reducers is set to -1.&lt;/p&gt;

&lt;p&gt;In this patch, it is set to zero. &lt;/p&gt;

&lt;p&gt;Also added a move task as the child task of the merge task. added a conf to control whether to check index or not, and add the job name for the merge job.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; title=&quot;alter table concatenate fails and deletes data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2125&quot;&gt;&lt;del&gt;HIVE-2125&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2125&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096599 &lt;br/&gt;
  trunk/conf/hive-default.xml 1096599 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java 1096599 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096599 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/rcfile/merge/BlockMergeTask.java 1096599 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java 1096599 &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/alter_merge_index.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientpositive/alter_merge_index.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/alter_merge_index.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/665/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yongqiang&lt;/p&gt;
</comment>
                            <comment id="13025005" author="jiraposter@reviews.apache.org" created="Mon, 25 Apr 2011 23:22:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/665/#review554&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#review554&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/conf/hive-default.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1169&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1169&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    can you make the indentation consistent with the other property elements?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1170&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1170&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    So after adding this, does the block-level merge after INSERT OVERWRITE be automatically supported?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ning&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-25 22:47:17, Yongqiang He wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/665/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-25 22:47:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;alter table concatenate fails and deletes data&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It is because the number of reducers is set to -1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In this patch, it is set to zero. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Also added a move task as the child task of the merge task. added a conf to control whether to check index or not, and add the job name for the merge job.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; title=&quot;alter table concatenate fails and deletes data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2125&quot;&gt;&lt;del&gt;HIVE-2125&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2125&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/rcfile/merge/BlockMergeTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/665/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yongqiang&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025014" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 00:16:03 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-04-25 23:20:59, Ning Zhang wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/conf/hive-default.xml, line 1042&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/diff/1/?file=17317#file17317line1042&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff/1/?file=17317#file17317line1042&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     can you make the indentation consistent with the other property elements?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It shows the same indentation on my local. So it might just be an review board display issue.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-04-25 23:20:59, Ning Zhang wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java, line 1203&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/diff/1/?file=17321#file17321line1203&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff/1/?file=17321#file17321line1203&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     So after adding this, does the block-level merge after INSERT OVERWRITE be automatically supported?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No. Not automatically supported. We still need to do some work there. but it is a separate issue.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Yongqiang&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/665/#review554&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#review554&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-04-25 22:47:17, Yongqiang He wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/665/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-25 22:47:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;alter table concatenate fails and deletes data&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It is because the number of reducers is set to -1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In this patch, it is set to zero. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Also added a move task as the child task of the merge task. added a conf to control whether to check index or not, and add the job name for the merge job.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; title=&quot;alter table concatenate fails and deletes data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2125&quot;&gt;&lt;del&gt;HIVE-2125&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2125&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/rcfile/merge/BlockMergeTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/665/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yongqiang&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025078" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 05:33:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/665/#review557&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#review557&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/conf/hive-default.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1177&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1177&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The indentation looks the same in your editor because these are TABs. Please remove, and then configure your editor to disallow TABs.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1176&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1176&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Spacing.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/queries/clientnegative/alter_merge_index.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1174&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1174&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please add some comments explaining what it is that you&apos;re testing, e.g. why is this a negative test? Why is expected to fail?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1175&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1175&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please add some comments here too.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-25 22:47:17, Yongqiang He wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/665/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-25 22:47:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;alter table concatenate fails and deletes data&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It is because the number of reducers is set to -1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In this patch, it is set to zero. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Also added a move task as the child task of the merge task. added a conf to control whether to check index or not, and add the job name for the merge job.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; title=&quot;alter table concatenate fails and deletes data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2125&quot;&gt;&lt;del&gt;HIVE-2125&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2125&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/rcfile/merge/BlockMergeTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/665/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yongqiang&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025083" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 06:03:03 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-04-26 05:33:19, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/test/queries/clientpositive/alter_merge_index.q, line 1&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/diff/1/?file=17323#file17323line1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff/1/?file=17323#file17323line1&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Please add some comments here too.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Carl, what kind of comments do you want here? &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-04-26 05:33:19, Carl Steinbach wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; trunk/ql/src/test/queries/clientnegative/alter_merge_index.q, line 1&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/diff/1/?file=17322#file17322line1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff/1/?file=17322#file17322line1&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Please add some comments explaining what it is that you&apos;re testing, e.g. why is this a negative test? Why is expected to fail?&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;&amp;gt;why is this a negative test? Why is expected to fail?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;should i put a positive test on a negative test dir? Should we explain all test cases in client negative dir?&lt;br/&gt;
Come on, please put some positive suggestions.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Yongqiang&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/665/#review557&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#review557&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-04-25 22:47:17, Yongqiang He wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/665/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-25 22:47:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;alter table concatenate fails and deletes data&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It is because the number of reducers is set to -1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In this patch, it is set to zero. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Also added a move task as the child task of the merge task. added a conf to control whether to check index or not, and add the job name for the merge job.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; title=&quot;alter table concatenate fails and deletes data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2125&quot;&gt;&lt;del&gt;HIVE-2125&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2125&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/rcfile/merge/BlockMergeTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/665/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yongqiang&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025098" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 06:53:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/665/#review560&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#review560&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/conf/hive-default.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1187&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1187&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Besides describing the effect of this configuration property, can you also please explain the motivation? Why would the user want to set this to true? Is there a valid reason for setting it to false?&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/queries/clientnegative/alter_merge_index.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1183&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1183&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt; Should we explain all test cases in client negative dir?&lt;/p&gt;

&lt;p&gt;    Emphatically yes!&lt;/p&gt;

&lt;p&gt;    And since I&apos;m a helpful person I&apos;ll even write the comment for you:&lt;/p&gt;

&lt;p&gt;    &quot;Verify that an error is thrown if the user attempts to concatenate an indexed table when hive.exec.concatenate.check.index=true&quot;&lt;/p&gt;

&lt;p&gt;    Also, please explicitly set hive.exec.concatenate.check.index=true at the beginning of this test.&lt;/p&gt;

&lt;p&gt;    Also, please change the name of this file and the name of the table so that it matches the semantics of the ALTER TABLE command, i.e. alter_concatenate_indexed_table.q and src_rc_concatenate_test.&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1186&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1186&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How about this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Verify that an indexed table can be concatenated when hive.exec.concatenate.check.index=false.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Verify that a partitioned table can be concatenated when hive.exec.concatenate.check.index=false.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The point of the comments is help the reader distinguish between details that are relevant to the intended purpose of the test from those that are not.&lt;/p&gt;




&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1188&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please replace &quot;merge&quot; with &quot;concatenate&quot;. A better name for this test would be &quot;alter_concatenate_indexed_table.q&quot;&lt;/p&gt;



&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/665/#comment1185&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/#comment1185&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    These tables get cleaned up automatically. Please remove the drop statements.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Carl&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-04-25 22:47:17, Yongqiang He wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/665/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-04-25 22:47:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;alter table concatenate fails and deletes data&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It is because the number of reducers is set to -1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In this patch, it is set to zero. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Also added a move task as the child task of the merge task. added a conf to control whether to check index or not, and add the job name for the merge job.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; title=&quot;alter table concatenate fails and deletes data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2125&quot;&gt;&lt;del&gt;HIVE-2125&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2125&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/conf/hive-default.xml 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/io/rcfile/merge/BlockMergeTask.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java 1096599 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientnegative/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/queries/clientpositive/alter_merge_index.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientnegative/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;trunk/ql/src/test/results/clientpositive/alter_merge_index.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/665/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yongqiang&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13025484" author="jiraposter@reviews.apache.org" created="Tue, 26 Apr 2011 22:28:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/665/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-04-26 22:27:30.586885)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;address Carl&apos;s comments about .q files&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;alter table concatenate fails and deletes data&lt;/p&gt;

&lt;p&gt;It is because the number of reducers is set to -1.&lt;/p&gt;

&lt;p&gt;In this patch, it is set to zero. &lt;/p&gt;

&lt;p&gt;Also added a move task as the child task of the merge task. added a conf to control whether to check index or not, and add the job name for the merge job.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; title=&quot;alter table concatenate fails and deletes data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2125&quot;&gt;&lt;del&gt;HIVE-2125&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2125&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2125&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096925 &lt;br/&gt;
  trunk/conf/hive-default.xml 1096925 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java 1096925 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096925 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/rcfile/merge/BlockMergeTask.java 1096925 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java 1096925 &lt;br/&gt;
  trunk/ql/src/test/queries/clientnegative/alter_concatenate_indexed_table.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/queries/clientpositive/alter_concatenate_indexed_table.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientnegative/alter_concatenate_indexed_table.q.out PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/alter_concatenate_indexed_table.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/665/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/665/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yongqiang&lt;/p&gt;
</comment>
                            <comment id="13025485" author="he yongqiang" created="Tue, 26 Apr 2011 22:29:19 +0000"  >&lt;p&gt;Carl, the comments for the config is the hive-site.xml. so i think it should not be added to .q files. And also putting comments before &apos;set&apos; command can lead to some random errors. And all other comments are addressed in this new patch.&lt;/p&gt;</comment>
                            <comment id="13025639" author="nzhang" created="Wed, 27 Apr 2011 06:50:39 +0000"  >&lt;p&gt;The new patch looks good to me and addressed most of Carl&apos;s comments. &lt;/p&gt;

&lt;p&gt;Also about comments in the test .q files, I&apos;m aware of the bug Yongqiang mentioned (test failed in some cases if comments are present, but passed otherwise). We should fix that bug in QTestsUtil and make a group effort to add comments to .q files as much as possible. Carl, what do you think?&lt;/p&gt;</comment>
                            <comment id="13026007" author="nzhang" created="Wed, 27 Apr 2011 21:00:01 +0000"  >&lt;p&gt;All unit tests passed. &lt;/p&gt;

&lt;p&gt;@Carl, do you have further comments? If you are +1 we can open a separate JIRA to fix the comment bug in .q files. &lt;/p&gt;</comment>
                            <comment id="13026389" author="nzhang" created="Thu, 28 Apr 2011 17:53:24 +0000"  >&lt;p&gt;Just committed. Thanks Yongqiang!&lt;/p&gt;

&lt;p&gt;Also Yongqiang, can you file a JIRA to fix the comments in .q files (if it is not filed already)?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477338" name="HIVE-2125.1.patch" size="31317" author="he yongqiang" created="Mon, 25 Apr 2011 22:44:48 +0000"/>
                            <attachment id="12477452" name="HIVE-2125.2.patch" size="32644" author="he yongqiang" created="Tue, 26 Apr 2011 22:26:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 25 Apr 2011 22:47:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72556</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lijr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123655</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2126] Hive&apos;s symlink text input format should be able to work with ComineHiveInputFormat</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2126</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;at compile time, if a partition&apos;s file format is SymlinkTextInputFormat, will replace the symlink path with paths in the symlink file. This way, it will work with Hive&apos;s HiveCombineFileInputFormat.&lt;/p&gt;

&lt;p&gt;The reason we are doing it at compile time is because:&lt;br/&gt;
1) At run time, the input path is not only used to get record reader, but also used for hive to get aliases and thus operator tree. But the CombineHiveInputFormat can have multiple paths for each split, and when switching paths, it also set the job with new input file name. So it always require a real input path name. Can not fake it.&lt;br/&gt;
2) if write a new input format, it will require a lot of duplication work with existing CombineHiveInputFormat.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505004">HIVE-2126</key>
            <summary>Hive&apos;s symlink text input format should be able to work with ComineHiveInputFormat</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Apr 2011 19:06:12 +0000</created>
                <updated>Fri, 16 Dec 2011 23:57:04 +0000</updated>
                            <resolved>Tue, 26 Apr 2011 20:55:58 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13024760" author="he yongqiang" created="Mon, 25 Apr 2011 09:21:59 +0000"  >&lt;p&gt;review board: &lt;a href=&quot;https://reviews.apache.org/r/653/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/653/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13024761" author="jiraposter@reviews.apache.org" created="Mon, 25 Apr 2011 09:22:06 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/653/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/653/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Hive&apos;s symlink text input format should be able to work with ComineHiveInputFormat&lt;/p&gt;


&lt;p&gt;This addresses bug hive-2126.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hive-2126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hive-2126&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096093 &lt;br/&gt;
  trunk/conf/hive-default.xml 1096093 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 1096093 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096093 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/ReworkMapredInputFormat.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/SymlinkTextInputFormat.java 1096093 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ExplainSemanticAnalyzer.java 1096093 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096093 &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/io/TestSymlinkTextInputFormat.java 1096093 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/653/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/653/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yongqiang&lt;/p&gt;
</comment>
                            <comment id="13024840" author="namit" created="Mon, 25 Apr 2011 16:53:14 +0000"  >&lt;p&gt;I havent taken a look at the code - but a high level question.&lt;br/&gt;
Should we call it SymbolicInputFormat instead ?&lt;br/&gt;
I mean, it should work for all kinds of files - not just text files.&lt;br/&gt;
For backward compatibility, we can make SymbolicTextInputFormat extend&lt;br/&gt;
SymbolicInputFormat.&lt;/p&gt;</comment>
                            <comment id="13024883" author="he yongqiang" created="Mon, 25 Apr 2011 17:49:40 +0000"  >&lt;p&gt;The reason of using&quot;ReworkMapredInputFormat&quot; is that the interface &quot;reworkMapred&quot; can also be used by other formats in future, like some other file format also want to change the mapred work depends on the input.&lt;br/&gt;
what do you think?&lt;/p&gt;</comment>
                            <comment id="13024891" author="namit" created="Mon, 25 Apr 2011 18:07:52 +0000"  >&lt;p&gt;It might be simpler if the HiveInputFormat (or a new interface which extends InputFommat) adds &lt;br/&gt;
this new method.&lt;/p&gt;

&lt;p&gt;All Hive input formats will implement the above interface. The default implementation does nothing,&lt;/p&gt;

&lt;p&gt;You dont need code like below:&lt;br/&gt;
     if (partDesc.getInputFileFormatClass().equals(SymlinkTextInputFormat.class)) {&lt;br/&gt;
        //change to TextInputFormat&lt;/p&gt;

&lt;p&gt;You always call a new method, which is a no-op for all other input formats right now.&lt;/p&gt;</comment>
                            <comment id="13024956" author="namit" created="Mon, 25 Apr 2011 20:48:46 +0000"  >&lt;p&gt;can you update the review board ?&lt;/p&gt;</comment>
                            <comment id="13024957" author="jiraposter@reviews.apache.org" created="Mon, 25 Apr 2011 20:49:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/653/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/653/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-04-25 20:48:09.176419)&lt;/p&gt;


&lt;p&gt;Review request for hive.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added a new class SymbolicInputFormat, and move the reworkMapred to this new class.&lt;br/&gt;
move the new code from SemanticAnalyzer to a Utilities method&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Hive&apos;s symlink text input format should be able to work with ComineHiveInputFormat&lt;/p&gt;


&lt;p&gt;This addresses bug hive-2126.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hive-2126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hive-2126&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1096548 &lt;br/&gt;
  trunk/conf/hive-default.xml 1096548 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 1096548 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java 1096548 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java 1096548 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/ReworkMapredInputFormat.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/SymbolicInputFormat.java PRE-CREATION &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/io/SymlinkTextInputFormat.java 1096548 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/ExplainSemanticAnalyzer.java 1096548 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java 1096548 &lt;br/&gt;
  trunk/ql/src/test/org/apache/hadoop/hive/ql/io/TestSymlinkTextInputFormat.java 1096548 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/653/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/653/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yongqiang&lt;/p&gt;
</comment>
                            <comment id="13025076" author="namit" created="Tue, 26 Apr 2011 05:23:52 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13025428" author="namit" created="Tue, 26 Apr 2011 20:55:58 +0000"  >&lt;p&gt;Committed. Thanks Yongqiang&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477283" name="HIVE-2126.1.patch" size="18327" author="he yongqiang" created="Mon, 25 Apr 2011 09:17:39 +0000"/>
                            <attachment id="12477334" name="HIVE-2126.2.patch" size="21800" author="he yongqiang" created="Mon, 25 Apr 2011 20:45:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 25 Apr 2011 09:22:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37484</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05inb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30118</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2127] Improve stats gathering reliability by retries on failures with hive.stats.retries.max and hive.stats.retries.wait</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2127</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Stats publishing and aggregation only try once and if there is any exception it will fail and return. If many mappers/reducers updating stats at the same time, it is very common to get lock timeout. We should make stats more reliable by retry when there is an SQLException.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505025">HIVE-2127</key>
            <summary>Improve stats gathering reliability by retries on failures with hive.stats.retries.max and hive.stats.retries.wait</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nzhang">Ning Zhang</assignee>
                                    <reporter username="nzhang">Ning Zhang</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Apr 2011 03:18:59 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:21 +0000</updated>
                            <resolved>Wed, 27 Apr 2011 14:19:58 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                    <component>Statistics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13024897" author="nzhang" created="Mon, 25 Apr 2011 18:27:48 +0000"  >&lt;p&gt;Review board: &lt;a href=&quot;https://reviews.apache.org/r/664/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/664/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13024991" author="nzhang" created="Mon, 25 Apr 2011 22:31:49 +0000"  >&lt;p&gt;Paul has an offline comment about it cannot handle Connection exceptions. I&apos;m working on a new patch and will update it soon. &lt;/p&gt;</comment>
                            <comment id="13025009" author="nzhang" created="Mon, 25 Apr 2011 23:42:46 +0000"  >&lt;p&gt;Updated the review board. &lt;/p&gt;</comment>
                            <comment id="13025607" author="namit" created="Wed, 27 Apr 2011 05:14:22 +0000"  >&lt;p&gt;Comments in review-board&lt;/p&gt;</comment>
                            <comment id="13025610" author="namit" created="Wed, 27 Apr 2011 05:19:29 +0000"  >&lt;p&gt;Also add the new configuration variables in the name of the jira&lt;/p&gt;</comment>
                            <comment id="13025615" author="nzhang" created="Wed, 27 Apr 2011 05:29:48 +0000"  >&lt;p&gt;@Namit, what does the new configuration variable do? Do you mean to define a variable to disable retry? If so set hive.stats.retries.max = 0 will do.&lt;/p&gt;</comment>
                            <comment id="13025620" author="namit" created="Wed, 27 Apr 2011 05:35:43 +0000"  >&lt;p&gt;What I meant was: &lt;/p&gt;

&lt;p&gt;Change the subject of the jira:&lt;br/&gt;
Improve stats gathering reliability by retries on failures&lt;/p&gt;

&lt;p&gt;for better searching&lt;/p&gt;</comment>
                            <comment id="13025621" author="namit" created="Wed, 27 Apr 2011 05:36:43 +0000"  >&lt;p&gt;Looks good otherwise&lt;/p&gt;</comment>
                            <comment id="13025631" author="nzhang" created="Wed, 27 Apr 2011 06:11:23 +0000"  >&lt;p&gt;Changed the JIRA subject&lt;/p&gt;</comment>
                            <comment id="13025800" author="namit" created="Wed, 27 Apr 2011 14:19:58 +0000"  >&lt;p&gt;Committed. Thanks Ning&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477343" name="HIVE-2127.2.patch" size="30635" author="nzhang" created="Mon, 25 Apr 2011 23:36:14 +0000"/>
                            <attachment id="12477320" name="HIVE-2127.patch" size="19612" author="nzhang" created="Mon, 25 Apr 2011 18:17:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Apr 2011 05:14:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66835</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00x5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3305</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2128] Automatic Indexing with multiple tables</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2128</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Make automatic indexing work with jobs which access multiple tables.  We&apos;ll probably need to modify the way that the index input format works in order to associate index formats/files with specific tables.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505027">HIVE-2128</key>
            <summary>Automatic Indexing with multiple tables</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="salbiz">Syed S. Albiz</assignee>
                                    <reporter username="rmelick">Russell Melick</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Apr 2011 03:42:43 +0000</created>
                <updated>Thu, 2 May 2013 02:29:38 +0000</updated>
                            <resolved>Tue, 26 Jul 2011 00:12:52 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Indexing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13049555" author="jvs" created="Wed, 15 Jun 2011 01:06:04 +0000"  >&lt;p&gt;HiveInputFormat already keeps track of the mapping from path to input format.  So the idea here is that instead of setting HiveIndexedInputFormat globally for the entire job, we need to be associating it only with the paths that are supposed to have index filtering applied.&lt;/p&gt;</comment>
                            <comment id="13060075" author="jiraposter@reviews.apache.org" created="Tue, 5 Jul 2011 19:03:16 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1010/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Grab the indexed tables during optimized query generation, grab the associated path URIs, and keep those around in the Configuration object. When the job is passed to ExecDriver, this data is extracted and used in HiveIndexedInputFormat to decide whether to use the index file or delegate to the parent (HiveInputFormat) class. Not sure if this is robust. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; title=&quot;Automatic Indexing with multiple tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2128&quot;&gt;&lt;del&gt;HIVE-2128&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2128&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 090ecfc &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexQueryContext.java 617723e &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java f1ee95d &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java 61bbbf5 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java 7c91946 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java dbc489f &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java a03a9a6 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1010/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added new testcase index_auto_mult_tables.q&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13060199" author="jvs" created="Tue, 5 Jul 2011 23:56:59 +0000"  >&lt;p&gt;I don&apos;t see the new testcase in either the patch or the reviewboard entry?&lt;/p&gt;</comment>
                            <comment id="13060206" author="salbiz" created="Wed, 6 Jul 2011 00:03:43 +0000"  >&lt;p&gt;updated to include testcase&lt;/p&gt;</comment>
                            <comment id="13060207" author="jiraposter@reviews.apache.org" created="Wed, 6 Jul 2011 00:04:16 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1010/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-06 00:03:20.513755)&lt;/p&gt;


&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;updated patch to include testcase&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Grab the indexed tables during optimized query generation, grab the associated path URIs, and keep those around in the Configuration object. When the job is passed to ExecDriver, this data is extracted and used in HiveIndexedInputFormat to decide whether to use the index file or delegate to the parent (HiveInputFormat) class. Not sure if this is robust. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; title=&quot;Automatic Indexing with multiple tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2128&quot;&gt;&lt;del&gt;HIVE-2128&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2128&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/exec/ExecDriver.java 090ecfc &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexQueryContext.java 617723e &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java f1ee95d &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java 61bbbf5 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java 7c91946 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java dbc489f &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java a03a9a6 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_mult_tables.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_mult_tables.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1010/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added new testcase index_auto_mult_tables.q&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13060217" author="jvs" created="Wed, 6 Jul 2011 00:38:32 +0000"  >&lt;p&gt;I don&apos;t think this approach works...what if both tables in the query have an applicable filter?&lt;/p&gt;

&lt;p&gt;In that case, don&apos;t we need a separate blockfilter file per table alias?&lt;/p&gt;</comment>
                            <comment id="13060267" author="salbiz" created="Wed, 6 Jul 2011 03:51:23 +0000"  >&lt;p&gt;Hmm, you&apos;re right, we would need multiple blockfilter files in that case. I&apos;m not sure if that is possible though in the framework we have, given that we choose one single index query to generate each time at each stage. In the case where we have multiple indexes involved at each stage, the index handler is responsible for combining index inputs into a single output file. For example, I have attached a case that seems like it might cause problems (both src and srcpart have indexes built and filters applied), however since the index queries are generated separately for separate table scans it seems like there is no collision between blockfilter files. Does this address the issue? It seems like there might still be a possibility of collision between table and blockfilter file, so I wonder if you had a different case in mind?&lt;/p&gt;</comment>
                            <comment id="13060888" author="jvs" created="Wed, 6 Jul 2011 22:42:13 +0000"  >&lt;p&gt;I was thinking of the case of compact indexes (one on each table).&lt;/p&gt;

&lt;p&gt;Your test case is similar, but for bitmap indexes.  We certainly should not be trying to combine the indexes in this case since they are on different tables!  The plan looks strange already because it is applying the srcpart predicate twice, and the src index not at all.  (It&apos;s hard to tell what&apos;s going on since the same predicate is applied on both tables; use a different predicate to see if it&apos;s two copies of the same vs one of each.)&lt;/p&gt;

&lt;p&gt;Regardless of index type, I think we &lt;b&gt;should&lt;/b&gt; be able to use indexes on different tables at once in the same query.&lt;/p&gt;</comment>
                            <comment id="13064253" author="jiraposter@reviews.apache.org" created="Wed, 13 Jul 2011 00:31:00 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1010/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-13 00:29:56.738368)&lt;/p&gt;


&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Revamped approach. We already uniquely assign filenames to each index query result, so instead of throwing those away, keep them in the indexIntermediateFile variable, and take the union of those input paths to generate the next set of input splits.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Grab the indexed tables during optimized query generation, grab the associated path URIs, and keep those around in the Configuration object. When the job is passed to ExecDriver, this data is extracted and used in HiveIndexedInputFormat to decide whether to use the index file or delegate to the parent (HiveInputFormat) class. Not sure if this is robust. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; title=&quot;Automatic Indexing with multiple tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2128&quot;&gt;&lt;del&gt;HIVE-2128&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2128&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/test/results/clientpositive/index_auto_self_join.q.out PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_mult_tables_compact.q.out PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/Driver.java b278ffe &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexQueryContext.java 617723e &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexResult.java b9b586e &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java f1ee95d &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/TableBasedIndexHandler.java 02ab78c &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java 61bbbf5 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java 7c91946 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java dbc489f &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java a03a9a6 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_mult_tables.q PRE-CREATION &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_mult_tables_compact.q PRE-CREATION &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_self_join.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_mult_tables.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1010/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added new testcase index_auto_mult_tables.q&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13067398" author="jvs" created="Mon, 18 Jul 2011 23:49:23 +0000"  >&lt;p&gt;Could you make sure the latest patch is uploaded here and matching Review Board, and then click Submit Patch?  Also make sure all spurious changes (like extra imports) are gone; I&apos;m seeing some of those in Review Board.&lt;/p&gt;</comment>
                            <comment id="13067469" author="salbiz" created="Tue, 19 Jul 2011 03:14:39 +0000"  >&lt;p&gt;removed unnecessary imports&lt;/p&gt;</comment>
                            <comment id="13067470" author="jiraposter@reviews.apache.org" created="Tue, 19 Jul 2011 03:15:45 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1010/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-19 03:15:17.006396)&lt;/p&gt;


&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;removed unnecessary imports from patch&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Grab the indexed tables during optimized query generation, grab the associated path URIs, and keep those around in the Configuration object. When the job is passed to ExecDriver, this data is extracted and used in HiveIndexedInputFormat to decide whether to use the index file or delegate to the parent (HiveInputFormat) class. Not sure if this is robust. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; title=&quot;Automatic Indexing with multiple tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2128&quot;&gt;&lt;del&gt;HIVE-2128&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2128&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/test/results/clientpositive/index_auto_self_join.q.out PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_mult_tables_compact.q.out PRE-CREATION &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_self_join.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_mult_tables.q.out PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java a03a9a6 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_mult_tables.q PRE-CREATION &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_mult_tables_compact.q PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexResult.java b9b586e &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java f1ee95d &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java 61bbbf5 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java 7c91946 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java dbc489f &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexQueryContext.java 617723e &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1010/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added new testcase index_auto_mult_tables.q&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13067877" author="jvs" created="Tue, 19 Jul 2011 18:37:26 +0000"  >&lt;p&gt;Comments on Review Board.  After that it looks good to go!&lt;/p&gt;</comment>
                            <comment id="13067878" author="jiraposter@reviews.apache.org" created="Tue, 19 Jul 2011 18:38:57 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1010/#review1112&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/#review1112&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexQueryContext.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1010/#comment2271&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/#comment2271&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why was this comment truncated?&lt;/p&gt;



&lt;p&gt;ql/src/test/queries/clientpositive/index_auto_mult_tables.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1010/#comment2273&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/#comment2273&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    All of these SELECT statements need ORDER BY for determinism.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-07-19 03:15:17, Syed Albiz wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1010/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-19 03:15:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Grab the indexed tables during optimized query generation, grab the associated path URIs, and keep those around in the Configuration object. When the job is passed to ExecDriver, this data is extracted and used in HiveIndexedInputFormat to decide whether to use the index file or delegate to the parent (HiveInputFormat) class. Not sure if this is robust. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; title=&quot;Automatic Indexing with multiple tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2128&quot;&gt;&lt;del&gt;HIVE-2128&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2128&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/index_auto_self_join.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/index_auto_mult_tables_compact.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/index_auto_self_join.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/index_auto_mult_tables.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java a03a9a6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/index_auto_mult_tables.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/index_auto_mult_tables_compact.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexResult.java b9b586e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java f1ee95d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java 61bbbf5 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java 7c91946 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java dbc489f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexQueryContext.java 617723e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1010/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;added new testcase index_auto_mult_tables.q&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Syed&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13069299" author="jiraposter@reviews.apache.org" created="Thu, 21 Jul 2011 23:53:58 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1010/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-21 23:52:23.929900)&lt;/p&gt;


&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added order by to testcases. This revealed an existing bug where we would walk the entire operator tree for each task in the task tree in IndexWhereTaskDispatcher. I amended this to only walk the subset of the operator tree in the current task.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Grab the indexed tables during optimized query generation, grab the associated path URIs, and keep those around in the Configuration object. When the job is passed to ExecDriver, this data is extracted and used in HiveIndexedInputFormat to decide whether to use the index file or delegate to the parent (HiveInputFormat) class. Not sure if this is robust. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; title=&quot;Automatic Indexing with multiple tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2128&quot;&gt;&lt;del&gt;HIVE-2128&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2128&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/test/results/clientpositive/index_bitmap_auto_partitioned.q.out 4c9efd1 &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_self_join.q.out PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexResult.java b9b586e &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java f1ee95d &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java 61bbbf5 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java 7c91946 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java dbc489f &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereTaskDispatcher.java da084f6 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java a03a9a6 &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_mult_tables.q PRE-CREATION &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_mult_tables_compact.q PRE-CREATION &lt;br/&gt;
  ql/src/test/queries/clientpositive/index_auto_self_join.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_mult_tables.q.out PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/index_auto_mult_tables_compact.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1010/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1010/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added new testcase index_auto_mult_tables.q&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Syed&lt;/p&gt;
</comment>
                            <comment id="13069851" author="jvs" created="Fri, 22 Jul 2011 23:58:45 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="13069899" author="jvs" created="Sat, 23 Jul 2011 04:44:06 +0000"  >&lt;p&gt;I got failures in the new tests:&lt;/p&gt;

&lt;p&gt;testCliDriver_index_auto_mult_tables&lt;br/&gt;
testCliDriver_index_auto_mult_tables_compact&lt;br/&gt;
testCliDriver_index_auto_self_join&lt;/p&gt;

&lt;p&gt;Plus this existing test:&lt;/p&gt;

&lt;p&gt;testCliDriver_index_bitmap_auto_partitioned&lt;/p&gt;

&lt;p&gt;Maybe you forgot to update the logs?&lt;/p&gt;</comment>
                            <comment id="13070041" author="salbiz" created="Sat, 23 Jul 2011 19:53:53 +0000"  >&lt;p&gt;Sorry, I forgot to regenerate the testcase outputs. Fixed in this patch&lt;/p&gt;</comment>
                            <comment id="13070648" author="jvs" created="Mon, 25 Jul 2011 18:06:44 +0000"  >&lt;p&gt;Reran with latest patch and still got failures in these three:&lt;/p&gt;

&lt;p&gt;testCliDriver_index_auto_mult_tables&lt;br/&gt;
testCliDriver_index_auto_mult_tables_compact&lt;br/&gt;
testCliDriver_index_auto_self_join&lt;/p&gt;</comment>
                            <comment id="13070681" author="salbiz" created="Mon, 25 Jul 2011 19:00:53 +0000"  >&lt;p&gt;Ah, sorry, forgot to git rebase before regenerating the patch, some of the recently landed patches introduced changes to the testcase output.&lt;/p&gt;</comment>
                            <comment id="13070868" author="jvs" created="Tue, 26 Jul 2011 00:12:52 +0000"  >&lt;p&gt;Committed.  Thanks Syed!&lt;/p&gt;</comment>
                            <comment id="13070943" author="hudson" created="Tue, 26 Jul 2011 04:48:03 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #848 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/848/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/848/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2128&quot; title=&quot;Automatic Indexing with multiple tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2128&quot;&gt;&lt;del&gt;HIVE-2128&lt;/del&gt;&lt;/a&gt;. Automatic Indexing with multiple tables.&lt;br/&gt;
(Syed Albiz via jvs)&lt;/p&gt;

&lt;p&gt;jvs : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1150962&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1150962&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexResult.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/index_auto_mult_tables_compact.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/index_auto_mult_tables_compact.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/index_auto_self_join.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/index_bitmap_auto_partitioned.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereTaskDispatcher.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/index_auto_self_join.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/index_auto_mult_tables.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/index_auto_mult_tables.q&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12474222">HIVE-1644</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12485352" name="HIVE-2128.1.patch" size="30079" author="salbiz" created="Wed, 6 Jul 2011 00:03:43 +0000"/>
                            <attachment id="12485310" name="HIVE-2128.1.patch" size="10328" author="salbiz" created="Tue, 5 Jul 2011 18:44:50 +0000"/>
                            <attachment id="12485364" name="HIVE-2128.2.patch" size="41490" author="salbiz" created="Wed, 6 Jul 2011 03:51:23 +0000"/>
                            <attachment id="12486965" name="HIVE-2128.4.patch" size="97206" author="salbiz" created="Tue, 19 Jul 2011 03:05:02 +0000"/>
                            <attachment id="12486966" name="HIVE-2128.5.patch" size="95214" author="salbiz" created="Tue, 19 Jul 2011 03:14:39 +0000"/>
                            <attachment id="12487375" name="HIVE-2128.6.patch" size="104843" author="salbiz" created="Thu, 21 Jul 2011 23:52:45 +0000"/>
                            <attachment id="12487612" name="HIVE-2128.7.patch" size="105000" author="salbiz" created="Sat, 23 Jul 2011 19:53:53 +0000"/>
                            <attachment id="12487745" name="HIVE-2128.8.patch" size="101533" author="salbiz" created="Mon, 25 Jul 2011 19:00:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 Jun 2011 01:06:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66963</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i010cn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3822</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2129] Display indexing information for TableScanOperator in plan</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2129</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Show the indexInputFormat and indexIntermediateFile in the plan, to indicate that the table scan&apos;s input is being filtered by the intermediate file.  But, we only want to do this when these values are non-null (could use the usesIndex() function), so that all the old tests aren&apos;t messed up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505028">HIVE-2129</key>
            <summary>Display indexing information for TableScanOperator in plan</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rmelick">Russell Melick</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Apr 2011 03:51:12 +0000</created>
                <updated>Thu, 2 May 2013 02:29:38 +0000</updated>
                                            <version>0.8.0</version>
                                                    <component>Indexing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                    <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12474222">HIVE-1644</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42259</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i010cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2130] Cost based choice for rewrite during Automatic Indexing</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2130</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;After processing a predicate, there are potentially multiple index rewrites possible.  Currently, we just choose the first one.  However, there are probably heuristics for choosing certain rewrites over others, based on potential time savings. See IndexWhereProcessor for a good place to do this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505029">HIVE-2130</key>
            <summary>Cost based choice for rewrite during Automatic Indexing</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rmelick">Russell Melick</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Apr 2011 03:56:17 +0000</created>
                <updated>Thu, 2 May 2013 02:29:38 +0000</updated>
                                            <version>0.8.0</version>
                                                    <component>Indexing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                    <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12474222">HIVE-1644</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42258</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i010c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3820</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2131] Bitmap Operation UDF doesn&apos;t clear return list</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2131</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The AbstractGenericUDFEWAHBitmapBop.java does not clear the return list when evaluate() is called, causing each subsequent call to a bitmap operation to return the wrong values.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505102">HIVE-2131</key>
            <summary>Bitmap Operation UDF doesn&apos;t clear return list</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mwang5">Marquis Wang</assignee>
                                    <reporter username="mwang5">Marquis Wang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Apr 2011 10:01:25 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:24 +0000</updated>
                            <resolved>Tue, 26 Apr 2011 04:11:39 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13024766" author="mwang5" created="Mon, 25 Apr 2011 10:03:20 +0000"  >&lt;p&gt;Small patch that solves this problem.&lt;/p&gt;</comment>
                            <comment id="13024842" author="jvs" created="Mon, 25 Apr 2011 16:56:36 +0000"  >&lt;p&gt;Can you add a test case?&lt;/p&gt;</comment>
                            <comment id="13024961" author="mwang5" created="Mon, 25 Apr 2011 21:03:42 +0000"  >&lt;p&gt;I&apos;ve updated the udf_bitmap_and and udf_bitmap_or tests so that they would have detected the bug in the old code.&lt;/p&gt;</comment>
                            <comment id="13024980" author="jvs" created="Mon, 25 Apr 2011 21:58:22 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="13025056" author="jvs" created="Tue, 26 Apr 2011 04:11:39 +0000"  >&lt;p&gt;Committed.  Thanks Marquis!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477284" name="HIVE-2131.1.patch" size="707" author="mwang5" created="Mon, 25 Apr 2011 10:03:20 +0000"/>
                            <attachment id="12477336" name="HIVE-2131.2.patch" size="9958" author="mwang5" created="Mon, 25 Apr 2011 21:03:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 25 Apr 2011 16:56:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72555</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lijz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123656</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2132] Load a file into a table/partition should be able to run in parallel</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2132</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently, the load runs sequentially, which can be a problem for loading a large directory.&lt;/p&gt;

&lt;p&gt;The following syntax should work:&lt;/p&gt;

&lt;p&gt;LOAD OVERWRITE DIRECTORY INTO TABLE &amp;lt;T&amp;gt; PARTITION &amp;lt;P&amp;gt;;&lt;/p&gt;

&lt;p&gt;The user should be able the total number of mappers. For now, a single mapper per file is OK.&lt;br/&gt;
We can add support for parallelism within a file later&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505142">HIVE-2132</key>
            <summary>Load a file into a table/partition should be able to run in parallel</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Apr 2011 22:48:53 +0000</created>
                <updated>Wed, 27 Apr 2011 06:40:17 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42257</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lik7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123657</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-2133] DROP TABLE IF EXISTS should not fail if a view of that name exists</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2133</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We should match MySQL behavior on this.  Likewise for DROP VIEW IF EXISTS when a table of that name exists.&lt;/p&gt;

&lt;p&gt;Note that without IF EXISTS, we still want the statement to fail when the existing object type does not match.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505143">HIVE-2133</key>
            <summary>DROP TABLE IF EXISTS should not fail if a view of that name exists</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jvs">John Sichi</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Apr 2011 23:00:07 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:39 +0000</updated>
                            <resolved>Fri, 29 Apr 2011 07:19:37 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13026752" author="cwsteinbach" created="Thu, 28 Apr 2011 22:54:14 +0000"  >&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13026888" author="cwsteinbach" created="Fri, 29 Apr 2011 07:19:37 +0000"  >&lt;p&gt;Committed to trunk. Thanks John!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477459" name="HIVE-2133.1.patch" size="75213" author="jvs" created="Tue, 26 Apr 2011 23:30:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 28 Apr 2011 22:54:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72554</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0likf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123658</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-2134] Remove System.exit </title>
                <link>https://issues.apache.org/jira/browse/HIVE-2134</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;System.exit exists in various places in code. Its good to get rid of it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505238">HIVE-2134</key>
            <summary>Remove System.exit </summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Apr 2011 19:49:31 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:00 +0000</updated>
                            <resolved>Mon, 16 May 2011 04:21:36 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13025397" author="ashutoshc" created="Tue, 26 Apr 2011 19:50:57 +0000"  >&lt;p&gt;As discussed in April Contributor meeting its good to get rid of System.exit. This patch removes all System.exit from Metastore directory.&lt;/p&gt;</comment>
                            <comment id="13026879" author="amareshwari" created="Fri, 29 Apr 2011 06:36:07 +0000"  >&lt;p&gt;Patch removes System.exit calls and as logs warning saying it is exiting. Shouldn&apos;t it throw out the exceptions for exit?&lt;/p&gt;</comment>
                            <comment id="13027249" author="ashutoshc" created="Sat, 30 Apr 2011 00:23:53 +0000"  >&lt;p&gt;Now throws the exception instead of doing System.exit. Didn&apos;t do it in MetaStoreUtils since there it is launched in a thread and run() doesn&apos;t allow to throw checked exceptions. I could have casted exception into RuntimeException but even that would not make sense because once exception is thrown in thread, there is no one who can catch it and do something with it.&lt;/p&gt;</comment>
                            <comment id="13031541" author="amareshwari" created="Wed, 11 May 2011 04:54:16 +0000"  >&lt;p&gt;Looks fine. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13031556" author="amareshwari" created="Wed, 11 May 2011 06:06:32 +0000"  >&lt;p&gt;Seems patch has gone stale. I&apos;m compilation error with the patch:&lt;br/&gt;
TestMetaStoreEventListener.java:56: unreported exception java.lang.Throwable;&lt;br/&gt;
      must be caught or declared to be thrown&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;       HiveMetaStore.main(new String[]&lt;/p&gt;
{msPort}
&lt;p&gt;);&lt;/p&gt;</comment>
                            <comment id="13031856" author="ashutoshc" created="Wed, 11 May 2011 17:11:11 +0000"  >&lt;p&gt;$ svn co  &lt;a href=&quot;http://svn.apache.org/repos/asf/hive/trunk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hive/trunk&lt;/a&gt; .&lt;br/&gt;
$ curl &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12477856/hive_2134.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12477856/hive_2134.patch&lt;/a&gt; | patch -p0&lt;br/&gt;
$ ant package&lt;br/&gt;
BUILD SUCCESSFUL&lt;br/&gt;
Total time: 2 minutes 35 seconds&lt;/p&gt;

&lt;p&gt;works for me. can you double check if you have clean upto date tree.&lt;/p&gt;</comment>
                            <comment id="13032251" author="amareshwari" created="Thu, 12 May 2011 04:48:20 +0000"  >&lt;p&gt;Ashutosh, ant package builds properly. But ant test fails with compilation error.&lt;/p&gt;</comment>
                            <comment id="13032471" author="ashutoshc" created="Thu, 12 May 2011 15:58:09 +0000"  >&lt;p&gt;Sorry about that. Uploaded new patch with no compilation errors.&lt;/p&gt;</comment>
                            <comment id="13033869" author="amareshwari" created="Mon, 16 May 2011 04:21:36 +0000"  >&lt;p&gt;I just committed this. &lt;br/&gt;
Thanks Ashutosh!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477856" name="hive_2134.patch" size="2884" author="ashutoshc" created="Sat, 30 Apr 2011 00:23:53 +0000"/>
                            <attachment id="12478984" name="hive_2134_1.patch" size="3258" author="ashutoshc" created="Thu, 12 May 2011 15:58:09 +0000"/>
                            <attachment id="12477436" name="no_sysexit.patch" size="1482" author="ashutoshc" created="Tue, 26 Apr 2011 19:50:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 29 Apr 2011 06:36:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72553</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0likn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123659</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>
