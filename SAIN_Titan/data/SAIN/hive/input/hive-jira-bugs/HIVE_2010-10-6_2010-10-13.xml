<!--
RSS generated by JIRA (7.6.3#76005-sha1:8a4e38d34af948780dbf52044e7aafb13a7cae58) at Tue Jan 22 15:16:50 UTC 2019

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+HIVE+AND+created+%3E%3D+2010-10-6+AND+created+%3C%3D+2010-10-13+ORDER+BY+key+ASC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="12" total="12"/>
                <build-info>
            <version>7.6.3</version>
            <build-number>76005</build-number>
            <build-date>09-01-2018</build-date>
        </build-info>

<item>
            <title>[HIVE-1694] Accelerate GROUP BY execution using indexes</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1694</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The index building patch (Hive-417) is checked into trunk, this JIRA issue tracks supporting indexes in Hive compiler &amp;amp; execution engine for SELECT queries.&lt;/p&gt;

&lt;p&gt;This is in ref. to John&apos;s comment at&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-417?focusedCommentId=12884869&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12884869&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-417?focusedCommentId=12884869&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12884869&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;on creating separate JIRA issue for tracking index usage in optimizer &amp;amp; query execution.&lt;/p&gt;

&lt;p&gt;The aim of this effort is to use indexes to accelerate query execution (for certain class of queries). E.g.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Filters and range scans (already being worked on by He Yongqiang as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-417&quot; title=&quot;Implement Indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-417&quot;&gt;&lt;del&gt;HIVE-417&lt;/del&gt;&lt;/a&gt;?)&lt;/li&gt;
	&lt;li&gt;Joins (index based joins)&lt;/li&gt;
	&lt;li&gt;Group By, Order By and other misc cases&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The proposal is multi-step:&lt;br/&gt;
1. Building index based operators, compiler and execution engine changes&lt;br/&gt;
2. Optimizer enhancements (e.g. cost-based optimizer to compare and choose between index scans, full table scans etc.)&lt;/p&gt;

&lt;p&gt;This JIRA initially focuses on the first step. This JIRA is expected to hold the information about index based plans &amp;amp; operator implementations for above mentioned cases.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12476655">HIVE-1694</key>
            <summary>Accelerate GROUP BY execution using indexes</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pkalmegh">Prajakta Kalmegh</assignee>
                                    <reporter username="nikhail">Nikhil Deshpande</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Oct 2010 11:07:58 +0000</created>
                <updated>Sat, 5 Apr 2014 22:16:52 +0000</updated>
                            <resolved>Tue, 13 Sep 2011 02:21:21 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Indexing</component>
                    <component>Query Processor</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>20</watches>
                                                                <comments>
                            <comment id="12919961" author="jvs" created="Mon, 11 Oct 2010 19:39:55 +0000"  >&lt;p&gt;Note that we have a team of students from Harvey Mudd planning to work on this one.&lt;/p&gt;</comment>
                            <comment id="12925779" author="nikhail" created="Thu, 28 Oct 2010 11:22:32 +0000"  >&lt;p&gt;This is a patch to demonstrate query performance gains using indexes&lt;br/&gt;
(added in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-417&quot; title=&quot;Implement Indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-417&quot;&gt;&lt;del&gt;HIVE-417&lt;/del&gt;&lt;/a&gt;). The patch is over latest hive trunk.&lt;/p&gt;

&lt;p&gt;ChangeLog for the patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Implements a new rewrite for a certain set of queries with GROUP BY to speed those queries by running them on index data instead of base table.&lt;/li&gt;
	&lt;li&gt;Implements a skeleton generic rewrite engine.&lt;/li&gt;
	&lt;li&gt;Implements the rewrite rule for a GroupBy queries set (mentioned above).  More details in the class comment GbToCompactSumIdxRewrite.&lt;/li&gt;
	&lt;li&gt;Rewrite needs to be currently explicitly enabled with a flag hive.ql.rw.gb_to_idx.&lt;/li&gt;
	&lt;li&gt;Modifies metastore &amp;amp; metadata API for getting some index info.&lt;/li&gt;
	&lt;li&gt;Modifies QB metadata &amp;amp; parseblock code to add some rewrite assist methods.&lt;/li&gt;
	&lt;li&gt;Inserts a rewrite hook into Semantic Analyzer.&lt;/li&gt;
	&lt;li&gt;Fixes a bug in ql QTestUtil to clean-up indexed tables properly&lt;/li&gt;
	&lt;li&gt;Contains new test for Group By rewrite using indexes: ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Quick performance test results on a very small Hadoop cluster:&lt;/p&gt;

&lt;p&gt;2 queries (chosen to demonstrate perf gains) run on TPC-H benchmark data lineitem table.&lt;/p&gt;

&lt;p&gt;Timings in seconds, data set size (1M, 1G etc.) is TPC-H scale factor.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-----------------------------------------------
               1M      1G       10G      30G 
-----------------------------------------------
  q1_no_idx  24.161   76.790  506.005  1551.555
q1_with_idx  21.268   27.292   35.502    86.133
-----------------------------------------------
  q1_no_idx  73.660  130.587  764.619  2146.423
q2_with_idx  69.393   75.493   92.867   190.619
-----------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hadoop cluster description used for above perf test:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;2 server class machines (each box: CentOS 5.x Linux, 5 SAS disks in RAID5, 16GB RAM)&lt;/li&gt;
	&lt;li&gt;2-node Hadoop cluster (0.20.2), un-tuned and un-optimized, data not partitioned and clustered, Hive tables stored in row-store format, HDFS replication factor: 2&lt;/li&gt;
	&lt;li&gt;Sun JDK 1.6 (server mode JVM, JVM_HEAP_SIZE:4GB RAM)&lt;/li&gt;
	&lt;li&gt;Queries on TPC-H Data (lineitem table: 70% of TPC-H data size, e.g. TPC-H 30GB data: 21GB lineitem, ~180Million tuples)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;These changes are being maintained at &lt;a href=&quot;http://github.com/prafullat/hive&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/prafullat/hive&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12925780" author="nikhail" created="Thu, 28 Oct 2010 11:24:26 +0000"  >&lt;p&gt;Patch mentioned for above comment.&lt;/p&gt;</comment>
                            <comment id="12925781" author="nikhail" created="Thu, 28 Oct 2010 11:26:17 +0000"  >&lt;p&gt;Example/demo queries used for testing performance gains.&lt;/p&gt;</comment>
                            <comment id="12926675" author="prafulla" created="Sun, 31 Oct 2010 03:09:29 +0000"  >&lt;p&gt;Here is one presentation we(Me and Nikhil) had at Persistent Systems Ltd, regarding this changes.&lt;br/&gt;
&lt;a href=&quot;http://www.slideshare.net/NikhilDeshpande/indexed-hive&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.slideshare.net/NikhilDeshpande/indexed-hive&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12927070" author="jvs" created="Mon, 1 Nov 2010 18:15:17 +0000"  >&lt;p&gt;Hey guys, I haven&apos;t gone through all the code yet, but reading through the slides just now, there&apos;s one problem I should point out with using the existing compact indexes for aggregate rewrite.&lt;/p&gt;

&lt;p&gt;Namely, we store only the distinct block offsets, not the distinct row offsets.  So, if the same key appears more than once within the same block, you&apos;ll get the wrong answer for COUNT.  One way to address this would be to compute the COUNT per index entry at the time we are building the index, and then SUM that later for aggregation.  But currently the compact index does not store that, so we would need to add it as a new index type.&lt;/p&gt;

&lt;p&gt;One smaller item is that for the DISTINCT rewrite (slide 10), you still need to keep a DISTINCT on the rewritten query since the same l_shipdate may be repeated in the index table if it appears in multiple buckets.&lt;/p&gt;</comment>
                            <comment id="12927073" author="namit" created="Mon, 1 Nov 2010 18:20:11 +0000"  >&lt;p&gt;Had an offline discussion with John just now - I think he is also giving similar comments, so I will keep it very brief.&lt;/p&gt;

&lt;p&gt;One concern is that all the optimizations should be at the operator level, I mean - this should be treated as just another optimization.&lt;br/&gt;
As you mentioned in your presentation correctly, Hive does not support cost-based optimizer currently, and it will &lt;br/&gt;
require all the optimizations to be consolidated in one place to help move to that model.&lt;/p&gt;

&lt;p&gt;We are thinking about moving the group by skews also in the optimizer (instead of the current approach in&lt;br/&gt;
SemanticAnalyzer). Once all the optimizations are in a central place, it will be much easier to move to costing.&lt;/p&gt;

&lt;p&gt;The Harvey Mudd folks currently are not looking at Group By optimizations for indexing, so, this will be extremely&lt;br/&gt;
useful for the whole community.&lt;/p&gt;</comment>
                            <comment id="12927077" author="jvs" created="Mon, 1 Nov 2010 18:30:18 +0000"  >&lt;p&gt;+1 to what Namit said.  Doing the rewrites at the relational algebra Operator level (similar to the way optimizer transformations such as predicate pushdown already work) will have two big advantages:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;more general (syntax-independent)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;much easier to maintain (as you noted in your presentation, the SemanticAnalyzer data structures can be very difficult to analyze and manipulate, whereas the Operator structures are a lot cleaner)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;BTW, thanks for the very clear explanation of the work you&apos;ve done so far.&lt;/p&gt;</comment>
                            <comment id="12969186" author="pkalmegh" created="Wed, 8 Dec 2010 05:20:03 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am Prajakta from Persistent Systems Ltd. and am working on the changes that John and Namit have suggested above along with Nikhil and Prafulla.&lt;br/&gt;
This is a design note about implementation of above review comments.&lt;/p&gt;

&lt;p&gt;We&apos;re implementing the following changes as a single transformation in optimizer:&lt;br/&gt;
    (1) Table replacement: involves modification of some internal members of TableScanOperator.&lt;br/&gt;
    (2) Group by removal: involves removal of some operators (GBY-RS-GBY) where GBY is done at both mapper-reducer side; and re-setting of correct parent and child operators within the DAG.&lt;br/&gt;
    (3) Sub-query insertion: involves creation of new DAG for sub-query and attaching it to the original DAG at an appropriate place.&lt;br/&gt;
    (4) Projection modification: involves steps similar to (3).&lt;/p&gt;

&lt;p&gt;We have implemented the above changes as a proof of concept. In this implementation, we have invoked this rule as the first transformation in the optimizer code so that lineage information is computed later as part of the Generator transformation. Another reason that we have applied this as the first transformation is that, as of now, the implementation uses the query block (QB) information to decide if the transformation can be applied for the input query (similar to the canApplyThisRule() method in the original rewrite code). Finally, to make the changes (3) and (4), we are modifying the operator DAG. However, we are not modifying the original query block (QB). Hence, this leaves the QB and the operator DAG out of sync.&lt;/p&gt;

&lt;p&gt;The major issues in this implementation approach are:&lt;br/&gt;
1. The changes listed above require either modification of operator DAG (in case of 2) or creation of new operator DAG(in case of 3 and 4). The implementation requires some hacks in the SemanticAnalyzer code if we create a new DAG (as in the case of replaceViewReferenceWithDefinition() method which uses ParseDriver() to do the same). However, the methods are private (like genBodyPlan(...), genSelectPlan(...) etc) making it all the more difficult to implement changes (3) and (4) without access to these methods.&lt;br/&gt;
2. The creation of new DAG will require creating all associated data structures like QB, ASTNode etc as this information is necessary to generate DAG operator plan for the sub-queries. This approach would be very similar to what we are already doing in rewrite i.e creating new QB and ASTNode. &lt;br/&gt;
3. Since we are creating a new DAG and appending it to the enclosing query DAG, we also need to modify the row schema and row resolvers for the operators.&lt;/p&gt;

&lt;p&gt;One of the questions that underlies before finalizing the above approach is whether the cost-based optimizer, which is to be implemented in the future, will work on the query block or on the DAG operator tree. In case it works on the operator DAG, then the implementation changes we listed here are bound to be done. However, if the cost-based optimizer is to work on the query block, then we feel that the initial query rewrite engine code which worked after semantic analysis but before plan generation can be made to work with the cost-based optimizer. It will be a valuable input from your side if you could comment on the cost-based optimizer.&lt;/p&gt;
</comment>
                            <comment id="12970058" author="jvs" created="Fri, 10 Dec 2010 02:36:52 +0000"  >&lt;p&gt;I talked to Namit, and he thinks there should be no relevant dependencies on the QB once we start on optimization, so letting it get out of sync with the operator DAG may not be an issue.  (I scanned the code in optimizer, and it seems like a few dependencies have crept in, but only for special cases like ANALYZE.)&lt;/p&gt;

&lt;p&gt;For issue #1, you are proposing what I&apos;ll call the &quot;internal SQL&quot; approach, which is to construct an internal SQL expression (either in string or ASTNode form) and then partially analyze that (via SemanticAnalyzer), producing an operator DAG to be spliced into the main one.  For this approach, we would need to figure out how to make the relevant phases of SemanticAnalyzer modularized and invocable.&lt;/p&gt;

&lt;p&gt;Alternately, the &quot;direct construction&quot; approach would be to attempt to construct the new operator subgraph directly via custom code targeted to the specific patterns you generate, and then splice that in.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure which approach is better; Namit, any opinions?  The internal SQL approach definitely seems the most appropriate for the WHERE clause work being done by the Harvey Mudd team, since it produces a self-contained job to be run to produce the temp table containing the filtered block list.  But for GROUP BY, the direct construction approach may be cleaner.&lt;/p&gt;

&lt;p&gt;For issue #2, it seems like this would happen automatically for the internal SQL approach (but this could also pollute the SemanticAnalyzer state to some extent).  The direct construction approach is the opposite:  it avoids polluting SemanticAnalyzer, but still might require modularizing some SemanticAnalyzer calls, e.g. for generating and registering the necessary aliases for index tables.&lt;/p&gt;

&lt;p&gt;Regarding issue #3, that&apos;s already true for other optimizations such as projection pushdown (ColumnPruner), which modifies operator row schemas/resolvers; see for example ColumnPrunerProcFactory.pruneJoinOperator.  So there shouldn&apos;t be anything new here.&lt;/p&gt;

&lt;p&gt;Regarding the need to run your transformation first, it would be best to avoid this since a more advanced optimizer may want freedom in reordering transformations.  So instead of relying on information from the QB, analyze the relevant operator subgraph to decide whether your transformation is applicable.  This is the approach we expect to require for cost-based optimization.&lt;/p&gt;

&lt;p&gt;Also, note that from a lineage perspective, it makes more sense for lineage to be derived prior to index transformation rather than subsequently.  Someone examining the lineage associated with an ETL job would typically be more interested in the logical source table from which it pulls (rather than from a physical index).&lt;/p&gt;</comment>
                            <comment id="12970245" author="namit" created="Fri, 10 Dec 2010 17:50:41 +0000"  >&lt;p&gt;I think having a mechanism which lets is issue &quot;internal&quot; or &quot;recursive&quot; sql is better in the long term.&lt;br/&gt;
That is something we will need anyway for future optimizations.&lt;/p&gt;

&lt;p&gt;We can create a thin API around SemanticAnalyzer (analyze etc.), which is indirectly present in Driver.&lt;br/&gt;
Another implementation of that API can be the internal API, say RecursiveDriver.&lt;br/&gt;
In a recursive context, you are only allowed to invoke RecursiveDriver. &lt;br/&gt;
External Clients (CliDriver, HiveServer etc.) invoke Driver directly.&lt;/p&gt;

&lt;p&gt;As John said, definitely keep your optimizations pluggable. Currently, they are invoked as rule-based, &lt;br/&gt;
but should be flexible enough to be invoked based on some costs in the future.&lt;/p&gt;</comment>
                            <comment id="12976380" author="pkalmegh" created="Sat, 1 Jan 2011 02:35:12 +0000"  >&lt;p&gt;Thanks to both of you for your comments on our proposed design. Since the last post, we have been working on the code changes as per your comments. The progress has been in the following areas:&lt;br/&gt;
1) Removed the dependency for our optimizer to be the first one. It can now be used as any other optimizer by adding it to &quot;transformations&quot; list.&lt;br/&gt;
2) Implemented changes to re-structure the operator DAG plan for group-by queries.&lt;br/&gt;
3) We have removed the dependency of our optimization to read data from QB(query block) as it used to do earlier to check if the optimization can be applied before proceeding to apply the re-write. (See canApply() method in the original rewrite code.)&lt;br/&gt;
4) Regarding issue #3 (from my original post), as per John&apos;s suggestion, the change for modification of operator row schemas/resolvers are done smoothly wherever applicable.&lt;br/&gt;
5) We have completed testing the new implementation for simple group-by cases. Also, the code to append a sub-query to original DAG is implemented separately as of now. This needs to be integrated as part of our optimization.&lt;/p&gt;

&lt;p&gt;         The only issue that will be pending post this implementation will be regarding John&apos;s post on Nov 1st stating &quot;...we store only the distinct block offsets, not the distinct row offsets.....&quot;. We plan to work on this once the current implementation is tested end-to-end. You can expect the update on this in a couple of weeks.&lt;/p&gt;</comment>
                            <comment id="12976882" author="jvs" created="Mon, 3 Jan 2011 19:02:34 +0000"  >&lt;p&gt;Thanks Prajakta.  Let us know once you have new code ready to review.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1644&quot; title=&quot;use filter pushdown for automatically accessing indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1644&quot;&gt;&lt;del&gt;HIVE-1644&lt;/del&gt;&lt;/a&gt; is going to need the internal SQL support too, so I&apos;d like to make sure that as much as possible is reusable there.&lt;/p&gt;</comment>
                            <comment id="12982999" author="jvs" created="Tue, 18 Jan 2011 04:26:55 +0000"  >&lt;p&gt;Is there an updated tree for this?  I checked github but didn&apos;t see it.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1644&quot; title=&quot;use filter pushdown for automatically accessing indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1644&quot;&gt;&lt;del&gt;HIVE-1644&lt;/del&gt;&lt;/a&gt; needs support for compiling internally-generated SQL into operators, so if you have that working, I&apos;d like to point the Harvey Mudd folks at it when I talk to them tomorrow.&lt;/p&gt;</comment>
                            <comment id="12983184" author="pkalmegh" created="Tue, 18 Jan 2011 13:31:26 +0000"  >&lt;p&gt;Hey John,&lt;/p&gt;

&lt;p&gt;We are maintaining the latest code in github on &apos;prj&apos; branch. You can access it here:&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://github.com/prafullat/hive/tree/prj&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/prafullat/hive/tree/prj&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;We have created a &apos;RewriteParseContextGenerator&apos; class in the org.apache.hadoop.hive.ql.optimizer package to return a ParseContext instance (which contains all the information on the operator tree) when given a string command (query) as input. Since we only need the operator tree for our execution, we have created this basic utility class for our code.&lt;/p&gt;

&lt;p&gt;Rest of the code is being internally reviewed by the team right now. We are expecting it to be completed by end of this week. We will update you once the code is ready for your review.&lt;/p&gt;</comment>
                            <comment id="12989983" author="pkalmegh" created="Thu, 3 Feb 2011 06:30:21 +0000"  >&lt;p&gt;Hi John,&lt;/p&gt;

&lt;p&gt;We have the code ready for review. You can view it at &amp;lt;&lt;a href=&quot;https://github.com/prafullat/hive/tree/prj&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/prafullat/hive/tree/prj&lt;/a&gt;&amp;gt;.&lt;br/&gt;
Please find attached the diff &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.1.patch&apos; for the changes. We have taken the diff from the github hive repo &amp;lt;&lt;a href=&quot;https://github.com/apache/hive.git&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hive.git&lt;/a&gt;&amp;gt; on 30th Jan 2011. The last commit on github apache/hive before we took a diff was &amp;lt;&lt;a href=&quot;https://github.com/apache/hive/commit/2cbbccc5fa9fe3bd9b0569021831f745fa1d4a06&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hive/commit/2cbbccc5fa9fe3bd9b0569021831f745fa1d4a06&lt;/a&gt;&amp;gt;.&lt;/p&gt;

&lt;p&gt;Rewrite needs to be enabled explicitly by setting the &apos;hive.optimize.gbyusingindex&apos; flag to true as done in &apos;ql_rewrite_gbtoidx.q&apos; test case. We have added the &apos;ql_rewrite_gbtoidx.q&apos; file in  ql/src/test/queries/clientpositive.&lt;/p&gt;</comment>
                            <comment id="12989984" author="pkalmegh" created="Thu, 3 Feb 2011 06:31:32 +0000"  >&lt;p&gt;Changes on branch prj.&lt;/p&gt;</comment>
                            <comment id="12990418" author="jvs" created="Fri, 4 Feb 2011 00:46:19 +0000"  >&lt;p&gt;I&apos;ve created a review board request but have not added any comments yet:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/392/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/392/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The patch required -p1 instead of -p0 to apply.  For the next patch, please make sure&lt;/p&gt;

&lt;p&gt;patch -p0 &amp;lt; patchfile&lt;/p&gt;

&lt;p&gt;applies cleanly.&lt;/p&gt;</comment>
                            <comment id="12990466" author="pkalmegh" created="Fri, 4 Feb 2011 06:32:57 +0000"  >&lt;p&gt;Thanks John. We will ensure that henceforth. &lt;/p&gt;</comment>
                            <comment id="12993742" author="jvs" created="Fri, 11 Feb 2011 22:44:22 +0000"  >&lt;p&gt;Taking a closer look at this one now.&lt;/p&gt;</comment>
                            <comment id="12993803" author="jvs" created="Sat, 12 Feb 2011 02:25:46 +0000"  >&lt;p&gt;I&apos;m buffering up a bunch of comments in review board, but won&apos;t publish for a while since it&apos;ll take me some time to go through all the code.  Looks good so far.&lt;/p&gt;
</comment>
                            <comment id="12993879" author="pkalmegh" created="Sat, 12 Feb 2011 10:52:38 +0000"  >&lt;p&gt;Thanks for the update John.&lt;/p&gt;</comment>
                            <comment id="12995613" author="jvs" created="Thu, 17 Feb 2011 00:40:57 +0000"  >&lt;p&gt;Note:  I pointed the Harvey Mudd team over to your branch, so they&apos;re copying bits and pieces of necessary support into their patch.  Once they&apos;re a little further along, we can figure out how to reconcile the two before commit.&lt;/p&gt;</comment>
                            <comment id="12998353" author="pkalmegh" created="Wed, 23 Feb 2011 12:52:08 +0000"  >&lt;p&gt;Hi John,&lt;/p&gt;

&lt;p&gt;Can you please let us know the status of the review of this patch? &lt;/p&gt;</comment>
                            <comment id="12998619" author="jvs" created="Wed, 23 Feb 2011 23:53:58 +0000"  >&lt;p&gt;Hi Prajakta,&lt;/p&gt;

&lt;p&gt;I got caught up with some other work; I&apos;ll try to publish my comments before next week.&lt;/p&gt;</comment>
                            <comment id="12998659" author="pkalmegh" created="Thu, 24 Feb 2011 01:45:15 +0000"  >&lt;p&gt;Thanks John.&lt;/p&gt;</comment>
                            <comment id="13000062" author="jvs" created="Sun, 27 Feb 2011 23:50:24 +0000"  >&lt;p&gt;First round of review comments are here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/392/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/392/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After those are resolved, and patch is rebased, I&apos;ll ask Namit and Yongqiang to take a look to see if they can find ways to simplify any of the rewrite logic.&lt;/p&gt;</comment>
                            <comment id="13000144" author="pkalmegh" created="Mon, 28 Feb 2011 06:57:09 +0000"  >&lt;p&gt;Hi John, &lt;/p&gt;

&lt;p&gt;Thanks for the review comments. I have posted my replies on some of your questions. For the others, we will make the required changes in the code and upload a new patch. &lt;/p&gt;</comment>
                            <comment id="13000145" author="pkalmegh" created="Mon, 28 Feb 2011 06:58:16 +0000"  >&lt;p&gt;We are currently working on implementing a new index type to get a correct COUNT for group-by queries that are re-written to use index table instead of base table. We have three implementation options as listed below:&lt;/p&gt;

&lt;p&gt;1. Create a new index handler called &apos;AggregationIndexHandler&apos; which pre-computes the count on indexed columns&lt;br/&gt;
        In this appraoch, we plan to implement a new index type that stores the COUNT of the indexed column per index entry as suggested by John in November 1st 2010&apos;s comment. The &apos;AggregationIndexHandler&apos; will override the default implementation for &apos;analyzeIndexDefinition(...)&apos; and &apos;generateIndexBuildTaskList(...)&apos; methods. The &apos;analyzeIndexDefinition(...)&apos; method implementation will add a FieldSchema object for COUNT rather than &apos;offsets&apos; in the StorageDescriptor for the index table. The &apos;generateIndexBuildTaskList(...)&apos; method will be the same but there will be a change in the implementation of the &apos;getIndexBuilderMapRedTask(...)&apos; method which is invoked within this method. &lt;/p&gt;

&lt;p&gt;Currently, for the index rebuild on the following index creation, &lt;/p&gt;

&lt;p&gt;CREATE INDEX lineitem_lshipdate_idx ON TABLE lineitem(l_shipdate) AS &apos;org.apache.hadoop.hive.ql.index.compact.CompactIndexHandler&apos; WITH DEFERRED REBUILD;&lt;br/&gt;
ALTER INDEX lineitem_lshipdate_idx ON lineitem REBUILD;&lt;/p&gt;

&lt;p&gt;the &apos;getIndexBuilderMapRedTask(...)&apos; method creates a command &apos;INSERT OVERWRITE TABLE `default_&lt;em&gt;lineitem_lineitem_lshipdate_idx&lt;/em&gt;&lt;em&gt;` SELECT `l_shipdate`,INPUT&lt;/em&gt;&lt;em&gt;FILE&lt;/em&gt;&lt;em&gt;NAME, collect_set (BLOCK&lt;/em&gt;&lt;em&gt;OFFSET&lt;/em&gt;&lt;em&gt;INSIDE&lt;/em&gt;&lt;em&gt;FILE)  FROM `lineitem` GROUP BY `l_shipdate`, INPUT&lt;/em&gt;&lt;em&gt;FILE&lt;/em&gt;_NAME&apos; in the CompactIndexHandler. This command is later passed to the driver to compile and rebuild the index which collects data from base table and stores it in index table.&lt;/p&gt;

&lt;p&gt;With the &apos;AggregationIndexHandler&apos;, we plan to create a command like &apos; INSERT OVERWRITE TABLE `default_&lt;em&gt;lineitem_lineitem_lshipdate_idx&lt;/em&gt;&lt;em&gt;` SELECT `l_shipdate`,INPUT&lt;/em&gt;&lt;em&gt;FILE&lt;/em&gt;&lt;em&gt;NAME, COUNT(`l_shipdate`) FROM `lineitem`  GROUP BY `l_shipdate`, INPUT&lt;/em&gt;&lt;em&gt;FILE&lt;/em&gt;_NAME&apos; which will count the number of unique indexed column entries.&lt;/p&gt;

&lt;p&gt;        In the current implementation of our optimizer, we are doing a &apos;size(_offsets)&apos; to replace the COUNT in group-by queries. We need to change this implementation if we use the AggregationIndexHandler. This will still give a comparable performance improvement on the original queries that will, otherwise, scan full tables for a COUNT of the indexed columns. &lt;br/&gt;
Note: We plan to go ahead with creating a new HiveIndexHandler type rather than changing the implementation of the CompactIndexHandler to let in some flexibility in the use of AggregationIndexHandler only for cases where it is required. &lt;/p&gt;

&lt;p&gt;2. Implement a &apos;CompactRowIndexHandler&apos; similar to &apos;CompactIndexHandler&apos; but it stores the ROW_OFFSET_INSIDE_FILE instead of BLOCK_OFFSET_INSIDE_FILE&lt;br/&gt;
        We create a new index handler called &apos;CompactRowIndexHandler&apos;. This will give us a ROW_OFFSET_INSIDE_FILE array&amp;lt;bigint&amp;gt; and we can compute the COUNT for group-by queries by doing a s&apos;ize(ROW_OFFSET_INSIDE_FILE)&apos; on it.  The command will look like,&lt;/p&gt;

&lt;p&gt;&apos; INSERT OVERWRITE TABLE `default_&lt;em&gt;lineitem_lineitem_lshipdate_idx&lt;/em&gt;&lt;em&gt;` SELECT `l_shipdate`,INPUT&lt;/em&gt;&lt;em&gt;FILE&lt;/em&gt;&lt;em&gt;NAME, collect_set (ROW_OFFSET_INSIDE_FILE) FROM `lineitem`  GROUP BY `l_shipdate`, INPUT&lt;/em&gt;&lt;em&gt;FILE&lt;/em&gt;_NAME&apos; which will give us an array of all row offsets in the input file grouped by indexed column.&lt;/p&gt;

&lt;p&gt;We had a look at the &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1803&quot; title=&quot;Implement bitmap indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1803&quot;&gt;&lt;del&gt;HIVE-1803&lt;/del&gt;&lt;/a&gt; patch. If we re-use the implementation changes done in Hive1803 to classes HiveContextAwareRecordReader.java, IOContext.java, VirtualColumn.java and MapOperator.java, we can implement &apos;CompactRowIndexHandler.java&apos; to support the above index type.&lt;/p&gt;

&lt;p&gt;3. Use BitMapIndexHandler without creating a new index handler&lt;br/&gt;
        Another approach is to use the Hive1803 BitMapIndexHandler to get a count of all those bits in the bitmap array for which the row_offset is ON. This will indeed give us a correct count for all the rows that contain the indexed column. However, we will have multiple counts per block entry. For this, we may need to do the SUM again to get a correct count per indexed column entry. Although this is do-able, it will be somewhat complex to implement.&lt;/p&gt;

&lt;p&gt;Please let us know what you think of the proposed solutions. If you have a better implementation approach in mind, please do share it with us. &lt;/p&gt;</comment>
                            <comment id="13000490" author="jvs" created="Mon, 28 Feb 2011 19:50:06 +0000"  >&lt;p&gt;I&apos;d like to propose a fourth option instead:  create a new handler type which stores both the count and the offsets together, so that it can be used for both aggregation and filtering.  The index build can still be done with a single GROUP BY, but now with three aggregate expressions in the SELECT list:  collect_set (BLOCKOFFSETINSIDEFILE), COUNT(`l_shipdate`), COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.  For a column known to be NOT NULL, just COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; is good enough, but Hive doesn&apos;t currently have that metadata.  You could also use IDXPROPERTIES to allow for additional expressions (SUM/MAX/MIN, complex expressions, etc), making these start to look more like materialized aggregate views.&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1803&quot; title=&quot;Implement bitmap indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1803&quot;&gt;&lt;del&gt;HIVE-1803&lt;/del&gt;&lt;/a&gt;, they are working on factoring out some of the generic parts of compact index handler for reuse; we should depend on that for the aggregate index handler to avoid duplicating code.&lt;/p&gt;</comment>
                            <comment id="13002015" author="pkalmegh" created="Thu, 3 Mar 2011 15:15:05 +0000"  >&lt;p&gt;Patch version 2 - includes changes for review comments from John.&lt;/p&gt;</comment>
                            <comment id="13002017" author="pkalmegh" created="Thu, 3 Mar 2011 15:19:55 +0000"  >&lt;p&gt;Hi John&lt;/p&gt;

&lt;p&gt;We have made all the changes as suggested by you except for making the code pluggable (so that the rewrite expression changes depending on which index handler is used). We will submit this change along with the patch for new index type. &lt;/p&gt;

&lt;p&gt;We have started working on the new index type creation as per your suggestion and will let you know once that is complete. &lt;/p&gt;</comment>
                            <comment id="13002119" author="pkalmegh" created="Thu, 3 Mar 2011 18:11:46 +0000"  >&lt;p&gt;Patch version 2 - includes changes for review comments from John. Re-attaching the appropriate file.&lt;/p&gt;</comment>
                            <comment id="13005044" author="pkalmegh" created="Thu, 10 Mar 2011 12:16:03 +0000"  >&lt;p&gt;Patch with new index type support and optimizer code that uses the new index type.&lt;/p&gt;</comment>
                            <comment id="13005045" author="pkalmegh" created="Thu, 10 Mar 2011 12:19:21 +0000"  >&lt;p&gt;Hi John&lt;/p&gt;

&lt;p&gt;Please find attached the patch with new index type support. We have also made changes to the our optimizer code to use count of indexed columns from this new index type (instead of computing the size(_offsets)). Can you please upload it for review on ReviewBoard?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13005461" author="jvs" created="Fri, 11 Mar 2011 02:43:10 +0000"  >&lt;p&gt;Hi Prajakta,&lt;/p&gt;

&lt;p&gt;Review Board is self-service...you can create yourself an account and then follow the steps here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/hadoop/Hive/HowToContribute#Review_Process&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hive/HowToContribute#Review_Process&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13006321" author="pkalmegh" created="Mon, 14 Mar 2011 03:02:20 +0000"  >&lt;p&gt;Hi John&lt;/p&gt;

&lt;p&gt;Thanks for the link. We have created a new Review Board entry: &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/505/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/505/&lt;/a&gt;&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13008235" author="jvs" created="Fri, 18 Mar 2011 00:06:10 +0000"  >&lt;p&gt;I added a few review board comments; there are a lot of places where the exception handling is still wrong; I didn&apos;t comment on all of those but they need to be fixed.&lt;/p&gt;

&lt;p&gt;We still need to reconcile with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1803&quot; title=&quot;Implement bitmap indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1803&quot;&gt;&lt;del&gt;HIVE-1803&lt;/del&gt;&lt;/a&gt;, but I&apos;ll ask Namit and Yongqiang to take a look now to get their comments on the rewrite implementation.&lt;/p&gt;</comment>
                            <comment id="13033254" author="jvs" created="Fri, 13 May 2011 20:12:18 +0000"  >&lt;p&gt;Need a rebase now that the refactoring from &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1803&quot; title=&quot;Implement bitmap indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1803&quot;&gt;&lt;del&gt;HIVE-1803&lt;/del&gt;&lt;/a&gt; has been committed.&lt;/p&gt;</comment>
                            <comment id="13033906" author="pkalmegh" created="Mon, 16 May 2011 08:06:19 +0000"  >&lt;p&gt;Thanks John. Please let us know how to proceed on this. We are taking a look at the &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1803&quot; title=&quot;Implement bitmap indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1803&quot;&gt;&lt;del&gt;HIVE-1803&lt;/del&gt;&lt;/a&gt; changes in the meanwhile.&lt;/p&gt;</comment>
                            <comment id="13034181" author="jvs" created="Mon, 16 May 2011 18:33:13 +0000"  >&lt;p&gt;For the rebasing, you&apos;ll need to make your new handlers work with the refactored base classes.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1803&quot; title=&quot;Implement bitmap indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1803&quot;&gt;&lt;del&gt;HIVE-1803&lt;/del&gt;&lt;/a&gt; copied some of your refactoring and took it further.&lt;/p&gt;

&lt;p&gt;I&apos;m going to ping Yongqiang again.&lt;/p&gt;</comment>
                            <comment id="13034207" author="jvs" created="Mon, 16 May 2011 19:10:52 +0000"  >&lt;p&gt;Scheduled a meeting this Friday to take a look at this with some other FB folks and get you more feedback.&lt;/p&gt;</comment>
                            <comment id="13034533" author="pkalmegh" created="Tue, 17 May 2011 03:57:10 +0000"  >&lt;p&gt;That would be great. Thanks.&lt;/p&gt;</comment>
                            <comment id="13038104" author="jvs" created="Mon, 23 May 2011 18:14:20 +0000"  >&lt;p&gt;I collected comments from last week&apos;s review meeting below.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The rewrite needs to check to make sure that the index partitions are available (matching the referenced table partitions).  You can take a look at the way the Harvey Mudd team handles this, and maybe reuse their code.  This implies that predicate pushdown and partition pruning need to happen BEFORE the rewrite is applied (currently the rewrite happens before them).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Isn&apos;t it a bug that the GROUP BY is removed in some cases?  The index may store multiple rows for the same base table key (since FILENAME is part of the index table key), so it seems like a GROUP BY should always be required for removing those duplicates.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Where is _countall used instead of _countkey?  Also, what happens if the index is compound (multiple columns in its key)?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Add a test case for a query in which a table scan is reused in a directed acyclic graph, e.g. a UNION where one branch of the union does a rewritable GROUP BY on the table and the other branch just reads the table directly.  We want to make sure that in this case, the rewrite&apos;s replacement of the base table in one branch does not corrupt the other branch in any way.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;After these have been addressed (along with the existing review board comments) and you&apos;ve had a chance to rebase the patch, we&apos;ll do another pass.&lt;/p&gt;

&lt;p&gt;Thanks again!&lt;/p&gt;</comment>
                            <comment id="13038958" author="pkalmegh" created="Wed, 25 May 2011 04:56:23 +0000"  >&lt;p&gt;Thanks John. Our team here is working on it. I will let you know once the new patch is ready.&lt;/p&gt;</comment>
                            <comment id="13071130" author="jiraposter@reviews.apache.org" created="Tue, 26 Jul 2011 14:45:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b46976f &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java 2ca63b3 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java 77a6dc6 &lt;br/&gt;
  ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Prajakta&lt;/p&gt;
</comment>
                            <comment id="13071134" author="pkalmegh" created="Tue, 26 Jul 2011 14:52:27 +0000"  >&lt;p&gt;Review Changes done after last review. Added new functionality (See post for more details)&lt;/p&gt;</comment>
                            <comment id="13071135" author="pkalmegh" created="Tue, 26 Jul 2011 14:53:07 +0000"  >&lt;p&gt;Hi John&lt;/p&gt;

&lt;p&gt;Please find attached the latest patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.4.patch):&lt;br/&gt;
The patch contains:&lt;br/&gt;
1. Support for multiple aggregates in index creation using the AggregateIndexHandler. The column names for the index schema are constructed dynamically depending on the aggregates. &lt;br/&gt;
For &apos;aggregateFunction(columnName)&apos;, the column name in index will be `_aggregateFunction_of_columnName`. &lt;br/&gt;
For example, for count(l_shipdate), the column name will be `_count_of_l_shipdate)`.&lt;br/&gt;
For &apos;count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&apos; function, the column name will be `_count_of_all`.&lt;/p&gt;

&lt;p&gt;2. Fixed the bug for duplicates in Group-by removal cases. We are not removing group-by in any case now. This has made the logic for query rewrites quite simpler than before. &lt;br/&gt;
We removed 4 classes (RewriteIndexSubqueryCtx.java, RewriteIndexSubqueryProcFactory.java, RewriteRemoveGroupbyCtx.java, RewriteRemoveGroupbyProcFactory.java) from the previous patch  and added two new simpler classes instead (RewriteQueryUsingAggregateIndex.java, RewriteQueryUsingAggregateIndexCtx.java). &lt;/p&gt;

&lt;p&gt;3. Added a new query (with &apos;UNION ALL&apos;) in the same ql_rewrite_gbtoidx.q file to demonstrate your requirement in last post. Please  note that the query is not a valid real-work use case scenario; but still suffices our purpose to see that one branch rewrite does not corrupt the other branch.&lt;/p&gt;

&lt;p&gt;4. Rewrite Optimization now happens after the PredicatePushdown, PartitionPruner and PartitionConditionRemover.&lt;/p&gt;

&lt;p&gt;This patch does not contain:&lt;br/&gt;
1. Optimization for cases with mulitple aggregates in selection&lt;br/&gt;
2. Optimization for any other aggregate function apart from count&lt;br/&gt;
3. Optimization for queries involving multiple tables (even if they are in a different branch). Since we are not optimizing for case of joins, the constraint also filters out queries which have different tables in union queries.&lt;br/&gt;
4. Optimizations for index with multiple columns in its key&lt;/p&gt;

&lt;p&gt;Here is the review board link for the patch &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&amp;gt;.&lt;/p&gt;

&lt;p&gt;Please let me know if you have any questions.&lt;/p&gt;</comment>
                            <comment id="13072550" author="jiraposter@reviews.apache.org" created="Thu, 28 Jul 2011 21:42:10 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/#review1212&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#review1212&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2711&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2711&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please run ant checkstyle and fix all the formatting discrepancies it reports for your new files.&lt;/p&gt;




&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2695&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2695&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Don&apos;t you need to reuse the compact implementation here so that the index can be used for WHERE (not just GROUP BY)?&lt;/p&gt;




&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2696&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2696&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This method is redundant now.&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2698&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2698&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I can&apos;t think of a case where it would be worse.&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2699&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2699&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Actually group-by is now preserved in all cases.&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2700&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2700&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please use HTML bullet syntax for Javadoc (otherwise it all gets run together into one line when rendered).&lt;/p&gt;




&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2701&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2701&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    indentation&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2703&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2703&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Shouldn&apos;t this be BIGINT?&lt;/p&gt;

&lt;p&gt;    Also, I think you&apos;re supposed to use a TypeInfoFactory for this purpose.&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2702&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2702&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    indentation&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2704&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2704&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    typo:  Repace&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2707&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2707&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Not sure why this new constructor is needed...after using it, all you do is get the table out of it.&lt;/p&gt;



&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2709&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2709&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This should &lt;b&gt;not&lt;/b&gt; be using the index, since the index is built on count(l_shipdate), and l_shipdate may contain nulls, whereas the query is referencing count(1), which is insensitive to nulls.&lt;/p&gt;



&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2710&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2710&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Need additional tests to verify all the cases where the optimization should &lt;b&gt;not&lt;/b&gt; be used:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;when configuration disables it&lt;/li&gt;
	&lt;li&gt;when index partitions do not cover table partitions (I still don&apos;t see the code for this case)&lt;/li&gt;
	&lt;li&gt;... all the other conditions checked for in the code ...&lt;/li&gt;
&lt;/ul&gt;




&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-07-26 14:44:01, Prajakta Kalmegh wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-26 14:44:01)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b46976f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java 2ca63b3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java 77a6dc6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Prajakta&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13073604" author="jiraposter@reviews.apache.org" created="Mon, 1 Aug 2011 16:44:10 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java, line 61&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27052#file27052line61&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27052#file27052line61&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Please run ant checkstyle and fix all the formatting discrepancies it reports for your new files.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done! The code is still having checkstyle formatting errors only for places where we have used LinkedHashMap, HashMap and ArrayList. The error states &quot;Declaring variables, return values or parameters of type &apos;HashMap&apos; is not allowed&quot;.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java, line 184&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27052#file27052line184&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27052#file27052line184&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Don&apos;t you need to reuse the compact implementation here so that the index can be used for WHERE (not just GROUP BY)?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The AggregateIndexHandler now extends from CompactIndexHandler instead of TableBasedIndexHandler. We override only analyzeIndexDefinition(...) and getIndexBuilderMapRedTask(...) methods from CompactIndexHandler.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java, line 700&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27054#file27054line700&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27054#file27054line700&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This method is redundant now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Removed. Sorry to have missed that.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java, line 252&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27056#file27056line252&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27056#file27056line252&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I can&apos;t think of a case where it would be worse.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java, line 164&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27057#file27057line164&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27057#file27057line164&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Actually group-by is now preserved in all cases.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Forgot to change a few comments after fixing the bug. Done!&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java, line 66&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27058#file27058line66&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27058#file27058line66&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Please use HTML bullet syntax for Javadoc (otherwise it all gets run together into one line when rendered).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done!&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java, line 93&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27060#file27060line93&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27060#file27060line93&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Shouldn&apos;t this be BIGINT?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Also, I think you&apos;re supposed to use a TypeInfoFactory for this purpose.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. Changed it to bigint. Also changed it in AggregateIndexHandler where I had declared the type to be &quot;int&quot;.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java, line 603&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27062#file27062line603&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27062#file27062line603&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Not sure why this new constructor is needed...after using it, all you do is get the table out of it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The only other constructor option for tableSpec needs the ASTNode as one of its parameters. Since we need to construct a new tableSpec using only the index table name, and we do not have a ASTNode for this, I need this constructor. If you have any other way in mind, please let me know. That would be helpful.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q, line 27&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27063#file27063line27&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27063#file27063line27&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This should &lt;b&gt;not&lt;/b&gt; be using the index, since the index is built on count(l_shipdate), and l_shipdate may contain nulls, whereas the query is referencing count(1), which is insensitive to nulls.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes true. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I have now changed the count(1) queries with count(l_shipdate) in ql_rewrite_gbtoidx.q file. Also, verified that the count(1) queries are not using the index.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q, line 61&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27063#file27063line61&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27063#file27063line61&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Need additional tests to verify all the cases where the optimization should &lt;b&gt;not&lt;/b&gt; be used:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     * when configuration disables it&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     * when index partitions do not cover table partitions (I still don&apos;t see the code for this case)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     * ... all the other conditions checked for in the code ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Added new queries to verify that optimization is not used in case of:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;when configuration disables it&lt;/li&gt;
	&lt;li&gt;... all the other conditions checked for in the code ...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;About &quot;* when index partitions do not cover table partitions &quot;, still pending (also the code for it). I will upload the new patch once this is done.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Prajakta&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/#review1212&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#review1212&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-07-26 14:44:01, Prajakta Kalmegh wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-26 14:44:01)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b46976f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java 2ca63b3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java 77a6dc6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Prajakta&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13075964" author="jiraposter@reviews.apache.org" created="Mon, 1 Aug 2011 23:52:27 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java, line 61&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27052#file27052line61&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27052#file27052line61&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Please run ant checkstyle and fix all the formatting discrepancies it reports for your new files.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Prajakta Kalmegh wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done! The code is still having checkstyle formatting errors only for places where we have used LinkedHashMap, HashMap and ArrayList. The error states &quot;Declaring variables, return values or parameters of type &apos;HashMap&apos; is not allowed&quot;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Best practice is to only use interfaces (Map/List) except at the point of instantiation where you select a concrete class.  Hive violates this in a number of places, and sometimes that forces you to violate it in new code too; but otherwise, please follow this one.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-28 21:40:30, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java, line 603&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/1/?file=27062#file27062line603&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/1/?file=27062#file27062line603&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Not sure why this new constructor is needed...after using it, all you do is get the table out of it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Prajakta Kalmegh wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The only other constructor option for tableSpec needs the ASTNode as one of its parameters. Since we need to construct a new tableSpec using only the index table name, and we do not have a ASTNode for this, I need this constructor. If you have any other way in mind, please let me know. That would be helpful.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m asking why you even need to construct a new tableSpec instance.  All you do with it is reference ts.tableHandle.  And to create that tableHandle, you can just do db.getTable(tableName).  So I don&apos;t see the purpose of the tableSpec instance.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/#review1212&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#review1212&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-07-26 14:44:01, Prajakta Kalmegh wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-26 14:44:01)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b46976f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java 2ca63b3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java 77a6dc6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Prajakta&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13078686" author="pkalmegh" created="Wed, 3 Aug 2011 10:29:43 +0000"  >&lt;p&gt;Changes after comments on Reviewboard &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13078687" author="jiraposter@reviews.apache.org" created="Wed, 3 Aug 2011 10:32:27 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-03 10:31:42.024369)&lt;/p&gt;


&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated the patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.5.patch with changes for review comments for patch 4.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b46976f &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java a57f9cf &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/IndexUtils.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java 8295687 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereTaskDispatcher.java 699519b &lt;br/&gt;
  ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Prajakta&lt;/p&gt;
</comment>
                            <comment id="13080235" author="jiraposter@reviews.apache.org" created="Fri, 5 Aug 2011 21:20:27 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/#review1303&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#review1303&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2955&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2955&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can&apos;t you just look up &quot;AGGREGATES&quot; in the map?&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2953&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2953&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Add a helper method to avoid duplicating the code in the else block below.&lt;/p&gt;




&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2954&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2954&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can&apos;t you just look up &quot;AGGREGATES&quot; in the map?&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2956&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2956&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    See recent changes in corresponding CompactIndexHandler code for HIVEOPTINDEXFILTER; need the same here (or better, factor out common code here and elsewhere).&lt;/p&gt;

&lt;p&gt;    On a related note, you may be able to use the same technique instead of isQueryInsertToTable; this would be preferable since it&apos;s nice to be able to use the index rewrite in cases where it&apos;s a normal INSERT table with index being used for GROUP BY on SELECT from some other table.&lt;/p&gt;




&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/IndexUtils.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2957&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    @params here don&apos;t match actual params&lt;/p&gt;



&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2958&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2958&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Shouldn&apos;t this be the same as COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;?&lt;/p&gt;




&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2980&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Besides EXPLAIN, you should include a few queries against a non-empty table verifying that you get the correct results both with and without the optimization applied.  Remember to include an ORDER BY for test determinism.&lt;/p&gt;




&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/#comment2978&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#comment2978&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Isn&apos;t this set redundant?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;John&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-08-03 10:31:42, Prajakta Kalmegh wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-03 10:31:42)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b46976f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java a57f9cf &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/IndexUtils.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java 8295687 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereTaskDispatcher.java 699519b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Prajakta&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13080236" author="jvs" created="Fri, 5 Aug 2011 21:21:34 +0000"  >&lt;p&gt;Added some comments on Review Board.  Thanks for carrying this one all the way through such a long review process; let&apos;s see if we can get this one committed before it turns one year old &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13098986" author="jiraposter@reviews.apache.org" created="Wed, 7 Sep 2011 14:31:09 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-08-05 21:20:21, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java, line 172&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/2/?file=30443#file30443line172&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/2/?file=30443#file30443line172&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     See recent changes in corresponding CompactIndexHandler code for HIVEOPTINDEXFILTER; need the same here (or better, factor out common code here and elsewhere).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     On a related note, you may be able to use the same technique instead of isQueryInsertToTable; this would be preferable since it&apos;s nice to be able to use the index rewrite in cases where it&apos;s a normal INSERT table with index being used for GROUP BY on SELECT from some other table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have factored out the common code in all Index handler classes and placed it in IndexUtils file. &lt;/p&gt;

&lt;p&gt;I also removed the code for &quot;isQueryInsertToTable&quot; and am setting the HIVEOPTINDEXFILTER to false instead. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-08-05 21:20:21, John Sichi wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java, line 153&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1194/diff/2/?file=30449#file30449line153&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff/2/?file=30449#file30449line153&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Shouldn&apos;t this be the same as COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes it is. I missed to change this part from the previous code.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Prajakta&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/#review1303&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/#review1303&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-08-03 10:31:42, Prajakta Kalmegh wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-03 10:31:42)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b46976f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java a57f9cf &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/IndexUtils.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java 8295687 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereTaskDispatcher.java 699519b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Prajakta&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13100839" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 01:16:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-09-09 01:14:16.218940)&lt;/p&gt;


&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;br/&gt;
  ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereTaskDispatcher.java 699519b &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java dcdfb9e &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 66ee0be &lt;br/&gt;
  data/files/lineitem.txt PRE-CREATION &lt;br/&gt;
  data/files/tbl.txt PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java 5053576 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java 7a00c00 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java bec8787 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/IndexUtils.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Prajakta&lt;/p&gt;
</comment>
                            <comment id="13101606" author="jvs" created="Fri, 9 Sep 2011 22:24:20 +0000"  >&lt;p&gt;Looks great.  One last change:  for all the SELECT queries in the .q file, can you add an ORDER BY on a full key for test determinism.&lt;/p&gt;</comment>
                            <comment id="13102149" author="jiraposter@reviews.apache.org" created="Sat, 10 Sep 2011 21:11:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-09-10 21:10:06.178279)&lt;/p&gt;


&lt;p&gt;Review request for hive and John Sichi.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added order-by to queries for test determinism.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch has defined a new AggregateIndexHandler which is used to optimize the query plan for groupby queries. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1694&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 66ee0be &lt;br/&gt;
  data/files/lineitem.txt PRE-CREATION &lt;br/&gt;
  data/files/tbl.txt PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java 591c9ff &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java 5053576 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java 7a00c00 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java bec8787 &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/IndexUtils.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java 590d69a &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java PRE-CREATION &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java dcdfb9e &lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereTaskDispatcher.java 699519b &lt;br/&gt;
  ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1194/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1194/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Prajakta&lt;/p&gt;
</comment>
                            <comment id="13102988" author="jvs" created="Mon, 12 Sep 2011 20:09:26 +0000"  >&lt;p&gt;Prajakta, can you re-attach your latest patch granting rights to ASF (so the feather shows up next to the attachment), and then click the Submit Patch button?&lt;/p&gt;</comment>
                            <comment id="13103006" author="pkalmegh" created="Mon, 12 Sep 2011 20:25:07 +0000"  >&lt;p&gt;Accelerate group-by queries using aggregate index.&lt;/p&gt;</comment>
                            <comment id="13103013" author="jvs" created="Mon, 12 Sep 2011 20:30:20 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="13103280" author="jvs" created="Tue, 13 Sep 2011 02:21:21 +0000"  >&lt;p&gt;Committed to trunk.  Thanks Prajakta!&lt;/p&gt;</comment>
                            <comment id="13103427" author="hudson" created="Tue, 13 Sep 2011 07:40:25 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #949 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/949/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/949/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1694&quot; title=&quot;Accelerate GROUP BY execution using indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1694&quot;&gt;&lt;del&gt;HIVE-1694&lt;/del&gt;&lt;/a&gt;. Accelerate GROUP BY execution using indexes&lt;br/&gt;
(Prajakta Kalmegh via jvs)&lt;/p&gt;

&lt;p&gt;jvs : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170007&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1170007&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/data/files/lineitem.txt&lt;/li&gt;
	&lt;li&gt;/hive/trunk/data/files/tbl.txt&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/AggregateIndexHandler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndex.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/bitmap/BitmapIndexHandler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/compact/CompactIndexHandler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/IndexUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/index&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteCanApplyProcFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteGBUsingIndex.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteParseContextGenerator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndex.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/index/RewriteQueryUsingAggregateIndexCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereProcessor.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/index/IndexWhereTaskDispatcher.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/ql_rewrite_gbtoidx.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13961262" author="lefty@hortonworks.com" created="Sat, 5 Apr 2014 22:16:52 +0000"  >&lt;p&gt;This added the &lt;b&gt;hive.optimize.index.groupby&lt;/b&gt; configuration property in Hive 0.8.1 (branch08r2).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12422895">HIVE-417</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12480471">HIVE-1803</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12470111" name="HIVE-1694.1.patch.txt" size="265067" author="pkalmegh" created="Thu, 3 Feb 2011 06:31:32 +0000"/>
                            <attachment id="12472576" name="HIVE-1694.2.patch.txt" size="261586" author="pkalmegh" created="Thu, 3 Mar 2011 18:11:46 +0000"/>
                            <attachment id="12473258" name="HIVE-1694.3.patch.txt" size="288092" author="pkalmegh" created="Thu, 10 Mar 2011 12:16:03 +0000"/>
                            <attachment id="12487843" name="HIVE-1694.4.patch" size="117231" author="pkalmegh" created="Tue, 26 Jul 2011 14:52:27 +0000"/>
                            <attachment id="12489180" name="HIVE-1694.5.patch" size="274625" author="pkalmegh" created="Wed, 3 Aug 2011 10:29:43 +0000"/>
                            <attachment id="12493710" name="HIVE-1694.6.patch" size="371508" author="pkalmegh" created="Fri, 9 Sep 2011 01:22:44 +0000"/>
                            <attachment id="12494110" name="HIVE-1694.7.patch" size="377860" author="pkalmegh" created="Mon, 12 Sep 2011 20:14:55 +0000"/>
                            <attachment id="12493927" name="HIVE-1694.7.patch" size="377860" author="pkalmegh" created="Sat, 10 Sep 2011 21:08:35 +0000"/>
                            <attachment id="12458242" name="HIVE-1694_2010-10-28.diff" size="188724" author="nikhail" created="Thu, 28 Oct 2010 11:24:26 +0000"/>
                            <attachment id="12458243" name="demo_q1.hql" size="521" author="nikhail" created="Thu, 28 Oct 2010 11:26:17 +0000"/>
                            <attachment id="12458244" name="demo_q2.hql" size="1806" author="nikhail" created="Thu, 28 Oct 2010 11:26:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Oct 2010 19:39:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59954</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 42 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i010ef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3830</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1695] MapJoin followed by ReduceSink should be done as single MapReduce Job</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1695</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently MapJoin followed by ReduceSink runs as two MapReduce jobs : One map only job followed by a Map-Reduce job. It can be combined into single MapReduce Job.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12476659">HIVE-1695</key>
            <summary>MapJoin followed by ReduceSink should be done as single MapReduce Job</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="sreekanth">Sreekanth Ramakrishnan</assignee>
                                    <reporter username="amareshwari">Amareshwari Sriramadasu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Oct 2010 11:44:24 +0000</created>
                <updated>Mon, 14 Jan 2013 00:50:05 +0000</updated>
                            <resolved>Fri, 14 Dec 2012 07:41:04 +0000</resolved>
                                                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="12918603" author="namit" created="Wed, 6 Oct 2010 17:28:38 +0000"  >&lt;p&gt;This would be a very useful optimization&lt;/p&gt;</comment>
                            <comment id="12918607" author="jsensarma" created="Wed, 6 Oct 2010 17:44:31 +0000"  >&lt;p&gt;i think there&apos;s already a jira for this&lt;/p&gt;</comment>
                            <comment id="12964676" author="sreekanth" created="Mon, 29 Nov 2010 10:20:49 +0000"  >&lt;p&gt;Current processing of the jobs with MapJoin followed by the Reduce sink happens in two stages.&lt;/p&gt;

&lt;p&gt;Stage-1 : Mapjoin + Select operator is split into one single stage. This stage the plan is split when the select operator is encountered immediately after the MapJoin. A file Sink Operator is added immediately after the Mapjoin and the select operator is removed from the tree.&lt;/p&gt;

&lt;p&gt;Stage-2: Mapjoin + Reduce Sink processor. This stage the work is initialized from the previous stage by looking at the output from the FileSinkOperator and then uses this as input for current stage and select operator is added for the column to be used in the reduce stage along with ordering and other information.&lt;/p&gt;

&lt;p&gt;In order to collapse the two stage into a single stage we would need to do the following:&lt;/p&gt;

&lt;p&gt;After Stage-1 processing is done, i.e. after the NodeProcessor from MapJoinFactory.MapJoin is run and the next stage NodeProcessor is called, we need to:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;In GenMRRedSink4, access the current MapJoin Operator. Remove the FileSinkOperator which is added to mark the end of stage.&lt;/li&gt;
	&lt;li&gt;Add Reduce operator to the same to pass the expression and the sort order to be used by the reducer.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thoughts on the above approach? &lt;/p&gt;

&lt;p&gt;Plus, by adding the reduce operator at the end of the MapJoin would it cause any regressions? Is there a cleaner way of doing the same i.e by adding a new rule for processing?&lt;/p&gt;</comment>
                            <comment id="12965652" author="sreekanth" created="Wed, 1 Dec 2010 10:32:44 +0000"  >&lt;p&gt;Attaching a sample plan based on the above approach&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_TABREF test a) (TOK_TABREF test1 b) (= (. (TOK_TABLE_OR_COL a) key) (. (TOK_TABLE_OR_COL b) key)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_HINTLIST (TOK_HINT TOK_MAPJOIN (TOK_HINTARGLIST b))) (TOK_SELEXPR (. (TOK_TABLE_OR_COL a) key))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (. (TOK_TABLE_OR_COL a) key)))))

STAGE DEPENDENCIES:
  Stage-4 is a root stage
  Stage-1 depends on stages: Stage-4
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-4
    Map Reduce Local Work
      Alias -&amp;gt; Map Local Tables:
        b 
          Fetch Operator
            limit: -1
      Alias -&amp;gt; Map Local Operator Tree:
        b 
          TableScan
            alias: b
            HashTable Sink Operator
              condition expressions:
                0 {key}
                1 
              handleSkewJoin: false
              keys:
                0 [Column[key]]
                1 [Column[key]]
              Position of Big Table: 0

  Stage: Stage-1
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        a 
          TableScan
            alias: a
            Map Join Operator
              condition map:
                   Inner Join 0 to 1
              condition expressions:
                0 {key}
                1 
              handleSkewJoin: false
              keys:
                0 [Column[key]]
                1 [Column[key]]
              outputColumnNames: _col0
              Position of Big Table: 0
              Reduce Output Operator
                key expressions:
                      expr: _col0
                      type: int
                sort order: +
                tag: -1
                value expressions:
                      expr: _col0
                      type: int
      Local Work:
        Map Reduce Local Work
      Reduce Operator Tree:
        Extract
          File Output Operator
            compressed: false
            GlobalTableId: 0
            table:
                input format: org.apache.hadoop.mapred.TextInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat

  Stage: Stage-0
    Fetch Operator
      limit: -1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently, trying to fix the issue in the map failure due to the above plan. Stil figuring out how to add a Select Operator at the end of the map join operator.&lt;/p&gt;</comment>
                            <comment id="12965892" author="he yongqiang" created="Wed, 1 Dec 2010 22:34:54 +0000"  >&lt;p&gt;To be accurate,  MapJoin followed by ReduceSink followed by GroupBy should be in a one mapreduce job.&lt;/p&gt;

&lt;p&gt;So at some point (like processing MapJoin%SEL), we know this mapjoin is followed by a reducesink. &lt;br/&gt;
And at that point if we know the reduce sink is for a group by, then we can just try to skip the work splitting the task.&lt;/p&gt;

&lt;p&gt;would that be easier?&lt;/p&gt;</comment>
                            <comment id="12966044" author="sreekanth" created="Thu, 2 Dec 2010 09:57:00 +0000"  >&lt;p&gt;The initial thought of mine was to change the processing of MapJoin followed by select operator. But there was comment in MapJoinFactory class which stated that, while walking down the node stack, we only process the current element or its parent and leave children process to the child processor code.&lt;/p&gt;

&lt;p&gt;Is it ok to remove the MapJoin%Sel and change the processing in MapJoin%RS to make it clearer?&lt;/p&gt;

&lt;p&gt;I have handled the group by case, Will be attaching how the Plan look like in next comment.&lt;/p&gt;</comment>
                            <comment id="12966046" author="sreekanth" created="Thu, 2 Dec 2010 10:06:03 +0000"  >&lt;p&gt;Group By operator Plan:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_TABREF test a) (TOK_TABREF test1 b) (= (. (TOK_TABLE_OR_COL a) key) (. (TOK_TABLE_OR_COL b) key)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_HINTLIST (TOK_HINT TOK_MAPJOIN (TOK_HINTARGLIST b))) (TOK_SELEXPR (. (TOK_TABLE_OR_COL a) key))) (TOK_GROUPBY (. (TOK_TABLE_OR_COL a) key))))

STAGE DEPENDENCIES:
  Stage-4 is a root stage
  Stage-1 depends on stages: Stage-4
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-4
    Map Reduce Local Work
      Alias -&amp;gt; Map Local Tables:
        b 
          Fetch Operator
            limit: -1
      Alias -&amp;gt; Map Local Operator Tree:
        b 
          TableScan
            alias: b
            HashTable Sink Operator
              condition expressions:
                0 {key}
                1 
              handleSkewJoin: false
              keys:
                0 [Column[key]]
                1 [Column[key]]
              Position of Big Table: 0

  Stage: Stage-1
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        a 
          TableScan
            alias: a
            Map Join Operator
              condition map:
                   Inner Join 0 to 1
              condition expressions:
                0 {key}
                1 
              handleSkewJoin: false
              keys:
                0 [Column[key]]
                1 [Column[key]]
              outputColumnNames: _col0
              Position of Big Table: 0
              Reduce Output Operator
                key expressions:
                      expr: _col0
                      type: int
                sort order: +
                Map-reduce partition columns:
                      expr: _col0
                      type: int
                tag: -1
      Local Work:
        Map Reduce Local Work
      Reduce Operator Tree:
        Group By Operator
          bucketGroup: false
          keys:
                expr: KEY._col0
                type: int
          mode: mergepartial
          outputColumnNames: _col0
          Select Operator
            expressions:
                  expr: _col0
                  type: int
            outputColumnNames: _col0
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.TextInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat

  Stage: Stage-0
    Fetch Operator
      limit: -1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have successfully got group by and order by working with new NodeProcessor Which I implemented, cross checked it with the results from before and after the plan alterations were done.&lt;/p&gt;</comment>
                            <comment id="12966227" author="he yongqiang" created="Thu, 2 Dec 2010 18:40:58 +0000"  >&lt;p&gt;The approach sounds good. (Or you can keep MapJoin%Sel and do sth inside it.)&lt;/p&gt;</comment>
                            <comment id="12966247" author="jsensarma" created="Thu, 2 Dec 2010 19:48:33 +0000"  >&lt;p&gt;couple of things to watch out for:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;mapjoin uses a lot of memory on the mapper. i am not sure how the memory setting are controlled - but we need to make sure that the map-join and the sort (imposed by the reducesink) don&apos;t blow through the task heap limits. In case the RS is coming because of group by - the map side hash aggregation will also use memory.&lt;/li&gt;
	&lt;li&gt;the stuff that liyin has been working on converts regular joins into map joins automatically. i believe he generates several plans (map-join and sort-merge join) and chooses from one of them at runtime. will the technique discussed here apply to map-join plans generated by auto-map-joins? (i am not sure - so asking)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12968683" author="sreekanth" created="Tue, 7 Dec 2010 11:11:31 +0000"  >&lt;p&gt;Attaching initial version of the patch. Patch currently does not have unit tests. I have manually tested some queries with mapjoin and order by, group by and filter operator code. All of the above three seems passes.&lt;/p&gt;

&lt;p&gt;The code changes which I have seems to be final. I have not removed the current NodeProcessor Code, instead added a new file. This way the review of the core logic can be easier. I will be removing the same and uploading a patch once the approach in the code seems fine along with unit test case.&lt;/p&gt;


&lt;p&gt;The code currently does not cover the case of joins being converted to mapjoins automatically as done in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1642&quot; title=&quot;Convert join queries to map-join based on size of table/row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1642&quot;&gt;&lt;del&gt;HIVE-1642&lt;/del&gt;&lt;/a&gt;. Should we address that in this issue or as a separate issue?&lt;/p&gt;</comment>
                            <comment id="12969294" author="sreekanth" created="Wed, 8 Dec 2010 12:58:48 +0000"  >&lt;p&gt;Found an issue with the current patch with respect to move operator. Will be uploading a new patch alongwith the test case modification, soon.&lt;/p&gt;</comment>
                            <comment id="12970792" author="sreekanth" created="Mon, 13 Dec 2010 12:15:36 +0000"  >&lt;p&gt;Attaching a patch which fixes the test case to include the plan changes which are required in this new case.&lt;/p&gt;
</comment>
                            <comment id="12971166" author="sreekanth" created="Tue, 14 Dec 2010 04:52:03 +0000"  >&lt;p&gt;Ran test case, TestParse failed and checked it. it seems to be an xml Decoder issue.&lt;/p&gt;

&lt;p&gt;The diff&apos;s of faliures seems to be of following types:&lt;br/&gt;
Original:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;void property=&quot;mode&quot;&amp;gt; 
&amp;lt;object class=&quot;org.apache.hadoop.hive.ql.udf.generic.GenericUDAFEvaluator$Mode&quot; method=&quot;valueOf&quot;&amp;gt; 
&amp;lt;string&amp;gt;PARTIAL1&amp;lt;/string&amp;gt; 
&amp;lt;/object&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;test case output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;void property=&quot;mode&quot;&amp;gt;
&amp;lt;object class=&quot;java.lang.Enum&quot; method=&quot;valueOf&quot;&amp;gt;
&amp;lt;class&amp;gt;org.apache.hadoop.hive.ql.udf.generic.GenericUDAFEvaluator$Mode&amp;lt;/class&amp;gt;
&amp;lt;string&amp;gt;PARTIAL1&amp;lt;/string&amp;gt;
&amp;lt;/object&amp;gt;
&amp;lt;/void&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Marking this patch as available so review can be done.&lt;/p&gt;</comment>
                            <comment id="12971177" author="namit" created="Tue, 14 Dec 2010 07:01:43 +0000"  >&lt;p&gt;Sorry for the delay on responding on this.&lt;/p&gt;

&lt;p&gt;@Sreekanth, after &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1642&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1642&lt;/a&gt;, we are planning to slowly deprecate/ignore the MAPJOIN&lt;br/&gt;
hint, and do all the optimizations at runtime.&lt;/p&gt;

&lt;p&gt;A join followed by group by today will be run as 2 MR jobs, and 1 map-only job followed by 1 MR job if&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1642&quot; title=&quot;Convert join queries to map-join based on size of table/row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1642&quot;&gt;&lt;del&gt;HIVE-1642&lt;/del&gt;&lt;/a&gt; decides to convert the join into a regular join.&lt;br/&gt;
Your approach is certainly more optimal.&lt;/p&gt;

&lt;p&gt;What is your use case ? Are you concerned about the join followed by groupby where the join key is the same as groupby key ?&lt;br/&gt;
Or, are you concerned about a a join followed by any operator which leads to a reduce-sink ?&lt;/p&gt;

&lt;p&gt;As Joy said above, it is very important to carefully tune the memory for the map-join, because the code assumes that there&lt;br/&gt;
is no memory consuming operations going on. The only exception to this rule so far was &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1830&quot; title=&quot;mappers in group followed by joins may die OOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1830&quot;&gt;&lt;del&gt;HIVE-1830&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We should not do any optimizations for map-join, but for general joins which may be converted to joins at runtime.&lt;/p&gt;</comment>
                            <comment id="13532136" author="amareshwari" created="Fri, 14 Dec 2012 07:41:04 +0000"  >&lt;p&gt;Will be fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3784&quot; title=&quot;de-emphasize mapjoin hint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3784&quot;&gt;&lt;del&gt;HIVE-3784&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13550048" author="ashutoshc" created="Thu, 10 Jan 2013 19:53:10 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12623099">HIVE-3784</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12466132" name="hive-1695-1.patch" size="96338" author="sreekanth" created="Mon, 13 Dec 2010 12:15:35 +0000"/>
                            <attachment id="12465686" name="hive-1695.patch" size="10168" author="sreekanth" created="Tue, 7 Dec 2010 11:11:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 6 Oct 2010 17:28:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08njj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48413</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1696] Add delegation token support to metastore</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1696</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-842&quot; title=&quot;Authentication Infrastructure for Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-842&quot;&gt;&lt;del&gt;HIVE-842&lt;/del&gt;&lt;/a&gt;, kerberos authentication is only sufficient for authentication of a hive user client to the metastore. There are other cases where thrift calls need to be authenticated when the caller is running in an environment without kerberos credentials. For example, an MR task running as part of a hive job may want to report statistics to the metastore, or a job may be running within the context of Oozie or Hive Server.&lt;/p&gt;

&lt;p&gt;This JIRA is to implement support of delegation tokens for the metastore. The concept of a delegation token is borrowed from the Hadoop security design - the quick summary is that a kerberos-authenticated client may retrieve a binary token from the server. This token can then be passed to other clients which can use it to achieve authentication as the original user in lieu of a kerberos ticket.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12476697">HIVE-1696</key>
            <summary>Add delegation token support to metastore</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21146&amp;avatarType=issuetype">Sub-task</type>
                            <parent id="12436081">HIVE-842</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="devaraj">Devaraj Das</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Oct 2010 18:10:46 +0000</created>
                <updated>Thu, 5 Jul 2018 15:46:48 +0000</updated>
                            <resolved>Wed, 19 Jan 2011 17:28:41 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Authentication</component>
                    <component>Metastore</component>
                    <component>Security</component>
                    <component>Server Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="12918615" author="tlipcon" created="Wed, 6 Oct 2010 18:17:14 +0000"  >&lt;p&gt;A few of us had a phone call this morning. We briefly discussed a design for this, summarized below:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The metastore should make use of the delegation token facilities in Hadoop Common. The classes in Common are already generic since they&apos;re used by both MR and HDFS for their delegation token types.&lt;/li&gt;
	&lt;li&gt;The metastore needs to keep track of active delegation tokens across restarts - it probably makes sense to use the existing DB backing store for this.&lt;/li&gt;
	&lt;li&gt;The metastore thrift API will need a new call, something like: &lt;tt&gt;binary getDelegationToken(1: string renewer)&lt;/tt&gt; which returns the opaque token.&lt;/li&gt;
	&lt;li&gt;We&apos;ll need to make some changes to HadoopThriftAuthBridge from &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-842&quot; title=&quot;Authentication Infrastructure for Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-842&quot;&gt;&lt;del&gt;HIVE-842&lt;/del&gt;&lt;/a&gt; in order to support using a delegation token over SASL.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In terms of the use cases above, here are some thoughts on how the delegation tokens will be used:&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;MRtasksreportingstatistics&quot;&gt;&lt;/a&gt;MR tasks reporting statistics&lt;/h3&gt;

&lt;p&gt;When a hive job is submitted, it will first obtain a DT from the hive metastore. This DT will be passed with the job, either as a private distributedcache file, or maybe base64-encoded in the jobconf itself. The MR tasks themselves will then load the token into the UGI before making calls. This is basically the pattern that normal hadoop MR jobs use to access HDFS from within a task.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;OozieorHiveServerjobs&quot;&gt;&lt;/a&gt;Oozie or Hive Server jobs&lt;/h3&gt;

&lt;p&gt;Before Oozie or Hive Server forks the child process which actually runs the job, it will need to obtain a delegation token from the metastore on behalf of the user running the job. It will then provide this to the child process using an environment variable or configuration property. In this case, Oozie or the Hive Server needs to be configured as a &quot;proxy superuser&quot; on the metastore - ie the oozie/_HOST or hiveserver/_HOST principal is allowed to impersonate other users in order to grab delegation tokens for them.&lt;/p&gt;</comment>
                            <comment id="12970307" author="ashutoshc" created="Fri, 10 Dec 2010 20:58:32 +0000"  >&lt;p&gt;This builds on top of current &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-842&quot; title=&quot;Authentication Infrastructure for Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-842&quot;&gt;&lt;del&gt;HIVE-842&lt;/del&gt;&lt;/a&gt; patch. Adds delegation token support for Hive.&lt;/p&gt;</comment>
                            <comment id="12971936" author="devaraj" created="Thu, 16 Dec 2010 01:57:38 +0000"  >&lt;p&gt;I did a walk-thru of the patch. Looks good mostly. One comment I have is that the server should check delegation-token issue/renewal are allowed for kerberos-authenticated users only. This is what is done in the cases of HDFS/MAPREDUCE delegation tokens.&lt;/p&gt;</comment>
                            <comment id="12971993" author="ashutoshc" created="Thu, 16 Dec 2010 08:01:48 +0000"  >&lt;p&gt;Devraj,&lt;/p&gt;

&lt;p&gt;Thanks for the review. I will incorporate those changes and will generate a new patch.&lt;/p&gt;</comment>
                            <comment id="12972171" author="devaraj" created="Thu, 16 Dec 2010 18:15:09 +0000"  >&lt;p&gt;Upon a bit more thought, it seems to me that we don&apos;t actually need the DelegationTokenManager shim. Since the delegation token stuff is part of Hadoop 20S, we might as well merge these classes/methods in the 20S shim...&lt;/p&gt;</comment>
                            <comment id="12972348" author="ashutoshc" created="Fri, 17 Dec 2010 03:19:38 +0000"  >&lt;p&gt;New patches (with and without thrift).&lt;/p&gt;

&lt;p&gt;Devraj,&lt;br/&gt;
This includes both of your suggestions.  Can you take a look again ?&lt;/p&gt;</comment>
                            <comment id="12972544" author="ashutoshc" created="Fri, 17 Dec 2010 16:55:27 +0000"  >&lt;p&gt;Yongqiang,&lt;/p&gt;

&lt;p&gt;Can you take a look?  We have been testing it for a month in our test cluster. This patch is ready to go in.&lt;/p&gt;</comment>
                            <comment id="12972554" author="devaraj" created="Fri, 17 Dec 2010 17:35:24 +0000"  >&lt;p&gt;The patch looks fine to me.&lt;/p&gt;</comment>
                            <comment id="12973799" author="devaraj" created="Tue, 21 Dec 2010 18:28:04 +0000"  >&lt;p&gt;Patch with a little bit of refactoring on the previous patch. I also removed the code for checking whether a client is kerberos authenticated in the getDelegationToken and renewDelegationToken methods. That requires some changes in a Hadoop security API to have a cleaner implementation. We can do that in a follow up jira.&lt;/p&gt;</comment>
                            <comment id="12973800" author="devaraj" created="Tue, 21 Dec 2010 18:28:49 +0000"  >&lt;p&gt;This is with the generated code.&lt;/p&gt;</comment>
                            <comment id="12975999" author="devaraj" created="Thu, 30 Dec 2010 09:49:04 +0000"  >&lt;p&gt;Attached patch has a testcase that tests the Hive MetaStore client to MetaStore server communication with SASL on &amp;amp; delegation tokens. The test is run as part of the &quot;test&quot; target at the top level.&lt;/p&gt;</comment>
                            <comment id="12976000" author="devaraj" created="Thu, 30 Dec 2010 09:51:50 +0000"  >&lt;p&gt;Patch with the generated code..&lt;/p&gt;</comment>
                            <comment id="12976912" author="cwsteinbach" created="Mon, 3 Jan 2011 19:48:50 +0000"  >&lt;p&gt;Reviewboard request: &lt;a href=&quot;https://reviews.apache.org/r/198/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/198/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12977977" author="ashutoshc" created="Wed, 5 Jan 2011 21:40:56 +0000"  >&lt;p&gt;Is somebody taking a look at this? Maintaining a separate branch for an uncommitted patch is no fun : (&lt;/p&gt;</comment>
                            <comment id="12978176" author="jvs" created="Thu, 6 Jan 2011 07:00:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-78&quot; title=&quot;Authorization infrastructure for Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-78&quot;&gt;&lt;del&gt;HIVE-78&lt;/del&gt;&lt;/a&gt; (which is really large, and conflicts with this one due to the metastore codegen) has been wending its way through review for quite some time; I think Namit is going to try to get it committed tomorrow, and then we&apos;ll need an update on this one.&lt;/p&gt;

&lt;p&gt;A few comments from me:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-78&quot; title=&quot;Authorization infrastructure for Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-78&quot;&gt;&lt;del&gt;HIVE-78&lt;/del&gt;&lt;/a&gt;&apos;s metastore API additions also references &quot;principal&quot;, but it has a different meaning, so we should find a way to distinguish them.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The new conf variable should be named hive.metastore.token.signature&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In HadoopShims.java, the overload for getTokenStrForm needs Javadoc for the tokenSignature parameter&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12981173" author="devaraj" created="Thu, 13 Jan 2011 08:23:26 +0000"  >&lt;p&gt;I renamed the &quot;principal&quot; to &quot;kerberos_principal&quot; in the thrift calls introduced by this patch. Also this patch has only one getTokenStrForm method in the shim (the implementation of the method already handles what the other method was handling), and i put a detailed javadoc on that.  This patch is without the gen&apos;ed code. Once I get a go-ahead on this patch, I will submit a patch with the gen&apos;ed code. Could this patch be quickly looked at please?&lt;/p&gt;</comment>
                            <comment id="12981175" author="devaraj" created="Thu, 13 Jan 2011 08:30:54 +0000"  >&lt;p&gt;Sorry missed updating the metastore client with the &quot;kerberos&quot; prefix in the &quot;principal name&quot; references. This patch fixes that.&lt;/p&gt;</comment>
                            <comment id="12981577" author="jvs" created="Fri, 14 Jan 2011 00:29:31 +0000"  >&lt;p&gt;Looks fine to me.  Can you post the patch with generated code so I can do some testing?&lt;/p&gt;</comment>
                            <comment id="12981596" author="cwsteinbach" created="Fri, 14 Jan 2011 01:25:00 +0000"  >&lt;p&gt;Devaraj&apos;s patch with generated Thrift code.&lt;/p&gt;</comment>
                            <comment id="12981604" author="devaraj" created="Fri, 14 Jan 2011 01:49:04 +0000"  >&lt;p&gt;Thanks Carl!&lt;br/&gt;
In my earlier patch there was a typo in the testcase, and it was a mistake on my part during the patch generation due to which the typo crept in (due to which the test will fail). I edited Carl&apos;s patch and fixed that.&lt;/p&gt;</comment>
                            <comment id="12981812" author="namit" created="Fri, 14 Jan 2011 16:23:47 +0000"  >&lt;p&gt;Devaraj, I am assuming this is ready for review&lt;/p&gt;</comment>
                            <comment id="12981814" author="devaraj" created="Fri, 14 Jan 2011 16:28:28 +0000"  >&lt;p&gt;Yes, I had forgotten to put it in PA state. Thanks!&lt;/p&gt;</comment>
                            <comment id="12983807" author="namit" created="Wed, 19 Jan 2011 17:28:41 +0000"  >&lt;p&gt;Committed. Thanks Devaraj&lt;/p&gt;</comment>
                            <comment id="12983814" author="devaraj" created="Wed, 19 Jan 2011 17:58:40 +0000"  >&lt;p&gt;For the record, I&apos;d like to mention that Pradeep Kamath did a lot of initial work on the patch. Thanks, Pradeep!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12436081">HIVE-842</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12598632">HIVE-3255</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12953707">HIVE-13363</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12524585">HIVE-2467</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12466745" name="hive-1696-1-with-gen-code.patch" size="388776" author="devaraj" created="Tue, 21 Dec 2010 18:28:49 +0000"/>
                            <attachment id="12466744" name="hive-1696-1.patch" size="53023" author="devaraj" created="Tue, 21 Dec 2010 18:28:04 +0000"/>
                            <attachment id="12467159" name="hive-1696-3-with-gen-code.patch" size="402936" author="devaraj" created="Thu, 30 Dec 2010 09:51:49 +0000"/>
                            <attachment id="12467158" name="hive-1696-3.patch" size="65630" author="devaraj" created="Thu, 30 Dec 2010 09:49:04 +0000"/>
                            <attachment id="12468332" name="hive-1696-4-with-gen-code.1.patch" size="595046" author="devaraj" created="Fri, 14 Jan 2011 01:49:04 +0000"/>
                            <attachment id="12468329" name="hive-1696-4-with-gen-code.patch" size="595041" author="cwsteinbach" created="Fri, 14 Jan 2011 01:24:59 +0000"/>
                            <attachment id="12468233" name="hive-1696-4.patch" size="67267" author="devaraj" created="Thu, 13 Jan 2011 08:30:54 +0000"/>
                            <attachment id="12468232" name="hive-1696-4.patch" size="67203" author="devaraj" created="Thu, 13 Jan 2011 08:23:26 +0000"/>
                            <attachment id="12466440" name="hive_1696.patch" size="266228" author="ashutoshc" created="Fri, 17 Dec 2010 03:20:22 +0000"/>
                            <attachment id="12466019" name="hive_1696.patch" size="277635" author="ashutoshc" created="Fri, 10 Dec 2010 20:58:32 +0000"/>
                            <attachment id="12466439" name="hive_1696_no-thrift.patch" size="44989" author="ashutoshc" created="Fri, 17 Dec 2010 03:19:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Dec 2010 20:58:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72764</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06ak7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34642</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1697] Migration scripts should increase size of PARAM_VALUE in PARTITION_PARAMS</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1697</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The migration scripts should increase the size of column PARAM_VALUE in the table PARTITION_PARAMS to 4000 chars to follow the description in package.jdo.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12476719">HIVE-1697</key>
            <summary>Migration scripts should increase size of PARAM_VALUE in PARTITION_PARAMS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauly">Paul Yang</assignee>
                                    <reporter username="pauly">Paul Yang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Oct 2010 23:02:06 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:49 +0000</updated>
                            <resolved>Wed, 6 Oct 2010 23:23:43 +0000</resolved>
                                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12918730" author="namit" created="Wed, 6 Oct 2010 23:23:43 +0000"  >&lt;p&gt;Committed in trunk and 0.6 - Thanks Paul&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12467637">HIVE-1427</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12456551" name="HIVE-1697.1.patch" size="1102" author="pauly" created="Wed, 6 Oct 2010 23:03:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 6 Oct 2010 23:23:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72763</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lgfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123314</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1698] Improve error log in HiveInputFormat</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1698</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When newInstance() call fails in getInputFormatFromCache(), the exception isn&apos;t displayed in the log.&lt;/p&gt;

&lt;p&gt;java.io.IOException: Cannot create an instance of InputFormat class org.apache.hadoop.mapred.TextInputFormat as specified in mapredWork!&lt;/p&gt;

&lt;p&gt;It would help debug the issue by including the exception in log, e.g.:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.RuntimeException: Error in configuring object&lt;br/&gt;
        at org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:93)&lt;br/&gt;
        at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:64)&lt;br/&gt;
        at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:117)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.io.HiveInputFormat.getInputFormatFromCache(HiveInputFormat.java:194)&lt;br/&gt;
        ... 19 more&lt;br/&gt;
Caused by: java.lang.reflect.InvocationTargetException&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:88)&lt;br/&gt;
        ... 22 more&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: Compression codec com.hadoop.compression.lzo.LzoCodec not found.&lt;br/&gt;
        at org.apache.hadoop.io.compress.CompressionCodecFactory.getCodecClasses(CompressionCodecFactory.java:96)&lt;br/&gt;
        at org.apache.hadoop.io.compress.CompressionCodecFactory.&amp;lt;init&amp;gt;(CompressionCodecFactory.java:134)&lt;br/&gt;
        at org.apache.hadoop.mapred.TextInputFormat.configure(TextInputFormat.java:41)&lt;br/&gt;
        ... 27 more&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: com.hadoop.compression.lzo.LzoCodec&lt;br/&gt;
        at java.net.URLClassLoader$1.run(URLClassLoader.java:202) &lt;/p&gt;</description>
                <environment></environment>
        <key id="12476904">HIVE-1698</key>
            <summary>Improve error log in HiveInputFormat</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ted_yu">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Oct 2010 22:48:24 +0000</created>
                <updated>Sat, 17 Dec 2011 00:01:02 +0000</updated>
                            <resolved>Fri, 4 Nov 2011 07:22:07 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Server Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13143798" author="ashutoshc" created="Fri, 4 Nov 2011 07:22:08 +0000"  >&lt;p&gt;This got resolved as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1203&quot; title=&quot;HiveInputFormat.getInputFormatFromCache &amp;quot;swallows&amp;quot;  cause exception when throwing IOExcpetion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1203&quot;&gt;&lt;del&gt;HIVE-1203&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Nov 2011 07:22:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42395</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lgg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123315</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1699] incorrect partition pruning ANALYZE TABLE</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1699</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;If table T is partitioned, ANALYZE TABLE T PARTITION (...) COMPUTE STATISTICS; will gather stats for all partitions even though partition spec only chooses a subset. &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12477102">HIVE-1699</key>
            <summary>incorrect partition pruning ANALYZE TABLE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nzhang">Ning Zhang</assignee>
                                    <reporter username="nzhang">Ning Zhang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Oct 2010 06:13:58 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:31 +0000</updated>
                            <resolved>Wed, 13 Oct 2010 16:07:34 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12920341" author="nzhang" created="Tue, 12 Oct 2010 20:56:54 +0000"  >&lt;p&gt;This patch includes the following changes:&lt;/p&gt;

&lt;p&gt;  1) correctly pruning partitions based on the partition specification in ANALYZE TABLE command.&lt;br/&gt;
  2) adding a Hive.getPartitionsByNames() method to get a list of partitions based on their names. Previous we&apos;ll have to use Hive.getPartitions which get all partitions as Partition objects and then filter out partitions that doesn&apos;t satisfy spec. This is very expensive for tables with large number of partitions. This could be further improved by using the partition filtering pushdown feature once it is fully supported. &lt;br/&gt;
  3) Caching the list of partitions in tableSpec so that StatsTask does not need to get the list of partitions again. &lt;br/&gt;
  4) adding a explicit variable tableSpec to indicate its type (TABLE_ONLY, STATIC_PARTITION, DYNAMIC_PARTITION) rather than relying on implicit checking on partHandle. &lt;/p&gt;</comment>
                            <comment id="12920343" author="namit" created="Tue, 12 Oct 2010 21:01:41 +0000"  >&lt;p&gt;@Paul, are you working on optimizing Hive.getPartitionsByNames() by using partition filtering ?&lt;/p&gt;</comment>
                            <comment id="12920360" author="namit" created="Tue, 12 Oct 2010 21:38:58 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12920634" author="namit" created="Wed, 13 Oct 2010 16:07:34 +0000"  >&lt;p&gt;Committed. Thanks Ning&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12457009" name="HIVE-1699.patch" size="88869" author="nzhang" created="Tue, 12 Oct 2010 20:56:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Oct 2010 21:01:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72762</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lggf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123316</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1700] Optimiza JDBM to make mapjoin faster</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1700</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;copied from email:&lt;/p&gt;


&lt;p&gt;From: Joydeep Sen Sarma&lt;br/&gt;
Sent: Tuesday, October 12, 2010 11:11 AM&lt;br/&gt;
To: Yongqiang He; Liyin Tang; Namit Jain&lt;br/&gt;
Subject: RE: Optimize jdbm&lt;/p&gt;

&lt;p&gt;seems like we should move all deserialization to hive land. jdbm should just work on byte arrays for both keys and values. (since the output of the serializer used by hive is byte comparable - that seems to suffice)&lt;br/&gt;
________________________________________&lt;br/&gt;
From: Yongqiang He&lt;br/&gt;
Sent: Tuesday, October 12, 2010 10:22 AM&lt;br/&gt;
To: Liyin Tang; Namit Jain&lt;br/&gt;
Cc: Joydeep Sen Sarma&lt;br/&gt;
Subject: Optimize jdbm&lt;/p&gt;

&lt;p&gt;  1.  Htree.get() cost 70% total time.  It could help a lot if there is bloom filter here to avoid unneeded get() if we know for sure the given key is not in JDBM. (we can generate the bloom filter when doing the jdbm sink, and read into memory when doing read. )&lt;br/&gt;
  2.  HTree.get() will deserialize both key and value until find a matched key. We can only de-serialize the key, and de-serialize the value until  the key match.&lt;/p&gt;

&lt;p&gt;Any others?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477169">HIVE-1700</key>
            <summary>Optimiza JDBM to make mapjoin faster</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="liyin">Liyin Tang</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Oct 2010 18:38:31 +0000</created>
                <updated>Wed, 1 Dec 2010 22:19:38 +0000</updated>
                            <resolved>Wed, 1 Dec 2010 22:19:39 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12920339" author="namit" created="Tue, 12 Oct 2010 20:53:35 +0000"  >&lt;p&gt;Let us break into 2 separate jiras:&lt;/p&gt;

&lt;p&gt;1. HTree.get() will deserialize both key and value until find a matched key. We can only de-serialize the key, and de-serialize the value until the key match.&lt;br/&gt;
seems like we should move all deserialization to hive land. jdbm should just work on byte arrays for both keys and values. (since the output of the serializer used by hive is byte comparable - that seems to suffice)&lt;/p&gt;

&lt;p&gt;2. Htree.get() cost 70% total time. It could help a lot if there is bloom filter here to avoid unneeded get() if we know for sure the given key is not in JDBM. (we can generate the bloom filter when doing the jdbm sink, and read into memory when doing read. )&lt;/p&gt;
</comment>
                            <comment id="12965859" author="boisvert" created="Wed, 1 Dec 2010 21:47:21 +0000"  >&lt;p&gt;Duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1702&quot; title=&quot;optimize JDBM to make mapjoin faster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1702&quot;&gt;&lt;del&gt;HIVE-1702&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12965877" author="liyin" created="Wed, 1 Dec 2010 22:19:38 +0000"  >&lt;p&gt;The JDBM component has been removed from Hive.&lt;br/&gt;
No need to optimize this any more.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12477180">HIVE-1702</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Oct 2010 20:53:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72761</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lggn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123317</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The JDBM component has been removed from Hive.&lt;br/&gt;
No need to optimize this any more.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1701] drop support for pre-0.20 Hadoop versions</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1701</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;As discussed previously on the mailing lists, we&apos;re dropping support for pre-0.20 Hadoop versions starting with Hive 0.7.  This JIRA issue is for deleting the corresponding build and shim implementations.  The shim mechanism itself will be left in place (we already have 0.20 and 0.20S coexisting).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477172">HIVE-1701</key>
            <summary>drop support for pre-0.20 Hadoop versions</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jvs">John Sichi</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Oct 2010 18:56:38 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:17 +0000</updated>
                            <resolved>Wed, 13 Oct 2010 13:33:00 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Build Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12920379" author="jvs" created="Tue, 12 Oct 2010 22:23:49 +0000"  >&lt;p&gt;Note that this patch deletes a lot of files; the committer needs to do the following explicitly:&lt;/p&gt;

&lt;p&gt;cd shims/src&lt;br/&gt;
svn remove 0.17 0.18 0.19&lt;/p&gt;</comment>
                            <comment id="12920389" author="jvs" created="Tue, 12 Oct 2010 22:38:47 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1704&quot; title=&quot;remove Hadoop 0.17 specific test reference logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1704&quot;&gt;&lt;del&gt;HIVE-1704&lt;/del&gt;&lt;/a&gt; as a followup for getting rid of the 0.17 reference logs, which we can do in a separate transaction to minimize conflicts.&lt;/p&gt;</comment>
                            <comment id="12920439" author="nzhang" created="Wed, 13 Oct 2010 04:49:17 +0000"  >&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="12920539" author="nzhang" created="Wed, 13 Oct 2010 13:33:00 +0000"  >&lt;p&gt;Committed. Thanks John!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12477189">HIVE-1705</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12477188">HIVE-1704</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12457021" name="HIVE-1701.1.patch" size="4935" author="jvs" created="Tue, 12 Oct 2010 22:23:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Oct 2010 04:49:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lggv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123318</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1702] optimize JDBM to make mapjoin faster</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1702</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Htree.get() cost 70% total time. It could help a lot if there is bloom filter here to avoid unneeded get() if we know for sure the given key is not in JDBM. (we can generate the bloom filter when doing the jdbm sink, and read into memory when doing read. )&lt;/p&gt;

&lt;p&gt;Copied from &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1700&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1700&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477180">HIVE-1702</key>
            <summary>optimize JDBM to make mapjoin faster</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="liyin">Liyin Tang</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Oct 2010 20:55:00 +0000</created>
                <updated>Tue, 2 Nov 2010 02:16:25 +0000</updated>
                            <resolved>Tue, 2 Nov 2010 02:16:25 +0000</resolved>
                                                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                    <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12477169">HIVE-1700</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72759</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lgh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123319</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>JDBM will be removed from Hive</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1703] BOOL types should implicitly cast to INT</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1703</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;From the Wiki:&lt;br/&gt;
&quot;Otherwise, the operator is probably a UDF/UDAF function. In that case, we will try to convert the parameters to the types that are accepted by the UDF/UDAF function. If the UDF/UDAF function is overloaded (with more than 1 implementations with different types), we will try to find the one with least number of type conversions needed.&quot;&lt;/p&gt;

&lt;p&gt;However,&lt;br/&gt;
SELECT SUM(thing=otherthing) FROM table&lt;br/&gt;
...fails, because thing=otherthing is a bool, and there is no system by which BOOL would convert to INT, as it should. INT is higher precision, so this should always work. Explicit casting, SUM(CAST(thing=otherthing AS INT)) works just fine.&lt;/p&gt;

&lt;p&gt;(yes, in this simple case COUNT(1) WHERE thing=otherthing would do the job, but it serves to illustrate the bug.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477181">HIVE-1703</key>
            <summary>BOOL types should implicitly cast to INT</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="xuefuz">Xuefu Zhang</assignee>
                                    <reporter username="akramer">Adam Kramer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Oct 2010 21:01:37 +0000</created>
                <updated>Tue, 22 Oct 2013 22:19:21 +0000</updated>
                                                                            <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42394</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08p6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48678</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>


<item>
            <title>[HIVE-1704] remove Hadoop 0.17 specific test reference logs</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1704</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;While we were supporting Hadoop 0.17, we introduced a test mechanism to allow for different expected output for different Hadoop versions.  As of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1701&quot; title=&quot;drop support for pre-0.20 Hadoop versions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1701&quot;&gt;&lt;del&gt;HIVE-1701&lt;/del&gt;&lt;/a&gt;, we&apos;re dropping support for pre-0.20 Hadoop versions, so we can delete the *_0.17 files (but keep the test infra mechanism).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477188">HIVE-1704</key>
            <summary>remove Hadoop 0.17 specific test reference logs</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jvs">John Sichi</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Oct 2010 22:29:42 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:53 +0000</updated>
                            <resolved>Fri, 15 Oct 2010 06:15:13 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Testing Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12920383" author="jvs" created="Tue, 12 Oct 2010 22:30:36 +0000"  >&lt;p&gt;Followup for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1701&quot; title=&quot;drop support for pre-0.20 Hadoop versions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1701&quot;&gt;&lt;del&gt;HIVE-1701&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12921131" author="jvs" created="Thu, 14 Oct 2010 21:15:16 +0000"  >&lt;p&gt;Note that this patch just deletes a bunch of files, so you have to do the svn remove manually.&lt;/p&gt;

&lt;p&gt;I used&lt;/p&gt;

&lt;p&gt;svn remove `find . -name &apos;*_0.17&apos;`&lt;br/&gt;
svn diff --no-diff-deleted&lt;/p&gt;

&lt;p&gt;to generate it.&lt;/p&gt;</comment>
                            <comment id="12921160" author="nzhang" created="Thu, 14 Oct 2010 23:08:51 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12921240" author="nzhang" created="Fri, 15 Oct 2010 06:15:13 +0000"  >&lt;p&gt;Committed. Thanks John!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12477172">HIVE-1701</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12457192" name="HIVE-1704.1.patch" size="13314" author="jvs" created="Thu, 14 Oct 2010 21:15:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 Oct 2010 23:08:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72758</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lghb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123320</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>


<item>
            <title>[HIVE-1705] remove pre-0.20 Hadoop tweaks</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1705</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Grepping the code for 0.17, 0.18, and 0.19, there are lots of tweaks which were applied to keep the code compatible with these Hadoop versions.  As of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1701&quot; title=&quot;drop support for pre-0.20 Hadoop versions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1701&quot;&gt;&lt;del&gt;HIVE-1701&lt;/del&gt;&lt;/a&gt;, we&apos;re dropping support for them, so we should clean up by eliminating the tweaks.&lt;/p&gt;

&lt;p&gt;Likewise, we can scrub away any shim interface methods which were only needed for these versions (i.e. most of them).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477189">HIVE-1705</key>
            <summary>remove pre-0.20 Hadoop tweaks</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="appodictic">Edward Capriolo</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Oct 2010 22:45:39 +0000</created>
                <updated>Mon, 14 Feb 2011 21:02:01 +0000</updated>
                                            <version>0.7.0</version>
                                                    <component>Configuration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12920392" author="jvs" created="Tue, 12 Oct 2010 22:46:05 +0000"  >&lt;p&gt;Followup for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1701&quot; title=&quot;drop support for pre-0.20 Hadoop versions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1701&quot;&gt;&lt;del&gt;HIVE-1701&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12920421" author="jvs" created="Wed, 13 Oct 2010 02:51:50 +0000"  >&lt;p&gt;We can also remove the version-specific logic in command-line scripts, e.g.&lt;/p&gt;


&lt;p&gt;  if [ $minor_ver -lt 20 ]; then&lt;br/&gt;
    exec $HADOOP jar $AUX_JARS_CMD_LINE $RUNJAR $RUNCLASS $HIVE_OPTS &quot;$@&quot;&lt;br/&gt;
  else&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;hadoop 20 or newer - skip the aux_jars option and hiveconf&lt;br/&gt;
    exec $HADOOP jar $RUNJAR $RUNCLASS $HIVE_OPTS &quot;$@&quot;&lt;br/&gt;
  fi&lt;/li&gt;
&lt;/ol&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12477172">HIVE-1701</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12473622">HIVE-1623</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42393</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08onr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48594</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>
